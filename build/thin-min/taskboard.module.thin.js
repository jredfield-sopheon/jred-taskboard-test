/*!
 *
 * Bryntum TaskBoard 5.6.2
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
import{Styleable_default as kt}from"./chunks/chunk-VCPKNRNI.js";import{ProjectCombo as ze}from"./chunks/chunk-3VT4LA4Q.js";import{UndoRedoBase as vt}from"./chunks/chunk-2SSW5IKU.js";import"./chunks/chunk-JHLZS7IF.js";import{Slider as Ct}from"./chunks/chunk-CYP557IJ.js";import{Featureable_default as Tt,FilterField as Ae,Responsive_default as wt}from"./chunks/chunk-XMY3DSSV.js";import{AbstractCrudManager as yt,AbstractCrudManagerMixin_default as xt,AbstractCrudManagerValidation_default as St,AjaxTransport_default as Et,AssignmentModel as It,AssignmentModelMixin_default as Dt,AssignmentStore as Bt,AssignmentStoreMixin_default as Mt,CrudManager as _t,CrudManagerView_default as Ne,DependencyBaseModel as $t,DependencyModel as Rt,DependencyStore as Ft,DependencyStoreMixin_default as Ot,EventModel as We,EventModelMixin_default as At,EventStore as Ue,EventStoreMixin_default as Lt,GetEventsMixin_default as Pt,JsonEncoder_default as jt,PartOfProject_default as Ht,ProjectCrudManager_default as Ge,ProjectModel as qe,ProjectModelCommon_default as Vt,ProjectModelMixin_default as zt,ProjectModelTimeZoneMixin_default as Nt,RecurrenceModel as Wt,RecurringEventsMixin_default as Ut,RecurringTimeSpan_default as Gt,RecurringTimeSpansMixin_default as qt,ResourceModel as Kt,ResourceModelMixin_default as Xt,ResourceStore as Zt,ResourceStoreMixin_default as Jt,ResourceTimeRangeModel as Yt,ResourceTimeRangeStore as Qt,TimeRangeModel as es,TimeRangeStore as ts,TimeSpan as ss,TimeZonedDatesMixin_default as as}from"./chunks/chunk-KVD75ID2.js";import{AvatarRendering as Le,ColorField as ns,Draggable_default as Pe,Droppable_default as je}from"./chunks/chunk-4LHHPUQ6.js";import{GridRowModel as os}from"./chunks/chunk-4NB7OJYA.js";import{ArrayHelper as ye,AsyncHelper as rs,Base as M,BrowserHelper as ls,Button as Re,ColorPicker as is,Combo as He,ContextMenuBase as Ke,DomHelper as T,DomSync as F,Editor as Xe,EventHelper as _,Events_default as Ze,Factoryable_default as Je,Field as ds,InstancePlugin as cs,LocaleHelper as us,Model as Ye,ObjectHelper as b,Panel as ms,Pluggable_default as gs,Popup as hs,Rectangle as S,ScrollManager as ps,Scroller as xe,State_default as fs,Store as Qe,StringHelper as x,Tooltip as et,VersionHelper as tt,Widget as Fe,__privateAdd as bs,__privateGet as ks,__privateSet as st,__publicField as i}from"./chunks/chunk-MZVS5JQA.js";var O=class extends cs.mixin(Je){onConfigChange(e){!this.isConfiguring&&!this.isDestroying&&this.client.recompose(),super.onConfigChange(e)}};i(O,"factoryable",{}),i(O,"configurable",{}),O._$name="TaskBoardFeature";var Y=class extends O{initialCompose(){const e=this;e.draggable=vs.new({dragRootElement:e.disabled?null:e.client.bodyWrapElement,dropRootElement:e.client.bodyWrapElement,owner:e,internalListeners:{beforeDragStart:"onBeforeDragStart",dragStart:"onDragStart",thisObj:e}},e.draggable)}doDestroy(){var e;(e=this.draggable)==null||e.destroy(),super.doDestroy()}doDisable(e){super.doDisable(e),this.draggable&&(this.draggable.dragRootElement=e?null:this.client.bodyWrapElement)}movePrev(e){const{columns:s}=this.client;s.move(e,s.getPrev(e))}moveNext(e){const{columns:s}=this.client,t=Math.min(s.indexOf(e)+2,s.count);s.move(e,s.getAt(t))}populateColumnHeaderMenu({items:e,columnRecord:s}){const{client:t}=this,{columns:a,rtl:n}=t;!t.readOnly&&!this.disabled&&(e.moveColumnLeft={text:"L{TaskBoard.moveColumnLeft}",icon:"b-fw-icon b-icon-left",disabled:s===a[n?"last":"first"],weight:200,onItem:()=>this["move"+(n?"Next":"Prev")](s)},e.moveColumnRight={text:"L{TaskBoard.moveColumnRight}",icon:"b-fw-icon b-icon-right",disabled:s===a[n?"first":"last"],weight:300,onItem:()=>this["move"+(n?"Prev":"Next")](s)})}onBeforeDragStart({drag:e,event:s}){return this.client.trigger("beforeColumnDrag",{drag:e,event:s,columnRecord:e.columnRecord})}onDragStart({drag:e,event:s}){return this.client.trigger("columnDragStart",{drag:e,event:s,columnRecord:e.columnRecord})}};i(Y,"$name","ColumnDrag"),i(Y,"type","columnDrag"),i(Y,"pluginConfig",{after:["initialCompose","populateColumnHeaderMenu"]}),Y.initClass();var vs=class extends M.mixin(Pe,je,Ze){static get configurable(){return{dragSelector:".b-taskboard-column-header, .b-taskboard-column-header *",dragItemSelector:".b-taskboard-column-header",draggingItemCls:null,dragProxy:{type:"default",async open(e){const{owner:s}=this,{itemElement:t,startEvent:a,columnRecord:n}=e,o=s.owner.client,r=S.from(t,s.dragRootElement),l=_.getClientPoint(a).getDelta(r),d=T.createElement({className:"b-taskboard-column-drag-proxy",parent:s.dragRootElement,style:{top:r.y,left:_.getClientPoint(a).translate(l[0],0).x,width:t.getBoundingClientRect().width},retainElement:!0}),c=[t,...o.getColumnElements(n)];Object.assign(e,{proxy:d,elements:c,proxyOffset:l}),c.forEach((u,m)=>{const h=u.cloneNode(!0),p=u.getBoundingClientRect();if(u.originalWidth=p.width,u.originalHeight=p.height,u.matches(".b-taskboard-column")){const f=u.closest(".b-taskboard-swimlane"),g=F.getChild(f,"header"),C=F.getChild(f,"body"),k=f.cloneNode(),v=g==null?void 0:g.cloneNode(!0),w=C.cloneNode();let y=f.getBoundingClientRect().height;if(m===c.length-1){const $=T.getStyleValue(u.parentElement,"padding-bottom");y-=parseFloat($)}k.style.flex=`0 0 ${y}px`,v&&k.appendChild(v),w.appendChild(h),k.appendChild(w),d.appendChild(k)}else d.appendChild(h);u.classList.add("b-drag-original")})},dragMove({proxy:e,event:s,proxyOffset:t}){const a=_.getClientPoint(s).translate(t[0],0);e.style.left=`${a.x}px`}}}}setupDragContext(e){const s=super.setupDragContext(e),{client:t}=this.owner;return s.scrollManager=t.scrollManager,s.monitoringConfig={scrollables:[{element:t.bodyElement,direction:"horizontal"}]},s}startDrag(e){return e.columnRecord=this.owner.client.resolveColumnRecord(e.itemElement),super.startDrag(e)}dragStart(e){this.owner.client.suspendResponsiveness(),e.wasStarted=!0}dragEnter(e){if(!e.itemElement.matches(this.dragItemSelector))return!1;e.dropIndicators||(e.dropIndicators=e.elements.map((s,t)=>T.createElement({className:"b-taskboard-column-drop-indicator",elementData:{dropIndicator:!0,element:s},style:{width:s.originalWidth,height:s.originalHeight}})),this.insertDropIndicators(e,e.columnRecord))}insertDropIndicators(e,s){const{client:t}=this.owner,a=t.columns.indexOf(s);e.dropIndicators.forEach((n,o)=>{var r,l;if(o===0){const d=F.getChild(t.bodyElement,"header"),c=[...d.children];ye.remove(c,n),d.insertBefore(n,c[a])}else{const d=(l=(r=t.swimlanes)==null?void 0:r.getAt(o-1))!=null?l:{domId:"default"},c=F.getChild(t.getSwimlaneElement(d),"body"),u=[...c.children];ye.remove(u,n),c.insertBefore(n,u[a])}})}updateValidity(e,s){e.proxy.classList.toggle("b-invalid",!s),e.dropIndicators.forEach(t=>t.classList.toggle("b-invalid",!s)),e.invalid=!s}dragMove(e){var s;const{client:t}=this.owner,a=t.documentRoot,n=S.from(e.proxy,void 0,!0),o=a.elementFromPoint(n.center.x,n.y),r=o==null?void 0:o.closest(".b-taskboard-column-header");if(e.invalid&&(e.valid=!1),!((s=o==null?void 0:o.elementData)!=null&&s.dropIndicator)&&r){const l=S.from(r);let d=t.resolveColumnRecord(r);n.center.x>l.center.x&&(d=t.columns.getNext(d)),this.insertDropIndicators(e,d);const c=e.beforeColumn!==d;if(e.beforeColumn=d,c){const u=t.trigger("columnDrag",{drag:e,columnRecord:e.columnRecord,beforeColumn:d});this.updateValidity(e,u!==!1)}}}async dragDrop(e){const{client:s}=this.owner,{columns:t}=s,{columnRecord:a,beforeColumn:n,elements:o,dropIndicators:r,proxy:l}=e;e.invalid||await s.trigger("beforeColumnDrop",{drag:e,columnRecord:a,beforeColumn:n})===!1?e.valid=!1:e.finalizer=new Promise(d=>{function c(){l.remove(),r.forEach(u=>u.remove()),o.forEach(u=>u.classList.remove("b-drag-original")),s.suspendDomTransition(),n!==void 0&&t.move(a,n),s.resumeDomTransition(),s.trigger("columnDrop",{drag:e,columnRecord:a,beforeColumn:n}),s.trigger("columnDragEnd",{drag:e,columnRecord:a,beforeColumn:n}),s.resumeResponsiveness(),d()}l.classList.add("b-dropping"),T.alignTo(l,S.from(r[0],void 0,!0)),T.getPropertyTransitionDuration(l,"transform")?_.onTransitionEnd({element:l,property:"transform",handler:c,thisObj:s}):c()})}dragLeave(e){}doAbort(e){const{client:s}=this.owner,{dropIndicators:t,proxy:a,columnRecord:n,elements:o}=e;if(a){let r=function(){a.remove(),t.forEach(l=>l.remove()),o.forEach(l=>l.classList.remove("b-drag-original")),s.trigger("columnDragAbortFinalized")};a.classList.add("b-dropping"),t.forEach((l,d)=>{const c=e.elements[d];l.classList.remove("b-invalid"),c.parentElement.insertBefore(l,c)}),T.alignTo(a,S.from(t[0],void 0,!0)),T.getPropertyTransitionDuration(a,"transform")?_.onTransitionEnd({element:a,property:"transform",handler:r,thisObj:s}):r()}s.trigger("columnDragAbort",{drag:e,columnRecord:n}),e.wasStarted&&s.trigger("columnDragEnd",{drag:e,columnRecord:n})}dragEnd(e){(!e.valid||e.aborted)&&this.doAbort(e)}};Y._$name="ColumnDrag";var j=class extends Ke{static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateColumnHeaderMenu","populateColumnHeader","onColumnHeaderClick"),e}changeItems(e){return b.assertObject(e,"features.columnHeaderMenu.items"),e}changeProcessItems(e){return b.assertFunction(e,"features.columnHeaderMenu.processItems"),e}populateColumnHeader({columnHeaderConfig:e}){this.disabled||(e.children.padder.children.menu={tag:"button",class:{"b-column-header-button":1,"b-taskboard-column-header-menu-button":1,"b-fw-icon":1,"b-icon-menu-horizontal":1}})}getDataFromEvent(e){return b.assign(super.getDataFromEvent(e),e.taskBoardData)}populateColumnHeaderMenu({items:e,columnRecord:s}){const{client:t}=this;t.readOnly||(e.addTask={text:"L{TaskBoard.addTask}",icon:"b-fw-icon b-icon-add",weight:100,onItem(){t.addTask(s)}})}onColumnHeaderClick(e){const{event:s}=e;s.target.matches(".b-column-header-button")&&this.showContextMenu(s,{target:s.target,align:"t90-b90"})}doDisable(e){super.doDisable(e),!this.isConfiguring&&this.client.recompose()}get showMenu(){return!0}};i(j,"$name","ColumnHeaderMenu"),i(j,"type","columnHeaderMenu"),i(j,"configurable",{processItems:null,items:null,menu:{anchor:!0},type:"columnHeader",triggerEvent:!1}),O.register(j.type,j),j._$name="ColumnHeaderMenu";var H=class extends O{constructor(){super(...arguments),i(this,"columnMap",new Map)}doDestroy(){for(const[,e]of this.columnMap)e.destroy();super.doDestroy()}changeTopItems(e){return b.assertObject(e,"features.columnToolbars.topItems"),e}changeBottomItems(e){return b.assertObject(e,"features.columnToolbars.bottomItems"),e}changeProcessItems(e){return b.assertFunction(e,"features.columnToolbars.processItems"),e}getToolbar(e,s,t){var a,n;const o=this,{columnMap:r,client:l,namedItems:d}=o,c=o[`${e}Items`],u=`${e}_._${s.domId}_._${(a=t==null?void 0:t.domId)!=null?a:"default"}`;let m=r.get(u);if(!m){const h={};if(b.getTruthyKeys(c).map(p=>{const f=d[p],g=c[p];h[p]=b.merge({internalListeners:{click:"onClick",change:"onChange",thisObj:o},columnRecord:s,swimlaneRecord:t},f,g)}),((n=o.processItems)==null?void 0:n.call(o,{items:h,location:e,columnRecord:s,swimlaneRecord:t}))===!1)return null;m=l.add({type:"toolbar",cls:`b-taskboard-column-${e[0]}bar`,overflow:null,monitorResize:!1,contentElMutationObserver:!1,items:h,dataset:{role:`${e}-toolbar`,domTransition:!0}}),r.set(u,m)}return m.element}populateColumn({columnConfig:e,columnRecord:s,swimlaneRecord:t}){const a=this;a.disabled||(b.getTruthyKeys(a.topItems).length&&T.merge(e,{children:{"tbar > body":a.getToolbar("top",s,t)}}),b.getTruthyKeys(a.bottomItems).length&&(e.children.bbar=a.getToolbar("bottom",s,t)))}removeColumnToolbar(e,s,t){const{columnMap:a,client:n}=this,o=`${e}_._${s}_._${t}`,r=a.get(o);r&&(n.remove(r),n.setTimeout(()=>r.destroy(),0),a.delete(o))}removeColumnToolbars(e,s){this.removeColumnToolbar("top",e,s),this.removeColumnToolbar("bottom",e,s)}onRemoveColumnElement({columnId:e,swimlaneRecord:s}){var t;this.removeColumnToolbars(e,(t=s.id)!=null?t:"default")}onRemoveSwimlaneElement({swimlaneId:e}){for(const s of this.client.columns)this.removeColumnToolbars(s.id,e)}onAddClick({source:e}){this.client.addTask(e.columnRecord,e.swimlaneRecord)}onChange({source:e}){this.trigger("itemChange",{item:e,columnRecord:e.columnRecord,swimlaneRecord:e.swimlaneRecord})}onClick({source:e}){this.trigger("itemClick",{item:e,columnRecord:e.columnRecord,swimlaneRecord:e.swimlaneRecord})}};i(H,"$name","ColumnToolbars"),i(H,"type","columnToolbars"),i(H,"configurable",{topItems:null,bottomItems:{addTask:!0},namedItems:{addTask:{type:"button",icon:"b-icon-add",tooltip:"L{TaskBoard.addTask}",ariaLabel:"L{TaskBoard.addTask}",internalListeners:{click:"onAddClick"}}},processItems:null}),i(H,"pluginConfig",{chain:["populateColumn","onRemoveColumnElement","onRemoveSwimlaneElement"]}),H.initClass(),H._$name="ColumnToolbars";var D=class extends M.mixin(Je){static getEditorConfig({config:e,item:s}){const t=e.editor!==null&&(e.editor||s.defaultEditor);return typeof t=="string"?{type:t}:t}};i(D,"factoryable",{}),i(D,"configurable",{}),i(D,"defaultEditor",{type:"text"}),D._$name="TaskItem";var Cs={editNext:1,cancel:1,editPrevious:1,complete:1},V=class extends O{changeAddNewAtEnd(e){return b.assertBoolean(e,"features.simpleTaskEdit.addNewAtEnd"),e}editTask(e,s){const t=this,a=t.client;s||(s=a.getTaskElement(e));const n=a.resolveTaskItem(s),o=n.element,r=D.getEditorConfig(n);if(!r)return!1;if(t.disabled||e.readOnly||a.trigger("beforeSimpleTaskEdit",{simpleTaskEdit:t,taskRecord:e,field:n.config.field})===!1)return!0;s.focus();const l=t.editor=Xe.new({owner:a,appendTo:o.parentNode,scrollAction:"realign",cls:"b-simple-task-editor",completeKey:null,cancelKey:null,inputField:{autoSelect:!0,name:n.config.field,...r},align:{align:"c-c",allowTargetOut:!1},internalListeners:{complete:"onEditorComplete",cancel:"onEditorCancel",finishEdit:"onEditorFinishEdit",thisObj:t}},t.editorConfig);t.currentElement=o,o.classList.add("b-editing");const d=T.getStyleValue(o,"color");return l.element.style.color=d,l.inputField.element.style.color=d,l.element.retainElement=!0,a.getTaskElement(e).scrollIntoView({block:"nearest"}),o.scrollIntoView({block:"nearest"}),l.startEdit({target:n.element,record:e,field:n.config.field}),!0}async editPrevious(e){const s=this,{client:t,editor:a}=s,n=a.record,o=t.getTaskElement(n),r=Array.from(o.querySelectorAll(".b-taskboard-taskitem.b-editable")),l=r.indexOf(s.currentElement)-1;if(await s.complete(e))if(l>=0)s.editTask(n,r[l]);else{const d=t.getPreviousTask(n,!1);if(d){const c=t.getTaskElement(d),u=Array.from(c.querySelectorAll(".b-taskboard-taskitem.b-editable"));s.editTask(d,u[u.length-1])}}}async editNext(e){const s=this,{client:t,editor:a}=s,n=a.record,o=t.getTaskElement(n),r=Array.from(o.querySelectorAll(".b-taskboard-taskitem.b-editable")),l=r.indexOf(s.currentElement)+1;if(await s.complete(e))if(l<r.length)s.editTask(n,r[l]);else{const d=t.getNextTask(n,!1);d?s.editTask(d):s.addNewAtEnd&&t.addTask(t.getColumn(n),t.getSwimlane(n))}}complete(e){return this.editor.completeEdit(null,e)}cancel(e){this.editor.cancelEdit(e)}onActivateTask({taskRecord:e,event:s}){this.editTask(e,s.target)&&s.preventDefault()}onEditorComplete({source:e}){this.client.trigger("simpleTaskEditComplete",{simpleTaskEdit:this,taskRecord:e.record,field:e.dataField})}onEditorCancel({source:e}){this.client.trigger("simpleTaskEditCancel",{simpleTaskEdit:this,taskRecord:e.record,field:e.dataField})}onEditorFinishEdit(){const e=this,{editor:s}=e;s==null||s.setTimeout(()=>{e.editor===s&&(e.currentElement=null,e.editor=null),s.destroy()},0)}isActionAvailable({actionName:e}){if(Cs[e])return!!this.editor}};i(V,"$name","SimpleTaskEdit"),i(V,"type","simpleTaskEdit"),i(V,"configurable",{addNewAtEnd:!0,editorConfig:{},keyMap:{Enter:"editNext",Escape:"cancel","Ctrl+Enter":"complete","Shift+Enter":"editPrevious"}}),i(V,"pluginConfig",{assign:["editTask"],before:["onActivateTask"]}),V.initClass(),V._$name="SimpleTaskEdit";var Q=class extends O{initialCompose(){const e=this;e.draggable=Ts.new({dragRootElement:e.disabled?null:e.client.bodyWrapElement,dropRootElement:e.client.bodyWrapElement,owner:e},e.draggable)}doDisable(e){super.doDisable(e),this.draggable&&(this.draggable.dragRootElement=e?null:this.client.bodyWrapElement)}};i(Q,"$name","SwimlaneDrag"),i(Q,"type","swimlaneDrag"),i(Q,"pluginConfig",{after:["initialCompose"]}),Q.initClass();var Ts=class extends M.mixin(Pe,je){static get configurable(){return{dragSelector:".b-taskboard-swimlane-header, .b-taskboard-swimlane-header *",dragItemSelector:".b-taskboard-swimlane-header",draggingItemCls:null,dragProxy:{type:"default",async open(e){const{owner:s}=this,{itemElement:t,startEvent:a}=e,n=s.owner.client,o=n.resolveSwimlaneRecord(t),r=n.getSwimlaneElement(o),l=T.getStyleValue(r.syncIdMap.body,["padding-left","padding-right"]),d=S.from(r,s.dragRootElement).deflate(0,parseFloat(l["padding-right"]),0,parseFloat(l["padding-left"])),c=_.getClientPoint(a).getDelta(d),u=T.createElement({className:"b-taskboard-swimlane-drag-proxy",parent:s.dragRootElement,style:{top:_.getClientPoint(a).translate(0,c[1]).y,left:d.x,width:d.width},retainElement:!0});Object.assign(e,{proxy:u,swimlaneRecord:o,swimlaneElement:r,proxyOffset:c,bounds:d});const m=r.cloneNode(!0);u.appendChild(m)},dragMove({proxy:e,event:s,proxyOffset:t}){const a=_.getClientPoint(s).translate(0,t[1]);e.style.top=`${a.y}px`}}}}setupDragContext(e){const s=super.setupDragContext(e),{client:t}=this.owner;return s.scrollManager=t.scrollManager,s.monitoringConfig={scrollables:[{element:t.bodyElement,direction:"vertical"}]},s}dragStart(e){}dragEnter(e){if(!e.itemElement.matches(this.dragItemSelector))return!1;if(!e.dropIndicator){const{bounds:s}=e;e.dropIndicator=T.createElement({className:"b-taskboard-swimlane-drop-indicator",elementData:{dropIndicator:!0},style:{width:s.width,height:s.height}}),this.insertDropIndicator(e.dropIndicator,e.swimlaneRecord),e.swimlaneElement.classList.add("b-drag-original")}}insertDropIndicator(e,s){const{client:t}=this.owner;t.bodyElement.insertBefore(e,s&&t.getSwimlaneElement(s))}async dragMove(e){var s;const{client:t}=this.owner,{documentRoot:a}=t,n=S.from(t.element,void 0,!0),o=S.from(e.proxy,void 0,!0),r=o.center.y>n.bottom?a.elementFromPoint(o.x,o.y):a.elementFromPoint(o.x,o.center.y),l=r==null?void 0:r.closest(".b-taskboard-swimlane");if(!((s=r==null?void 0:r.elementData)!=null&&s.dropIndicator)&&l){const d=S.from(l,void 0,!0);let c=t.resolveSwimlaneRecord(l);o.center.y>d.center.y&&(c=t.swimlanes.getNext(c)),this.insertDropIndicator(e.dropIndicator,c),e.beforeSwimlane=c}}async dragDrop(e){const{client:s}=this.owner,{swimlanes:t}=s,{swimlaneRecord:a,beforeSwimlane:n,swimlaneElement:o,dropIndicator:r,proxy:l}=e;function d(){l.remove(),r.remove(),o.classList.remove("b-drag-original"),n!==void 0&&t.move(a,n),s.trigger("dropSwimlane",{beforeSwimlane:n,drag:e})}l.classList.add("b-dropping"),T.alignTo(l,S.from(r,void 0,!0)),T.getPropertyTransitionDuration(l,"transform")?_.onTransitionEnd({element:l,property:"transform",handler:d,thisObj:s}):d()}dragLeave(e){}};Q._$name="SwimlaneDrag";var at=".b-taskboard-card, .b-taskboard-card-drop-indicator",nt=(e,s=!1)=>T.children(e.parentElement,`.b-taskboard-card${s?":not(.b-drag-original)":""}, .b-first-drop-indicator`).indexOf(e),ws=e=>e.some((s,t)=>s.parentElement!==s.elementData.initialParent||t===0&&nt(s,!0)!==s.elementData.initialIndex),z=class extends O{initialCompose(){const e=this;e.draggable=ys.new({dragRootElement:e.disabled?null:e.client.bodyWrapElement,dropRootElement:e.client.bodyWrapElement,owner:e,[e.dragTouchStartDelay!=null?"dragTouchStartDelay":void 0]:e.dragTouchStartDelay,internalListeners:{beforeDragStart:"onBeforeDragStart",dragStart:"onDragStart",thisObj:e}},e.draggable)}doDestroy(){var e;super.doDestroy(),(e=this.draggable)==null||e.destroy()}doDisable(e){super.doDisable(e),this.draggable&&(this.draggable.dragRootElement=e?null:this.client.bodyWrapElement)}onBeforeDragStart({drag:e,event:s}){return this.client.trigger("beforeTaskDrag",{drag:e,event:s,domEvent:s,taskRecords:e.taskRecords})}onDragStart({drag:e,event:s}){return this.client.trigger("taskDragStart",{drag:e,event:s,domEvent:s,taskRecords:e.taskRecords})}};i(z,"$name","TaskDrag"),i(z,"type","taskDrag"),i(z,"pluginConfig",{after:["initialCompose"]}),i(z,"configurable",{reorderTaskRecords:!1,dragTouchStartDelay:null}),z.initClass();var ys=class extends M.mixin(Pe,je,Ze){static get configurable(){return{dragSelector:".b-taskboard-card:not(.b-readonly)",dragItemSelector:".b-taskboard-card:not(.b-readonly)",dropTargetSelector:".b-taskboardbase",draggingItemCls:null,dragProxy:{type:"default",async open(e){const{itemElement:s,startEvent:t}=e,a=this.owner.owner.client,n=s.closest(".b-taskboard-column"),o=a.resolveTaskRecord(s),r=e.proxy=T.createElement({className:"b-taskboard-drag-proxy "+n.className,role:"presentation",retainElement:!0}),l=[];let d;a.selectedTasks.includes(o)?d=a.selectedTasks.filter(u=>!u.readOnly).sort((u,m)=>u.parentIndex-m.parentIndex):d=[o];const c=d.map(u=>a.getTaskElement(u));Object.assign(e,{taskElements:c,taskHeights:new Map,proxyOffset:_.getClientPoint(t).getDelta(S.from(s,null,!0))}),c.forEach(u=>{var m;const{elementData:h}=u,p=u.cloneNode(!0),f=S.from(u,s);p.style.width=f.width+"px",p.style.height=f.height+"px",e.taskHeights.set(u,f.height),p.style.left=f.x+"px",p.style.top=f.y+"px",p.taskElement=u,p.taskRecord=h.taskRecord,p.originalColor=((m=h.swimlaneRecord)==null?void 0:m.color)||h.columnRecord.color,r.appendChild(p),l.push(p)}),c.forEach(u=>u.classList.add("b-drag-original")),await rs.animationFrame(),l.forEach((u,m)=>{m>0?(u.style.top=30+m*20+"px",u.style.left=40+m*5+"px"):(u.style.top=0,u.style.left=0)})},dragMove({proxy:e,event:s,proxyOffset:t}){const{dragRootElement:a}=this.owner,n=a.getBoundingClientRect(),o=_.getClientPoint(s).translate(t[0]-n.left+a.scrollLeft,t[1]-n.top+a.scrollTop);e.style.top=o.y+"px",e.style.left=o.x+"px"}}}}configureListeners(e){const s=super.configureListeners(e);return s.element=this.owner.client.rootElement,s}setupDragContext(e){const s=super.setupDragContext(e),{client:t}=this.owner;return s.scrollManager=t.scrollManager,s.monitoringConfig={scrollables:[{element:".b-taskboard-column-body",direction:"vertical"},{element:t.bodyElement,direction:"both"}]},s}startDrag(e){const{itemElement:s}=e,t=this.owner.client,a=t.resolveTaskRecord(s);return t.isSelected(a)?e.taskRecords=t.selectedTasks.slice().sort((n,o)=>n.parentIndex-o.parentIndex):e.taskRecords=[a],e.initiatedFrom=a,super.startDrag(e)}dragStart(e){const{client:s}=this.owner,t=e.itemElement;e.wasStarted=!0,e.position="after",e.targetTaskRecord=e.initiatedFrom;for(const a of e.taskRecords)a.instanceMeta(s).dragging=!0;s.bodyWrapElement.appendChild(e.proxy),e.dropIndicators=e.taskElements.map((a,n)=>T.createElement({className:{"b-taskboard-card-drop-indicator":1,"b-first-drop-indicator":n===0},style:{height:e.taskHeights.get(a)},elementData:{dropIndicator:!0,initialParent:a.parentElement,initialIndex:nt(a),taskElement:a},retainElement:!0,nextSibling:t})),s.element.classList.add("b-dragging-task")}dragEnter(e){if(!e.itemElement.matches(this.dragItemSelector))return!1}getFirstVisibleChild(e){for(const s of e.children)if(s.offsetParent)return s}getCardAt(e,s){return this.owner.client.getCardAt(e,s,at)}updateValidity(e,s){e.proxy.classList.toggle("b-invalid",!s),e.dropIndicators.forEach(t=>t.classList.toggle("b-invalid",!s)),e.invalid=!s}dragMove(e){var s,t,a;const n=this,{client:o}=n.owner,{event:r,dropIndicators:l}=e,{clientX:d,clientY:c}=r,u=o.documentRoot.elementFromPoint(d,c),m=F.getChild(u==null?void 0:u.closest(".b-taskboard-column"),"body.inner");if(e.invalid&&(e.valid=!1),!!u&&m){const h=o.resolveSwimlaneRecord(u),p=o.resolveColumnRecord(u),f=p.tasksPerRow||(h==null?void 0:h.tasksPerRow)||o.tasksPerRow;let g=u.closest(at),C=h!==e.targetSwimlane||p!==e.targetColumn;if(e.targetSwimlane=h,e.targetColumn=p,!g){const{cardGap:k}=o,v=S.from(m),w=n.getFirstVisibleChild(m),y=(s=w==null?void 0:w.getBoundingClientRect().top)!=null?s:null;if(f===1)if(y!==null&&c<y)g=w;else{const $=v.center.x,I=n.getCardAt($,c-k),R=n.getCardAt($,c+k);g=I||R}else{const $=o.getColumnWidth(e.targetColumn),I=(v.width-$)/2,R=$/f,E=Math.floor((d-v.left)/R),B=v.left+I+R*(E+.5);if(y!==null&&c<y)g=n.getCardAt(B,y);else{const L=v.center.x,J=n.getCardAt(L-k,c),bt=n.getCardAt(L+k,c);g=J||bt}}}if(!(g!=null&&g.elementData.dropIndicator)){let k=!1;if(g){const v=S.from(g),w=o.resolveTaskRecord(g);f===1&&c<v.center.y||f>1&&d<v.center.x?(e.position!=="before"&&(C=!0),k=g,e.position="before"):(e.position!=="after"&&(C=!0),k=g.nextElementSibling,e.position="after"),w!==e.targetTaskRecord&&(C=!0),e.targetTaskRecord=w}else e.position!=="last"&&(C=!0),e.position="last",e.targetTaskRecord=null;(t=k==null?void 0:k.elementData)!=null&&t.dropIndicator||(k===!1?l.forEach(v=>{m==null||m.appendChild(v)}):l.forEach(v=>{((k==null?void 0:k.parentElement)||m).insertBefore(v,k)}),e.lastCardElement=g)}for(const k of e.proxy.children){if(!k.taskRecord.eventColor){const v=((a=e.targetSwimlane)==null?void 0:a.color)||e.targetColumn.color;k.originalColor&&k.classList.remove(`b-taskboard-color-${k.originalColor}`),v&&(k.originalColor=v,T.isNamedColor(v)?k.classList.add(`b-taskboard-color-${v}`):k.style.color=v)}e.targetSwimlane&&(k.dataset.lane=e.targetSwimlane.id),k.dataset.column=e.targetColumn.id}if(C){const{taskRecords:k,targetTaskRecord:v,position:w}=e,y=o.trigger("taskDrag",{drag:e,taskRecords:k,targetSwimlane:h,targetColumn:p,targetTaskRecord:v,position:w,event:r,domEvent:r});n.updateValidity(e,y!==!1)}}}async dragDrop(e){const s=this,{client:t}=s.owner,{dropIndicators:a,taskRecords:n,targetSwimlane:o,targetColumn:r,targetTaskRecord:l,event:d}=e,c={drag:e,domEvent:d,event:d,taskRecords:n,targetSwimlane:o,targetColumn:r,targetTaskRecord:l};!ws(a)||!r||e.invalid||await t.trigger("beforeTaskDrop",c)===!1?e.valid=!1:e.finalizer=new Promise(m=>{var h;const{columnField:p,swimlaneField:f}=t,{taskStore:g}=t.project,{proxy:C}=e,k=r.tasks,v=o?k==null?void 0:k.filter(R=>R[f]===o.id):k,w=!k;let y;if(!w)if(e.targetTaskRecord){if(e.position==="before")y=l;else if(e.position==="after"){const R=v.indexOf(l);y=(h=v[R+1])!=null?h:null}}else v.length&&(y=null);function $(){var R;if(C.remove(),a.forEach(E=>{const{taskElement:B}=E.elementData;E.parentElement.insertBefore(B,E),E.parentElement.syncIdMap[B.elementData.taskId]=B,B.classList.remove("b-drag-original"),E.remove()}),t.suspendDomTransition(),!w){let E;if(y){const B=v.slice(v.indexOf(y)),L=v[v.indexOf(y)-1];let J;for(L?(J=Math.max(1,Math.round((y.weight-L.weight)/2)),E=L.weight+J):E=Math.max(1,Math.round(y.weight/2));((R=B[0])==null?void 0:R.weight)===E;)J=B[1]?Math.max(1,Math.round((B[1].weight-E)/2)):50,E=B[0].weight=E+J,B.shift()}else E=v.length?v[v.length-1].weight+100:100;n.forEach(B=>{const L={[p]:r.id,weight:E};o&&(L[f]=o.id),t.features.taskDrag.reorderTaskRecords&&y!==void 0&&g.move(B,y),B.set(L)}),!t.features.taskDrag.reorderTaskRecords&&!t.taskSorterFn&&t.project.taskStore.sort()}t.resumeDomTransition(),t.trigger("taskDrop",{drag:e,event:d,taskRecords:n,targetSwimlane:o,targetColumn:r,moveBefore:y,domEvent:d}),t.trigger("taskDragEnd",{drag:e,taskRecords:n,domEvent:d}),t.element.classList.remove("b-dragging-task");for(const E of n)E.instanceMeta(t).dragging=!1;m()}const I=Array.from(C.children);C.classList.add("b-pre-dropping"),I[0].offsetWidth,C.classList.add("b-dropping"),I.forEach((R,E)=>{const B=a[E];T.alignTo(R,S.from(B,void 0,!0))}),T.getPropertyTransitionDuration(I[0],"transform")?_.onTransitionEnd({element:I[0],property:"transform",handler:$,thisObj:t}):$()})}dragLeave(e){e.dropIndicators.forEach(s=>{const{taskElement:t}=s.elementData;t.parentElement.insertBefore(s,t)})}doAbort(e){const{client:s}=this.owner,{dropIndicators:t,proxy:a,taskRecords:n}=e;if(a){let o=function(){a.remove(),t.forEach(l=>{l.elementData.taskElement.classList.remove("b-drag-original"),l.remove()}),s.element.classList.remove("b-dragging-task");for(const l of n)l.instanceMeta(s).dragging=!1;s.trigger("taskDragAbortFinalized")};const r=Array.from(a.children);a.classList.add("b-dropping"),t.forEach(l=>{const{taskElement:d}=l.elementData;l.classList.remove("b-invalid"),d.parentElement.insertBefore(l,d)}),r.forEach((l,d)=>{T.alignTo(l,S.from(t[d],void 0,!0))}),T.getPropertyTransitionDuration(r[0],"transform")?_.onTransitionEnd({element:r[0],property:"transform",handler:o,thisObj:s}):o()}s.trigger("taskDragAbort",{drag:e,taskRecords:n}),e.wasStarted&&s.trigger("taskDragEnd",{drag:e,taskRecords:n})}dragEnd(e){(e.started||e.wasStarted)&&(!e.valid||e.aborted)&&this.doAbort(e)}};z._$name="TaskDrag";var N=class extends O{constructor(){super(...arguments),i(this,"state","idle")}changeDragThreshold(e){return b.assertNumber(e,"features.taskDragSelect.dragThreshold"),e}initializeDragSelect(e){const s=this,{client:t}=s;s.bounds=S.from(t.bodyElement,!0),s.element=T.createElement({tag:"div",className:"b-dragselect-rect"},{returnAll:!0})[0],t.floatRoot.appendChild(s.element),t.element.classList.add("b-dragselecting");const a=Array.from(t.element.querySelectorAll(".b-taskboard-card:not(.b-dragging-item)"));s.cardRectangles=a.flatMap(n=>{const o=t.resolveTaskRecord(n);return o?{rectangle:S.from(n,!0),record:o}:[]}),e.ctrlKey||t.deselectAll(),t.navigateable=!1,s.state="selecting"}updateSelection(){const{cardRectangles:e,rectangle:s,client:t}=this;for(let a=0,n=e.length;a<n;a++){const o=e[a],r=s.intersect(o.rectangle,!0);r&&!o.selected?(o.selected=!0,t.selectTask(o.record,!0)):!r&&o.selected&&(o.selected=!1,t.deselectTask(o.record))}}onColumnMouseDown({event:e}){const s=this;!s.disabled&&e.button===0&&(s.state="considering",s.startX=e.clientX,s.startY=e.clientY,s.mouseUpDetacher=_.on({element:document,mouseup:"onMouseUp",thisObj:s}))}onMouseMove({event:e}){const s=this,{startX:t,startY:a}=s,{clientX:n,clientY:o}=e;if(s.state==="considering"){const r=Math.abs(n-t),l=Math.abs(o-a);(r>s.dragThreshold||l>s.dragThreshold)&&s.initializeDragSelect(e)}if(s.state==="selecting"){const{element:r,bounds:l}=s,d=Math.max(n,l.left),c=Math.max(o,l.top),u=Math.min(t,d),m=Math.min(a,c),h=Math.abs(t-d),p=Math.abs(a-c),f=new S(u,m,h,p).constrainTo(l);T.setTranslateXY(r,f.left,f.top),r.style.width=f.width+"px",r.style.height=f.height+"px",s.rectangle=f,s.updateSelection()}}onMouseUp(){var e,s;const t=this,{client:a,state:n}=t;n==="selecting"&&((e=t.element)==null||e.remove(),a.element.classList.remove("b-dragselecting"),a.setTimeout(()=>a.navigateable=!0,100)),(n==="selecting"||n==="considering")&&(t.state="idle",t.startX=t.startY=t.rectangle=t.bounds=null),(s=t.mouseUpDetacher)==null||s.call(t)}};i(N,"$name","TaskDragSelect"),i(N,"type","taskDragSelect"),i(N,"configurable",{dragThreshold:5}),i(N,"pluginConfig",{chain:["onColumnMouseDown","onMouseMove"]}),N.initClass(),N._$name="TaskDragSelect";var A=e=>{var s;return s=class extends(e||M){get taskBoard(){return this._taskBoard||this.up(t=>t.isTaskBoardBase)||Fe.query(t=>t.isTaskBoardBase)}changeTaskBoard(t){if(t&&!t.isTaskBoard)throw new Error("The taskBoard config only accepts an instance of TaskBoard or a subclass thereof");return t}},i(s,"$name","TaskBoardLinked"),i(s,"configurable",{taskBoard:null}),s},W=class extends He.mixin(A){afterConstruct(){!this.showBoxForNoColor&&!this.value&&this.element.classList.add("b-colorless")}syncInputFieldValue(...e){const s=this,{color:t}=s.record||{};let a="b-colorbox";t&&(T.isNamedColor(t)?a+=` b-taskboard-color-${t}`:s.colorBox.style.color=t),s.colorBox.className=a,s.showBoxForNoColor||s.element.classList.toggle("b-colorless",!t),super.syncInputFieldValue(...e)}get innerElements(){return[{reference:"colorBox",className:"b-colorbox"},...super.innerElements]}};i(W,"$name","ColorBoxCombo"),i(W,"type","colorboxcombo"),i(W,"configurable",{displayField:"text",valueField:"id",editable:!1,showBoxForNoColor:!1,listItemTpl({text:e,color:s}){let t=x.encodeHtml(e);return s&&(T.isNamedColor(s)?t=`<div class="b-colorbox b-taskboard-color-${s}"></div>`+t:t=`<div class="b-colorbox" style="color : ${s}"></div>`+t),t},picker:{cls:"b-colorbox-picker"}}),W._$name="ColorBoxCombo";var Se=class extends W{changeStore(){return this.taskBoard.columns.chain()}};i(Se,"$name","ColumnCombo"),i(Se,"type","columncombo"),Se.initClass(),Se._$name="ColumnCombo";var ee=class extends He.mixin(A){get innerElements(){return this.peekConfig("multiSelect")||this._multiSelect?super.innerElements:[{reference:"avatarContainer"},this.inputElement]}syncInputFieldValue(...e){const s=this;if(!s.multiSelect){const t=s.record;t&&F.sync({targetElement:s.avatarContainer,domConfig:{className:"b-resourcescombo-avatar-container",children:[s.avatarRendering.getResourceAvatar({resourceRecord:t,initials:t.initials,color:t.color,iconCls:t.iconCls,imageUrl:t.image===!1?null:t.imageUrl||(s.taskBoard.resourceImagePath||"")+(t.image||""),dataset:{btip:x.encodeHtml(t.name)}})]}})}super.syncInputFieldValue(...e)}changeStore(){return this.taskBoard.project.resourceStore.chain()}changeAvatarRendering(e,s){if(s==null||s.destroy(),e)return new Le({element:this.element})}};i(ee,"$name","ResourcesCombo"),i(ee,"type","resourcescombo"),i(ee,"configurable",{displayField:"name",valueField:"id",multiSelect:!0,editable:!1,listItemTpl(e){const{avatarRendering:s,taskBoard:t}=this.owner;return T.createElement(s.getResourceAvatar({resourceRecord:e,initials:e.initials,color:e.color,iconCls:e.iconCls,imageUrl:e.image===!1?null:e.imageUrl||(t.resourceImagePath||"")+(e.image||"")})).outerHTML+x.encodeHtml(e.name)},picker:{cls:"b-resources-picker"},chipView:{scrollable:null,itemTpl(e){const{avatarRendering:s,taskBoard:t}=this.owner;return T.createElement(s.getResourceAvatar({resourceRecord:e,initials:e.initials,color:e.color,iconCls:e.iconCls,imageUrl:e.image===!1?null:e.imageUrl||(t.resourceImagePath||"")+(e.image||""),dataset:{btip:x.encodeHtml(e.name)}})).outerHTML}},avatarRendering:{value:!0,$config:"nullify"}}),ee.initClass(),ee._$name="ResourcesCombo";var Ee=class extends W{changeStore(){return this.taskBoard.swimlanes.chain()}};i(Ee,"$name","SwimlaneCombo"),i(Ee,"type","swimlanecombo"),Ee.initClass(),Ee._$name="SwimlaneCombo";var te=class extends is{};i(te,"$name","TaskColorPicker"),i(te,"type","taskcolorpicker"),i(te,"configurable",{colorClasses:[{color:"red",text:"Red"},{color:"pink",text:"Pink"},{color:"purple",text:"Purple"},{color:"deep-purple",text:"Deep purple"},{color:"indigo",text:"Indigo"},{color:"blue",text:"Blue"},{color:"light-blue",text:"Light blue"},{color:"cyan",text:"Cyan"},{color:"teal",text:"Teal"},{color:"green",text:"Green"},{color:"light-green",text:"Light green"},{color:"lime",text:"Lime"},{color:"yellow",text:"Yellow"},{color:"amber",text:"Amber"},{color:"orange",text:"Orange"},{color:"deep-orange",text:"Deep orange"}],colorClassPrefix:"b-taskboard-background-color-",colors:null}),te.initClass(),te._$name="TaskColorPicker";var se=class extends ns{};i(se,"$name","TaskColorCombo"),i(se,"type","taskcolorcombo"),i(se,"configurable",{picker:{type:"taskcolorpicker"},name:"eventColor",clearable:!0}),se.initClass(),se._$name="TaskColorCombo";var ae=class extends hs.mixin(A){changeItems(e,s){const{taskBoard:t}=this,{column:a,swimlane:n,resources:o}=e;return t?(a&&(a.name||(a.name=t.columnField),a.label||(a.label=x.capitalize(t.columnField))),n&&(!t.swimlaneField||!t.swimlanes?e.swimlane=null:(n.name||(n.name=t.swimlaneField),n.label||(n.label=x.capitalize(t.swimlaneField)))),t.project.resourceStore.count||(e.resources=null),t.project.eventStore.usesSingleAssignment&&o&&(o.multiSelect=!1)):e.column=e.swimlane=e.resources=null,super.changeItems(e,s)}processItemsObject(e,s,t){for(const a in e){const n=e[a];n&&!("name"in n)&&(n.name=a)}return super.processItemsObject(e,s,t)}updateAutoUpdateRecord(e){this.bbar.hidden=e}updateRecord(e){super.updateRecord(e),e&&(this.element.dataset.taskId=e.id)}onSaveClick(){const e=this,{record:s,owner:t}=e,{resources:a,...n}=e.values;if(e.isValid){if((t==null?void 0:t.trigger("beforeSave",{record:s,values:e.values,editor:e}))===!1)return;t==null||t.trigger("save",{record:s,values:e.values,editor:e}),e.close(),s.set(n),a&&(s.resources=a)}}onCancelClick(){var e,s;const t=this;((e=t.owner)==null?void 0:e.trigger("beforeCancel",{editor:t}))!==!1&&((s=t.owner)==null||s.trigger("cancel",{editor:t}),t.close())}onInternalKeyDown(e){const s=this;s.saveAndCloseOnEnter&&!s.readOnly&&e.key==="Enter"&&(e.preventDefault(),s.autoUpdateRecord?s.isValid&&(e.target.blur(),s.close()):s.onSaveClick()),super.onInternalKeyDown(e)}};i(ae,"$name","TaskEditor"),i(ae,"type","taskboardtaskeditor"),i(ae,"configurable",{centered:!0,modal:{closeOnMaskTap:!0},closable:!0,autoUpdateRecord:!0,autoUpdateFields:!0,saveAndCloseOnEnter:!0,draggable:{handleSelector:".b-panel-header"},autoShow:!1,anchor:!0,closeAction:"destroy",scrollAction:"realign",title:"L{TaskBoard.editTask}",defaults:{labelWidth:"30%"},width:"30em",items:{name:{type:"text",label:"L{TaskBoard.name}",weight:100},description:{type:"textarea",label:"L{TaskBoard.description}",height:"5em",weight:200},resources:{type:"resourcescombo",label:"L{TaskBoard.resources}",weight:300},color:{type:"taskcolorcombo",label:"L{TaskBoard.color}",name:"eventColor",weight:400},column:{type:"columncombo",weight:500},swimlane:{type:"swimlanecombo",weight:600}},bbar:{hidden:!0,items:{saveButton:{text:"L{TaskBoard.save}",onClick:"up.onSaveClick",weight:100},cancelButton:{text:"L{TaskBoard.cancel}",onClick:"up.onCancelClick",weight:200}}},maximizeOnMobile:!0}),ae.initClass(),ae._$name="TaskEditor";var U=class extends O{constructor(){super(...arguments),i(this,"editor",null)}doDestroy(){var e;(e=this.editor)==null||e.destroy()}changeEditorConfig(e){return b.assertObject(e,"features.taskEdit.editorConfig"),e}changeEditorType(e){return b.assertString(e,"features.taskEdit.editorType"),e}changeItems(e){return b.assertObject(e,"features.taskEdit.items"),e}changeProcessItems(e){return b.assertFunction(e,"features.taskEdit.processItems"),e}async editTask(e,s=null){var t,a;const n=this,{client:o}=n,r=o.getColumn(e),l=o.swimlaneField&&((t=o.swimlanes)==null?void 0:t.getById(e.getValue(o.swimlaneField)));if(n.disabled||await o.trigger("beforeTaskEdit",{taskRecord:e})===!1)return;n.isEditing&&n.cancelEdit();const d=Fe.resolveType(n.editorType),c=d.mergeConfigs(d.$meta.config.items,n.items);if(((a=n.processItems)==null?void 0:a.call(n,{items:c,taskRecord:e,columnRecord:r,swimlaneRecord:l}))===!1)return;const m=n.editor=d.new({items:c,owner:o,readOnly:e.readOnly},n.editorConfig);o.trigger("beforeTaskEditShow",{taskRecord:e,editor:m}),m.record=e,m.centered||!ls.isHoverableDevice?m.show():(xe.scrollIntoView(s!=null?s:o.getTaskElement(e)),m.showBy(s!=null?s:o.getTaskElement(e))),m.isVisible&&m.ion({hide:n.onEditorHide,thisObj:n})}cancelEdit(){}onActivateTask({taskRecord:e,event:s}){s.defaultPrevented||this.editTask(e)}populateTaskMenu({items:e,taskRecord:s}){!this.client.readOnly&&!this.disabled&&(e.editTask={text:"L{TaskBoard.editTask}",icon:"b-fw-icon b-icon-edit",weight:100,onItem:()=>this.editTask(s),disabled:s.readOnly})}onEditorHide(){var e;(e=this.client.getTaskElement(this.editor.record))==null||e.focus()}};i(U,"$name","TaskEdit"),i(U,"type","taskEdit"),i(U,"configurable",{editorType:"taskboardtaskeditor",editorConfig:{},items:{},processItems:null}),i(U,"pluginConfig",{assign:["editTask"],chain:["onActivateTask","populateTaskMenu"]}),U.initClass(),U._$name="TaskEdit";var G=class extends Ke{static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateTaskMenu"),e}changeItems(e){return b.assertObject(e,"features.taskMenu.items"),e}changeProcessItems(e){return b.assertFunction(e,"features.taskMenu.processItems"),e}updateTriggerEvent(e){this.detachListeners("triggerEvent"),e&&this.client.ion({name:"triggerEvent",[e]:"onTriggerEvent",thisObj:this})}doDisable(e){super.doDisable(e),!this.isConfiguring&&this.client.recompose()}onTriggerEvent({event:e}){this.internalShowContextMenu(e)}showMenuFor(e,s=".b-taskboard-task-menu"){const t=this.client.getTaskElement(e),a=t.querySelector(s),n={taskRecord:e,columnRecord:this.client.getColumn(e),targetElement:t};let o=null;a&&(n.targetElement=a,o={target:a}),this.showContextMenu(n,o)}showContextMenu(e,...s){this.client.isSelected(e.taskRecord)||this.client.selectTask(e.taskRecord),super.showContextMenu(e,...s)}getDataFromEvent(e){return b.assign(super.getDataFromEvent(e),e.taskBoardData)}populateTaskMenu({items:e,taskRecord:s}){var t;const{client:a,disabled:n}=this;if(!a.readOnly&&!n){const{columnField:o,swimlaneField:r,selectedTasks:l}=a,{resourceStore:d,eventStore:c}=a.project,u=l.includes(s);e.column={text:`L{TaskBoard.changeColumn} ${o}`,icon:"b-fw-icon b-icon-move-left-right",weight:300,disabled:s.readOnly,menu:a.columns.map(m=>({ref:m.id,text:x.encodeHtml(m.text),cls:"b-column-menu-item",isColumn:!0,checked:s.getValue(o)===m.id,closeParent:!0})),onItem({item:m}){m.isColumn&&(s.setValue(o,m.ref),m.parent.items.forEach(h=>{h!==m&&(h.checked=!1)}))}},(t=a.swimlanes)!=null&&t.count&&r&&(e.swimlane={text:x.xss`L{TaskBoard.changeSwimlane} ${r}`,icon:"b-fw-icon b-icon-move-up-down",weight:400,disabled:s.readOnly,menu:a.swimlanes.map(m=>({ref:m.id,text:x.encodeHtml(m.text),isSwimlane:!0,checked:s.getValue(r)===m.id,closeParent:!0})),onItem({item:m}){m.isSwimlane&&(s.setValue(r,m.ref),m.parent.items.forEach(h=>{h!==m&&(h.checked=!1)}))}}),d.count&&(e.resources={text:"L{TaskBoard.resources}",icon:"b-fw-icon b-icon-user",weight:200,disabled:s.readOnly,menu:d.map(m=>{var h;const p=(h=this.avatarRendering)==null?void 0:h.getResourceAvatar({resourceRecord:m,initials:m.initials,color:m.color,iconCls:m.iconCls,imageUrl:m.imageUrl||(a.resourceImagePath||"")+(m.image||"")});return{ref:m.id,cls:"b-resource-menu-item",text:p?{className:"b-resource-menu-item-inner",children:[p,x.encodeHtml(m.name)]}:x.encodeHtml(m.name),resource:m,checked:s.resources.includes(m),toggleGroup:c.usesSingleAssignment?"single":null}}),onItem({item:m}){m.resource&&s[m.checked?"assign":"unassign"](m.resource)}}),e.removeTask={text:u&&l.length>1?"L{TaskBoard.removeTasks}":"L{TaskBoard.removeTask}",icon:"b-fw-icon b-icon-trash",cls:"b-separator",weight:500,disabled:s.readOnly,onItem:()=>a.removeTask(u?l:s)}}}get showMenu(){return!0}updateShowAvatars(e){var s;(s=this.avatarRendering)==null||s.destroy(),e&&(this.avatarRendering=new Le({element:this.client.element}))}};i(G,"$name","TaskMenu"),i(G,"type","taskMenu"),i(G,"configurable",{processItems:null,items:null,type:"task",triggerEvent:"taskContextMenu",showAvatars:{value:!0,$config:"nullify"},menu:{align:"t90-b90",anchor:!0}}),O.register(G.type,G),G._$name="TaskMenu";var q=class extends O{changeTemplate(e){return b.assertFunction(e,"features.taskTooltip.template"),e}doDisable(e){super.doDisable(e),this._tooltip&&(this.tooltip.disabled=e)}changeTooltip(e,s){const t=this,{client:a}=t;if(b.assertObject(e,"features.taskTooltip.tooltip"),s==null||s.destroy(),e)return new et(b.assign({axisLock:"flexible",cls:"b-taskboard-tooltip",forSelector:".b-taskboardbase:not(.b-draghelper-active) .b-taskboard-card",scrollAction:"realign",forElement:a.element,showOnHover:!0,hoverDelay:0,hideDelay:100,anchorToTarget:!0,allowOver:!!(t.config.items||t.config.tools),getHtml:t.getTipHtml.bind(t),disabled:t.disabled,textContent:!1},e))}getTipHtml({tip:e,activeTarget:s}){const{client:t}=this,a=t.resolveTaskRecord(s),n=t.resolveColumnRecord(s),o=t.resolveSwimlaneRecord(s);if(this.template)return this.template({tip:e,taskRecord:a,columnRecord:n,swimlaneRecord:o,activeTarget:s});const r=[{class:"b-taskboard-tooltip-title",text:a.name},{class:"b-taskboard-tooltip-label",text:x.capitalize(t.columnField)},{class:"b-taskboard-tooltip-value",text:n.text}];return o&&r.push({class:"b-taskboard-tooltip-label",text:x.capitalize(t.swimlaneField)},{class:"b-taskboard-tooltip-value",text:o.text}),a.resources.length&&r.push({class:"b-taskboard-tooltip-label",text:this.L("L{TaskBoard.resources}")},{class:"b-taskboard-tooltip-value",text:a.resources.map(l=>l.name).join(", ")}),{children:r}}render(){this.getConfig("tooltip")}};i(q,"$name","TaskTooltip"),i(q,"type","taskTooltip"),i(q,"configurable",{tooltip:{value:{},$config:["lazy","nullify"]},template:null}),i(q,"pluginConfig",{chain:["render"]}),q.initClass(),q._$name="TaskTooltip";var Ie=class extends Ye{get tasks(){return this.taskBoard.getColumnTasks(this,!0)}get taskBoard(){return this.firstStore.taskBoard}async collapse(){return this.taskBoard.collapse(this)}async expand(){return this.taskBoard.expand(this)}};i(Ie,"$name","ColumnModel"),i(Ie,"fields",["text","tooltip",{name:"color",type:"string"},"tasksPerRow",{name:"collapsible",type:"boolean",defaultValue:!0},{name:"collapsed",type:"boolean"},{name:"hidden",type:"boolean"},{name:"width",type:"number"},{name:"flex",type:"number"},{name:"minWidth",type:"number"}]),Ie._$name="ColumnModel";var K=class extends We{};i(K,"$name","TaskModel"),i(K,"fields",["status","prio","description","eventColor",{name:"weight",type:"number"},{name:"readOnly",type:"boolean"}]),K._$name="TaskModel";var De=class extends Ue{afterLoadData(){const{records:e}=this;if(this.autoAssignWeight&&!e.some(s=>s.weight!=null))for(let s=0;s<e.length;s++)e[s].setData("weight",(s+1)*100)}};i(De,"configurable",{autoAssignWeight:!0,storeId:"tasks",modelClass:K,removeUnassignedEvent:!1,sorters:[{field:"weight",ascending:!0}]}),De._$name="TaskStore";var Oe=class extends qe.mixin(Ge){construct(e){e.tasks&&(e.eventsData=e.tasks),e.tasksData&&(e.eventsData=e.tasksData),e.taskStore&&(e.eventStore=e.taskStore),e.taskModelClass&&(e.eventModelClass=e.taskModelClass),e.taskStoreClass&&(e.eventStoreClass=e.taskStoreClass),super.construct(e);const s=this;s.addPrioritizedStore(s.assignmentStore),s.addPrioritizedStore(s.resourceStore),s.addPrioritizedStore(s.taskStore)}get taskStore(){return this.eventStore}set taskStore(e){this.eventStore=e}get tasksData(){return this.eventsData}set tasksData(e){this.eventsData=e}get tasks(){return this.eventsData}set tasks(e){this.events=e}toJSON(){const{taskStore:e,assignmentStore:s,resourceStore:t}=this,a={tasksData:e.toJSON()};return s!=null&&s.count&&(a.assignmentsData=s.toJSON()),t!=null&&t.count&&(a.resourcesData=t.toJSON()),a}};i(Oe,"configurable",{eventStoreClass:De,eventModelClass:K,taskStoreClass:De,taskModelClass:K}),Oe._$name="ProjectModel";var Be=class extends Ye{get taskBoard(){return this.firstStore.taskBoard}async collapse(){this.taskBoard.collapse(this)}async expand(){return this.taskBoard.expand(this)}get tasks(){return[...this.taskBoard.getSwimlaneTasks(this)||[]]}};i(Be,"$name","SwimlaneModel"),i(Be,"fields",[{name:"text",type:"string"},{name:"color",type:"string"},{name:"collapsible",type:"boolean",defaultValue:!0},{name:"collapsed",type:"boolean"},{name:"hidden",type:"boolean"},{name:"height",type:"number"},{name:"flex",type:"number"},"tasksPerRow"]),Be._$name="SwimlaneModel";var ot=e=>{var s;return s=class extends(e||M){get widgetClass(){}changeShowCollapseInHeader(t){return b.assertBoolean(t,"showCollapseInHeader"),t}async collapse(t){return this.toggleCollapse(t,!0)}async expand(t){return this.toggleCollapse(t,!1)}async toggleCollapse(t,a=!t.collapsed){t.isSwimlaneModel?await this.toggleSwimlaneCollapse(t,a):await this.toggleColumnCollapse(t,a)}async toggleSwimlaneCollapse(t,a=!t.collapsed){return new Promise(n=>{const o=this,r=o.getSwimlaneElement(t),l=F.getChild(r,"body");a&&(l.style.height=`${l.getBoundingClientRect().height}px`),_.onTransitionEnd({element:l,property:"height",handler(){a?r.style.height="":(l.style.height="",r.style.height=`${t.height}px`),r.classList.remove(a?"b-collapsing":"b-expanding"),o.recompose.flush(),n()},thisObj:o}),r.classList.add(a?"b-collapsing":"b-expanding"),o.suspendDomTransition(),t.collapsed=a,o.trigger(`swimlane${a?"Collapse":"Expand"}`,{swimlaneRecord:t}),o.trigger("swimlaneToggle",{swimlaneRecord:t,collapse:a}),o.resumeDomTransition()})}async toggleColumnCollapse(t,a=!t.collapsed){return new Promise(n=>{var o,r;const l=this,{documentRoot:d}=l,c=l.getColumnElements(t),u=F.getChild(l.bodyElement,`header.${t.domId}`),m=t.width&&!t.flex,h=d.querySelectorAll(`.b-taskboard-card[data-column="${t.domId}"]`),p=`${(o=h[0])==null?void 0:o.getBoundingClientRect().width}px`,f=`${(r=c[0])==null?void 0:r.getBoundingClientRect().width}px`;h.forEach(g=>{a&&(g.style.width=p)}),c.unshift(u),c.forEach(g=>{a?(m||(g.style.width=f),g.classList.add("b-collapsing")):g.classList.add("b-expanding")}),_.onTransitionEnd({element:u,property:"width",handler(){h.forEach(g=>{a||(g.style.width="")}),c.forEach(g=>{a?g.classList.remove("b-collapsing"):(m||(g.style.width=""),g.classList.remove("b-expanding"))}),l.recompose.flush(),l.scrollable.syncOverflowState(),n()},thisObj:l}),u.offsetWidth,l.suspendDomTransition(),t.collapsed=a,l.trigger(`column${a?"Collapse":"Expand"}`,{columnRecord:t}),l.trigger("columnToggle",{columnRecord:t,collapse:a}),l.resumeDomTransition()})}populateColumnHeader(t){var a;(a=super.populateColumnHeader)==null||a.call(this,t);const{showCollapseInHeader:n,collapseTitle:o,hasSwimlanes:r,showCollapseTooltip:l}=this,{columnRecord:d,columnHeaderConfig:c}=t,{text:u,collapsed:m,collapsible:h}=d;T.merge(c,{class:{"b-collapsed":m,"b-rotate-title":m&&!o&&!r},style:{minWidth:m?null:d.minWidth},children:{padder:{children:{expander:n&&h&&{tag:"button",class:{"b-taskboard-column-expander":1,"b-fw-icon":1,"b-icon-expand-column":1},dataset:{btip:l?x.xss`${this.L(m?"L{TaskBoard.expand}":"L{TaskBoard.collapse}",u)}`:null}}}}}})}populateColumn(t){var a;(a=super.populateColumn)==null||a.call(this,t);const{columnRecord:n,columnConfig:o}=t,{collapsed:r}=n;o.class["b-collapsed"]=r,r&&(o.style.minWidth=null)}populateSwimlane(t){var a;(a=super.populateColumn)==null||a.call(this,t);const{swimlaneRecord:n,swimlaneConfig:o}=t;if(n){const{showCollapseInHeader:r,showCollapseTooltip:l}=this,{text:d,collapsed:c,collapsible:u}=n;T.merge(o,{class:{"b-collapsed":c,"b-collapsible":u},children:{header:{children:{title:{children:{"expander > text":r&&u&&{tag:"button",class:{"b-taskboard-swimlane-expander":1,"b-icon":1,"b-icon-expand-row":1},dataset:{btip:l?x.xss`${this.L(c?"L{TaskBoard.expand}":"L{TaskBoard.collapse}",d)}`:null}}}}}},body:{[c?"inert":null]:!0}}})}}onColumnHeaderClick({event:t,columnRecord:a}){(t.target.matches(".b-taskboard-column-expander")||a.collapsed)&&this.toggleCollapse(a)}onColumnClick({columnRecord:t}){t.collapsed&&this.toggleCollapse(t)}onSwimlaneHeaderClick({swimlaneRecord:t}){this.toggleCollapse(t)}},i(s,"$name","ExpandCollapse"),i(s,"configurable",{showCollapseInHeader:!0,collapseTitle:!1,showCollapseTooltip:!0}),s},rt=e=>{var s;return s=class extends(e||M){constructor(){super(...arguments),i(this,"responsivenessSuspended",0)}get widgetClass(){}changeCardSizes(t){return b.assertArray(t,"cardSizes"),t}suspendResponsiveness(){this.responsivenessSuspended++}resumeResponsiveness(){this.responsivenessSuspended--}getCardSize(t,a){const n=this,{cardSizes:o}=n,r=n.getTasksPerRow(t,a),l=n.getColumnWidth(t),d=(l-n.cardGap*(r-1))/r;return(o==null?void 0:o.find(c=>d<c.maxWidth))||(o==null?void 0:o[o.length-1])}getColumnWidth(t){return t.instanceMeta(this).width}getTasksPerRow(t,a){return t.tasksPerRow||(a==null?void 0:a.tasksPerRow)||this.tasksPerRow}onChildResize(t){const a=this;if(a.recompose.suspended||a.responsivenessSuspended)return;let n=!1;for(const o of t){const{target:r,contentRect:l}=o;if(r.observedWidth!==l.width){const d=a.resolveColumnRecord(r),c=d&&a.columns.includes(d)&&a.getColumnElements(d);if(!d||d.collapsed||d.hidden||!c)return;d.instanceMeta(a).width=r.observedWidth=l.width;for(const u of c){const m=a.resolveSwimlaneRecord(u),h=a.getCardSize(d,m);h&&u.elementData.cardSize!==h.name&&(n=!0)}}}n&&(a.recompose.now(),a.scrollable.syncOverflowState())}changeResizeObserver(t,a){return a==null||a.disconnect(),this.isDestroying||!ResizeObserver?null:new ResizeObserver(this.onChildResize.bind(this))}populateColumn(t){var a;(a=super.populateColumn)==null||a.call(this,t);const{columnRecord:n,swimlaneRecord:o,columnConfig:r}=t,l=t.cardSize=this.getCardSize(n,o);l&&(r.class[`b-${l.name}-cards`]=l,r.elementData.cardSize=l.name)}},i(s,"$name","ResponsiveCards"),i(s,"configurable",{cardSizes:[{maxWidth:50,name:"micro",maxAvatars:1,headerItems:{text:null},bodyItems:{text:null}},{maxWidth:75,name:"tiny",maxAvatars:1,bodyItems:{text:null}},{maxWidth:175,name:"small",maxAvatars:2,bodyItems:{text:null}},{maxWidth:250,name:"medium",maxAvatars:3},{name:"large",maxAvatars:7}],resizeObserver:{value:!0,$config:["nullify"]}}),s},xs={remove:1,move:1,update:1,filter:1},lt=e=>{var s;return s=class extends(e||M){get widgetClass(){}changeAutoGenerateColumns(t){return b.assertBoolean(t,"autoGenerateColumns"),t}changeColumnField(t){return b.assertString(t,"columnField"),t}updateColumnField(t,a){if(a){const{storage:n}=this.project.taskStore;a!==this.swimlaneField&&n.removeIndex(a),n.addIndex({property:t,unique:!1})}this.shouldAutoGenerateColumns=t&&this.autoGenerateColumns}changeColumns(t){return Qe.from(t,{objectify:!0,modelClass:Ie},a=>typeof a=="string"?{id:a,text:x.capitalize(a)}:a)}updateColumns(t){this.detachListeners("columns"),t&&((t.$store||t).taskBoard=this,t.ion({change:"onColumnsChange",refresh:"onColumnsChange",thisObj:this}))}get columns(){const t=this,{taskStore:a}=t.project;return t.shouldAutoGenerateColumns&&a.count&&(t.columns=a.getDistinctValues(t.columnField).sort(),t.shouldAutoGenerateColumns=!1),t._columns}onColumnsChange({action:t}){if((t==="add"||t==="remove"||t==="removeAll"||t==="update")&&this.project.taskStore.storage.invalidateIndices(),xs[t]){const a={};(t==="update"||t==="remove")&&(a.addTransition={width:1,opacity:1},a.removeTransition={width:1,opacity:1}),this.recomposeWithDomTransition(a)}else this.recompose()}getColumnTasks(t,a=!1){const n=this,{taskStore:o}=n.project,r=o.storage.findItem(n.columnField,t.id),l=r?[...r]:[];if(a&&r)if(n.swimlanes){const{swimlaneField:d}=n,c=n.swimlanes.map(u=>u.id);if(l.sort((u,m)=>{const h=c.indexOf(u[d])-c.indexOf(m[d]);return h!==0?h:u.weight!=null||m.weight!=null?u.weight-m.weight:o.indexOf(u)-o.indexOf(m)}),c.length&&d)return l.filter(u=>c.includes(u[d]))}else l.sort((d,c)=>d.weight-c.weight);return l}getColumn(t){return this.columns.getById(t.getValue(this.columnField))}getNextTask(t,a=!0){const n=this.getColumn(t),o=n.tasks;let r=o.indexOf(t)+1;if(r===o.length)if(a)r=0;else return null;return o[r]}getPreviousTask(t,a=!0){const n=this.getColumn(t),o=n.tasks;let r=o.indexOf(t)-1;if(r<0)if(a)r=o.length-1;else return null;return o[r]}},i(s,"$name","TaskBoardColumns"),i(s,"configurable",{columns:{},autoGenerateColumns:!1,columnField:null}),i(s,"properties",{shouldAutoGenerateColumns:!1}),s},it=e=>{var s;return s=class extends(e||M){get widgetClass(){}resolveTaskRecord(t){var a;return t=t.closest(".b-taskboard-card"),t&&this.project.taskStore.getById((a=t.elementData)==null?void 0:a.taskId)}resolveColumnRecord(t){var a;return t=t.closest(".b-taskboard-column, .b-taskboard-column-header"),t&&this.columns.getById((a=t.elementData)==null?void 0:a.columnId)}resolveSwimlaneRecord(t){var a;return t=t.closest(".b-taskboard-swimlane"),t&&((a=this.swimlanes)==null?void 0:a.getById(t.elementData.laneId))}getTaskElement(t){const a=this.getTaskColumnElement(t);return a&&F.getChild(a,`body.inner.${t.domId}`)}getTaskColumnElement(t){const a=this.columns.getById(t.getValue(this.columnField));return a&&F.getChild(this.getTaskSwimlaneElement(t),`body.${a.domId}`)}getTaskSwimlaneElement(t){var a,n;const o=(a=this.swimlanes)!=null&&a.count?(n=this.swimlanes.getById(t.getValue(this.swimlaneField)))==null?void 0:n.domId:"default";return F.getChild(this.bodyElement,o)}getSwimlaneElement(t){return F.getChild(this.bodyElement,t.domId)}getSwimlaneColumnElement(t,a){return t?F.getChild(this.getSwimlaneElement(t),`body.${a.domId}`):this.getColumnElement(a)}getColumnElement(t){var a;return(a=this.getColumnElements(t))==null?void 0:a[0]}getColumnElements(t){var a;return(a=this.swimlanes)!=null&&a.count?this.swimlanes.reduce((n,o)=>(o.hidden||n.push(this.getSwimlaneColumnElement(o,t)),n),[]):[this.getSwimlaneColumnElement({domId:"default"},t)]}getColumnHeaderElement(t){return F.getChild(this.bodyElement,`header.${t.domId}`)}getCardAt(t,a,n=".b-taskboard-card"){var o;return(o=this.documentRoot.elementFromPoint(t,a))==null?void 0:o.closest(n)}cacheCSSVar(t,a){const n=this;let o=n[`_${t}`];if(o==null){const r=n.css[t];o=T.measureSize(r||a,n.element),r&&(n[`_${t}`]=o)}return o}get cardGap(){return this.cacheCSSVar("cardGap","1em")}},i(s,"$name","TaskBoardDom"),s},dt=e=>{var s,t;return s=class extends(e||M){constructor(){super(...arguments),bs(this,t,null)}get widgetClass(){}changeDomListeners(a){if(a)for(const n in this.domEvents)a[n]="triggerDomEvent";return a}resolveEvent(a){const{target:n}=a,o=this.resolveTaskRecord(n),r=this.resolveColumnRecord(n),l=this.resolveSwimlaneRecord(n);return{taskRecord:o,columnRecord:r,swimlaneRecord:l,event:a}}triggerDomEvent(a){const n=this,o=n.resolveEvent(a),r=n.domEvents[a.type],{target:l}=a;if(n.isScrolling||l.closest(".b-widget")!==n._element)return;a.taskBoardData=o;let d;if(o.taskRecord){const c=`task${x.capitalize(r)}`;d=n.trigger(c,o),c===n.activateTaskEvent&&!a.defaultPrevented&&n.trigger("activateTask",{taskRecord:o.taskRecord,event:a})}else o.columnRecord?l.closest(".b-taskboard-column-header")?d=n.trigger(`columnHeader${x.capitalize(r)}`,o):d=n.trigger(`column${x.capitalize(r)}`,o):o.swimlaneRecord&&(l.closest(".b-taskboard-swimlane-header")?d=n.trigger(`swimlaneHeader${x.capitalize(r)}`,o):d=n.trigger(`swimlane${x.capitalize(r)}`,o));if(d!==!1&&(n.trigger(r,o),(r==="mouseOver"||r==="mouseOut")&&o.taskRecord)){const c=l.closest(".b-taskboard-card");r==="mouseOver"&&c!==ks(n,t)&&(st(n,t,c),n.trigger("taskMouseEnter",o)),r==="mouseOut"&&!c.contains(a.relatedTarget)&&(st(n,t,null),n.trigger("taskMouseLeave",o))}}domSyncCallback({action:a,domConfig:n,lastDomConfig:o,targetElement:r,syncId:l,jsx:d}){var c,u,m,h,p,f;const g=this,{elementType:C}=(c=n==null?void 0:n.elementData)!=null?c:{},k=a==="reuseOwnElement",{reactComponent:v}=this;if(d&&this.processTaskItemContent){this.processTaskItemContent({jsx:d,targetElement:r,reactComponent:v,domConfig:n});return}if(n)if(C==="task"){const{taskId:w}=n.elementData,y=g.project.taskStore.getById(w);a==="newElement"&&((u=g.cardIntersectionObserver)==null||u.observe(r)),a==="newElement"||a==="reuseOwnElement"?(!g.isVirtualized||y.instanceMeta(g).intersects)&&g.trigger("renderTask",{taskRecord:y,element:r,isRefresh:k}):a==="removeElement"&&((m=g.cardIntersectionObserver)==null||m.unobserve(r),g.trigger("removeTaskElement",{taskId:w,element:r}))}else if(C==="column"){const{columnId:w,laneId:y}=n.elementData,$=g.columns.getById(w),I=y!=null&&((h=g.swimlanes)==null?void 0:h.getById(y));a==="newElement"||a==="reuseOwnElement"?g.trigger("renderColumn",{columnRecord:$,swimlaneRecord:I,element:r,isRefresh:k}):a==="removeElement"&&g.trigger("removeColumnElement",{columnId:w,swimlaneRecord:I,element:r})}else if(C==="swimlane"){const{laneId:w}=n.elementData,y=w!=null&&w!=="default"&&((p=g.swimlanes)==null?void 0:p.getById(w));w!=="default"&&(a==="newElement"||a==="reuseOwnElement"?g.trigger("renderSwimlane",{swimlaneRecord:y,element:r,isRefresh:k}):a==="removeElement"&&g.trigger("removeSwimlaneElement",{swimlaneId:w,element:r}))}else(f=n.class)!=null&&f["b-taskboard-column-header-padder"]&&g.resizeObserver&&(a==="newElement"&&(r.isResizeObserved||(g.resizeObserver.observe(r),r.isResizeObserved=!0)),a==="removeElement"&&r.isResizeObserved&&(g.resizeObserver.unobserve(r),delete r.isResizeObserved))}onClick(){}onMouseMove(){}onMouseUp(){}onTaskMouseDown(){}onTaskClick(){}onTaskDblClick(){}onTaskContextMenu(){}onColumnMouseDown(){}onColumnHeaderClick(...a){super.onColumnHeaderClick(...a)}onSwimlaneHeaderClick(...a){super.onSwimlaneHeaderClick(...a)}onActivateTask(){}},t=new WeakMap,i(s,"$name","TaskBoardDomEvents"),i(s,"configurable",{activateTaskEvent:"taskDblClick",domEvents:{click:"click",dblclick:"dblClick",mouseup:"mouseUp",mousedown:"mouseDown",mousemove:"mouseMove",mouseover:"mouseOver",mouseout:"mouseOut",keydown:"keyDown",contextmenu:"contextMenu"},domListeners:{}}),s},ct=e=>{var s;return s=class extends(e||M){get widgetClass(){}onInternalPaint({firstPaint:t}){if(t){const a=this;_.on({element:a.element,scroll(){a.isScrolling=!0,a.onScrollEnd()},capture:!0,thisObj:a})}}onScrollEnd(){this.isScrolling=!1,this.recomposeOnScrollEnd&&(this.recompose(),this.recomposeOnScrollEnd=!1)}changeScrollOptions(t){return b.assertObject(t,"scrollOptions"),t}async scrollToSwimlane(t,a=this.scrollOptions){const n=this.swimlanes.getById(t),o=n&&this.getSwimlaneElement(n);if(o)return a=b.assign({x:!1,animate:(a==null?void 0:a.animate)||(a==null?void 0:a.behavior)==="smooth"},a),xe.scrollIntoView(o,a,this.rtl)}async scrollToColumn(t,a=this.scrollOptions){const n=this.columns.getById(t),o=n&&this.getColumnHeaderElement(n);if(o)return a=b.assign({animate:(a==null?void 0:a.animate)||(a==null?void 0:a.behavior)==="smooth",y:!1},a),xe.scrollIntoView(o,a,this.rtl)}async scrollToIntersection(t,a,n=this.scrollOptions){const o=this.swimlanes.getById(t),r=this.columns.getById(a),l=o&&r&&this.getSwimlaneColumnElement(o,r);if(l)return n=b.assign({animate:(n==null?void 0:n.animate)||(n==null?void 0:n.behavior)==="smooth",edgeOffset:10},n),xe.scrollIntoView(l,n,this.rtl)}async scrollToTask(t,a=this.scrollOptions){const n=this,o=n.project.taskStore.getById(t),r=o&&n.getTaskElement(o);if(r){const l={start:10,end:10,top:10,bottom:10};return n.stickyHeaders&&(n.hasSwimlanes&&(l.top+=n.getTaskSwimlaneElement(o).syncIdMap.header.offsetHeight),l.top+=n.bodyElement.syncIdMap.header.offsetHeight),n.isVirtualized&&!n.getTaskHeight&&(r.scrollIntoView(),await new Promise((d,c)=>{const u=n.ion({renderTask({taskRecord:m}){m===o&&(u(),d())},expires:{delay:200,alt:c}})})),a=b.assign({animate:(a==null?void 0:a.animate)||(a==null?void 0:a.behavior)==="smooth",edgeOffset:l},a),xe.scrollIntoView(r,a,n.rtl)}}},i(s,"$name","TaskBoardScroll"),i(s,"configurable",{scrollOptions:{animate:!0,block:"nearest",highlight:!0},testConfig:{scrollOptions:{animate:!1,block:"nearest"}}}),i(s,"delayable",{onScrollEnd:tt.isTestEnv?300:100}),s},ut=e=>{var s;return s=class extends(e||M){get widgetClass(){}get assignments(){return this.project.assignmentStore.records}updateAssignments(t){this.project.assignmentStore.data=t}get resources(){return this.project.resourceStore.records}updateResources(t){this.project.resourceStore.data=t}get tasks(){return this.project.taskStore.records}updateTasks(t){this.project.taskStore.data=t}changeNewTaskDefaults(t){return b.assertObject(t,"newTaskDefaults"),t}changeProject(t){return t&&!t.isModel&&(t=this.projectModelClass.new(t)),this.attachToProject(t),t}attachToProject(t){const a=this;if(a.bindCrudManager(t),t){const{taskStore:n}=t;if(n){const{storage:o}=n;o.addIndex({property:a.columnField,unique:!1}),a.swimlaneField&&o.addIndex({property:a.swimlaneField,unique:!1}),Reflect.defineProperty(n.$master.modelClass.prototype,"columnSwimlaneIntersection",{get(){return this.buildIndexKey({[a.columnField]:this[a.columnField],[a.swimlaneField]:this[a.swimlaneField]})}}),n.$master.modelClass.prototype.buildIndexKey=function(r){var l;return`${r[a.columnField]}-/-${((l=a.swimlanes)==null?void 0:l.count)&&r[a.swimlaneField]||"default"}`},o.addIndex({property:"columnSwimlaneIntersection",unique:!1,dependentOn:{[a.swimlaneField]:!0,[a.columnField]:!0}})}a.attachToProjectStore(t.taskStore,{change:"onTaskStoreChange",changePreCommit:"onTaskStoreEarlyChange",refresh:"onTaskStoreRefresh"}),a.attachToProjectStore(t.assignmentStore),a.attachToProjectStore(t.resourceStore)}}attachToProjectStore(t,a={}){this.detachListeners(t.$name),t==null||t.ion({name:t.$name,change:"recompose",refresh:"recompose",thisObj:this,...a})}onTaskStoreEarlyChange({action:t}){t==="add"&&this.recomposeWithDomTransition({addTransition:{height:1,opacity:1}})}onTaskStoreChange({action:t,changes:a}){const{columnField:n,swimlaneField:o}=this;t==="remove"||t==="filter"||t==="update"&&(a[n]||o&&a[o])?this.recomposeWithDomTransition({removeTransition:{height:1,opacity:1}}):this.recompose()}onTaskStoreRefresh({action:t}){t==="sort"?!this.taskSorterFn&&this.recomposeWithDomTransition():this.recompose()}async addTask(t,a=null,n={}){var o;const r=this,{swimlaneField:l,swimlanes:d,project:c}=r,u=r.getColumnElement(t).syncIdMap.body,m=u.lastElementChild,h={[r.columnField]:t.id,name:r.L("L{TaskBoard.newTaskName}"),weight:((o=c.taskStore.max("weight"))!=null?o:0)+100,...r.newTaskDefaults,...n};let p=!1;l&&(a?h[l]=a.id:d!=null&&d.count&&(h[l]=d.first.id)),m&&m.offsetTop+m.offsetHeight>u.clientHeight-100&&(r.suspendDomTransition(),p=!0);const f=c.autoSync&&c.await("sync",!1),[g]=c.taskStore.add(h);if(r.recompose.now(),r.useDomTransition&&!r.domTransitionSuspended&&await r.await("transitionedRecompose",!1),!r.isDestroyed&&(await r.scrollToTask(g,b.assign({},r.scrollOptions,{highlight:!1,block:"nearest"})),!r.isDestroyed)){if(f){if(await f,r.isDestroyed)return;r.recompose.now()}return p&&r.resumeDomTransition(),r.features.simpleTaskEdit&&r.editTask(g),g}}async removeTask(t){const a=ye.asArray(t);return await this.trigger("beforeTaskRemove",{taskRecords:a})!==!1?(this.project.taskStore.remove(a),!0):!1}},i(s,"$name","TaskBoardStores"),i(s,"configurable",{projectModelClass:Oe,project:{},assignments:null,resources:null,tasks:null,newTaskDefaults:{},loadMaskDefaults:{useTransition:!0,showDelay:100},syncMask:null}),s},mt=e=>{var s;return s=class extends(e||M){get widgetClass(){}changeAutoGenerateSwimlanes(t){return b.assertBoolean(t,"autoGenerateSwimlanes"),t}changeSwimlaneField(t){return b.assertString(t,"swimlaneField"),t}updateSwimlaneField(t,a){if(!this.isConfiguring){const{storage:n}=this.project.taskStore;a&&a!==this.columnField&&n.removeIndex(a),n.addIndex({property:t,unique:!1})}this.shouldAutoGenerateSwimlanes=t&&this.autoGenerateSwimlanes}changeSwimlanes(t){return Qe.from(t,{objectify:!0,modelClass:Be},a=>typeof a=="string"?{id:a,text:x.capitalize(a)}:a)}updateSwimlanes(t){this.detachListeners("swimlanes"),t&&((t.$store||t).taskBoard=this,t.ion({change:"onSwimlanesChange",refresh:"onSwimlanesChange",thisObj:this}))}get swimlanes(){const t=this,{taskStore:a}=t.project;return t.shouldAutoGenerateSwimlanes&&a.count&&(t.swimlanes=a.getDistinctValues(t.swimlaneField).sort(),t.shouldAutoGenerateSwimlanes=!1),t._swimlanes}onSwimlanesChange({action:t}){if((t==="add"||t==="remove"||t==="removeAll"||t==="update")&&this.project.taskStore.storage.invalidateIndices(),t==="remove"||t==="update"||t==="filter"){const a={};t==="update"&&(a.addTransition={height:1,opacity:1},a.removeTransition={height:1,opacity:1}),this.recomposeWithDomTransition(a);return}this.recompose()}get hasSwimlanes(){var t;return!!(this.swimlaneField&&((t=this.swimlanes)!=null&&t.count))}getSwimlaneTasks(t){return this.project.taskStore.storage.findItem(this.swimlaneField,t.id)}getSwimlane(t){var a;return this.swimlaneField&&((a=this.swimlanes)==null?void 0:a.getById(t.getValue(this.swimlaneField)))}},i(s,"$name","TaskBoardSwimlanes"),i(s,"configurable",{swimlanes:{},autoGenerateSwimlanes:!1,swimlaneField:null}),i(s,"properties",{shouldAutoGenerateSwimlanes:!1}),s},gt=e=>{var s;return s=class extends(e||M){get widgetClass(){}changeVirtualize(t){return b.assertBoolean(t,"virtualize"),t}updateVirtualize(t){var a;const n=this;(a=n.cardIntersectionObserver)==null||a.disconnect(),n.cardIntersectionObserver=null,t&&(n.cardIntersectionObserver=new IntersectionObserver(o=>{for(const r of o)n.onCardIntersection(r.target,r.isIntersecting,r)})),!this.isConfiguring&&!this.isDestroying&&this.refreshVirtualizedCards()}refreshVirtualizedCards(){const t=this;if(t.recompose.now(),t.cardIntersectionObserver)for(const a of t.element.querySelectorAll(".b-taskboard-card"))t.cardIntersectionObserver.observe(a)}changeGetTaskHeight(t){return t&&b.assertFunction(t,"getTaskHeight"),t}updateGetTaskHeight(t){!this.isConfiguring&&!this.isDestroying&&this.refreshVirtualizedCards()}compose(t){return t.class["b-virtualized"]=this.isVirtualized,super.compose(t)}get isVirtualized(){return!!this.cardIntersectionObserver}onCardIntersection(t,a,n){const o=this,{taskRecord:r}=t.elementData,l=r.instanceMeta(o),d=l.intersects;d!==a&&(l.intersects=a,!a&&d&&(l.lastHeight=n.boundingClientRect.height),(!o.isScrolling||o.drawOnScroll)&&o.queueColumnRecompose(o.getColumn(r),o.getSwimlane(r)),o.isScrolling&&(o.recomposeOnScrollEnd=!0))}renderCardOutline(t,a,n){var o;const r=this,{id:l,domId:d,weight:c}=t;return{id:`${r.id}-card-${d}`,class:{"b-taskboard-card":!0,"b-out-of-view":!0},tabIndex:0,dataset:{task:d,column:a.id,lane:n==null?void 0:n.id,weight:c,domTransition:!0},elementData:{elementType:"task",taskId:l,taskRecord:t,columnRecord:a,swimlaneRecord:n},style:{height:((o=r.getTaskHeight)==null?void 0:o.call(r,t))||t.instanceMeta(r).lastHeight}}}renderCard(t,a,n){const{isVirtualized:o}=this,r=t.instanceMeta(this);if(o&&!r.dragging&&!r.intersects&&!this.isSelected(t))return this.renderCardOutline(t,a,n)}},i(s,"$name","TaskBoardVirtualization"),i(s,"configurable",{getTaskHeight:null,virtualize:{value:null,$config:"nullify"},drawOnScroll:!0}),s},Me=class extends D{static render({domConfig:e,value:s,taskRecord:t,config:a}){a.field==="id"&&t.hasGeneratedId?(e.class["b-generated-id"]=1,e.text="\u273B"):e.text=t.getFieldDefinition(a.field).print(s)}};i(Me,"$name","TextItem"),i(Me,"type","text"),Me.initClass(),Me._$name="TextItem";var ne=class extends D{static render({taskBoard:e,domConfig:s,config:t,taskRecord:a,cardSize:n}){var o,r;const l=(r=(o=n==null?void 0:n.maxAvatars)!=null?o:t.maxAvatars)!=null?r:7,{resourceImagePath:d}=e,{resources:c}=a,u=c.length>l,m=c.length-l+1,h=c[l];let{avatarRendering:p}=e;if(p||(p=e.avatarRendering=new Le({element:e.element,colorPrefix:"b-taskboard-background-color-"})),!e.project.resourceStore.count)return!1;b.merge(s,{class:{"b-overlap":t.overlap},children:[...c.sort((f,g)=>f.name.localeCompare(g.name)).slice(0,l-(u?1:0)).map((f,g)=>({class:{"b-taskboard-resource-avatar-wrap":1},dataset:{resourceId:f.id},children:[p.getResourceAvatar({resourceRecord:f,imageUrl:f.image===!1?null:f.imageUrl||f.image&&(d||"")+f.image,initials:f.initials,color:f.eventColor,dataset:{btip:x.encodeHtml(f.name)}})]})),u&&{class:{"b-taskboard-resource-avatar-overflow":1},dataset:{resourceId:"$overflow",btip:c.slice(-m).map(f=>x.encodeHtml(f.name)).join(", "),count:m},children:[p.getResourceAvatar({resourceRecord:h,imageUrl:h.image===!1?null:h.imageUrl||h.image&&d+h.image,initials:h.initials})]}],syncOptions:{syncIdField:"resourceId"}})}static onClick({source:e,taskRecord:s,event:t}){const a=t.target.closest(".b-resource-avatar, .b-taskboard-resource-avatar-overflow");if(a){if(a.matches(".b-resource-avatar")){const n=e.project.resourceStore.getById(a.dataset.resourceId);e.trigger("resourceAvatarClick",{resourceRecord:n,taskRecord:s,element:a,event:t})}else e.trigger("resourceAvatarOverflowClick",{taskRecord:s,element:a,event:t});return!1}}};i(ne,"$name","ResourceAvatarsItem"),i(ne,"type","resourceAvatars"),i(ne,"defaultEditor",{type:"resourcescombo",pickerWidth:"13em"}),ne.initClass(),ne._$name="ResourceAvatarsItem";var Ss={resourceAvatars:1,separator:1,taskMenu:1},Ve=".b-taskboard-taskitem",Es=/\s*<\s*/,Is=/\s*>\s*/,ht=e=>{var s;return s=class extends(e||M){get widgetClass(){}changeProcessItems(t){return b.assertFunction(t,"processItems"),t}mergeItems(t,a){return a&&t&&(t=b.mergeItems(a,t)),t}changeHeaderItems(t,a){return b.assertObject(t,"headerItems"),this.mergeItems(t,a)}changeBodyItems(t,a){return b.assertObject(t,"bodyItems"),this.mergeItems(t,a)}changeFooterItems(t,a){return b.assertObject(t,"footerItems"),this.mergeItems(t,a)}renderItems(t,a,n,o){for(const r in a){const l=a[r];if(l&&!l.hidden){"field"in l||(r.includes(">")?[l.field]=r.split(Is):r.includes("<")?[,l.field]=r.split(Es):l.field=r);const{field:d}=l,c=t.getValue(d);if(c!=null||Ss[l.type]||l.renderNull){const u=D.resolveType(l.type),m=`b-taskboard-${x.hyphenate(l.type)}`,h={class:{"b-taskboard-taskitem":1,[m]:1,[l.cls]:l.cls,"b-editable":!t.readOnly&&u.getEditorConfig({config:l,item:u})},dataset:{role:`item-${d}`,field:d,ref:r},elementData:{item:u,taskRecord:t,config:l},style:{order:l.order,style:l.style}};u.render({taskBoard:this,domConfig:h,value:c,config:l,taskRecord:t,cardSize:o})!==!1&&(n.children[r]=h)}}}}populateCard(t){var a;(a=super.populateCard)==null||a.call(this,t);const n=this,{processItems:o}=n,{taskRecord:r,cardConfig:l,cardSize:d}=t,{headerItems:c,bodyItems:u,footerItems:m}=d||{},{header:h,body:p,footer:f}=l.children;let{headerItems:g,bodyItems:C,footerItems:k}=n;(c||o)&&(g=b.clone(g)),(u||o)&&(C=b.clone(C)),(m||o)&&(k=b.clone(k)),c&&b.merge(g,c),u&&b.merge(C,u),m&&b.merge(k,m),o==null||o({headerItems:g,bodyItems:C,footerItems:k,taskRecord:r,cardSize:d}),n.renderItems(r,g,h,d),n.renderItems(r,C,p,d),n.renderItems(r,k,f,d)}resolveTaskItem(t){const a=t.closest(Ve)||t.querySelector(`:scope > * > ${Ve}, :scope > ${Ve}`);return a?{...a.elementData,element:a}:null}onTaskClick(t){var a;const n=this.resolveTaskItem(t.event.target);if(n){const{config:o,item:r}=n;(a=r.onClick)==null||a.call(r,{config:o,...t})}super.onTaskClick(t)}onTaskDblClick(t){var a;const n=this.resolveTaskItem(t.event.target);if(n){const{config:o,item:r}=n;(a=r.onDblClick)==null||a.call(r,{config:o,...t})}super.onTaskDblClick(t)}},i(s,"$name","TaskItems"),i(s,"configurable",{headerItems:{value:{text:{type:"text",field:"name"}},$config:{merge:"items"}},bodyItems:{value:{text:{type:"text",field:"description"}},$config:{merge:"items"}},footerItems:{value:{resourceAvatars:{type:"resourceAvatars",field:"resources"}},$config:{merge:"items"}},processItems:null}),s},Ds=["navigateDown","navigateLeft","navigateUp","navigateRight","activate"],pt=e=>{var s;return s=class extends(e||M){get widgetClass(){}getTaskNear(t,a){var n,o,r;const{documentRoot:l}=this,d=T.measureSize(this.css.cardGap||"1em",this.bodyElement.querySelector(".b-taskboard-swimlane-body .b-taskboard-column"));let c=(n=l.elementFromPoint(t,a))==null?void 0:n.closest(".b-taskboard-card");return c||(c=(o=l.elementFromPoint(t,a-d))==null?void 0:o.closest(".b-taskboard-card")),c||(c=(r=l.elementFromPoint(t,a+d))==null?void 0:r.closest(".b-taskboard-card")),c}focusAndOptionallySelect(t,a){if(t){const n=this,o=n.resolveTaskRecord(document.activeElement);if(a&&o&&!n.isSelected(o)&&n.selectTask(o,!0),n.selectOnNavigation||a){const r=n.resolveTaskRecord(t);n.isSelected(r)?a&&n.deselectTask(o):n.selectTask(r,a)}t.focus()}}navigateNext(t,a){const n=this,{taskRecord:o,swimlaneRecord:r,columnRecord:l}=t.taskBoardData,d=n.getTaskElement(o);let c=null,u=l;do if(u=n.columns.getNext(u,!0),!u.hidden){const m=n.getSwimlaneColumnElement(r,u),h=S.from(m,null,!0).center.x,p=S.from(d,null,!0).center.y;c=n.getTaskNear(h,p)}while(!c&&u!==l);n.focusAndOptionallySelect(c,a)}navigatePrev(t,a){const n=this,{taskRecord:o,swimlaneRecord:r,columnRecord:l}=t.taskBoardData,d=n.getTaskElement(o);let c=null,u=l;do if(u=n.columns.getPrev(u,!0),!u.hidden){const m=n.getSwimlaneColumnElement(r,u),h=S.from(m,null,!0).center.x,p=S.from(d,null,!0).center.y;c=n.getTaskNear(h,p)}while(!c&&u!==l);n.focusAndOptionallySelect(c,a)}navigateRight(t,a=!1){this["navigate"+(this.rtl?"Prev":"Next")](t,a)}navigateLeft(t,a=!1){this["navigate"+(this.rtl?"Next":"Prev")](t,a)}navigateDown(t,a=!1){const{taskRecord:n}=t.taskBoardData,o=this.getNextTask(n,!0);this.focusAndOptionallySelect(this.getTaskElement(o),a)}navigateUp(t,a=!1){const{taskRecord:n}=t.taskBoardData,o=this.getPreviousTask(n,!0);this.focusAndOptionallySelect(this.getTaskElement(o),a)}activate(t){const{taskRecord:a}=this.resolveEvent(t);a&&this.trigger("activateTask",{taskRecord:a,event:t})}isActionAvailable({action:t,event:a}){const n=this.resolveEvent(a);return a.taskBoardData=n,t==="activate"&&n.taskRecord&&a.target!==this.getTaskElement(n.taskRecord)?!1:!!((this.navigateable||!Ds.includes(t))&&(n!=null&&n.taskRecord))}},i(s,"$name","TaskNavigation"),i(s,"configurable",{keyMap:{ArrowDown:"navigateDown",ArrowLeft:"navigateLeft",ArrowUp:"navigateUp",ArrowRight:"navigateRight",Enter:"activate"},navigateable:!0,selectOnNavigation:!1}),s},ft=e=>{var s;return s=class extends(e||M){get widgetClass(){}changeSelectedTasks(t){return b.assertArray(t,"selectedTasks"),t.filter(a=>{var n;return((n=this.isTaskSelectable)==null?void 0:n.call(this,a))!==!1})}toggleTaskSelection(t,a=!1,n=null){const o=this;n==null?o.isSelected(t)?a?o.deselectTask(t):o.selectTask(t,!1):o.selectTask(t,a):n?o.selectTask(t,a):o.deselectTask(t)}selectTask(t,a=!1){var n;const{selectedTasks:o}=this,r={action:"select",select:[t]};((n=this.isTaskSelectable)==null?void 0:n.call(this,t))!==!1&&(a||(r.deselect=o.slice(),o.length=0),ye.include(o,t),this.triggerSelectionChange(r),this.recompose())}deselectTask(t){ye.remove(this.selectedTasks,t),this.triggerSelectionChange({action:"deselect",deselect:[t]}),this.recompose()}deselectAll(){const{selectedTasks:t}=this;if(t.length){const a=t.slice();t.length=0,this.triggerSelectionChange({action:"deselect",deselect:a}),this.recompose()}}isSelected(t){return this.selectedTasks.includes(t)}triggerSelectionChange(t){this.trigger("selectionChange",Object.assign({selection:this.selectedTasks,select:[],deselect:[]},t))}onTaskClick(t){super.onTaskClick(t);const{event:a,taskRecord:n}=t;a.defaultPrevented||this.toggleTaskSelection(n,a.ctrlKey)}keyboardSelect(t){if(!T.isEditable(t.target)){const{taskRecord:a}=this.resolveEvent(t);if(a)return this.toggleTaskSelection(a,!1),!0}return!1}keyboardToggleSelect(t){const{taskRecord:a}=this.resolveEvent(t);a&&this.toggleTaskSelection(a,!0)}onClick(t){super.onClick(t),!t.taskRecord&&this.navigateable&&this.deselectAll()}selectUp(t){this.navigateUp(t,!0)}selectDown(t){this.navigateDown(t,!0)}selectLeft(t){this.navigateLeft(t,!0)}selectRight(t){this.navigateRight(t,!0)}populateCard(t){var a;(a=super.populateCard)==null||a.call(this,t);const{taskRecord:n,cardConfig:o}=t;o.class["b-selected"]=this.isSelected(n)}populateBody(t){var a;(a=super.populateBody)==null||a.call(this,t);const{bodyConfig:n}=t;n.class["b-has-selection"]=!!this.selectedTasks.length}},i(s,"$name","TaskSelection"),i(s,"configurable",{selectedTasks:[],isTaskSelectable:null,keyMap:{" ":"keyboardSelect","Ctrl+ ":"keyboardToggleSelect","Shift+ArrowDown":"selectDown","Shift+ArrowLeft":"selectLeft","Shift+ArrowUp":"selectUp","Shift+ArrowRight":"selectRight"}}),s},oe=class extends D{static render({domConfig:e,value:s,config:t}){s&&Object.assign(e,{tag:"img",src:(t.baseUrl||"")+s,draggable:!1})}};i(oe,"$name","ImageItem"),i(oe,"type","image"),i(oe,"defaultEditor",null),oe.initClass(),oe._$name="ImageItem";var re=class extends D{static render({domConfig:e,config:s,taskRecord:t,value:a}){e.retainChildren=!0,e.children=[s.jsx({value:a,taskRecord:t,config:s})]}};i(re,"$name","JsxItem"),i(re,"type","jsx"),i(re,"defaultEditor",null),re.initClass(),re._$name="JsxItem";var X=class extends D{static render({domConfig:e,value:s,config:t}){const a=Math.round(100*s/(t.max||100))+"%";e.children=[{class:"b-taskboard-progress-outline",dataset:{percent:a},children:[{class:"b-taskboard-progress-progress",style:{width:a},dataset:{percent:a}}]}],e.dataset.percent=e.dataset.btip=a}};i(X,"$name","ProgressItem"),i(X,"type","progress"),i(X,"configurable",{}),i(X,"defaultEditor",null),X.initClass(),X._$name="ProgressItem";var le=class extends D{static render({domConfig:e,value:s,config:t}){const{max:a=s}=t;e.children=[];for(let n=0;n<a;n++)e.children.push({tag:"i",class:{"b-icon b-icon-star":1,"b-filled":n<s}})}};i(le,"$name","RatingItem"),i(le,"type","rating"),i(le,"defaultEditor",null),le.initClass(),le._$name="RatingItem";var ie=class extends D{static render({domConfig:e}){e.tag="hr"}};i(ie,"$name","SeparatorItem"),i(ie,"type","separator"),i(ie,"defaultEditor",null),ie.initClass(),ie._$name="SeparatorItem";var de=class extends He.mixin(A){afterConfigure(){var e;const s=this;if(!((e=s.store)!=null&&e.count)&&s.taskBoard&&s.name){const{name:t,separator:a}=s,n=[];s.taskBoard.project.taskStore.forEach(o=>{const r=o[t];r&&(typeof r=="string"?n.push(...r.split(a)):n.push(...r))}),s.items=[...new Set(n)].sort()}}changeValue(e,s){this.$expectsString=!1,this.separator&&typeof e=="string"&&(e=e.split(this.separator),this.$expectsString=!0),super.changeValue(e,s)}get value(){const e=super.value;return this.$expectsString?e.join(this.separator):e}set value(e){super.value=e}};i(de,"$name","TagCombo"),i(de,"type","tagcombo"),i(de,"configurable",{multiSelect:!0,editable:!1,separator:",",picker:{cls:"b-tag-picker"},chipView:{closable:!1}}),de.initClass(),de._$name="TagCombo";var ce=class extends D{static render({domConfig:e,value:s,config:t}){let a;s&&(typeof s=="string"?a=s.split(t.separator||",").map(n=>({text:n})):Array.isArray(s)&&(a=s.map(n=>typeof n=="string"?{text:n}:{text:t.textProperty&&n[t.textProperty],cls:t.clsProperty&&n[t.clsProperty]})),a&&(e.children=a.map(n=>{const o="cls"in n?n.cls:T.makeValidId(n.text,"-").toLowerCase();return{class:{"b-taskboard-tags-tag":1,[o]:!!o},text:n.text}})))}};i(ce,"$name","TagsItem"),i(ce,"type","tags"),i(ce,"defaultEditor",{type:"tagcombo",pickerWidth:"10em"}),ce.initClass(),ce._$name="TagsItem";var ue=class extends D{static render({domConfig:e,value:s,config:t,taskRecord:a}){const n=t.template({taskRecord:a,config:t,value:s});typeof n=="string"?e.html=n:b.isObject(n)?b.merge(e,n):Array.isArray(n)&&(e.children=n)}};i(ue,"$name","TemplateItem"),i(ue,"type","template"),i(ue,"defaultEditor",null),ue.initClass(),ue._$name="TemplateItem";var me=class extends D{static render({domConfig:e,value:s,config:t,taskRecord:a}){if(s){const{textField:n="text",checkedField:o="checked",clsField:r="cls",checkedIcon:l="b-icon b-icon-checked",uncheckedIcon:d="b-icon b-icon-unchecked"}=t;if(this.firstRender!==!1&&!a.getFieldDefinition(t.field).isArrayDataField)throw new Error('TodoListItem has to be mapped to a field with `type : "array"`');e.children=s.map((c,u)=>({class:{"b-taskboard-todolist-todo":1,[c[r]]:c[r],"b-checked":c[o]},children:{icon:{tag:"i",class:c[o]?l:d},text:{tag:"span",text:c[n]}},elementData:{index:u}})),this.firstRender=!1}}static onClick({source:e,taskRecord:s,event:t,config:a}){const n=t.target.closest(".b-taskboard-todolist-todo");if(n&&!s.readOnly){const{checkedField:o="checked",field:r}=a,{index:l}=n.elementData,d=s.getValue(r).slice(),c=d[l];c[o]=!c[o],s.setValue(r,d),e.trigger("todoToggle",{taskRecord:s,todo:c,checked:c[o],element:n,event:t}),t.preventDefault()}}static onDblClick({event:e}){e.preventDefault()}};i(me,"$name","TodoListItem"),i(me,"type","todoList"),i(me,"defaultEditor",null),me.initClass(),me._$name="TodoListItem";var Bs={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",GridBase:{loadFailedMessage:"Data loading failed!",syncFailedMessage:"Data synchronization failed!"},CrudManagerView:{serverResponseLabel:"Server response:"},TaskBoard:{column:"column",columns:"columns",Columns:"Columns",swimlane:"swimlane",swimlanes:"swimlanes",Swimlanes:"Swimlanes",task:"task",tasks:"tasks",addTask:"Add L{TaskBoard.task}",cancel:"Cancel",changeColumn:"Change L{TaskBoard.column}",changeSwimlane:"Change L{TaskBoard.swimlane}",collapse:e=>`Collapse ${e}`,color:"Color",description:"Description",editTask:"Edit L{TaskBoard.task}",expand:e=>`Expand ${e}`,filterColumns:"Filter L{TaskBoard.columns}",filterSwimlanes:"Filter L{TaskBoard.swimlanes}",filterTasks:"Filter L{TaskBoard.tasks}",moveColumnLeft:"Move L{TaskBoard.column} left",moveColumnRight:"Move L{TaskBoard.column} right",name:"Name",newTaskName:"New L{TaskBoard.task}",removeTask:"Remove L{TaskBoard.task}",removeTasks:"Remove L{TaskBoard.tasks}",resources:"Resources",save:"Save",scrollToColumn:"Scroll to L{TaskBoard.column}",scrollToSwimlane:"Scroll to L{TaskBoard.swimlane}",zoom:"Zoom"},TodoListField:{add:"Add",newTodo:"New todo"},UndoRedo:{UndoLastAction:"Undo",RedoLastAction:"Redo"}},Vs=us.publishLocale(Bs),Ms=(e,s)=>e.weight-s.weight,P=class extends ms.mixin(gs,fs,Tt,kt,Ne,ot,wt,rt,lt,it,dt,ct,ut,mt,gt,ht,pt,ft){constructor(){super(...arguments),i(this,"isInitiallyComposed",!1),i(this,"domTransitionSuspended",0),i(this,"columnRecomposeQueue",new Map)}onPaintOverride(){}onInternalPaint(...e){this.onPaintOverride()||super.onInternalPaint(...e)}changeResourceImagePath(e){return b.assertString(e,"resourceImagePath"),e}changeUseDomTransition(e){return b.assertBoolean(e,"useDomTransition"),e}changeStickyHeaders(e){return b.assertBoolean(e,"stickyHeaders"),e}changeScrollManager(e,s){return s==null||s.destroy(),e?ps.new({element:this.element,owner:this},e):null}changeShowCountInHeader(e){return b.assertBoolean(e,"showCountInHeader"),e}changeTasksPerRow(e){return b.assertNumber(e,"tasksPerRow"),e}changeSwimlaneRenderer(e){return b.assertFunction(e,"swimlaneRenderer"),e}changeTaskRenderer(e){return b.assertFunction(e,"taskRenderer"),e}changeTaskSorterFn(e){return e===!0?Ms:(e&&b.assertFunction(e,"taskSorterFn"),e)}queueColumnRecompose(e,s){this.columnRecomposeQueue.set(`${e.id}.-.${s==null?void 0:s.id}`,{columnRecord:e,swimlaneRecord:s}),this.recomposeColumns()}recomposeColumns(){for(const[,{columnRecord:e,swimlaneRecord:s}]of this.columnRecomposeQueue)this.recomposeColumn(e,s);this.columnRecomposeQueue.clear()}recomposeColumn(e,s){const t=this.getSwimlaneColumnElement(s,e),a=T.normalizeChildren(this.renderColumn(s,e));a.onlyChildren=!0,F.sync({targetElement:t,domConfig:a,callback:this.domSyncCallback,syncOptions:{syncIdField:"column",releaseThreshold:0}})}renderCard(e,s,t){var a,n,o;const r=super.renderCard(e,s,t);if(r)return r;const l=this,{id:d,domId:c,eventColor:u,weight:m}=e,h=u||(t==null?void 0:t.color)||s.color,p=T.isNamedColor(h)?h:null,f=l.getCardSize(s,t),g={id:`${l.id}-card-${c}`,class:{"b-taskboard-card":!0,[`b-taskboard-color-${p}`]:p,"b-readonly":e.readOnly,...e.cls},tabIndex:0,dataset:{task:c,column:s.id,lane:t==null?void 0:t.id,weight:m,domTransition:!0},style:{color:p?null:h,height:(n=(a=l.getTaskHeight)==null?void 0:a.call(l,e))!=null?n:null},elementData:{elementType:"task",taskId:d,taskRecord:e,columnRecord:s,swimlaneRecord:t},children:{header:{tag:"header",class:{"b-taskboard-card-header":1},children:{},syncOptions:{syncIdField:"role"}},body:{tag:"section",class:{"b-taskboard-card-body":1},children:{},syncOptions:{syncIdField:"role"}},footer:{tag:"footer",class:{"b-taskboard-card-footer":1},children:{},syncOptions:{syncIdField:"role"}}}},{children:C}=g,{header:k,body:v,footer:w}=C;return l.populateCard({taskRecord:e,columnRecord:s,swimlaneRecord:t,cardConfig:g,cardSize:f}),(o=l.taskRenderer)==null||o.call(l,{taskRecord:e,columnRecord:s,swimlaneRecord:t,cardConfig:g,cardSize:f}),k.html==null&&k.text==null&&(!k.children||Object.keys(k.children).length===0)&&(C.header=null),v.html==null&&v.text==null&&(!v.children||Object.keys(v.children).length===0)&&(C.body=null),w.html==null&&w.text==null&&(!w.children||Object.keys(w.children).length===0)&&(C.footer=null),g}renderColumnHeader(e){var s,t,a;const n=this,{text:o,id:r,domId:l,width:d,flex:c,minWidth:u,color:m,tooltip:h}=e,p=T.isNamedColor(m)?m:null,f={id:`${n.id}-column-header-${l}`,class:{"b-taskboard-column-header":1,"b-fixed-width":d&&!c,[`b-taskboard-color-${p}`]:p,"b-last":e===this.columns.last},style:{color:p?null:m,width:d,flex:c,minWidth:u},children:{padder:{class:{"b-taskboard-column-header-padder":1},children:{title:{class:{"b-taskboard-column-title":1},dataset:{btip:h},children:[{tag:"span",class:"b-column-title-text",text:o},n.showCountInHeader&&{tag:"span",class:{"b-taskboard-column-count":1},html:`(${(t=(s=n.getColumnTasks(e))==null?void 0:s.length)!=null?t:0})`}]}}}},dataset:{column:l,domTransition:!0},elementData:{elementType:"columnHeader",columnId:r}};return et.showOverflow=!0,n.populateColumnHeader({columnRecord:e,columnHeaderConfig:f}),(a=n.columnHeaderRenderer)==null||a.call(n,{columnRecord:e,columnHeaderConfig:f}),f}renderColumn(e,s){var t,a,n;const o=this,{taskSorterFn:r,stretchCards:l,columnField:d,swimlaneField:c}=o,{width:u,flex:m,id:h,domId:p,minWidth:f,color:g}=s,{taskStore:C}=o.project,k=C.isTree?C.query(I=>I[d]===h&&(!c||!e||I[c]===e.id)):Array.from(C.storage.findItem("columnSwimlaneIntersection",`${s.id}-/-${(t=e==null?void 0:e.id)!=null?t:"default"}`)||[]),v=o.getTasksPerRow(s,e),w=`${o.id}-column-${(a=e==null?void 0:e.domId)!=null?a:"default"}-${p}`,y=T.isNamedColor(g)?g:null,$={id:w,class:{"b-taskboard-column":1,"b-fixed-width":u&&!m,[`b-${v}-task${v>1?"s":""}-per-row`]:1,"b-inline":v>1,[`b-taskboard-color-${y}`]:y,"b-last":s===this.columns.last},style:{color:y?null:g,width:u,flex:m,minWidth:f},dataset:{column:p,lane:e==null?void 0:e.id,domTransition:!0},elementData:{elementType:"column",columnId:h,laneId:e==null?void 0:e.id},children:{body:{id:`${w}-body`,class:{"b-taskboard-column-body":1},dataset:{role:"body",domTransition:!0},children:[{class:{"b-taskboard-column-body-inner":1},style:{"grid-template-columns":`repeat(${l?Math.min(v,k.length):v}, 1fr)`},dataset:{role:"inner",domTransition:!0},children:(r?k.sort(r):k.sort((I,R)=>C.indexOf(I)-C.indexOf(R)),k.map(I=>o.renderCard(I,s,e))),syncOptions:{syncIdField:"task",releaseThreshold:o.isVirtualized?1e3:0}}],syncOptions:{syncIdField:"role"}}},syncOptions:{syncIdField:"role"}};return o.populateColumn({columnRecord:s,swimlaneRecord:e,columnConfig:$}),(n=o.columnRenderer)==null||n.call(o,{columnRecord:s,swimlaneRecord:e,columnConfig:$}),$}renderSwimlane(e){var s,t,a;const n=this,{showCountInHeader:o,columns:r}=n,{id:l="default",domId:d="default",text:c,height:u,flex:m,color:h}=e||{},p=`${n.id}-swimlane-${d}`,f=T.isNamedColor(h)?h:null,g={id:p,class:{"b-taskboard-swimlane":1,"b-fixed-height":u&&!m,"b-last":!e||e===n.swimlanes.last,[`b-taskboard-color-${f}`]:f},style:{color:f?null:h,height:u,flex:m},dataset:{lane:d,domTransition:!0},elementData:{elementType:"swimlane",laneId:l},children:{header:e&&{id:`${p}-header`,tag:"header",class:{"b-taskboard-swimlane-header":1},dataset:{role:"header",domTransition:"preserve-padding"},children:{title:{class:{"b-taskboard-swimlane-title":1},children:{text:c,count:o&&{tag:"span",class:{"b-taskboard-swimlane-count":1},text:`(${(t=(s=n.getSwimlaneTasks(e))==null?void 0:s.size)!=null?t:0})`}}}}},body:{id:`${p}-body`,class:{"b-taskboard-swimlane-body":1},dataset:{role:"body",domTransition:!0},children:r.map(C=>!C.hidden&&n.renderColumn(e,C)),syncOptions:{syncIdField:"column",releaseThreshold:0}}},syncOptions:{syncIdField:"role"}};return n.populateSwimlane({swimlaneRecord:e,swimlaneConfig:g}),(a=n.swimlaneRenderer)==null||a.call(n,{swimlaneRecord:e,swimlaneConfig:g}),g}get bodyConfig(){const e=this,{stickyHeaders:s,showCountInHeader:t,columns:a,columnField:n,swimlaneField:o,tasksPerRow:r,headerItems:l,bodyItems:d,footerItems:c,selectedTasks:u,showCollapseInHeader:m,showCollapseTooltip:h,taskSorterFn:p,stretchCards:f}=e;if(!e.rendered)return e.setTimeout(()=>e.recompose(),0),{reference:"bodyElement",listeners:b.assign({thisObj:e},e.domListeners)};const g={skipClone:!0,reference:"bodyElement",class:{"b-taskboard-body":1,"b-sticky-headers":s},children:[{tag:"header",id:`${e.id}-column-headers`,class:{"b-taskboard-column-headers":1},children:a.map(k=>!k.hidden&&e.renderColumnHeader(k)),dataset:{lane:"header",domTransition:!0},syncOptions:{syncIdField:"column"}}],syncOptions:{syncIdField:"lane",releaseThreshold:0,ignoreRefs:"children"}};let{swimlanes:C}=e;C!=null&&C.count||(C=[null]);for(const k of C)k!=null&&k.hidden||g.children.push(e.renderSwimlane(k));return e.populateBody({bodyConfig:g}),e.isComposed=!0,g}populateCard(e){var s;(s=super.populateCard)==null||s.call(this,e)}populateColumn(e){var s;(s=super.populateColumn)==null||s.call(this,e)}populateColumnHeader(e){var s;(s=super.populateColumnHeader)==null||s.call(this,e)}populateSwimlane(e){var s;(s=super.populateSwimlane)==null||s.call(this,e)}populateBody(e){var s;(s=super.populateBody)==null||s.call(this,e)}afterRecompose(){super.afterRecompose();const e=this;!e.isInitiallyComposed&&e.isComposed&&(e.isInitiallyComposed=!0,e.initialCompose()),e.project.taskStore.count>0&&e.trigger("renderTasks",{taskRecords:e.project.taskStore.allRecords}),e.transitionRecompose=null}initialCompose(){this.trigger("initialCompose")}onRenderColumn(){}onRemoveColumnElement(){}onRenderSwimlane(){}onRemoveSwimlaneElement(){}suspendDomTransition(){this.domTransitionSuspended++}resumeDomTransition(){this.domTransitionSuspended--}recomposeWithDomTransition(e){const s=this;s.useDomTransition&&!s.domTransitionSuspended&&(s.transitionRecompose={selector:"[data-dom-transition]",duration:300,element:s._bodyElement,...e}),s.recompose.suspended?s._recomposeQueued=!0:s.recompose()}resumeRecompose(){super.resumeRecompose(),this._recomposeQueued&&(this._recomposeQueued=null,this.recompose())}getCurrentConfig(e){const s=super.getCurrentConfig(e);return s.columns&&delete s.columns.modelClass,s}refresh(){this.recompose()}};i(P,"$name","TaskBoardBase"),i(P,"type","taskboardbase"),i(P,"featureable",{factory:O}),i(P,"configurable",{layout:"vbox",features:!0,taskRenderer:null,swimlaneRenderer:null,tasksPerRow:1,stretchCards:null,showCountInHeader:!0,stickyHeaders:!1,useDomTransition:!1,resourceImagePath:null,cssVarPrefix:"taskboard",scrollManager:{value:{},$config:["nullify","lazy"]},taskSorterFn:null,contentElMutationObserver:!1,textContent:!1,scrollable:!0}),i(P,"delayable",{recomposeColumns:"raf"}),P.initClass(),tt.setVersion("taskboard","5.6.2"),P._$name="TaskBoardBase";var _e=class extends D{static render({taskBoard:e,domConfig:s}){if(!e.features.taskMenu||e.features.taskMenu.disabled)return!1;s.tag="button",s.class["b-icon b-icon-menu-horizontal"]=1}static onClick({source:e,event:s}){var t;(t=e.features.taskMenu)==null||t.showContextMenu(s,{target:s.target})}};i(_e,"$name","TaskMenuItem"),i(_e,"type","taskMenu"),i(_e,"defaultEditor",null),_e.initClass(),_e._$name="TaskMenuItem";var ge=class extends P{};i(ge,"$name","TaskBoard"),i(ge,"type","taskboard"),i(ge,"configurable",{features:{columnHeaderMenu:!0,columnToolbars:!0,taskDrag:!0,taskDragSelect:!0,taskEdit:!0,taskMenu:!0}}),ge.initClass(),ge._$name="TaskBoard";var he=class extends Ae.mixin(A){};i(he,"$name","ColumnFilterField"),i(he,"type","columnfilterfield"),i(he,"configurable",{store:"this.taskBoard.columns",field:"text",label:"L{TaskBoard.filterColumns}",width:"20em",triggers:{filter:{cls:"b-icon b-icon-filter",align:"start"}}}),he.initClass(),he._$name="ColumnFilterField";var pe=class extends Re.mixin(A){onToggleColumn({item:e}){e.column.hidden=!e.checked}onMenuBeforeShow(e){super.onMenuBeforeShow(e),e.source.items=this.taskBoard.columns.map(s=>({ref:s.id,text:x.encodeHtml(s.text),checked:!s.hidden,column:s,onItem:"up.onToggleColumn"}))}};i(pe,"$name","ColumnPickerButton"),i(pe,"type","columnpickerbutton"),i(pe,"configurable",{text:"L{TaskBoard.Columns}",icon:"b-icon-picker",pressedIcon:"b-icon-picker-rotated",iconAlign:"end",menuIcon:null,menu:{items:null}}),pe.initClass(),pe._$name="ColumnPickerButton";var fe=class extends Re.mixin(A){onClickColumn({item:e}){this.setTimeout(()=>{var s;return(s=this.taskBoard)==null?void 0:s.scrollToColumn(e.column)},100)}changeMenu(e){return e&&(e=this.taskBoard.columns.map(s=>({ref:s.id,text:x.encodeHtml(s.text),column:s,onItem:"up.onClickColumn"}))),super.changeMenu(e)}};i(fe,"$name","ColumnScrollButton"),i(fe,"type","columnscrollbutton"),i(fe,"configurable",{text:"L{TaskBoard.scrollToColumn}",icon:"b-icon-picker",pressedIcon:"b-icon-picker-rotated",iconAlign:"end",menuIcon:null,menu:[]}),fe.initClass(),fe._$name="ColumnScrollButton";var be=class extends ze.mixin(A){updateTaskBoard(e){e&&(this.project=e.project)}afterConfigure(){this._taskBoard||this.updateTaskBoard(this.taskBoard)}};i(be,"$name","ProjectCombo"),i(be,"type","taskboardprojectcombo"),i(be,"configurable",{project:null}),be.initClass(),be._$name="ProjectCombo";var ke=class extends Ae.mixin(A){};i(ke,"$name","SwimlaneFilterField"),i(ke,"type","swimlanefilterfield"),i(ke,"configurable",{store:"this.taskBoard.swimlanes",field:"text",label:"L{TaskBoard.filterSwimlanes}",width:"20em",triggers:{filter:{cls:"b-icon b-icon-filter",align:"start"}}}),ke.initClass(),ke._$name="SwimlaneFilterField";var ve=class extends Re.mixin(A){onToggleSwimlane({item:e}){e.swimlane.hidden=!e.checked}onMenuBeforeShow(e){super.onMenuBeforeShow(e),e.source.items=this.taskBoard.swimlanes.map(s=>({ref:s.id,text:x.encodeHtml(s.text),checked:!s.hidden,swimlane:s,onItem:"up.onToggleSwimlane"}))}};i(ve,"$name","SwimlanePickerButton"),i(ve,"type","swimlanepickerbutton"),i(ve,"configurable",{text:"L{TaskBoard.Swimlanes}",icon:"b-icon-picker",pressedIcon:"b-icon-picker-rotated",iconAlign:"end",menuIcon:null,menu:{items:null}}),ve.initClass(),ve._$name="SwimlanePickerButton";var Ce=class extends Re.mixin(A){onClickSwimlane({item:e}){this.setTimeout(()=>{var s;return(s=this.taskBoard)==null?void 0:s.scrollToSwimlane(e.swimlane)},100)}changeMenu(e){return e&&(e=this.taskBoard.swimlanes.map(s=>({ref:s.id,text:x.encodeHtml(s.text),swimlane:s,onItem:"up.onClickSwimlane"}))),super.changeMenu(e)}};i(Ce,"$name","SwimlaneScrollButton"),i(Ce,"type","swimlanescrollbutton"),i(Ce,"configurable",{text:"L{TaskBoard.scrollToSwimlane}",icon:"b-icon-picker",pressedIcon:"b-icon-picker-rotated",iconAlign:"end",menuIcon:null,menu:[]}),Ce.initClass(),Ce._$name="SwimlaneScrollButton";var Te=class extends Ae.mixin(A){};i(Te,"$name","TaskFilterField"),i(Te,"type","taskfilterfield"),i(Te,"configurable",{store:"this.taskBoard.project.taskStore",field:"name",label:"L{TaskBoard.filterTasks}",width:"20em",triggers:{filter:{cls:"b-icon b-icon-filter",align:"start"}}}),Te.initClass(),Te._$name="TaskFilterField";var Z=class extends ds{compose(){const{editableItems:e}=this;return{class:{"b-editable":e}}}changeList(e){return Fe.create(b.assign({itemTpl:s=>x.xss`<div class="b-todo-text">${s.getValue(this.textField)}</div><i class='b-todo-edit b-icon b-icon-edit' data-noselect></i>`},e))}updateList(e){e.ion({item:"onItemClick",thisObj:this}),e.ion({selectionChange:"onSelectionChange",thisObj:this})}changeAddButton(e){const s=Fe.create(e);return this.ariaElement=s.element,s}updateAddButton(e){e.ion({click:"onAddClick",thisObj:this})}get childItems(){return[this.list,this.addButton]}get inputElement(){return this.list.element}get innerElements(){return super.innerElements.concat(this.addButton.element)}changeValue(e){e=e||[];let s=!1;return this.eachAncestor(t=>{if(t.autoUpdateRecord)return s=!0,!1}),this.originalValue=s?e:b.clone(e),e&&(e=b.clone(e),e.forEach((t,a)=>{t.id=a+1,t.originalIndex=a})),e}updateValue(e){if(e){const s=this;s.list.items=e,s.isSettingValue=!0,s.list.selected.values=e.filter(t=>t[s.checkedField]),s.isSettingValue=!1}}get value(){return this.originalValue.slice()}set value(e){super.value=e}get isValid(){return!0}editItem(e,s){const t=this,a=new Xe({appendTo:t.element,owner:t,cls:"b-todo-editor",inputField:{type:"text",triggers:{remove:{cls:"b-todo-remove b-icon-trash",handler(){t.removeItem(e),a.cancelEdit()}}}},style:"z-index : 20000",internalListeners:{complete({value:n}){t.originalValue[e.originalIndex][t.textField]=n,t.triggerFieldChange({value:t.value,userAction:!0})},finishEdit(){a.destroy()},thisObj:t}});a.startEdit({target:s,record:e,field:t.textField})}removeItem(e){const s=this,{originalIndex:t}=e;s.list.store.forEach(a=>{a.parentIndex>e.parentIndex&&a.originalIndex--}),s.list.store.remove(e),s.originalValue.splice(t,1),s.triggerFieldChange({value:s.value,userAction:!0})}onSelectionChange(){const e=this,{list:s}=e;e.isSettingValue||(e.originalValue.forEach((t,a)=>{const n=s.store.getAt(a);n&&(t[e.checkedField]=s.selected.includes(n))}),e.triggerFieldChange({value:e.value,userAction:!0}))}onItemClick({record:e,event:s}){s.target.matches(".b-todo-edit")&&this.editItem(e,s.target.closest(".b-list-item"))}onAddClick(){const e=this;e.originalValue.push({[e.textField]:e.L("L{newTodo}"),[e.checkedField]:!1}),e.value=e.originalValue,e.triggerFieldChange({value:e.value,userAction:!0})}};i(Z,"$name","TodoListField"),i(Z,"type","todolistfield"),i(Z,"alias","todolist"),i(Z,"configurable",{textField:"text",checkedField:"checked",editableItems:!0,list:{type:"list",multiSelect:!0,store:{fields:[]},itemIconTpl(){return'<i class="b-todo-checkbox b-icon"></i>'}},addButton:{type:"button",cls:"b-todo-add",icon:"b-icon-add",text:"L{TodoListField.add}"},role:null}),Z.initClass(),Z._$name="TodoListField";var $e=class extends vt.mixin(A){construct(){super.construct(...arguments),this.stm=this.taskBoard.project.stm}};i($e,"$name","UndoRedo"),i($e,"type","taskboardundoredo"),$e.initClass(),$e._$name="UndoRedo";var we=class extends Ct.mixin(A){calculateValue(e){return this.max-e+1}afterConstruct(){this.value=this.calculateValue(this.taskBoard.tasksPerRow)}onInput({value:e}){this.taskBoard.tasksPerRow=this.calculateValue(e)}updateValue(e){super.updateValue(e),this.onInput({value:e})}getTooltipHtml(e){const s=this.calculateValue(e);return`${s} card${s===1?"":"s"} per row`}};i(we,"$name","ZoomSlider"),i(we,"type","zoomslider"),i(we,"configurable",{text:"L{TaskBoard.zoom}",max:10,min:1,value:null,showValue:!1}),we.initClass(),we._$name="ZoomSlider";export{yt as AbstractCrudManager,xt as AbstractCrudManagerMixin,St as AbstractCrudManagerValidation,Et as AjaxTransport,It as AssignmentModel,Dt as AssignmentModelMixin,Bt as AssignmentStore,Mt as AssignmentStoreMixin,W as ColorBoxCombo,Se as ColumnCombo,Y as ColumnDrag,he as ColumnFilterField,j as ColumnHeaderMenu,Ie as ColumnModel,pe as ColumnPickerButton,fe as ColumnScrollButton,H as ColumnToolbars,_t as CrudManager,Ne as CrudManagerView,$t as DependencyBaseModel,Rt as DependencyModel,Ft as DependencyStore,Ot as DependencyStoreMixin,We as EventModel,At as EventModelMixin,Ue as EventStore,Lt as EventStoreMixin,ot as ExpandCollapse,Pt as GetEventsMixin,os as GridRowModel,oe as ImageItem,jt as JsonEncoder,re as JsxItem,Ht as PartOfProject,X as ProgressItem,be as ProjectCombo,Ge as ProjectCrudManager,Oe as ProjectModel,Vt as ProjectModelCommon,zt as ProjectModelMixin,Nt as ProjectModelTimeZoneMixin,le as RatingItem,Wt as RecurrenceModel,Ut as RecurringEventsMixin,Gt as RecurringTimeSpan,qt as RecurringTimeSpansMixin,ne as ResourceAvatarsItem,Kt as ResourceModel,Xt as ResourceModelMixin,Zt as ResourceStore,Jt as ResourceStoreMixin,Yt as ResourceTimeRangeModel,Qt as ResourceTimeRangeStore,ee as ResourcesCombo,rt as ResponsiveCards,ze as SchedulerProjectCombo,qe as SchedulerProjectModel,ie as SeparatorItem,V as SimpleTaskEdit,Ee as SwimlaneCombo,Q as SwimlaneDrag,ke as SwimlaneFilterField,Be as SwimlaneModel,ve as SwimlanePickerButton,Ce as SwimlaneScrollButton,de as TagCombo,ce as TagsItem,ge as TaskBoard,P as TaskBoardBase,lt as TaskBoardColumns,it as TaskBoardDom,dt as TaskBoardDomEvents,O as TaskBoardFeature,A as TaskBoardLinked,ct as TaskBoardScroll,ut as TaskBoardStores,mt as TaskBoardSwimlanes,gt as TaskBoardVirtualization,se as TaskColorCombo,te as TaskColorPicker,z as TaskDrag,N as TaskDragSelect,U as TaskEdit,ae as TaskEditor,Te as TaskFilterField,D as TaskItem,ht as TaskItems,G as TaskMenu,K as TaskModel,pt as TaskNavigation,ft as TaskSelection,De as TaskStore,q as TaskTooltip,ue as TemplateItem,Me as TextItem,es as TimeRangeModel,ts as TimeRangeStore,ss as TimeSpan,as as TimeZonedDatesMixin,Z as TodoListField,me as TodoListItem,$e as UndoRedo,we as ZoomSlider};
//# sourceMappingURL=taskboard.module.thin.js.map
