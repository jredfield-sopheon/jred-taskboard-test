/*!
 *
 * Bryntum TaskBoard 5.6.2
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
import{ArrayHelper as I,Base as y,Button as T,Checkbox as O,DomClassList as W,DomHelper as k,Events_default as _,FunctionHelper as A,GlobalEvents_default as S,Labelable_default as E,ObjectHelper as f,Panel as x,Toolbar as B,Widget as H,__publicField as o}from"./chunk-MZVS5JQA.js";var p=class extends _(y){construct(e={}){const t=this;super.construct(e),t.onWsOpen=t.onWsOpen.bind(t),t.onWsClose=t.onWsClose.bind(t),t.onWsMessage=t.onWsMessage.bind(t),t.onWsError=t.onWsError.bind(t),t.autoConnect&&t.address&&t.open()}doDestroy(){const e=this;e.connector&&(e.detachSocketListeners(e.connector),e.connector.close(),e.connector=null),super.doDestroy()}get isConnecting(){var e;return((e=this.connector)==null?void 0:e.readyState)===this.constructor.webSocketImplementation.CONNECTING}get isOpened(){var e;return((e=this.connector)==null?void 0:e.readyState)===this.constructor.webSocketImplementation.OPEN}get isClosing(){var e;return((e=this.connector)==null?void 0:e.readyState)===this.constructor.webSocketImplementation.CLOSING}get isClosed(){var e;return((e=this.connector)==null?void 0:e.readyState)===this.constructor.webSocketImplementation.CLOSED}createWebSocketConnector(){const e=this.connector=new this.constructor.webSocketImplementation(this.address);this.attachSocketListeners(e)}destroyWebSocketConnector(){this.detachSocketListeners(this.connector),this.connector.close(),this.connector=null}attachSocketListeners(e){const t=this;e.addEventListener("open",t.onWsOpen),e.addEventListener("close",t.onWsClose),e.addEventListener("message",t.onWsMessage),e.addEventListener("error",t.onWsError)}detachSocketListeners(e){const t=this;e.removeEventListener("open",t.onWsOpen),e.removeEventListener("close",t.onWsClose),e.removeEventListener("message",t.onWsMessage),e.removeEventListener("error",t.onWsError)}async open(){const e=this;if(e._openPromise)return e._openPromise;if(!e.address){console.warn("Server me.address cannot be empty");return}if(e.isOpened)return!0;e.createWebSocketConnector();let t;return e._openPromise=new Promise(i=>{t=e.ion({open(){i(!0)},error(){i(!1)}})}).then(i=>(t(),e._openPromise=null,i||e.destroyWebSocketConnector(),i)).catch(()=>{e._openPromise=null,e.destroyWebSocketConnector()}),e._openPromise}close(){this.connector&&(this.destroyWebSocketConnector(),this.trigger("close"))}send(e,t={}){var i;(i=this.connector)==null||i.send(JSON.stringify({command:e,...t}))}onWsOpen(e){this.trigger("open",{event:e})}onWsClose(e){this.trigger("close",{event:e})}onWsMessage(e){try{const t=JSON.parse(e.data);this.trigger("message",{data:t})}catch(t){this.trigger("error",{error:t})}}onWsError(e){this.trigger("error",{error:e})}};o(p,"webSocketImplementation",typeof WebSocket=="undefined"?null:WebSocket),o(p,"configurable",{address:"",userName:"User",autoConnect:!0}),p._$name="WebSocketManager";var c=class extends x.mixin(E){static get configurable(){return{bodyTag:"fieldset",focusable:!1,inline:null,inlineInternal:null,layout:{type:"box",horizontal:!1}}}static get prototypeProperties(){return{flexRowCls:"b-hbox",flexColCls:"b-vbox"}}get bodyConfig(){const e=super.bodyConfig,{className:t}=e,{inlineInternal:i,hasLabel:a,title:n}=this;return delete e.html,t["b-inline"]=i,t["b-fieldset-has-label"]=a,n&&(e.children={legendElement:{tag:"legend",text:n,class:{"b-fieldset-legend":1}}}),e}compose(){const{inlineInternal:e,label:t,labelCls:i,labelWidth:a}=this;return{class:{"b-field":t,"b-vbox":!e},children:{"labelElement > headerElement":(t||null)&&{tag:"label",html:t,class:{"b-label":1,"b-align-start":1,[i]:i},style:{width:k.unitize("width",a)[1]}}}}}syncInlineInternal(){var e;this.inlineInternal=(e=this.inline)!=null?e:this.label!=null&&this.labelPosition==="before"}updateDisabled(e,t){super.updateDisabled(e,t),this.eachWidget(i=>{i.disabled=e},!1)}updateInline(){this.syncInlineInternal()}updateInlineInternal(e){this.layout.horizontal=e}updateLabel(){this.syncInlineInternal()}updateLabelPosition(){this.syncInlineInternal()}};o(c,"$name","FieldSet"),o(c,"type","fieldset"),c.initClass(),c._$name="FieldSet";var u=class extends O{static get configurable(){return{inputType:"radio",clearable:null,uncheckedValue:void 0}}get textLabelCls(){return super.textLabelCls+" b-radio-label"}internalOnClick(e){super.internalOnClick(e)!==!1&&this.checked&&this.clearable&&(this.checked=!1)}updateName(e){this.toggleGroup=e}updateClearable(){}};o(u,"$name","Radio"),o(u,"type","radio"),o(u,"alias","radiobutton"),u.initClass(),u._$name="Radio";var m=class extends c{static get configurable(){return{defaultType:"radio",clearable:null,name:null,options:{value:null,$config:{merge:"items"}},defaultBindProperty:"value"}}get existingOptions(){const{name:e}=this;return this.ensureItems().filter(t=>t.name===e)}get refPrefix(){return`${this.name||this.ref||this.id}_`}get selected(){return this.existingOptions.filter(e=>e.input.checked)[0]||null}get value(){const{selected:e}=this;return e?e.checkedValue:null}set value(e){this.existingOptions.forEach(t=>{t.isConfiguring=this.isConfiguring,t.checked=t.checkedValue===e,t.isConfiguring=!1})}ensureItems(){return this.getConfig("options"),super.ensureItems()}changeOptions(e,t){if(!(e&&t&&f.isDeeplyEqual(t,e)))return e}convertOption(e,t,i){const a=this,{name:n}=a,s={name:n,type:"radio",value:e===a.value,ref:`${a.refPrefix}${e}`,checkedValue:e};return typeof t=="string"?s.text=t:f.assign(s,t),i?H.reconfigure(i,s):s}isOurRadio(e){return e.isRadio&&e.name===this.name}isolateFieldChange(e){return this.isOurRadio(e)}onChildAdd(e){super.onChildAdd(e),this.isOurRadio(e)&&e.ion({name:e.id,beforeChange:"onRadioItemBeforeChange",change:"onRadioItemChange",click:"onRadioClick",thisObj:this})}onChildRemove(e){this.isOurRadio(e)&&this.detachListeners(e.id),super.onChildRemove(e)}onRadioClick(e){const{source:t}=e;t.checked&&this.clearable&&t.clearable==null&&(t.checked=!1)}onRadioItemBeforeChange(e){if(e.checked){const t=this,{lastValue:i}=t;if(!t.reverting&&t.trigger("beforeChange",t.wrapRadioEvent(e))===!1&&i!=null&&i!==t.value)return t.reverting=!0,e.source.uncheckToggleGroupMembers(),t.value=i,t.lastValue=i,t.reverting=!1,!1}}onRadioItemChange(e){const t=this;e.checked&&!t.reverting&&(t.triggerFieldChange(t.wrapRadioEvent(e)),t.lastValue=t.value)}wrapRadioEvent(e){return{from:e,item:e.source,userAction:e.userAction,lastValue:this.lastValue,value:this.value}}updateOptions(){const e=this,{options:t,refPrefix:i}=e,a=e.existingOptions.reduce((d,C)=>(d[C.ref.substring(i.length)]=C,d),{});let n=0,s,r;if(t)for(s in t)r=e.convertOption(s,t[s],a[s]),delete a[s],e.insert(r,n++);const l=Object.values(a);l!=null&&l.length&&(e.remove(l),l.forEach(d=>d.destroy()))}};o(m,"$name","RadioGroup"),o(m,"type","radiogroup"),m.initClass(),m._$name="RadioGroup";var h=class extends T{static get configurable(){return{active:null,index:null,isFirst:null,isLast:null,item:{value:null,$config:"nullify"},itemCls:null,tabPanel:null,titleProperty:"text",titleSource:"title",role:"tab"}}compose(){const{active:e,cls:t,index:i,isFirst:a,isLast:n}=this,s=this.owner.visibleChildCount;return{tabindex:0,"aria-selected":e,"aria-setsize":s,"aria-posinset":i+1,class:{"b-tabpanel-tab":1,"b-active":e,"b-tab-first":a,"b-tab-last":n,...t},dataset:{index:i}}}updateIndex(e){this.isFirst=!e}updateItem(e,t){var i,a;const n=this;(t==null?void 0:t.tab)===n&&(t.tab=null),e&&(e.tab=n,n[n.titleProperty]=e[n.titleSource],n.itemCls=e.cls,n.ariaElement.setAttribute("aria-controls",e.id),e.role="tabpanel"),(i=n.itemChangeDetacher)==null||i.call(n),n.itemChangeDetacher=e&&A.after(e,"onConfigChange","onItemConfigChange",n,{return:!1}),(a=n.itemHideDetacher)==null||a.call(n),n.itemHideDetacher=e==null?void 0:e.ion({beforeChangeHidden:"onItemBeforeChangeHidden",beforeHide:"onItemBeforeHide",beforeUpdateDisabled:"onItemBeforeUpdateDisabled",thisObj:n,prio:1e3}),n.syncMinMax()}updateItemCls(e,t){const{element:i}=this,a=i&&W.from(i==null?void 0:i.classList,!0);i&&(a.remove(t).add(e),i.className=a.value)}updateRotate(e,t){!e!=!t&&this.syncMinMax()}syncMinMax(){const e=this,{rotate:t,tabPanel:i}=e;let{_minWidth:a,_minHeight:n,_maxWidth:s,_maxHeight:r}=e;if(i){const{tabMinWidth:l,tabMaxWidth:d}=i;l!=null&&(t?(a===l&&(a=null),n=l):(n===l&&(n=null),a=l)),d!=null&&(t?(s===d&&(s=null),r=d):(r===d&&(r=null),s=d)),e.minWidth=a,e.minHeight=n,e.maxWidth=s,e.maxHeight=r}}onItemBeforeChangeHidden({source:e,hidden:t}){if(!e.$isDeactivating&&!e.$isActivating){const{tabPanel:i}=this;this.hidden=t,t&&e===i.activeItem&&i.activateAvailableTab(e)}}onItemBeforeHide(){this.item.$isDeactivating||this.hide()}onItemBeforeUpdateDisabled({source:e,disabled:t}){const{tabPanel:i}=this;this.disabled=t,e===i.activeItem&&i.activateAvailableTab(e)}onItemConfigChange({name:e,value:t}){e===this.titleSource&&(this[this.titleProperty]=t)}};o(h,"$name","Tab"),o(h,"type","tab"),h.initClass(),h._$name="Tab";var v=e=>e.isTab,g=class extends B{static get configurable(){return{defaultType:"tab",overflow:"scroll",role:"tablist",ignoreParentReadOnly:!0}}get firstTab(){return this.tabAt(0)}get lastTab(){return this.tabAt(-1)}get tabCount(){return this._items.countOf(v)}get tabs(){return I.from(this._items,v)}compose(){return{children:{toolbarContent:{class:{"b-tabpanel-tabs":1}}}}}indexOfTab(e){return this._items.indexOf(e,v)}onChildAdd(e){super.onChildAdd(e),e.index==null&&this.syncTabs()}onChildRemove(e){super.onChildRemove(e),this.syncTabs()}onFocusIn(){const{activeIndex:e}=this.owner;isNaN(e)||this.tabs[e].focus()}syncTabs(){const{tabs:e}=this;for(let t=0,i=e.length;t<i;++t)e[t].index=t,e[t].isFirst=!t,e[t].isLast=t===i-1}tabAt(e){return this._items.find(v,e)||null}};o(g,"$name","TabBar"),o(g,"type","tabbar"),g.initClass(),g._$name="TabBar";var P=e=>e.maximized,b=class extends x{static get configurable(){return{activeTab:0,animateTabChange:!0,autoHeight:!1,defaultType:"container",focusable:!1,itemCls:"b-tabpanel-item",layout:{type:"card"},suppressChildHeaders:!0,tabBar:{type:"tabbar",weight:-2e3},tabMinWidth:null,tabMaxWidth:null}}get activeIndex(){return this.layout.activeIndex}get activeItem(){return this.layout.activeItem}get activeTabItemIndex(){var e;const{activeTab:t,items:i,tabBar:a}=this;return i.indexOf((e=a.tabs[t])==null?void 0:e.item)}get bodyConfig(){return f.merge({className:{"b-tabpanel-body":1}},super.bodyConfig)}get focusElement(){var e;const t=this.items[this.activeTab||0];return(t==null?void 0:t.focusElement)||((e=t==null?void 0:t.tab)==null?void 0:e.focusElement)}get tabPanelBody(){return this.bodyElement}finalizeInit(){super.finalizeInit();const e=this,{activeTab:t,layout:i}=e,{activeIndex:a}=i,{tabs:n}=e.tabBar,s=t>=0&&t<n.length&&e.items.indexOf(n[t].item);if(n.length>0&&(s===!1||s<0))throw new Error(`Invalid activeTab ${t} (${n.length} tabs)`);s!==a&&i.setActiveItem(s,a,{animation:!1,silent:!0}),i.animateCardChange=e.animateTabChange}onChildAdd(e){if(super.onChildAdd(e),!this.initialItems){const t=this,{tabBar:i}=t,a=t.makeTabConfig(e),n=a&&(i==null?void 0:i.firstTab),s=n&&i._items,r=n&&I.from(t._items,d=>d.tab||d===e),l=n?r.indexOf(e)+s.indexOf(n):0;a&&i&&(n&&e.weight==null&&l<s.count-1?i.insert(a,l):i.add(a))}}onChildRemove(e){const{tab:t}=e,{items:i}=this;t&&(this.tabBar.remove(t),t.destroy()),e===this.activeItem&&(this._activeTab=null,i.length&&(this.activeTab=i[Math.min(this.activeIndex,i.length-1)])),super.onChildRemove(e)}isDisabledOrHiddenTab(e){const{tabs:t}=this.tabBar,i=t==null?void 0:t[e];return i&&(i.disabled||i.hidden)}findAvailableTab(e,t=1){const{tabs:i}=this.tabBar,a=i.length,n=Math.max(0,i.indexOf(e.tab));n&&(t=-t);let s;for(let r=1;r<=a&&(s=(n+(t<0?a:0)+r*t)%a,!!this.isDisabledOrHiddenTab(s));++r);return s}activateAvailableTab(e,t=1){this.activeTab=this.findAvailableTab(e,t)}changeActiveTab(e,t){const i=this,{tabBar:a,layout:n}=i,{tabCount:s}=a;if(e.isWidget||f.isObject(e)?(i.items.indexOf(e)===-1&&(e=i.add(e)),e=a.indexOfTab(e.tab)):e=parseInt(e,10),!i.initialItems&&s>0&&(e<-1||e>=s))throw new Error(`Invalid activeTab ${e} (${s} tabs)`);if(i.isDisabledOrHiddenTab(e)&&(e=i.findAvailableTab(e)),n.animateCardChange&&n.cardChangeAnimation)n.cardChangeAnimation.then(r=>{(r==null?void 0:r.activeIndex)!==e&&(i._activeTab=e,i.updateActiveTab(e,t))});else return e}async updateActiveTab(e,t){var i;if(!this.initialItems){const{activeTabItemIndex:a,layout:n}=this;if(a>-1){const s=this.items[t],r=this.items[a];n.activeItem!==r&&(n.animateCardChange&&await this.tabSelectionPromise,s!=null&&s.containsFocus&&s.tab.focus(),this.tabSelectionPromise=(i=n.setActiveItem(r))==null?void 0:i.promise)}}}changeTabBar(e){return this.getConfig("strips"),this.strips={tabBar:e},this.strips.tabBar}makeTabConfig(e){const{tab:t}=e,i={item:e,type:"tab",tabPanel:this,disabled:!!e.disabled,hidden:e.initialConfig.hidden,weight:e.weight||0,internalListeners:{click:"onTabClick",thisObj:this},localizableProperties:{text:!1}};return t===!1?null:f.isObject(t)?h.mergeConfigs(i,t):i}updateItems(e,t){const i=this,{activeTab:a,initialItems:n}=i;let s=0,r;super.updateItems(e,t),n&&(r=Array.from(e,l=>i.makeTabConfig(l)).filter(l=>{if(l)return l.index=s++,!0}),s&&(r[0].isFirst=!0,r[s-1].isLast=!0,r[a].active=!0,i.tabBar.add(r),i.activeTab=a))}updateTabMinWidth(e){var t;(t=this.tabBar)==null||t.items.forEach(i=>{i.isTab&&(i.minWidth=e)})}updateTabMaxWidth(e){var t;(t=this.tabBar)==null||t.items.forEach(i=>{i.isTab&&(i.maxWidth=e)})}updateAutoHeight(e){this.detachListeners("themeAutoHeight"),e&&S.ion({name:"themeAutoHeight",theme:"internalOnThemeChange",thisObj:this}),this.$measureHeight=e}applyAutoHeight(){const e=this,{layout:t,activeTab:i,element:a}=e,{animateCardChange:n}=t;if(t.animateCardChange=!1,e.height=null,!e.up(P)){const s=e.height=Math.max(...e.items.map(r=>(e.activeTab=r,a.clientHeight)))+1;e.flex=`1 1 ${s}px`}e.activeTab=i,t.animateCardChange=n,e.$measureHeight=!1}internalOnThemeChange(){this.isVisible?this.applyAutoHeight():this.$measureHeight=!0}onBeginActiveItemChange(e){const t=this.tabBar.tabs,{activeItem:i,prevActiveItem:a}=e;this.activeTab=t.indexOf(i==null?void 0:i.tab),a!=null&&a.tab&&(a.tab.active=!1),i!=null&&i.tab&&(i.tab.active=!0,i.tab.show())}onBeforeActiveItemChange(e){return this.trigger("beforeTabChange",e)}onActiveItemChange(e){this.trigger("tabChange",e)}onTabClick(e){this.activeTab=e.source.item}onInternalPaint(){super.onInternalPaint(...arguments),this.$measureHeight&&this.applyAutoHeight()}};o(b,"$name","TabPanel"),o(b,"type","tabpanel"),o(b,"alias","tabs"),b.initClass(),b._$name="TabPanel";export{c as FieldSet,u as Radio,m as RadioGroup,h as Tab,g as TabBar,b as TabPanel,p as WebSocketManager};
//# sourceMappingURL=chunk-ILA6GLVW.js.map
