/*!
 *
 * Bryntum TaskBoard 5.6.2
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
import{Column as Rt,ColumnStore as Le,GridBase as At,GridFeatureManager as le,Header as Tt,Location as Mt,SubGrid as Ft,WidgetColumn as kt}from"./chunk-GGOYEX2W.js";import{ButtonGroup as ce}from"./chunk-6ZLMCHE5.js";import{CrudManager as Pt,CrudManagerView_default as zt,ProjectModel as It,RecurrenceDayRuleEncoder as J,TimeSpan as Lt}from"./chunk-KVD75ID2.js";import{AvatarRendering as _t,ColorField as Ot}from"./chunk-4LHHPUQ6.js";import{ArrayHelper as G,AsyncHelper as ue,Base as R,BrowserHelper as z,Collection as de,ColorPicker as Ht,Combo as ee,ContextMenuBase as jt,DateHelper as f,Delayable_default as _e,DomClassList as I,DomDataStore as Wt,DomHelper as T,DomSync as q,EventHelper as L,Events_default as Oe,FunctionHelper as Vt,GlobalEvents_default as he,IdHelper as He,LocaleHelper as Bt,Localizable_default as $t,Model as je,Navigator as Ut,ObjectHelper as E,Objects as We,Panel as Nt,Popup as Yt,Rectangle as k,ResizeMonitor as Gt,Scroller as qt,Store as me,StringHelper as P,TimeZoneHelper as Ve,VersionHelper as Z,Widget as Be,__privateAdd as Zt,__privateGet as Kt,__privateSet as $e,__publicField as b,unitMagnitudes as ge}from"./chunk-MZVS5JQA.js";var _=class extends je{static get fields(){return[{name:"base",type:"string"},{name:"name",type:"string"},{name:"rowHeight",defaultValue:24},{name:"tickWidth",defaultValue:50},{name:"tickHeight",defaultValue:50},{name:"displayDateFormat",defaultValue:"HH:mm"},{name:"shiftUnit",defaultValue:"hour"},{name:"shiftIncrement",defaultValue:1},{name:"defaultSpan",defaultValue:12},{name:"mainUnit"},{name:"start"},"timeResolution","headers","mainHeaderLevel","columnLinesFor"]}construct(){super.construct(...arguments),this.normalizeUnits()}generateId(t){const n=this,{headers:e}=n,i=[];let r=Object.getPrototypeOf(n.data).id;if(!r){for(let{length:s}=e,a=s-1;a>=0;a--){const{unit:o,increment:l}=e[a],c=l>1;i.push(`${c?l:""}${a?o:P.capitalize(o)}${c?"s":""}`)}r=i.join("And")}return t.count&&t.includes(r)&&(r+=`-${n.tickWidth}by${n.tickHeight||n.tickWidth}`,t.includes(r)&&(r+=`-${n.bottomHeader.increment}`,t.includes(r)&&(r=He.generateId(`${r}-`)))),r}normalizeUnits(){const t=this,{timeResolution:n,headers:e,shiftUnit:i}=t;if(e)for(let r=0,{length:s}=e;r<s;r++){const a=e[r];a.unit=f.normalizeUnit(a.unit),a.splitUnit&&(a.splitUnit=f.normalizeUnit(a.splitUnit)),"increment"in a||(e[r]=Object.assign({increment:1},a))}n&&(n.unit=f.normalizeUnit(n.unit)),i&&(t.shiftUnit=f.normalizeUnit(i))}static normalizeHeaderConfig(t){const{headerConfig:n,columnLinesFor:e,mainHeaderLevel:i}=t,r=t.headers=[];if(n.top&&(e==="top"&&(t.columnLinesFor=0),i==="top"&&(t.mainHeaderLevel=0),r[0]=n.top),n.middle)e==="middle"&&(t.columnLinesFor=r.length),i==="middle"&&(t.mainHeaderLevel=r.length),r.push(n.middle);else throw new Error("ViewPreset.headerConfig must be configured with a middle");n.bottom&&(t.mainHeaderLevel=r.length-1,e==null?t.columnLinesFor=r.length-1:e==="bottom"&&(t.columnLinesFor=r.length),i==null&&(t.mainHeaderLevel=r.length-1),i==="bottom"&&(t.mainHeaderLevel=r.length),r.push(n.bottom))}set(){}inSet(){}get columnLinesFor(){return"columnLinesFor"in this.data?this.data.columnLinesFor:this.headers.length-1}get tickSize(){return this._tickSize||this.tickWidth}get tickWidth(){return"tickWidth"in this.data?this.data.tickWidth:50}get tickHeight(){return"tickHeight"in this.data?this.data.tickHeight:50}get headerConfig(){if(this.data.headerConfig)return this.data.headerConfig;const t={},{headers:n}=this,{length:e}=n;switch(e){case 1:t.middle=n[0];break;case 2:this.mainHeaderLevel===0?(t.middle=n[0],t.bottom=n[1]):(t.top=n[0],t.middle=n[1]);break;case 3:t.top=n[0],t.middle=n[1],t.bottom=n[2];break;default:throw new Error("headerConfig object not supported for >3 header levels")}return t}set mainHeaderLevel(t){this.data.mainHeaderLevel=t}get mainHeaderLevel(){return"mainHeaderLevel"in this.data?this.data.mainHeaderLevel:this.data.headers.length===3?1:this.headers.length-1}get mainHeader(){return this.headers[this.mainHeaderLevel]}get topHeader(){return this.headers[0]}get topUnit(){return this.topHeader.unit}get topIncrement(){return this.topHeader.increment}get bottomHeader(){return this.headers[this.headers.length-1]}get leafUnit(){return this.bottomHeader.unit}get leafIncrement(){return this.bottomHeader.increment}get mainUnit(){return"mainUnit"in this.data?this.data.mainUnit:this.mainHeader.unit}get msPerPixel(){const{bottomHeader:t}=this;return Math.round(f.asMilliseconds(t.increment||1,t.unit)/this.tickWidth)}get isValid(){const t=this;let n=!0;for(const e of t.headers)n=n&&!!f.normalizeUnit(e.unit);return t.timeResolution&&(n=n&&f.normalizeUnit(t.timeResolution.unit)),t.shiftUnit&&(n=n&&f.normalizeUnit(t.shiftUnit)),n}};b(_,"$name","ViewPreset"),_._$name="ViewPreset";var Xt={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",Object:{newEvent:"New event"},ResourceInfoColumn:{eventCountText:t=>t+" event"+(t!==1?"s":"")},Dependencies:{from:"From",to:"To",valid:"Valid",invalid:"Invalid"},DependencyType:{SS:"SS",SF:"SF",FS:"FS",FF:"FF",StartToStart:"Start-to-Start",StartToEnd:"Start-to-Finish",EndToStart:"Finish-to-Start",EndToEnd:"Finish-to-Finish",short:["SS","SF","FS","FF"],long:["Start-to-Start","Start-to-Finish","Finish-to-Start","Finish-to-Finish"]},DependencyEdit:{From:"From",To:"To",Type:"Type",Lag:"Lag","Edit dependency":"Edit dependency",Save:"Save",Delete:"Delete",Cancel:"Cancel",StartToStart:"Start to Start",StartToEnd:"Start to End",EndToStart:"End to Start",EndToEnd:"End to End"},EventEdit:{Name:"Name",Resource:"Resource",Start:"Start",End:"End",Save:"Save",Delete:"Delete",Cancel:"Cancel","Edit event":"Edit event",Repeat:"Repeat"},EventDrag:{eventOverlapsExisting:"Event overlaps existing event for this resource",noDropOutsideTimeline:"Event may not be dropped completely outside the timeline"},SchedulerBase:{"Add event":"Add event","Delete event":"Delete event","Unassign event":"Unassign event",color:"Color"},TimeAxisHeaderMenu:{pickZoomLevel:"Zoom",activeDateRange:"Date range",startText:"Start date",endText:"End date",todayText:"Today"},EventCopyPaste:{copyEvent:"Copy event",cutEvent:"Cut event",pasteEvent:"Paste event"},EventFilter:{filterEvents:"Filter tasks",byName:"By name"},TimeRanges:{showCurrentTimeLine:"Show current timeline"},PresetManager:{secondAndMinute:{displayDateFormat:"ll LTS",name:"Seconds"},minuteAndHour:{topDateFormat:"ddd MM/DD, hA",displayDateFormat:"ll LST"},hourAndDay:{topDateFormat:"ddd MM/DD",middleDateFormat:"LST",displayDateFormat:"ll LST",name:"Day"},day:{name:"Day/hours"},week:{name:"Week/hours"},dayAndWeek:{displayDateFormat:"ll LST",name:"Week/days"},dayAndMonth:{name:"Month"},weekAndDay:{displayDateFormat:"ll LST",name:"Week"},weekAndMonth:{name:"Weeks"},weekAndDayLetter:{name:"Weeks/weekdays"},weekDateAndMonth:{name:"Months/weeks"},monthAndYear:{name:"Months"},year:{name:"Years"},manyYears:{name:"Multiple years"}},RecurrenceConfirmationPopup:{"delete-title":"You are deleting an event","delete-all-message":"Do you want to delete all occurrences of this event?","delete-further-message":"Do you want to delete this and all future occurrences of this event, or only the selected occurrence?","delete-further-btn-text":"Delete All Future Events","delete-only-this-btn-text":"Delete Only This Event","update-title":"You are changing a repeating event","update-all-message":"Do you want to change all occurrences of this event?","update-further-message":"Do you want to change only this occurrence of the event, or this and all future occurrences?","update-further-btn-text":"All Future Events","update-only-this-btn-text":"Only This Event",Yes:"Yes",Cancel:"Cancel",width:600},RecurrenceLegend:{" and ":" and ",Daily:"Daily","Weekly on {1}":({days:t})=>`Weekly on ${t}`,"Monthly on {1}":({days:t})=>`Monthly on ${t}`,"Yearly on {1} of {2}":({days:t,months:n})=>`Yearly on ${t} of ${n}`,"Every {0} days":({interval:t})=>`Every ${t} days`,"Every {0} weeks on {1}":({interval:t,days:n})=>`Every ${t} weeks on ${n}`,"Every {0} months on {1}":({interval:t,days:n})=>`Every ${t} months on ${n}`,"Every {0} years on {1} of {2}":({interval:t,days:n,months:e})=>`Every ${t} years on ${n} of ${e}`,position1:"the first",position2:"the second",position3:"the third",position4:"the fourth",position5:"the fifth","position-1":"the last",day:"day",weekday:"weekday","weekend day":"weekend day",daysFormat:({position:t,days:n})=>`${t} ${n}`},RecurrenceEditor:{"Repeat event":"Repeat event",Cancel:"Cancel",Save:"Save",Frequency:"Frequency",Every:"Every",DAILYintervalUnit:"day(s)",WEEKLYintervalUnit:"week(s)",MONTHLYintervalUnit:"month(s)",YEARLYintervalUnit:"year(s)",Each:"Each","On the":"On the","End repeat":"End repeat","time(s)":"time(s)"},RecurrenceDaysCombo:{day:"day",weekday:"weekday","weekend day":"weekend day"},RecurrencePositionsCombo:{position1:"first",position2:"second",position3:"third",position4:"fourth",position5:"fifth","position-1":"last"},RecurrenceStopConditionCombo:{Never:"Never",After:"After","On date":"On date"},RecurrenceFrequencyCombo:{None:"No repeat",Daily:"Daily",Weekly:"Weekly",Monthly:"Monthly",Yearly:"Yearly"},RecurrenceCombo:{None:"None",Custom:"Custom..."},Summary:{"Summary for":t=>`Summary for ${t}`},ScheduleRangeCombo:{completeview:"Complete schedule",currentview:"Visible schedule",daterange:"Date range",completedata:"Complete schedule (for all events)"},SchedulerExportDialog:{"Schedule range":"Schedule range","Export from":"From","Export to":"To"},ExcelExporter:{"No resource assigned":"No resource assigned"},CrudManagerView:{serverResponseLabel:"Server response:"},DurationColumn:{Duration:"Duration"}},Ai=Bt.publishLocale(Xt),te=class extends $t(me){static get $name(){return"PresetStore"}static get defaultConfig(){return{useRawData:!0,modelClass:_,zoomOrder:1}}set storage(t){super.storage=t,this.storage.addSorter((n,e)=>{const i=n.bottomHeader,r=e.bottomHeader;return(e.msPerPixel-n.msPerPixel||ge[i.unit]-ge[r.unit]||i.increment-r.increment)*this.zoomOrder})}get storage(){return super.storage}getById(t){return super.getById(t)||!this.isPresetManager&&globalThis.bryntum.PresetManager.getById(t)}createRecord(t,...n){let e;if(t.isViewPreset)return t;if(typeof t=="string")e=this.getById(t);else if(typeof t=="number")e=this.getAt(t);else return t.base&&(t=this.copyBaseValues(t)),super.createRecord(t,...n);if(!e)throw new Error(`ViewPreset ${t} does not exist`);return e}updateLocalization(){super.updateLocalization();const t=this;let n=t.allRecords;t.isPresetManager&&(n=new Set(n.concat(Object.values(t.basePresets)))),n.forEach(e=>{let i=t.optionalL(`L{PresetManager.${e.id}}`,null,!0);typeof i=="string"&&e.baseId&&(i=t.optionalL(`L{PresetManager.${e.baseId}}`,null,!0)),i&&typeof i=="object"&&(e.originalDisplayDateFormat||(e.originalDisplayDateFormat=e.displayDateFormat),e.mainHeaderLevel===0&&i.topDateFormat&&(i.middleDateFormat=i.middleDateFormat||i.topDateFormat),e.setData("displayDateFormat",i.displayDateFormat||e.originalDisplayDateFormat),["top","middle","bottom"].forEach(r=>{const s=e.headerConfig[r],a=i[r+"DateFormat"];s&&(s.originalDateFormat||(s.originalDateFormat=s.dateFormat),a&&s.renderer&&(s.renderer=null),s.dateFormat=a||s.originalDateFormat)}),i.name?(e.unlocalizedName||(e.unlocalizedName=e.name),e.setData("name",i.name)):e.unlocalizedName&&e.unlocalizedName!==e.name&&(e.name=e.unlocalizedName,e.unlocalizedName=null))})}getCurrentConfig(t){return super.getCurrentConfig(t).data}copyBaseValues(t){let n=this.getById(t.base);if(!n)throw new Error(`ViewPreset base '${t.base}' does not exist.`);return n=E.clone(n.data),delete n.id,t.name&&delete n.name,E.merge(n,t)}add(t){return t=Array.isArray(t)?t:[t],t.forEach(n=>{n.isViewPreset&&n.base&&(n.data=this.copyBaseValues(n.originalData))}),super.add(...arguments)}};te._$name="PresetStore";var Qt=class extends te{static get $name(){return"PresetManager"}static get defaultConfig(){return{preventSubClassingModel:!0,basePresets:{secondAndMinute:{name:"Seconds",tickWidth:30,tickHeight:40,displayDateFormat:"ll LTS",shiftIncrement:10,shiftUnit:"minute",defaultSpan:24,timeResolution:{unit:"second",increment:5},headers:[{unit:"minute",dateFormat:"lll"},{unit:"second",increment:10,dateFormat:"ss"}]},minuteAndHour:{name:"Minutes",tickWidth:60,tickHeight:60,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"hour",defaultSpan:24,timeResolution:{unit:"minute",increment:15},headers:[{unit:"hour",dateFormat:"ddd MM/DD, hA"},{unit:"minute",increment:30,dateFormat:"mm"}]},hourAndDay:{name:"Day",tickWidth:70,tickHeight:40,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:24,timeResolution:{unit:"minute",increment:30},headers:[{unit:"day",dateFormat:"ddd DD/MM"},{unit:"hour",dateFormat:"LT"}]},day:{name:"Day/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:1,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"day",dateFormat:"ddd DD/MM",splitUnit:"day"},{unit:"hour",renderer(t){return`
                                    <div class="b-sch-calendarcolumn-ct"><span class="b-sch-calendarcolumn-hours">${f.format(t,"HH")}</span>
                                    <span class="b-sch-calendarcolumn-minutes">${f.format(t,"mm")}</span></div>
                                `}}]},week:{name:"Week/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"week",defaultSpan:24,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"D d",splitUnit:"day"},{unit:"hour",dateFormat:"LT",renderer(t){return`
                                    <div class="sch-calendarcolumn-ct">
                                    <span class="sch-calendarcolumn-hours">${f.format(t,"HH")}</span>
                                    <span class="sch-calendarcolumn-minutes">${f.format(t,"mm")}</span>
                                    </div>
                                `}}]},dayAndWeek:{name:"Days & Weeks",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"day",shiftIncrement:1,defaultSpan:5,timeResolution:{unit:"hour",increment:1},headers:[{unit:"week",renderer(t){return f.getShortNameOfUnit("week")+"."+f.format(t,"WW MMM YYYY")}},{unit:"day",dateFormat:"dd DD"}]},dayAndMonth:{name:"Month",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"month",shiftIncrement:1,defaultSpan:1,mainUnit:"month",timeResolution:{unit:"hour",increment:1},headers:[{unit:"month",dateFormat:"MMMM YYYY"},{unit:"day",dateFormat:"DD"}]},weekAndDay:{name:"Week",tickWidth:100,tickHeight:80,displayDateFormat:"ll hh:mm A",shiftUnit:"week",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"YYYY MMMM DD"},{unit:"day",increment:1,dateFormat:"DD MMM"}]},weekAndMonth:{name:"Weeks",tickWidth:100,tickHeight:105,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:5,defaultSpan:6,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"MMM YYYY"},{unit:"week",dateFormat:"DD MMM"}]},weekAndDayLetter:{name:"Weeks/weekdays",tickWidth:20,tickHeight:50,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"ddd DD MMM YYYY",verticalColumnWidth:115},{unit:"day",dateFormat:"d1",verticalColumnWidth:25}]},weekDateAndMonth:{name:"Months/weeks",tickWidth:30,tickHeight:40,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"YYYY MMMM"},{unit:"week",dateFormat:"DD"}]},monthAndYear:{name:"Months",tickWidth:110,tickHeight:110,displayDateFormat:"ll",shiftIncrement:3,shiftUnit:"month",defaultSpan:12,timeResolution:{unit:"day",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"month",dateFormat:"MMM YYYY"}]},year:{name:"Years",tickWidth:100,tickHeight:100,resourceColumnWidth:100,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:1,mainHeaderLevel:0,timeResolution:{unit:"month",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"quarter",renderer(t,n,e){return f.getShortNameOfUnit("quarter").toUpperCase()+(Math.floor(t.getMonth()/3)+1)}}]},manyYears:{name:"Multiple years",tickWidth:40,tickHeight:50,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"year",increment:1},mainHeaderLevel:0,headers:[{unit:"year",increment:5,renderer:(t,n)=>t.getFullYear()+" - "+n.getFullYear()},{unit:"year",dateFormat:"YY",increment:1}]}},defaultPresets:["manyYears",{width:80,increment:1,resolution:1,base:"manyYears",resolutionUnit:"YEAR"},"year",{width:30,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},{width:50,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},{width:200,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},"monthAndYear","weekDateAndMonth","weekAndMonth","weekAndDayLetter","dayAndMonth","weekAndDay",{width:54,increment:1,resolution:1,base:"weekAndDay",resolutionUnit:"HOUR"},"hourAndDay",{width:64,increment:6,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},{width:100,increment:6,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},{width:64,increment:2,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},"minuteAndHour",{width:60,increment:15,resolution:5,base:"minuteAndHour"},{width:130,increment:15,resolution:5,base:"minuteAndHour"},{width:60,increment:5,resolution:5,base:"minuteAndHour"},{width:100,increment:5,resolution:5,base:"minuteAndHour"},"secondAndMinute",{width:60,increment:10,resolution:5,base:"secondAndMinute"},{width:130,increment:5,resolution:5,base:"secondAndMinute"}],internalListeners:{locale:"updateLocalization"}}}set basePresets(t){const n=this._basePresets={};for(const e in t)t[e].id=e,n[e]=this.createRecord(t[e])}get basePresets(){return this._basePresets}set defaultPresets(t){for(let n=0,{length:e}=t;n<e;n++){const i=t[n],r=typeof i=="string",s=r?i:i.base;let a;if(r)a=this.basePresets[s];else{const o=Object.setPrototypeOf(E.clone(this.basePresets[s].data),{id:s}),{timeResolution:l}=o,c=o.headers[o.headers.length-1];o.id=void 0,"width"in i&&(o.tickWidth=i.width),"height"in i&&(o.tickHeight=i.height),"increment"in i&&(c.increment=i.increment),"resolution"in i&&(l.increment=i.resolution),"resolutionUnit"in i&&(l.unit=f.getUnitByName(i.resolutionUnit)),a=this.createRecord(o),a.baseId=s}this.add(a)}}getById(t){return super.getById(t)||this.basePresets[t]}registerPreset(t,n){const e=this.createRecord(Object.assign({id:t},n)),i=this.find(r=>r.equals(e));if(i)return i;if(e.isValid)this.add(e);else throw new Error("Invalid preset, please check your configuration");return e}getPreset(t){return typeof t=="number"&&(t=this.getAt(t)),typeof t=="string"?t=this.getById(t):t instanceof _||(t=this.createRecord(t)),t}normalizePreset(t){const n=this;if(!(t instanceof _)){if(typeof t=="string"){if(t=n.getPreset(t),!t)throw new Error("You must define a valid view preset. See PresetManager for reference")}else if(typeof t=="object"){if(t.base){const e=this.getById(t.base);if(!e)throw new Error(`ViewPreset base '${t.base}' does not exist`);t=E.merge(E.clone(e.data),t)}t.id?t=n.createRecord(t):(t=n.createRecord(E.assign({},t)),t.id=t.generateId(t))}}return t}deletePreset(t){typeof t=="string"?t=this.getById(t):typeof t=="number"&&(t=this.getAt(t)),t&&(this.remove(t),delete this.basePresets[t.id])}},W=new Qt;globalThis.bryntum.PresetManager=W;var Jt=class extends Lt{get startDate(){return this.data.startDate}get endDate(){return this.data.endDate}},fe=class extends me{static get defaultConfig(){return{modelClass:Jt,continuous:!0,originalContinuous:null,include:null,autoAdjust:!0,adjustedStart:null,adjustedEnd:null,visibleTickStart:null,visibleTickEnd:null,tickCache:{},viewPreset:null,maxTraverseTries:100,useRawData:{disableDuplicateIdCheck:!0,disableDefaultValue:!0,disableTypeConversion:!0}}}static get configurable(){return{generateTicks:null,unit:null,increment:null,resolutionUnit:null,resolutionIncrement:null,mainUnit:null,shiftUnit:null,shiftIncrement:1,defaultSpan:1,weekStartDay:null,forceFullTicks:null}}construct(t){const n=this;if(super.construct(t),n.originalContinuous=n.continuous,n.ion({change:({action:e})=>{e!=="filter"&&n.trigger("reconfigure",{supressRefresh:!1})},refresh:()=>n.trigger("reconfigure",{supressRefresh:!1}),endreconfigure:e=>n.trigger("reconfigure",e)}),n.startDate)n.internalOnReconfigure(),n.trigger("reconfigure");else if(n.viewPreset){const e=n.getAdjustedDates(new Date);n.startDate=e.startDate,n.endDate=e.endDate}}get isTimeAxis(){return!0}reconfigure(t,n=!1,e=!1){const i=this,r=i.getAdjustedDates(t.startDate,t.endDate),s={};if(i.trigger("beforeReconfigure",{startDate:r.startDate,endDate:r.endDate,config:t})!==!1){i.trigger("beginReconfigure"),i._configuredStartDate=t.startDate,i._configuredEndDate=t.endDate;for(const o in t)s[o]=i[o];const a=t.viewPreset&&t.viewPreset!==i.viewPreset;if(a&&(e=i.isFiltered,i.filters.forEach(o=>o.disabled=!1)),Object.assign(i,t),i.internalOnReconfigure(e,a)===!1)return!1;i.trigger("endReconfigure",{suppressRefresh:n,config:t,oldConfig:s})}}internalOnReconfigure(t=!1,n){const e=this;e.isConfigured=!0;const i=e.getAdjustedDates(e.startDate,e.endDate,!0),r=e.getAdjustedDates(e.startDate,e.endDate),s=r.startDate,a=r.endDate;if(s>=a)throw new Error(`Invalid start/end dates. Start date must be less than end date. Start date: ${s}. End date: ${a}.`);const{unit:o,increment:l=1}=e,c=e.generateTicks(s,a,o,l)||e.constructor.prototype.generateTicks.call(e,s,a,o,l);e.suspendEvents(),e.maintainFilter=t,e.data=c,e.maintainFilter=!1;const{count:u}=e;if(u===0){if(t)return n&&e.disableFilters(),e.resumeEvents(),!1;throw new Error("Invalid time axis configuration or filter, please check your input data.")}e.startDate=e.first.startDate,e.endDate=e.last.endDate,e.resumeEvents(),e.isContinuous?(e.adjustedStart=i.startDate,e.adjustedEnd=f.getNext(u>1?c[u-1].startDate:i.startDate,o,l,e.weekStartDay)):(e.adjustedStart=e.startDate,e.adjustedEnd=e.endDate),e.updateVisibleTickBoundaries(),e.updateTickCache(!0)}updateVisibleTickBoundaries(){const t=this,{count:n,unit:e,startDate:i,endDate:r,weekStartDay:s,increment:a=1}=t,o=f.getNormalizedUnitDuration(i,e)*a,l=f.getNormalizedUnitDuration(r,e)*a;do t.visibleTickStart=(i-t.adjustedStart)/o,t.autoAdjust&&(t.visibleTickStart=Math.floor(t.visibleTickStart)),t.visibleTickStart>=1&&(t.adjustedStart=f.getNext(t.adjustedStart,e,a,s));while(t.visibleTickStart>=1);do t.visibleTickEnd=n-(t.adjustedEnd-r)/l,n-t.visibleTickEnd>=1&&(t.adjustedEnd=f.getNext(t.adjustedEnd,e,-1,s));while(n-t.visibleTickEnd>=1);t.fullTicks=!t.visibleTickStart&&t.visibleTickEnd===n}get viewPreset(){return this._viewPreset}set viewPreset(t){const n=this;if(t=W.getPreset(t),!t.isViewPreset)throw new Error("TimeAxis must be configured with the ViewPreset instance that the Scheduler is using");n._viewPreset=t,Object.assign(n,{unit:t.bottomHeader.unit,increment:t.bottomHeader.increment||1,resolutionUnit:t.timeResolution.unit,resolutionIncrement:t.timeResolution.increment,mainUnit:t.mainHeader.unit,shiftUnit:t.shiftUnit||t.mainHeader.unit,shiftIncrement:t.shiftIncrement||1,defaultSpan:t.defaultSpan||1,presetName:t.id,headers:t.headers})}get weekStartDay(){var t;return(t=this._weekStartDay)!=null?t:f.weekStartDay}get resolution(){return{unit:this.resolutionUnit,increment:this.resolutionIncrement}}set resolution(t){this.resolutionUnit=t.unit,this.resolutionIncrement=t.increment}get resolutionUnit(){return this.forceFullTicks?this.unit:this._resolutionUnit}get resolutionIncrement(){return this.forceFullTicks?this.increment:this._resolutionIncrement}setTimeSpan(t,n,e=!1){n&&t-n===0&&(n=null);const i=this,{startDate:r,endDate:s}=i.getAdjustedDates(t,n);if(i.startDate-r!==0||i.endDate-s!==0)return i.reconfigure({startDate:r,endDate:s},!1,e)}shift(t,n=this.shiftUnit){const e=this;let{startDate:i,endDate:r}=e;e.isFiltered&&(i=e.allRecords[0].startDate,r=e.allRecords[e.allCount-1].endDate);let s=0;do i=f.add(i,t,n),r=f.add(r,t,n);while(s++<e.maxTraverseTries&&e.setTimeSpan(i,r,{preventThrow:!0})===!1)}shiftNext(t=this.shiftIncrement){this.shift(t)}shiftPrevious(t=this.shiftIncrement){this.shift(-t)}filterBy(t,n=this){this.filters.clear(),super.filterBy((i,r)=>t.call(n,i.data,r))}filter(){const t=this,n=super.filter(...arguments);return!t.maintainFilter&&t.count===0&&(t.resumeEvents(),t.trigger("invalidFilter"),t.disableFilters()),n}disableFilters(){this.filters.forEach(t=>t.disabled=!0),this.filter()}triggerFilterEvent(t){const n=this;t.filters.count?n.continuous=!1:n.continuous=n.originalContinuous,n.updateTickCache(),super.triggerFilterEvent(t)}get isContinuous(){return this.continuous!==!1&&!this.isFiltered}getAdjustedDates(t,n,e=!1){const i=this;return n&&t-n===0&&(n=null),t=t||i.startDate,n=n||f.add(t,i.defaultSpan,i.mainUnit),i.autoAdjust||e?{startDate:i.floorDate(t,!1,i.autoAdjust?i.mainUnit:i.unit,1),endDate:i.ceilDate(n,!1,i.autoAdjust?i.mainUnit:i.unit,1)}:{startDate:t,endDate:n}}get startDate(){return this._start||(this.first?new Date(this.first.startDate):null)}set startDate(t){this._start=f.parse(t)}get endDate(){return this._end||(this.last?new Date(this.last.endDate):null)}set endDate(t){t&&(this._end=f.parse(t))}get startMS(){return this._startMS}get endMS(){return this._endMS}floorDate(t,n,e,i){n=n!==!1;const r=this,s=n?f.clone(r.startDate):null,a=i||r.resolutionIncrement,o=e||(n?r.resolutionUnit:r.mainUnit),l=(u,d)=>Math.floor(u/d)*d;if(n)return f.floor(t,{unit:o,magnitude:a},s);const c=f.clone(t);if(o==="week"){const u=c.getDay()||7,d=r.weekStartDay||7;f.add(f.startOf(c,"day",!1),u>=d?d-u:-(7-d+u),"day",!1),c.getDay()!==d&&c.getHours()===23&&f.add(c,1,"hour",!1)}else{f.startOf(c,o,!1);const u=["day","year"].includes(o)?1:0,d=o==="day"?"date":o,h=l(f.get(c,d)-u,a)+u;f.set(c,d,h)}return c}roundDate(t,n,e=this.resolutionUnit,i=this.resolutionIncrement||1){const r=this,s=f.clone(t);switch(n=f.clone(n||r.startDate),e){case"week":{f.startOf(s,"day",!1);let a=s.getDay()-r.weekStartDay,o;return a<0&&(a=7+a),Math.round(a/7)===1?o=7-a:o=-a,f.add(s,o,"day",!1)}case"month":{const a=f.diff(n,s,"month")+f.as("month",s.getDay()/f.daysInMonth(s)),o=Math.round(a/i)*i;return f.add(n,o,"month",!1)}case"quarter":return f.startOf(s,"month",!1),f.add(s,3-s.getMonth()%3,"month",!1);default:{const a=f.as(e,f.diff(n,s)),o=e==="year"?0:f.as(e,n.getTimezoneOffset()-s.getTimezoneOffset(),"minute"),l=Math.round((a+o)/i)*i;return f.add(n,l-o,e,!1)}}}ceilDate(t,n,e,i){const r=this;n=n!==!1,i=i||(n?r.resolutionIncrement:1);const s=e||(n?r.resolutionUnit:r.mainUnit),a=f.clone(t);let o=!1;switch(s){case"minute":o=!f.isStartOf(a,"minute");break;case"hour":o=!f.isStartOf(a,"hour");break;case"day":case"date":o=!f.isStartOf(a,"day");break;case"week":f.startOf(a,"day",!1),o=a.getDay()!==r.weekStartDay||!f.isEqual(a,t);break;case"month":f.startOf(a,"day",!1),o=a.getDate()!==1||!f.isEqual(a,t);break;case"quarter":f.startOf(a,"day",!1),o=a.getMonth()%3!==0||a.getDate()!==1||!f.isEqual(a,t);break;case"year":f.startOf(a,"day",!1),o=a.getMonth()!==0||a.getDate()!==1||!f.isEqual(a,t);break}return o?f.getNext(a,s,i,r.weekStartDay):a}get include(){return this._include}set include(t){const n=this;n._include=t,n.continuous=!t,n.isConfiguring||(n.startDate=n._configuredStartDate,n.endDate=n._configuredEndDate,n.internalOnReconfigure(),n.trigger("includeChange"))}processExclusion(t,n,e){const{include:i}=this;return i?Object.entries(i).some(([r,s])=>{if(!s)return!1;const{from:a,to:o}=s;if(f.compareUnits("day",e)>=0&&f.getLargerUnit(r)===e&&(a&&f.set(t,r,a),o)){let l=e;e==="day"&&(l="date"),f.set(n,{[l]:f.get(n,l)-1,[r]:o})}if(f.compareUnits(r,e)>=0){const l=r==="day"?t.getDay():f.get(t,r);if(a&&l<a||o&&l>=o)return!0}}):!1}initExclusion(){Object.entries(this.include).forEach(([t,n])=>{if(n){const{from:e,to:i}=n;n.lengthFactor=f.getUnitToBaseUnitRatio(t,f.getLargerUnit(t))/(i-e),n.lengthFactorExcl=f.getUnitToBaseUnitRatio(t,f.getLargerUnit(t))/(i-e-1),n.center=e+e/(n.lengthFactor-1)}})}updateGenerateTicks(){this.isConfiguring||this.reconfigure(this)}_generateTicks(t,n,e=this.unit,i=this.increment){const r=this,s=[],a=!!r.include;let o,l,c,u=0,{startDate:d,endDate:h}=r.getAdjustedDates(t,n);for(r.tickCache={},a&&r.initExclusion();d<h;){if(o=f.getNext(d,e,i,r.weekStartDay),!r.autoAdjust&&o>h&&(o=h),e==="hour"&&i>1&&s.length>0&&u===0){const m=s[s.length-1];u=(m.startDate.getHours()+i)%24-m.endDate.getHours(),u!==0&&(o=f.add(o,u,"hour"))}c=!1,a?(l=new Date(o.getTime()),c=r.processExclusion(d,o,e)):l=o,c||(s.push({id:s.length+1,startDate:d,endDate:o}),r.tickCache[d.getTime()]=s.length-1),d=l}return s}get visibleTickTimeSpan(){const t=this;return t.isContinuous?t.visibleTickEnd-t.visibleTickStart:t.count}getTickFromDate(t){var n,e;const i=this,r=i.records,s=(e=(n=t.getTime)==null?void 0:n.call(t))!=null?e:t;let a=0,o=r.length-1,l,c,u,d;if(!r.length||s<r[0].startDateMS||s>r[o].endDateMS)return-1;if(i.isContinuous){for(;a<o;)l=a+o+1>>1,s>r[l].endDateMS?a=l+1:s<r[l].startDateMS?o=l-1:a=l;return c=r[a],u=c.startDateMS,s>u&&(d=c.endDateMS,a+=(s-u)/(d-u)),Math.min(Math.max(a,i.visibleTickStart),i.visibleTickEnd)}else for(let h=0;h<=o;h++)if(d=r[h].endDateMS,s<=d)return u=r[h].startDateMS,c=h+(s>u?(s-u)/(d-u):0),c}getSnappedTickFromDate(t){const n=Math.floor(this.getTickFromDate(t));return this.getAt(n)}getDateFromTick(t,n){const e=this;if(t===e.visibleTickEnd)return e.endDate;const i=Math.floor(t),r=t-i,s=e.getAt(i);if(!s)return null;const a=i===0&&e.isContinuous?e.adjustedStart:s.startDate,o=i===e.count-1&&e.isContinuous?e.adjustedEnd:s.endDate;let l=f.add(a,r*(o-a),"millisecond");return n&&(l=e[n+"Date"](l)),l}get ticks(){return this.records}updateTickCache(t=!1){const n=this;n.count?(n._start=n.first.startDate,n._end=n.last.endDate,n._startMS=n.startDate.getTime(),n._endMS=n.endDate.getTime()):n._start=n._end=n._startMs=n._endMS=null,t||(n.tickCache={},n.forEach((e,i)=>n.tickCache[e.startDate.getTime()]=i))}dateInAxis(t,n=!1){const e=this,i=e.startDate,r=e.endDate;if(e.isContinuous)return n?f.betweenLesserEqual(t,i,r):f.betweenLesser(t,i,r);{const s=e.getCount();let a,o,l;for(let c=0;c<s;c++)if(l=e.getAt(c),a=l.startDate,o=l.endDate,n&&t<=o||!n&&t<o)return t>=a}return!1}timeSpanInAxis(t,n){const e=this;return!n||n.getTime()===t.getTime()?this.dateInAxis(t,!0):e.isContinuous?f.intersectSpans(t,n,e.startDate,e.endDate):t<e.startDate&&n>e.endDate||e.getTickFromDate(t)!==e.getTickFromDate(n)}isTimeSpanInAxis(t){var n;const e=this,{startMS:i,endMS:r}=e,{startDateMS:s}=t,a=(n=t.endDateMS)!=null?n:t.meta.endDateCached;if(!s||!a)return!1;if(a===s)return e.dateInAxis(t.startDate,!0);if(e.isContinuous)return a>i&&s<r;const o=e.getTickFromDate(t.startDate),l=e.getTickFromDate(t.endDate);return o===e.count&&f.isEqual(t.startDate,e.last.endDate)||l===0&&f.isEqual(t.endDate,e.first.startDate)?!1:s<i&&a>r||o!==l}forEachAuxInterval(t,n=1,e,i=this){const r=this.endDate;let s=this.startDate,a=0,o;if(s>r)throw new Error("Invalid time axis configuration");for(;s<r;)o=f.min(f.getNext(s,t,n,this.weekStartDay),r),e.call(i,s,o,a,o>=r),s=o,a++}};fe._$name="TimeAxis";var ve=class extends Oe(){static get defaultConfig(){return{timeAxis:null,availableSpace:null,tickSize:100,snap:!1,forceFit:!1,headers:null,mode:"horizontal",suppressFit:!1,columnConfig:[],viewPreset:null,columnLinesFor:null,originalTickSize:null,headersDatesCache:[]}}construct(t){const n=this;n.unitToPixelsCache={},super.construct(t);const e=n.timeAxis.viewPreset||n.viewPreset;if(e)if(e instanceof _)n.consumeViewPreset(e);else{const i=W.getPreset(e);i&&n.consumeViewPreset(i)}n.timeAxis.ion({reconfigure:"onTimeAxisReconfigure",thisObj:n}),n.configured=!0}doDestroy(){this.timeAxis.un("reconfigure",this.onTimeAxisReconfigure,this),super.doDestroy()}get columnConfig(){return this._columnConfig}set columnConfig(t){this._columnConfig=t}get headers(){return this._headers}set headers(t){if(t&&t.length&&t[t.length-1].cellGenerator)throw new Error("`cellGenerator` cannot be used for the bottom level of your headers. Use TimeAxis#generateTicks() instead.");this._headers=t}get isTimeAxisViewModel(){return!0}get isHorizontal(){return this.mode!=="vertical"}get isVertical(){return this.mode==="vertical"}set forceFit(t){t!==this._forceFit&&(this._forceFit=t,this.update())}reconfigure(t){this.headers=null,this.setConfig(t),this.trigger("reconfigure")}onTimeAxisReconfigure({source:t,suppressRefresh:n}){this.viewPreset!==t.viewPreset&&this.consumeViewPreset(t.viewPreset),!n&&t.count>0&&this.update()}update(t,n=!1,e=!1){const i=this,{timeAxis:r,headers:s}=i,a=t!==0;if(i.isConfiguring||a&&i._availableSpace===t){e&&i.trigger("update");return}if(i._availableSpace=Math.max(t||i.availableSpace||0,0),typeof i.availableSpace!="number")throw new Error("Invalid available space provided to TimeAxisModel");i.columnConfig=[];const o=i._tickSize=i.calculateTickSize(i.originalTickSize);if(typeof o!="number"||o<=0)throw new Error("Invalid timeAxis tick size");i.unitToPixelsCache={},i._totalSize=null;for(let l=0,{length:c}=s;l<c;l++){const u=s[l];if(u.cellGenerator){const d=u.cellGenerator.call(i,r.startDate,r.endDate);i.columnConfig[l]=i.createHeaderRow(l,u,d)}else i.columnConfig[l]=i.createHeaderRow(l,u)}n||i.trigger("update")}getDistanceBetweenDates(t,n){return this.getPositionFromDate(n)-this.getPositionFromDate(t)}getDistanceForDuration(t){return this.getSingleUnitInPixels("millisecond")*t}getPositionFromDate(t,n={}){const e=this.getScaledTick(t,n);return e===-1?-1:this.tickSize*(e-this.timeAxis.visibleTickStart)}getScaledTick(t,{respectExclusion:n,snapToNextIncluded:e,isEnd:i,min:r,max:s}){const{timeAxis:a}=this,{include:o,unit:l}=a;let c=a.getTickFromDate(t);if(c!==-1&&n&&o){let u=!1;if(o.hour&&f.compareUnits(l,"hour")>0&&l!=="day"){const{from:d,to:h,lengthFactor:m,center:g}=o.hour,v=t.getHours(),p=Math.min(Math.max(v,d),h);if(!e&&p!==v)return-1;const y=p+t.getMinutes()/60,C=g-y,S=g-C*m;t=f.add(t,S-v,"h"),u=!0}if(o.day&&f.compareUnits(l,"day")>0){const{from:d,to:h,lengthFactor:m,center:g}=o.day;let v=t.getDay();i&&t.getHours()===0&&t.getMinutes()===0&&t.getSeconds()===0&&t.getMilliseconds()===0&&--v<0&&(v=6);let p=0;if(v<d||v>=h)if(e){if(i?p=(h-v-8)%7:p=(d-v+7)%7,t=f.add(t,p,"d"),t=f.startOf(t,"d",!1),s&&t.getTime()>=s||r&&t.getTime()<=r)return-1}else return-1;const{weekStartDay:y}=a,C=t.getDay()===0?0:g,S=t.getDay()+t.getHours()/24,D=C-S,w=C-D*m;t=f.add(t,w-S+y,"d"),u=!0}u&&(t=f.constrain(t,a.startDate,a.endDate),c=a.getTickFromDate(t))}return c}getDateFromPosition(t,n,e=!1){const i=this,{timeAxis:r}=i,s=i.getScaledPosition(t)/i.tickSize+r.visibleTickStart;if(s<0||s>r.count){if(e){let a;return s<0?a=f.add(r.startDate,s,r.unit):a=f.add(r.endDate,s-r.count,r.unit),n&&(a=r[n+"Date"](a)),a}return null}return r.getDateFromTick(s,n)}getScaledPosition(t){const{include:n,unit:e,weekStartDay:i}=this.timeAxis;if(n){const r=this.getSingleUnitInPixels("day");if(n.day&&f.compareUnits(e,"day")>0){const{from:s,lengthFactor:a}=n.day,o=t%(r*7),l=t-o;t=o/a+(s-i)*r+l}if(n.hour&&f.compareUnits(e,"hour")>0&&e!=="day"){const{from:s,lengthFactorExcl:a}=n.hour,o=this.getSingleUnitInPixels("hour"),l=t%r,c=t-l;t=l/a+s*o+c}}return t}getSingleUnitInPixels(t){const n=this;return n.unitToPixelsCache[t]||(n.unitToPixelsCache[t]=f.getUnitToBaseUnitRatio(n.timeAxis.unit,t,!0)*n.tickSize/n.timeAxis.increment)}get snapPixelAmount(){if(this.snap){const{resolution:t}=this.timeAxis;return(t.increment||1)*this.getSingleUnitInPixels(t.unit)}return 1}get tickSize(){return this._tickSize}set tickSize(t){this.setTickSize(t,!1)}setTickSize(t,n){this._tickSize=this.originalTickSize=t,this.update(void 0,n)}get timeResolution(){return this.timeAxis.resolution}calculateTickSize(t){const n=this,{forceFit:e,timeAxis:i,suppressFit:r}=n,s=i.unit;let a=0,o=1;if(n.snap){const l=i.resolution;o=f.getUnitToBaseUnitRatio(s,l.unit)*l.increment}if(r)a=t;else{const l=n.availableSpace/i.visibleTickTimeSpan;a=e||t<l?l:t,o>0&&(!e||o<1)&&(a=Math.max(1,o*a)/o)}return a}get totalSize(){return this._totalSize||(this._totalSize=Math.floor(this.tickSize*this.timeAxis.visibleTickTimeSpan))}get availableSpace(){return this._availableSpace}set availableSpace(t){const n=this;if(n._availableSpace=Math.max(0,t),n._availableSpace>0){const e=n.calculateTickSize(n.originalTickSize);e>0&&e!==n.tickSize&&n.update()}}getDates(t=this.columnLinesFor,n=!1,e=!1){const i=this,r=[],s=n?i.lowestHeader:t,a=i.majorHeaderLevel,o=i.headers&&i.headers[t].unit,l=a!=null&&i.headers&&i.headers[a].unit,c=a!=null&&f.doesUnitsAlign(l,o);if(!!(i.headers&&i.headers[s].cellGenerator)){const d=i.columnConfig[s];for(let h=1,m=d.length;h<m;h++)r.push({date:d[h].startDate})}else i.forEachInterval(s,(d,h)=>{r.push({date:e?h:d,isMajor:a!==t&&c&&i.isMajorTick(e?h:d)})});return r}get forceFit(){return this._forceFit}fitToAvailableSpace(t){const n=Math.floor(this.availableSpace/this.timeAxis.visibleTickTimeSpan);this.setTickSize(n,t)}get snap(){return this._snap}set snap(t){t!==this._snap&&(this._snap=t,this.configured&&this.update())}createHeaderRow(t,n,e){const i=this,r=[],{align:s,headerCellCls:a=""}=n,o=f.clearTime(new Date),{timeAxis:l}=i,c=i.headers.length-1,u=(h,m,g,v,p)=>{let y=f.format(h,n.dateFormat);const C=g>0&&!v,S={align:s,start:h,end:m,value:p?p.header:y,headerCellCls:a,width:c===t&&i.owner&&(l.fullTicks||C)?i.owner.tickSize:i.getDistanceBetweenDates(h,m),index:g};S.width!==0&&(S.coord=d-1,d+=S.width,i.headersDatesCache[t][h.getTime()]=1,n.renderer&&(y=n.renderer.call(n.thisObj||i,h,m,S,g),S.value=y==null?"":y),n.unit==="day"&&(!n.increment||n.increment===1)&&(S.headerCellCls+=" b-sch-dayheadercell-"+h.getDay(),f.clearTime(h,!0)-o===0&&(S.headerCellCls+=" b-sch-dayheadercell-today")),r.push(S))};let d=0;return i.headersDatesCache[t]={},e?e.forEach((h,m)=>u(h.start,h.end,m,m===e.length-1,h)):i.forEachInterval(t,u),r}get mainHeader(){return"mainHeaderLevel"in this?this.headers[this.mainHeaderLevel]:this.bottomHeader}get bottomHeader(){return this.headers[this.headers.length-1]}get lowestHeader(){return this.headers.length-1}get majorHeaderLevel(){const{headers:t}=this;return t?Math.max(t.length-2,0):null}isMajorTick(t){const n=this.majorHeaderLevel;return n!=null&&this.headersDatesCache[n]&&this.headersDatesCache[n][t.getTime()]||!1}forEachInterval(t,n,e=this){const{headers:i,timeAxis:r}=this;if(i)if(t===i.length-1)r.forEach((s,a)=>n.call(e,s.startDate,s.endDate,a,a===r.count-1));else{const s=i[t];r.forEachAuxInterval(s.unit,s.increment,n,e)}}forEachMainInterval(t,n){this.forEachInterval(this.mainHeaderLevel,t,n)}consumeViewPreset(t){const n=this;n.headers=null,n.getConfig("tickSize"),n.viewPreset=t,Object.assign(n,{headers:t.headers,columnLinesFor:t.columnLinesFor,mainHeaderLevel:t.mainHeaderLevel,_tickSize:n.isHorizontal?t.tickWidth:t.tickHeight}),n.originalTickSize=n.tickSize}};ve._$name="TimeAxisViewModel";var Ue=new Date,Ne=t=>{var n;return n=class extends(t||R){getRtlX(e){return this.rtl&&this.isHorizontal&&(e=this.timeAxisViewModel.totalSize-e),e}getDateFromCoordinate(e,i,r=!0,s=!1,a=!1){return r||(e=this.currentOrientation.translateToScheduleCoordinate(e)),a||(e=this.getRtlX(e)),this.timeAxisViewModel.getDateFromPosition(e,i,s)}getDateFromCoord(e){return this.getDateFromCoordinate(e.coord,e.roundingMethod,e.local,e.allowOutOfRange,e.ignoreRTL)}getDateFromXY(e,i,r=!0,s=!1){return this.currentOrientation.getDateFromXY(e,i,r,s)}getDateFromDomEvent(e,i,r=!1){return this.getDateFromXY([e.pageX,e.pageY],i,!1,r)}getStartEndDatesFromRectangle(e,i,r,s=!1){const a=this,{isHorizontal:o}=a,l=o?e.x:e.top,c=o?e.right:e.bottom;let u,d;return l>=0&&c<a.timeAxisViewModel.totalSize?(u=a.getDateFromCoordinate(l,i,!0),d=a.getDateFromCoordinate(c,i,!0)):l<0?(d=a.getDateFromCoordinate(c,i,!0,s),u=d&&f.add(d,-r,"ms")):(u=a.getDateFromCoordinate(l,i,!0,s),d=u&&f.add(u,r,"ms")),{start:u,end:d}}getDisplayEndDate(e,i){return e.getHours()===0&&e.getMinutes()===0&&(!i||!(e.getYear()===i.getYear()&&e.getMonth()===i.getMonth()&&e.getDate()===i.getDate()))&&!f.formatContainsHourInfo(this.displayDateFormat)&&(e=f.add(e,-1,"day")),e}getFormattedEndDate(e,i){return this.getFormattedDate(this.getDisplayEndDate(e,i))}getCoordinateFromDate(e,i=!0){const r=this,{timeAxisViewModel:s}=r,{isContinuous:a,startMS:o,endMS:l,startDate:c,endDate:u,unit:d}=r.timeAxis,h=e.valueOf();i===!0?i={local:!0}:i?"local"in i||(i.local=!0):i={local:!1};let m;if(e instanceof Date||(Ue.setTime(e),e=Ue),a&&e.getTimezoneOffset()===c.getTimezoneOffset()&&c.getTimezoneOffset()===u.getTimezoneOffset()&&f.getUnitToBaseUnitRatio(d,"day")!==-1){if(h<o||h>l)return-1;m=(h-o)/(l-o)*s.totalSize}else m=s.getPositionFromDate(e,i);return r.rtl&&r.isHorizontal&&!(i!=null&&i.ignoreRTL)&&(m=s.totalSize-m),i.local||(m=r.currentOrientation.translateToPageCoordinate(m)),m}getTimeSpanDistance(e,i){return this.timeAxisViewModel.getDistanceBetweenDates(e,i)}get viewportCenterDate(){const{timeAxis:e,timelineScroller:i}=this;if(e.isContinuous){const r=(i.position+i.clientSize/2)/i.scrollSize;return new Date(e.startMS+(e.endMS-e.startMS)*r)}return this.getDateFromCoordinate(i.position+i.clientSize/2)}get viewportCenterDateCached(){return this.cachedCenterDate||(this.cachedCenterDate=this.viewportCenterDate)}get timeResolution(){return this.timeAxis.resolution}set timeResolution(e){this.timeAxis.resolution=typeof e=="number"?{increment:e,unit:this.timeAxis.resolution.unit}:e}get snap(){var e,i;return(i=(e=this._timeAxisViewModel)==null?void 0:e.snap)!=null?i:this._snap}updateSnap(e){this.isConfiguring||(this.timeAxisViewModel.snap=e,this.timeAxis.forceFullTicks=e&&this.fillTicks)}onSchedulerHorizontalScroll(e,i,r,s){s||(this.cachedCenterDate=null)}get widgetClass(){}},b(n,"$name","TimelineDateMapper"),b(n,"configurable",{snap:!1}),n},{eventNameMap:ei}=L,Ye=t=>{var n;return n=class extends(t||R){constructor(){super(...arguments),b(this,"hoveredEvents",new Set)}initDomEvents(){const e=this,{schedulerEvents:i}=e;i.element=e.timeAxisSubGridElement,i.thisObj=e,L.on(i),L.on({element:e.timeAxisSubGridElement,mouseleave:"handleScheduleLeaveEvent",capture:!0,thisObj:e}),e.updateTimelineContextOnScroll&&z.supportsPointerEventConstructor&&L.on({element:document,scroll:"onScheduleScroll",capture:!0,thisObj:e})}getTimeSpanMouseEventParams(e,i){throw new Error("Implement in subclass")}getScheduleMouseEventParams(e,i){throw new Error("Implement in subclass")}handleScheduleEvent(e){const i=this;if(i.ignoreDomEventsWhileScrolling&&(i.scrolling||i.timeAxisSubGrid.scrolling))return;const r=i.getTimelineEventContext(e);i.lastPointerEvent=e,r&&i.trigger(`${r.eventElement?i.scheduledEventName:"schedule"}${ei[e.type]||P.capitalize(e.type)}`,r),i.timelineContext=r}handleScheduleLeaveEvent(e){e.target===this.timeAxisSubGridElement&&this.handleScheduleEvent(e)}onScheduleScroll({target:e}){var i,r,s,a,o;const l=this;if(e&&l.updateTimelineContextOnScroll&&!((i=l.features.pan)!=null&&i.isActive)&&!l.partners.some(c=>{var u;return(u=c.features.pan)==null?void 0:u.isActive})&&(e.contains(l.element)||l.bodyElement.contains(e))){const{timelineContext:c,lastPointerEvent:u}=l;if(c){const d=T.elementFromPoint(c.domEvent.clientX,c.domEvent.clientY),h=new z.PointerEventConstructor("pointermove",u),m=new MouseEvent("mousemove",u);Object.defineProperty(h,"pointerId",{value:(o=(a=(r=he.currentPointerDown)==null?void 0:r.pointerId)!=null?a:(s=he.currentTouch)==null?void 0:s.identifier)!=null?o:1}),h.scrollInitiated=m.scrollInitiated=!0,d==null||d.dispatchEvent(h),d==null||d.dispatchEvent(m)}}}updateTimelineContext(e,i){this.trigger("timelineContextChange",{oldContext:i,context:e}),e&&!i?this.trigger("scheduleMouseEnter",e):e||this.trigger("scheduleMouseLeave",{event:i.event})}getTimelineEventContext(e){const i=this,r=e.target.closest(i.eventInnerSelector),s=i.getCellElementFromDomEvent(e);if(s){const a=i.getDateFromDomEvent(e,"floor");if(!a)return;const o=Wt.get(s),l=r?i.getTimeSpanMouseEventParams(r,e):i.getScheduleMouseEventParams(o,e);if(!l)return;const c=i.isVertical?i.resourceStore.indexOf(l.resourceRecord):o.row.dataIndex,u=i.timeAxis.getTickFromDate(a),d=i.timeAxis.getAt(Math.floor(u));if(d)return{isTimelineContext:!0,domEvent:e,eventElement:r,cellElement:s,index:c,tick:d,tickIndex:u,date:a,tickStartDate:d.startDate,tickEndDate:d.endDate,tickParentIndex:d.parentIndex,row:o.row,event:e,...l}}}getCellElementFromDomEvent({target:e,clientY:i,type:r}){var s;const a=this,{isVertical:o,foregroundCanvas:l}=a,c=e.closest(a.eventSelector);if(c){const u=!o&&(a.resolveRowRecord(c)||a.store.getAt(a.rowManager.getRowAt(i,!1).dataIndex));return a.getCell({[o?"row":"record"]:o?0:u,column:a.timeAxisColumn})}else if(l.contains(e)){if(e===l||r==="mousemove")return(s=a.rowManager.getRowAt(i,!1))==null?void 0:s.getCell(a.timeAxisColumn.id)}else return e.matches(".b-grid-row")?e.firstElementChild:e.closest(a.timeCellSelector)}matchScheduleCell(e){return e.closest(this.timeCellSelector)}onElementMouseButtonEvent(e){const i=e.target.closest(".b-sch-header-timeaxis-cell");if(i){const r=this,s=i.parentElement.dataset.headerPosition,a=r.timeAxisViewModel.columnConfig[s],o=r.timeAxis.isFiltered?a.findIndex(u=>u.index==i.dataset.tickIndex):i.dataset.tickIndex,l=a[o],c=r.features.contextMenu;(!c||e.type!==c.triggerEvent)&&this.trigger(`timeAxisHeader${P.capitalize(e.type)}`,{startDate:l.start,endDate:l.end,event:e})}}onElementMouseDown(e){this.onElementMouseButtonEvent(e),super.onElementMouseDown(e)}onElementClick(e){this.onElementMouseButtonEvent(e),super.onElementClick(e)}onElementDblClick(e){this.onElementMouseButtonEvent(e),super.onElementDblClick(e)}onElementContextMenu(e){this.onElementMouseButtonEvent(e),super.onElementContextMenu(e)}onElementMouseOver(e){var i;const r=this;if(r.ignoreDomEventsWhileScrolling&&(r.scrolling||r.timeAxisSubGrid.scrolling))return;super.onElementMouseOver(e);const{target:s}=e,{hoveredEvents:a}=r;if((s.closest(r.eventInnerSelector)||s.matches(".b-sch-terminal-hover-area"))&&!((i=r.features.eventDrag)!=null&&i.isDragging)){const o=s.closest(r.eventSelector);if(!a.has(o)&&!r.preventOverCls){a.add(o),o.classList.add(r.overScheduledEventClass);const l=r.getTimeSpanMouseEventParams(o,e);l&&r.trigger(`${r.scheduledEventName}MouseEnter`,l)}}else a.size&&r.unhoverAll(e)}onElementMouseOut(e){var i;const r=this,{features:s}=r,{target:a,relatedTarget:o}=e;o!=null&&o.closest(".b-sch-canvas *")||super.onElementMouseOut(e);const l=a.closest(r.eventSelector),c=l==null?void 0:l.querySelector(r.eventInnerSelector),u=l&&r.resolveTimeSpanRecord(l);c&&u&&r.hoveredEvents.has(l)&&!((i=s.eventDrag)!=null&&i.isDragging)&&o&&(T.isDescendant(c,o)||o.matches(".b-sch-terminal-hover-area"))||l&&r.unhover(l,e)}unhover(e,i){const r=this;e.classList.remove(r.overScheduledEventClass),r.trigger(`${r.scheduledEventName}MouseLeave`,r.getTimeSpanMouseEventParams(e,i)),r.hoveredEvents.delete(e)}unhoverAll(e){for(const i of this.hoveredEvents)!i.isReleased&&!i.classList.contains("b-released")&&this.unhover(i,e);this.hoveredEvents.clear()}get widgetClass(){}},b(n,"$name","TimelineDomEvents"),b(n,"configurable",{timelineContext:{$config:{equal(e,i){return(e==null?void 0:e.index)===(i==null?void 0:i.index)&&(e==null?void 0:e.tickParentIndex)===(i==null?void 0:i.tickParentIndex)&&!(((e==null?void 0:e.tickStartDate)||0)-((i==null?void 0:i.tickStartDate)||0))}}},updateTimelineContextOnScroll:!1,ignoreDomEventsWhileScrolling:null}),b(n,"properties",{schedulerEvents:{pointermove:"handleScheduleEvent",mouseover:"handleScheduleEvent",mousedown:"handleScheduleEvent",mouseup:"handleScheduleEvent",click:"handleScheduleEvent",dblclick:"handleScheduleEvent",contextmenu:"handleScheduleEvent",mousemove:"handleScheduleEvent",mouseout:"handleScheduleEvent"}}),b(n,"delayable",{onScheduleScroll:"raf"}),n},Ge=t=>class extends(t||R){static get $name(){return"TimelineViewPresets"}static get configurable(){return{viewPreset:"weekAndDayLetter",presets:!0,displayDateFormat:null}}changePresets(e){const i={owner:this};let r=[];if(e===!0)r=W.allRecords;else if(Array.isArray(e))for(const a of e)if(typeof a=="string"){const o=W.getById(a);o&&r.push(o)}else r.push(a);else E.assign(i,e);const s=new te(i);return s.add(r),s}changeViewPreset(e,i){const r=this,{presets:s}=r;e?(e=s.createRecord(e),s.includes(e)||s.add(e)):e=s.first;const a=r.lastViewPresetOptions||{},o=e.options||(e.options={}),l={...o,from:i,to:e,preset:e},c=!r._viewPreset||!r._viewPreset.equals(e);if(delete a.event,(c||!E.isEqual(o,a))&&(o.event=l,c||(r._viewPreset=null),r.isConfiguring||r.trigger("beforePresetChange",l)!==!1))return e}get displayDateFormat(){return this._displayDateFormat||this.viewPreset.displayDateFormat}updateDisplayDateFormat(e){this.trigger("displayDateFormatChange",{format:e})}getFormattedDate(e){return f.format(e,this.displayDateFormat)}updateViewPreset(e){var i;const r=this,{options:s}=e,{event:a,startDate:o,endDate:l}=s,{isHorizontal:c,_timeAxis:u,_timeAxisViewModel:d}=r,h=c&&r.rtl;let{centerDate:m,zoomDate:g,zoomPosition:v}=s,p=!1;if((i=r.syncSplits)==null||i.call(r,y=>y.viewPreset=e),delete e.options,r._viewPresetChanging=!0,u&&!r.isConfiguring){const{timelineScroller:y}=r;if(r.lastViewPresetOptions=s,u.isConfigured){r.suspendRefresh();const C=E.copyProperties({},r,["weekStartDay","startTime","endTime"]);r.infiniteScroll?Object.assign(C,r.calculateInfiniteScrollingDateRange(m||(o&&l?new Date((o.getTime()+l.getTime())/2):r.viewportCenterDateCached),!0,e)):o?(C.startDate=o,C.endDate=l,!m&&l&&(m=new Date((o.getTime()+l.getTime())/2))):(C.startDate=u.startDate,C.endDate=l||u.endDate,m||(m=r.viewportCenterDate)),u.isConfigured=!1,C.viewPreset=e,u.reconfigure(C,!0),d.reconfigure({viewPreset:e,headers:e.headers,columnLinesFor:e.columnLinesFor!=null?e.columnLinesFor:e.headers.length-1,tickSize:s.tickSize||(c?e.tickWidth:e.tickHeight||e.tickWidth||60)}),s.tickSize&&(r.tickSize=s.tickSize),r.resumeRefresh(!1)}if(r.refresh(),!s.notScroll&&r.isPainted)if("scrollPosition"in s)p=y.position===s.scrollPosition,y.scrollTo(s.scrollPosition);else if(s.visibleDate)r.visibleDate=s.visibleDate;else if(g&&v){const C=ge[u.resolutionUnit],S=C>3?"hour":"minute",D=f.asMilliseconds(S==="minute"?15:1,S),w=new Date(Math.round(g/D)*D);a.zoomDate=g,a.zoomPosition=v,a.zoomLevel=s.zoomLevel,h?y.position=y.scrollWidth-(r.getCoordinateFromDate(w)+v):y.position=r.getCoordinateFromDate(w)-v}else if(m){r.cachedCenterDate=m,a.centerDate=m;const C=r.timelineScroller.clientSize,S=h?r.timeAxisViewModel.totalSize-r.getCoordinateFromDate(m,!0):r.getCoordinateFromDate(m,!0),D=Math.max(S-C/2,0);D===(r.isHorizontal?r.scrollLeft:r.scrollTop)?p=!0:r.isHorizontal?r.scrollHorizontallyTo(D,{scrollingToCenter:!0}):r.scrollVerticallyTo(D,{scrollingToCenter:!0})}else(r.isHorizontal?r.scrollLeft:r.scrollTop)===0?p=!0:r.timelineScroller.scrollTo(0)}r.dataset.presetId=e.id,r.trigger("presetChange",a),r._viewPresetChanging=!1,p&&(r.isHorizontal?r.currentOrientation.updateFromHorizontalScroll(r.scrollLeft,!0):r.currentOrientation.updateFromVerticalScroll(r.scrollTop))}doDestroy(){this._presets.owner===this&&this._presets.destroy(),super.doDestroy()}getCurrentConfig(e){const i=super.getCurrentConfig(e);return i.viewPreset&&i.viewPreset.name&&!i.viewPreset.base&&delete i.viewPreset.name,i}get widgetClass(){}},pe=t=>{var n;return n=class extends(t||R){constructor(){super(...arguments),b(this,"lastWheelTime",-1),b(this,"lastZoomPosition",-1)}construct(e){const i=this;super.construct(e),i.zoomOnMouseWheel&&L.on({element:i.timeAxisSubGridElement,wheel:"onWheel",throttled:{buffer:100,alt:r=>r.ctrlKey&&r.preventDefault()},thisObj:i,capture:!0,passive:!1}),i.zoomOnTimeAxisDoubleClick&&i.ion({timeaxisheaderdblclick:({startDate:r,endDate:s})=>{i.forceFit||i.zoomToSpan({startDate:r,endDate:s})}})}get maxZoomLevel(){return this._maxZoomLevel||this.presets.count-1}set maxZoomLevel(e){if(typeof e!="number"&&(e=this.presets.count-1),e<0||e>=this.presets.count)throw new Error("Invalid range for `maxZoomLevel`");this._maxZoomLevel=e}get minZoomLevel(){return this._minZoomLevel}set minZoomLevel(e){if(typeof e!="number"&&(e=0),e<0||e>=this.presets.count)throw new Error("Invalid range for `minZoomLevel`");this._minZoomLevel=e}get zoomLevel(){return this.presets.indexOf(this.viewPreset)}set zoomLevel(e){this.zoomToLevel(e)}getMilliSecondsPerPixelForZoomLevel(e,i){const{bottomHeader:r}=e,s=this.isHorizontal?e.tickWidth:e.tickHeight;return Math.round((f.add(new Date(1,0,1),r.increment||1,r.unit)-new Date(1,0,1))/(i?s:e.actualWidth||s))}zoomTo(e){const i=this;typeof e=="object"?e.preset?i.zoomToLevel(e.preset,e):e.level!=null?i.zoomToLevel(e.level,e):i.zoomToSpan(e):i.zoomToLevel(e)}zoomToLevel(e,i={}){if(this.forceFit){console.warn("Warning: The forceFit setting and zooming cannot be combined");return}typeof e=="number"&&(e=Math.min(Math.max(e,this.minZoomLevel),this.maxZoomLevel));const r=this,{presets:s}=r,a=r.isVertical?"tickHeight":"tickWidth",o=s.createRecord(e),l=o[a],c=i.startDate?new Date(i.startDate):null,u=i.endDate?new Date(i.endDate):null;s.add(o);let d=c&&u?{startDate:c,endDate:u}:null;const h=i.centerDate?new Date(i.centerDate):d?new Date((c.getTime()+u.getTime())/2):r.viewportCenterDateCached;let m=r.isVertical?r.scrollable.clientHeight:r.timeAxisSubGrid.width;if(m===0){const{_beforeCollapseState:g}=r.timeAxisSubGrid;if(r.isHorizontal&&r.timeAxisSubGrid.collapsed&&(g!=null&&g.width))m=g.width;else return null}return d||(d=r.calculateOptimalDateRange(h,m,o)),"width"in i&&o.setData(a,i.width),r.isZooming=!0,o.options={...i,startDate:d.startDate||r.startDate,endDate:d.endDate||r.endDate,centerDate:h},r.viewPreset=o,o.actualWidth=r.timeAxisViewModel.tickSize,r.isZooming=!1,o.setData(a,l),r.zoomLevel}zoomToFit(e){const i=this.eventStore,r=i.getTotalTimeSpan();e={leftMargin:0,rightMargin:0,...e,...r},e.startDate&&e.endDate&&(e.endDate>e.startDate?this.zoomToSpan(e):this.scrollToDate(e.startDate))}zoomToSpan(e={}){if((e.leftMargin||e.rightMargin)&&(e.adjustStart=0,e.adjustEnd=0),e.leftMargin||(e.leftMargin=0),e.rightMargin||(e.rightMargin=0),!e.startDate||!e.endDate)throw new Error("zoomToSpan: must provide startDate + endDate dates");const i=this,{timeAxis:r}=i,s=e.adjustStart>=0||e.adjustEnd>=0;let{startDate:a,endDate:o}=e;if(s&&(a=f.add(a,-e.adjustStart,r.mainUnit),o=f.add(o,e.adjustEnd,r.mainUnit)),a<=o){const{availableSpace:l}=i.timeAxisViewModel,c=i.presets.allRecords,u=o-a||1;let d=i.zoomLevel,h,m;d===-1&&(d=0);let g=i.getMilliSecondsPerPixelForZoomLevel(c[d],!0),v=d+(h=u/g+e.leftMargin+e.rightMargin>l?-1:1),p,y=null;for(;v>=0&&v<=c.length-1;){p=c[v],g=i.getMilliSecondsPerPixelForZoomLevel(p,!0);const x=u/g+e.leftMargin+e.rightMargin;if(h===-1){if(x<=l){y=v;break}}else if(x<=l)d!==v-h&&(y=v);else break;v+=h}y=y!=null?y:v-h,p=c[y];const C=p.bottomHeader.unit;g=i.getMilliSecondsPerPixelForZoomLevel(p,!0),(e.leftMargin||e.rightMargin)&&(a=new Date(a.getTime()-g*e.leftMargin),o=new Date(o.getTime()+g*e.rightMargin));const S=f.getDurationInUnit(a,o,C,!0)/p.bottomHeader.increment;if(S===0)return null;const D=Math.floor(l/S),w=e.centerDate||new Date((a.getTime()+o.getTime())/2);s?m={startDate:a,endDate:o}:m=i.calculateOptimalDateRange(w,l,p);let A=i.zoomLevel;return i.zoomLevel===y?r.reconfigure(m):A=i.zoomToLevel(y,Object.assign(m,{width:D,centerDate:w})),this.trigger("zoomToSpan",{zoomLevel:y,startDate:a,endDate:o,centerDate:w}),A}return null}zoomIn(e=1,i){typeof e=="object"&&(i=e,e=1);const r=this.zoomLevel;return r>=this.maxZoomLevel?null:this.zoomToLevel(r+e,i)}zoomOut(e=1,i){typeof e=="object"&&(i=e,e=1);const r=this.zoomLevel;return r<=this.minZoomLevel?null:this.zoomToLevel(r-e,i)}zoomInFull(e){return this.zoomToLevel(this.maxZoomLevel,e)}zoomOutFull(e){return this.zoomToLevel(this.minZoomLevel,e)}calculateOptimalDateRange(e,i,r){const s=this,{timeAxis:a}=s,{bottomHeader:o}=r,l=s.isHorizontal?r.tickWidth:r.tickHeight;if(s.zoomKeepsOriginalTimespan)return{startDate:a.startDate,endDate:a.endDate};const c=o.unit,u=Math.ceil(i/l*o.increment*s.visibleZoomFactor/2),d=f.add(e,-u,c),h=f.add(e,u,c);return{startDate:a.floorDate(d,!1,c,o.increment),endDate:a.ceilDate(h,!1,c,o.increment)}}onElementMouseMove(e){const{isHorizontal:i,zoomContext:r}=this;super.onElementMouseMove(e),e.isTrusted&&r&&Math.abs(e[`client${i?"X":"Y"}`]-r.coordinate)>10&&(this.zoomContext=null)}async onWheel(e){if(e.ctrlKey&&!this.forceFit){e.preventDefault();const i=this,{zoomContext:r,isHorizontal:s,timelineScroller:a,zoomLevel:o}=i,l=performance.now(),c=e[`client${s?"X":"Y"}`];let u=c-a.viewport[`${s?"x":"y"}`];s&&i.rtl&&(u=a.viewport.width+a.viewport.x-c),l-i.lastWheelTime>200||!r||Math.abs(c-i.zoomContext.coordinate)>20?i.zoomContext={zoomLevel:o,coordinate:c,zoomPosition:u,zoomDate:i.getDateFromDomEvent(e)}:(o>r.zoomLevel&&(r.zoomDate=i.getDateFromDomEvent(e),r.zoomLevel=o),r.zoomPosition=u),i.lastWheelTime=l,i[`zoom${e.deltaY>0?"Out":"In"}`](void 0,i.zoomContext)}}setTimeSpan(e,i,r){this.timeAxis.setTimeSpan(e,i,r)}shift(e,i){this.timeAxis.shift(e,i)}shiftNext(e){this.timeAxis.shiftNext(e)}shiftPrevious(e){this.timeAxis.shiftPrevious(e)}get widgetClass(){}},b(n,"$name","TimelineZoomable"),b(n,"defaultConfig",{zoomOnMouseWheel:!0,zoomOnTimeAxisDoubleClick:!0,minZoomLevel:0,maxZoomLevel:null,visibleZoomFactor:5,zoomKeepsOriginalTimespan:null}),n},Se=class extends Yt{static get $name(){return"RecurrenceConfirmationPopup"}static get type(){return"recurrenceconfirmation"}static get defaultConfig(){return{localizableProperties:[],align:"b-t",autoShow:!1,autoClose:!1,closeAction:"onRecurrenceClose",modal:!0,centered:!0,scrollAction:"realign",constrainTo:globalThis,draggable:!0,closable:!0,floating:!0,eventRecord:null,cls:"b-sch-recurrenceconfirmation",bbar:{defaults:{localeClass:this},items:{changeSingleButton:{weight:100,cls:"b-raised",color:"b-blue",text:"L{update-only-this-btn-text}",onClick:"up.onChangeSingleButtonClick"},changeMultipleButton:{weight:200,color:"b-green",text:"L{Object.Yes}",onClick:"up.onChangeMultipleButtonClick"},cancelButton:{weight:300,color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelButtonClick"}}}}}get changeMultipleButton(){return this.widgetMap.changeMultipleButton}get changeSingleButton(){return this.widgetMap.changeSingleButton}get cancelButton(){return this.widgetMap.cancelButton}onChangeMultipleButtonClick(){this.processMultipleRecords(),this.hide()}onChangeSingleButtonClick(){this.processSingleRecord(),this.hide()}onCancelButtonClick(){this.cancelFn&&this.cancelFn.call(this.thisObj),this.hide()}onRecurrenceClose(){this.cancelFn&&this.cancelFn.call(this.thisObj),this.hide()}confirm(t={}){const n=this;return["actionType","eventRecord","title","html","changerFn","cancelFn","finalizerFn","thisObj"].forEach(e=>{e in t&&(n[e]=t[e])}),n.updatePopupContent(),super.show(t)}updatePopupContent(){const t=this,{changeMultipleButton:n,changeSingleButton:e,cancelButton:i}=t.widgetMap,{eventRecord:r,actionType:s="update"}=t;(r==null?void 0:r.isRecurring)?(n.text=t.L("L{Object.Yes}"),t.html=t.L(`${s}-all-message`)):(n.text=t.L(`${s}-further-btn-text`),t.html=t.L(`${s}-further-message`)),e.text=t.L(`${s}-only-this-btn-text`),i.text=t.L("L{Object.Cancel}"),t.width=t.L("L{width}"),t.title=t.L(`${s}-title`)}processMultipleRecords(){const{eventRecord:t,changerFn:n,thisObj:e,finalizerFn:i}=this;t.beginBatch(),n&&this.callback(n,e,[t]),t.endBatch(),i&&this.callback(i,e,[t])}processSingleRecord(){const{eventRecord:t,changerFn:n,thisObj:e,finalizerFn:i}=this;t.beginBatch();let r;t!=null&&t.isRecurring&&t.recurrence.forEachOccurrence(t.startDate,null,(s,a,o)=>{if(o>1)return r=s,!1}),r==null||r.convertToRealEvent(),t.recurrence=null,n&&this.callback(n,e,[t]),t.recurrenceRule=null,t.endBatch(),i&&this.callback(i,e,[t])}updateLocalization(){this.updatePopupContent(),super.updateLocalization()}};Se.initClass(),Se._$name="RecurrenceConfirmationPopup";var qe=t=>{var n;return n=class extends(t||R){construct(e){super.construct(e),this.ion({beforeEventDropFinalize:"onRecurrableBeforeEventDropFinalize",beforeEventResizeFinalize:"onRecurrableBeforeEventResizeFinalize",beforeAssignmentDelete:"onRecurrableAssignmentBeforeDelete"})}changeRecurrenceConfirmationPopup(e,i){const r=this.constructor.reconfigure(i,e,"recurrenceconfirmation");return r.owner=this,r}findRecurringEventToConfirmDelete(e){return e.find(i=>i.supportsRecurring&&(i.isRecurring||i.isOccurrence))}onRecurrableAssignmentBeforeDelete({assignmentRecords:e,context:i}){const r=e.map(a=>a.event),s=this.findRecurringEventToConfirmDelete(r);if(this.enableRecurringEvents&&s)return this.recurrenceConfirmationPopup.confirm({actionType:"delete",eventRecord:s,changerFn(){i.finalize(!0)},cancelFn(){i.finalize(!1)}}),!1}onRecurrableBeforeEventDropFinalize({context:e}){if(this.enableRecurringEvents){const{eventRecords:i}=e,r=i.filter(s=>s.supportsRecurring&&(s.isRecurring||s.isOccurrence));r.length&&(e.async=!0,this.recurrenceConfirmationPopup.confirm({actionType:"update",eventRecord:r[0],changerFn(){e.finalize(!0)},cancelFn(){e.finalize(!1)}}))}}onRecurrableBeforeEventResizeFinalize({context:e}){if(this.enableRecurringEvents){const{eventRecord:i}=e;i.supportsRecurring&&(i.isRecurring||i.isOccurrence)&&(e.async=!0,this.recurrenceConfirmationPopup.confirm({actionType:"update",eventRecord:i,changerFn(){e.finalize(!0)},cancelFn(){e.finalize(!1)}}))}}onAssignmentChange({action:e,records:i,changes:r}){var s;if(!(e==="update"&&r.event&&r.resource&&Object.keys(r).length===2)&&e!=="dataset"&&Array.isArray(i))for(const a of i)(s=a.event)!=null&&s.isRecurring&&!a.event.isBatchUpdating&&a.event.removeOccurrences(this.eventStore)}getOccurrencesFor(e){return this.eventStore.getOccurrencesForTimeSpan(e,this.timeAxis.startDate,this.timeAxis.endDate)}async removeEvents(e,i=null,r=this){const s=this;if(!s.readOnly&&e.length){const a={finalize(l=!0){i&&i(l),l!==!1&&(e.some(c=>{var u;return c.isOccurrence||((u=c.event)==null?void 0:u.isOccurrence)})?e.forEach(c=>c.isOccurrenceAssignment?c.event.remove():c.remove()):(e[0].isAssignment?s.assignmentStore:s.eventStore).remove(e))}};let o;if(e[0].isAssignment?o=s.trigger("beforeAssignmentDelete",{assignmentRecords:e,context:a}):o=await s.trigger("beforeEventDelete",{eventRecords:e,context:a}),o!==!1){const l=e.find(c=>c.isRecurring||c.isOccurrence);return l?(s.recurrenceConfirmationPopup.owner=r,s.recurrenceConfirmationPopup.confirm({actionType:"delete",eventRecord:l,changerFn(){a.finalize(!0)},cancelFn(){a.finalize(!1)}})):a.finalize(!0),!0}}return!1}get widgetClass(){}},b(n,"$name","RecurringEvents"),b(n,"configurable",{enableRecurringEvents:!1,recurrenceConfirmationPopup:{$config:["lazy"],value:{type:"recurrenceconfirmation"}}}),n},Ze=t=>{var n;return n=class extends(t||R){static get $name(){return"TimelineEventRendering"}static get defaultConfig(){return{managedEventSizing:!0,generatedIdCls:"b-sch-dirty-new",dirtyCls:"b-sch-dirty",committingCls:"b-sch-committing",endsOutsideViewCls:"b-sch-event-endsoutside",startsOutsideViewCls:"b-sch-event-startsoutside",fixedEventCls:"b-sch-event-fixed"}}updateFillTicks(e){this.isConfiguring||(this.timeAxis.forceFullTicks=e&&this.snap,this.refreshWithTransition(),this.trigger("stateChange"))}changeBarMargin(e){return E.assertNumber(e,"barMargin"),this._resourceMargin==null&&this.changeResourceMargin(e),this.isHorizontal&&this.rowHeight?Math.min(Math.ceil(this.rowHeight/2),e):e}updateBarMargin(){this.rendered&&(this.currentOrientation.onBeforeRowHeightChange(),this.refreshWithTransition(),this.trigger("stateChange"))}get resourceMargin(){return this._resourceMargin==null?this.barMargin:this._resourceMargin}changeResourceMargin(e){const i=this;return typeof e=="number"?(i.isHorizontal&&i.rowHeight&&(e=Math.min(Math.ceil(i.rowHeight/2),e)),i.resourceMarginObject={start:e,end:e,total:e*2},e):(e!=null&&e.start||(e.start=0),e!=null&&e.end||(e.end=0),i.isHorizontal&&i.rowHeight&&(e.start=i.rowHeight<e.start+e.end?Math.ceil(i.rowHeight/2):e.start,e.end=i.rowHeight<e.start+e.end?Math.ceil(i.rowHeight/2):e.end),i.resourceMarginObject=E.assign({total:e.start+e.end},e),e)}updateResourceMargin(){const e=this;e.rendered&&(e.currentOrientation.onBeforeRowHeightChange(),e.refreshWithTransition())}changeTickSize(e){return E.assertNumber(e,"tickSize"),e}updateTickSize(e){this.timeAxisViewModel.tickSize=e}get tickSize(){return this.timeAxisViewModel.tickSize}static get eventColors(){return["red","pink","purple","magenta","violet","indigo","blue","cyan","teal","green","gantt-green","lime","yellow","orange","deep-orange","gray","light-gray"]}static get eventStyles(){return["plain","border","hollow","colored","line","dashed","minimal","rounded"]}updateEventStyle(e){this.isConfiguring||(this.refreshWithTransition(),this.trigger("stateChange"))}updateEventColor(e){this.isConfiguring||(this.refreshWithTransition(),this.trigger("stateChange"))}get widgetClass(){}},b(n,"configurable",{barMargin:10,fillTicks:!1,resourceMargin:null,eventColor:"green",eventStyle:"plain",tickSize:null}),n},ti={maintainVisibleStart:!0},ii={block:"nearest"},Ke=t=>{var n;return n=class extends(t||R).mixin(pe){onZoomToSpan({startDate:e}){this.infiniteScroll&&this.scrollToDate(e,{block:"start"})}calculateOptimalDateRange(e,i,r){if(this.infiniteScroll){if(this.zoomKeepsOriginalTimespan){const{startDate:s,endDate:a}=this.timeAxis;return{startDate:s,endDate:a}}return this.calculateInfiniteScrollingDateRange(e,!0)}return super.calculateOptimalDateRange(...arguments)}initScroll(){var e;const i=this,{isHorizontal:r,visibleDate:s}=i;super.initScroll();const{scrollable:a}=r?i.timeAxisSubGrid:i;if(a.ion({scroll:"onTimelineScroll",thisObj:i}),i.infiniteScroll)if((e=i.partneredWith)!=null&&e.values.some(o=>o.infiniteScroll)){const o=a.element.getBoundingClientRect()[i.isHorizontal?"width":"height"];i.timeAxisViewModel.update(o,!1,!0)}else{const o=s?{...s,visibleDate:s.date}:{visibleDate:i.viewportCenterDate,block:"center"},{startDate:l,endDate:c}=i.calculateInfiniteScrollingDateRange(o.visibleDate,o.block==="center");i.setTimeSpan(l,c,o)}}get timelineScroller(){const e=this;return e.scrollInitialized||e.initScroll(),e._timelineScroller||(e._timelineScroller=new ni({widget:e,scrollable:e.isHorizontal?e.timeAxisSubGrid.scrollable:e.scrollable,isHorizontal:e.isHorizontal}))}calculateInfiniteScrollingDateRange(e,i,r=this.timeAxisViewModel.viewPreset){const{timeAxis:s,availableSpace:a}=this.timeAxisViewModel,{bufferCoef:o}=this,{leafUnit:l,leafIncrement:c,topUnit:u,topIncrement:d,tickSize:h}=r,m=l===u&&Math.round(d)===d&&Math.round(c)===c,g=m?d:c,v=m?u:l;if(i){const p=Math.ceil((a*o+a/2)/h);return{startDate:s.floorDate(f.add(e,-p*c,l),!1,v,g),endDate:s.ceilDate(f.add(e,p*c,l),!1,v,g)}}else{const p=Math.ceil(a*o/h);return{startDate:s.floorDate(f.add(e,-p*c,l),!1,v,g),endDate:s.ceilDate(f.add(e,Math.ceil((a/h+p)*c),l),!1,v,g)}}}doDestroy(){var e;(e=this._timelineScroller)==null||e.destroy(),super.doDestroy()}onTimelineScroll({source:e}){this.infiniteScroll&&this.checkTimeAxisScroll(e[this.isHorizontal?"x":"y"])}checkTimeAxisScroll(e){const i=this,r=i.timelineScroller,{clientSize:s}=r,a=s*i.bufferCoef,o=a*i.bufferThreshold,l=r.maxPosition,{style:c}=i.timeAxisSubGrid.virtualScrollerElement;(l-e<o||e<o)&&(c.overflow="hidden",c.pointerEvents="none",c.paddingBottom=`${T.scrollBarWidth}px`,i.setTimeout(()=>{c.overflow="",c.paddingBottom="",c.pointerEvents=""},100),i.shiftToDate(i.getDateFromCoordinate(e,null,!0,!1,!0)))}shiftToDate(e,i){const r=this.calculateInfiniteScrollingDateRange(e,i);this.setTimeSpan(r.startDate,r.endDate,ti)}updateInfiniteScroll(e){!this.isConfiguring&&e&&this.checkTimeAxisScroll(this.timelineScroller.position)}async scrollToDate(e,i={}){const r=this,{timeAxis:s,visibleDateRange:a,infiniteScroll:o}=r,{unit:l,increment:c}=s,u=i.edgeOffset||0,d=f.ceil(a.endDate,c+" "+l)-f.floor(a.startDate,c+" "+l),h=e>r.viewportCenterDate?1:-1,m=(o?d*r.bufferCoef*r.bufferThreshold:i.block==="center"?d/2:u?r.getMilliSecondsPerPixelForZoomLevel(r.viewPreset)*u:0)*h,g=new Date(e.getTime()+m);(g>s.endDate?1:g<s.startDate?-1:0)&&r.infiniteScroll&&(r.shiftToDate(new Date(e-m),null,!0),await r.nextAnimationFrame());const p=r.timelineScroller.viewport,y=r.getCoordinateFromDate(e,!0),C=Math.min(r.timeAxisViewModel.tickSize,r.timeAxisViewModel.availableSpace),S=r.isHorizontal?new k(r.getCoordinateFromDate(e,!1)-(r.rtl?C:0),p.y,C,p.height):new k(p.x,r.getCoordinateFromDate(e,!1),p.width,r.timeAxisViewModel.tickSize);await r.scrollToCoordinate(y,S,e,i)}scrollToNow(e={}){return this.scrollToDate(new Date,e)}async scrollToCoordinate(e,i,r,s={}){const a=this;if(e<0){const o=a.endDate-a.startDate,{unit:l,increment:c}=a.timeAxis,u=f.floor(new Date(r.getTime()-o/2),c+" "+l),d=f.add(u,o);return u-a.startDate!==0&&d-a.endDate!==0?(await a.setTimeSpan(u,d),a.scrollToDate(r,s)):void 0}return await a.timelineScroller.scrollIntoView(i,s),!a.isDestroyed&&a.nextAnimationFrame()}set scrollLeft(e){this.timeAxisSubGrid.scrollable.element.scrollLeft=e}get scrollLeft(){return this.timeAxisSubGrid.scrollable.element.scrollLeft}set scrollX(e){this.timeAxisSubGrid.scrollable.x=e}get scrollX(){return this.timeAxisSubGrid.scrollable.x}set scrollTop(e){this.scrollable.y=e}get scrollTop(){return this.scrollable.y}scrollHorizontallyTo(e,i=!0){return this.timeAxisSubGrid.scrollable.scrollTo(e,null,i)}scrollVerticallyTo(e,i=!0){return this.scrollable.scrollTo(null,e,i)}scrollTo(e,i=!0){return this.timeAxisSubGrid.scrollable.scrollTo(e,null,i)}get widgetClass(){}},b(n,"$name","TimelineScroll"),b(n,"configurable",{bufferCoef:5,bufferThreshold:.2,infiniteScroll:!1}),n},ni=class extends qt{static get configurable(){return{position:null,x:null,y:null}}updateOverflowX(){}updateOverflowY(){}onScroll(t){super.onScroll(t),this._position=null}syncPartners(t){this.scrollable.syncPartners(t)}updatePosition(t){this.scrollable[this.isHorizontal?"x":"y"]=t}get viewport(){return this.scrollable.viewport}get position(){return this._position=this.scrollable[this.isHorizontal?"x":"y"]}get clientSize(){return this.scrollable[`client${this.isHorizontal?"Width":"Height"}`]}get scrollSize(){return this.scrollable[`scroll${this.isHorizontal?"Width":"Height"}`]}get maxPosition(){return this.scrollable[`max${this.isHorizontal?"X":"Y"}`]}scrollTo(t,n){return this.isHorizontal?this.scrollable.scrollTo(t,null,n):this.scrollable.scrollTo(null,t,n)}scrollBy(t=0,n=0,e=ii){return this.isHorizontal?this.scrollable.scrollBy(t||n,0,e):this.scrollable.scrollBy(0,n||t,e)}scrollIntoView(){return this.scrollable.scrollIntoView(...arguments)}changeX(t){this.position=t}changeY(t){this.position=t}get x(){return this.position}set x(t){this.scrollable[this.isHorizontal?"x":"y"]=t}get y(){return this.position}set y(t){this.scroller[this.isHorizontal?"x":"y"]=t}get clientWidth(){return this.clientSize}get clientHeight(){return this.clientSize}get scrollWidth(){return this.scrollSize}get scrollHeight(){return this.scrollSize}get maxX(){return this.maxPosition}get maxY(){return this.maxPosition}},Xe=["barMargin"],Qe=t=>class extends(t||R){static get $name(){return"TimelineState"}getState(){const e=this,i=E.copyProperties(super.getState(),e,Xe);return i.zoomLevel=e.zoomLevel,i.zoomLevelOptions={startDate:e.startDate,endDate:e.endDate,centerDate:!e.infiniteScroll||e.timeAxisViewModel.availableSpace?e.viewportCenterDate:void 0,width:e.tickSize},i}applyState(e){var i;const r=this;r.suspendRefresh(),E.copyProperties(r,e,Xe),super.applyState(e),e.zoomLevel!=null&&(r.infiniteScroll&&(i=e==null?void 0:e.scroll)!=null&&i.scrollLeft&&(e.scroll.scrollLeft={}),r.isPainted?r.zoomToLevel(e.zoomLevel,e.zoomLevelOptions):r._zoomAfterPaint={zoomLevel:e.zoomLevel,zoomLevelOptions:e.zoomLevelOptions}),r.resumeRefresh(!0)}onInternalPaint(...e){if(super.onInternalPaint(...e),this._zoomAfterPaint){const{zoomLevel:i,zoomLevelOptions:r}=this._zoomAfterPaint;this.zoomToLevel(i,r),delete this._zoomAfterPaint}}get widgetClass(){}},Je=class extends Tt{static get $name(){return"SchedulerHeader"}refreshContent(){var t;(t=this.headersElement)!=null&&t.querySelector(".b-sch-timeaxiscolumn")||super.refreshContent()}};Je._$name="Header";var ye=class extends Ft{static get $name(){return"TimeAxisSubGrid"}static get type(){return"timeaxissubgrid"}static get configurable(){return{sealedColumns:!0,headerClass:Je}}startConfigure(t){const{grid:n}=t;n.timeAxisSubGrid=this,super.startConfigure(t),n.isHorizontal&&(t.header={cls:{"b-sticky-headers":n.stickyHeaders}},delete t.headerClass),"flex"in t||"width"in t||(t.flex=1)}changeScrollable(){const t=this,n=super.changeScrollable(...arguments);return n&&Object.defineProperty(n,"scrollWidth",{get(){var e,i;return(i=(e=this.element)==null?void 0:e.scrollWidth)!=null?i:0},set(){t.grid.updateCanvasSize()}}),n}handleHorizontalScroll(t=!0){this.grid._viewPresetChanging||super.handleHorizontalScroll(t)}onInternalResize(t,n,e,i,r){const s=this;if(super.onInternalResize(...arguments),s.isPainted&&n!==i){const a=s.grid,o=a._bodyRectangle.height,l=s.monitorResize&&T.scrollBarWidth&&n<i;l&&(s.monitorResize=!1),a.onSchedulerViewportResize(n,o,i,o),l&&queueMicrotask(()=>s.monitorResize=!0)}}get headerScrollWidth(){return this.grid.isVertical?super.headerScrollWidth:this.grid.timeAxisViewModel.totalSize}clearWidthCache(){super.clearWidthCache(),this.owner.isHorizontal&&this.owner.updateViewModelAvailableSpace(this.width)}async expand(){const{owner:t}=this;await super.expand(),t.isPainted&&t.timeAxisViewModel.update(this.width,!1,!0)}};ye.initClass(),ye._$name="TimeAxisSubGrid";var et={fn:"exitTransition",delay:0,cancelOutstanding:!0},tt=(t,n,e)=>n==null?e==null||t<e:e==null?t>=n:n<e?n<=t&&t<e:t<e||n<=t,ri=(t,n)=>tt(t.getDay(),n.fromDay,n.toDay)&&tt(t.getHours(),n.fromHour,n.toHour),Ce={},O=class extends At.mixin(Ne,Ye,Ze,pe,Ke,Qe,Ge,qe){constructor(){super(...arguments),b(this,"timeCellSelector",null),b(this,"_animationSuspendedCounter",0)}static get defaultConfig(){return{workingTime:null,timeAxis:null,timeAxisViewModel:null,autoAdjustTimeAxis:!0,snapRelativeToEventStartDate:!1,suppressFit:!1,timeCellCls:null,scheduledEventName:null,overScheduledEventClass:null,preventOverCls:!1,enableEventAnimations:!0,disableGridRowModelWarning:!0,animateRemovingRows:!1,schedulerRegion:"normal",transitionDuration:200,animationTimeout:null,defaultRegion:"locked",durationDisplayPrecision:1,asyncEventSuffix:"PreCommit"}}updateTimeZone(t){this.project&&(this.isConfiguring&&(this.project._isConfiguringTimeZone=!0),this.project.timeZone=t)}get timeZone(){var t;return(t=this.project)==null?void 0:t.timeZone}populateEventMenu(){}populateScheduleMenu(){}internalOnVisibleDateRangeChange(t){if(!this.handlingVisibleDateRangeChange){const n=this,{_visibleDateRange:e}=n;(!e||e.startDate-t.startDate||e.endDate-t.endDate)&&(n.timeView.range=t,n.handlingVisibleDateRangeChange=!0,n.trigger("visibleDateRangeChange",{old:e,new:t}),n.handlingVisibleDateRangeChange=!1,n._visibleDateRange=t)}}onVisibleResourceRangeChange(){}construct(t={}){const n=this;super.construct(t),n.$firstVerticalOverflow=!0,n.initDomEvents(),n.currentOrientation.init(),n.rowManager.ion({refresh:()=>{n.forceLayout=!1}})}createSubGrid(t,n={}){const e=this,{stickyHeaders:i}=e;return t===(e.schedulerRegion||"normal")?n.type="timeaxissubgrid":t==="locked"&&i&&e.isVertical&&(n.scrollable={overflowX:"visible",overflowY:"visible"},e.bodyContainer.classList.add("b-sticky-headers")),super.createSubGrid(t,n)}doDestroy(){const t=this,{partneredWith:n,currentOrientation:e}=t;e==null||e.destroy(),n?(n.forEach(i=>{t.removePartner(i)}),n.destroy()):(t.timeAxisViewModel.destroy(),t.timeAxis.destroy()),super.doDestroy()}startConfigure(t){super.startConfigure(t),Gt.addResizeListener(this.bodyContainer,this.onBodyResize.bind(this)),this.getConfig("partner")}changeStartDate(t){return typeof t=="string"&&(t=f.parse(t)),t}onInternalPaint({firstPaint:t}){var n,e;if(t){const i=this,r=i.isHorizontal?i.timeAxisSubGrid.scrollable:i.scrollable,s=r.element.getBoundingClientRect()[i.isHorizontal?"width":"height"];i.timeAxisViewModel.update(s,i.infiniteScroll,!0),i.infiniteScroll&&((e=(n=i.currentOrientation).doUpdateTimeView)==null||e.call(n)),i.getConfig("hideRowHover")}super.onInternalPaint(...arguments)}onSchedulerHorizontalScroll(t,n,e,i){this.currentOrientation.updateFromHorizontalScroll(e),super.onSchedulerHorizontalScroll(t,n,e,i)}initScroll(){const t=this;let n=0;super.initScroll(),t.ion({horizontalScroll:({subGrid:e,scrollLeft:i,scrollX:r,scrollingToCenter:s})=>{t.isPainted&&e===t.timeAxisSubGrid&&!t.isDestroying&&!t.refreshSuspended&&t.onSchedulerHorizontalScroll(e,i,r,s),n++}}),t.testPerformance==="horizontal"&&t.setTimeout(()=>{const e=performance.now();let i=5,r=1;const s=t.setInterval(()=>{if(i=i+5,t.scrollX+=(10+Math.floor(i))*r,r===1&&t.scrollX>5500&&(r=-1,i=5),r===-1&&t.scrollX<=0){const l=(performance.now()-e)/n,c=Math.round(1e3/l*10)/10;clearInterval(s),console.log(t.eventPositionMode,t.eventScrollMode,c+"fps")}},0)},500)}preserveViewCenter(t,n=this,...e){const i=this,r=i.viewportCenterDate,s=t.apply(n,e),a=i.timelineScroller,{clientSize:o}=a,l=Math.max(Math.floor(i.getCoordinateFromDate(r,!0)-o/2),0);return a.scrollTo(l,{scrollingToCenter:!0}),s}setTimeSpan(t,n,e=Ce){const i=this,{timeAxis:r}=i,{preventThrow:s=!1,maintainVisibleStart:a=!1,visibleDate:o}=e,{startDate:l,endDate:c}=r.getAdjustedDates(t,n),u=r.startDate-l!==0,d=r.endDate-c!==0;if(u||d){if(a){const{timeAxisViewModel:m}=i,{totalSize:g}=m,v=m.tickSize,p=i.timelineScroller,y=p.position,C=m.getDateFromPosition(y);C>=l&&C<c&&m.ion({update(){const S=m.tickSize!==v;i.updateCanvasSize(),u&&!d&&!S?p.position+=m.totalSize-g:!u&&!S?p.position=y:p.position=m.getPositionFromDate(C),p.syncPartners(!0)},prio:1e4,once:!0})}const h=r.reconfigure({startDate:l,endDate:c},!1,s);return o?i.scrollToDate(o,e).then(()=>h):h}}get hasVisibleEvents(){return!this.noFeatureElementsInAxis()||this.eventStore.storage.values.some(t=>this.timeAxis.isTimeSpanInAxis(t))}noFeatureElementsInAxis(){}get capitalizedEventName(){return this._capitalizedEventName||(this._capitalizedEventName=P.capitalize(this.scheduledEventName)),this._capitalizedEventName}updatePartner(t){t&&this.addPartner(t)}addPartner(t){const n=this;if(!n.isPartneredWith(t)){n._partner==null&&(n._partner=t),(n.partneredWith||(n.partneredWith=new de)).add(t),(t.partneredWith||(t.partneredWith=new de)).add(n),n.getConfig("viewPreset"),n.getConfig("infiniteScroll"),t.ion({presetchange:"onPartnerPresetChange",thisObj:n}),t.scrollable.ion({overflowChange:"onPartnerOverflowChange",thisObj:n});const i=n.partnerSharedConfigs.reduce((r,s)=>(r[s]=t[s],r),{});i.viewPreset.options={scrollPosition:t.timelineScroller.position,tickSize:t.tickSize},n.setConfig(i),n.ion({presetchange:"onPartnerPresetChange",thisObj:t}),n.scrollable.ion({overflowChange:"onPartnerOverflowChange",thisObj:t}),n.isPainted?(t.scrollable.addPartner(n.scrollable,n.isHorizontal?"x":"y"),t.syncPartnerSubGrids()):n.initScroll=Vt.createSequence(n.initScroll,()=>{t.scrollable.addPartner(n.scrollable,n.isHorizontal?"x":"y"),t.syncPartnerSubGrids()},n)}}removePartner(t){const n=this,{partneredWith:e}=n;n.isPartneredWith(t)&&(n._partner===t&&(n._partner=null),e.remove(t),n.scrollable.removePartner(t.scrollable),n.un({presetchange:"onPartnerPresetChange",thisObj:t}),n.scrollable.un({overflowChange:"onPartnerOverflowChange",thisObj:t}),t.removePartner(n))}isPartneredWith(t){var n;return!!((n=this.partneredWith)!=null&&n.includes(t))}onPartnerOverflowChange({source:t,y:n}){const{scrollable:e}=this,i=e.hasOverflow("y")||e.overflowY==="scroll";i!==n?e.overflowY==="scroll"?(e.overflowY=!0,this.refreshVirtualScrollbars()):i?t.overflowY="scroll":(t.overflowY=!0,e.overflowY="scroll",this.refreshVirtualScrollbars()):e.overflowY=!0}onPartnerPresetChange({preset:t,startDate:n,endDate:e,centerDate:i,zoomDate:r,zoomPosition:s,zoomLevel:a}){!this._viewPresetChanging&&this.viewPreset!==t&&(t.options={startDate:n,endDate:e,centerDate:i,zoomDate:r,zoomPosition:s,zoomLevel:a},this.viewPreset=t)}get partners(){const t=this.partner?[this.partner]:[];return this.partneredWith&&t.push.apply(t,this.partneredWith.allValues),[...new Set(t)]}get timeAxisColumn(){return this.columns&&this._timeAxisColumn}changeColumns(t,n){const e=this;let i,r;if(t){const s=Array.isArray(t);let a=t;s||(a=t.data),i=a&&a.length,a.some((o,l)=>o.type==="timeAxis"?(i=l,r=E.assign(o,e.timeAxisColumn),!0):!1),e.isVertical?(a=[E.assign({type:"verticalTimeAxis"},e.verticalTimeAxisColumn),a[i]],i=1):a=a.slice(),a[i]=this._timeAxisColumn||{type:"timeAxis",cellCls:e.timeCellCls,mode:e.mode,...r},s||t.isStore&&t.owner!==this?t=a:t.data=a}return super.changeColumns(t,n)}updateColumns(t,n){if(super.updateColumns(t,n),t){const e=this,i=e._timeAxisColumn=e.columns.find(r=>r.isTimeAxisColumn);e.isVertical&&(e.verticalTimeAxisColumn=e.columns.find(r=>r.isVerticalTimeAxisColumn),e.verticalTimeAxisColumn.relayAll(e)),i.relayAll(e)}}onColumnsChanged({action:t,changes:n,record:e,records:i}){var r;const{timeAxisColumn:s,columns:a}=this;(t==="dataset"||t==="batch")&&!a.includes(s)?a.add(s,!0):e===s&&"width"in n&&this.updateCanvasSize(),e&&((r=this.partneredWith)==null||r.forEach(o=>{const l=o.columns.getAt(e.allIndex);if(l!=null&&l.shouldSync(e)){const c={};for(const u in n)c[u]=n[u].value;l.set(c)}})),super.onColumnsChanged(...arguments)}get timeView(){var t,n;const e=this;return e.columns&&e.isVertical?(t=e.verticalTimeAxisColumn)==null?void 0:t.view:(n=e.timeAxisColumn)==null?void 0:n.timeAxisView}updateEventCls(t){const n=this;n.eventSelector||(n.unreleasedEventSelector=n.eventSelector=`.${t}-wrap`),n.eventInnerSelector||(n.eventInnerSelector=`.${t}`)}set timeAxisViewModel(t){const n=this,e=n._timeAxisViewModel,i={name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",prio:100,thisObj:n};n.partner&&!t||e&&e===t||((e==null?void 0:e.owner)===n&&e.destroy(),n.detachListeners("timeAxisViewModel"),t!=null&&t.isTimeAxisViewModel?t.ion(i):t=ve.new({mode:n._mode,snap:n.snap,forceFit:n.forceFit,timeAxis:n.timeAxis,suppressFit:n.suppressFit,internalListeners:i,owner:n},t),n.isConfiguring||(n.isHorizontal?n.timeAxisColumn.timeAxisViewModel=t:n.verticalTimeAxisColumn.view.model=t),n._timeAxisViewModel=t,n.relayEvents(t,["update"],"timeAxisViewModel"),e&&t&&n.trigger("timeAxisViewModelChange",{timeAxisViewModel:t}))}get timeAxisViewModel(){return this._timeAxisViewModel||(this.timeAxisViewModel=null),this._timeAxisViewModel}get suppressFit(){var t,n;return(n=(t=this._timeAxisViewModel)==null?void 0:t.suppressFit)!=null?n:this._suppressFit}set suppressFit(t){this._timeAxisViewModel?this.timeAxisViewModel.suppressFit=t:this._suppressFit=t}set timeAxis(t){const n=this,e=n._timeAxis,i={name:"timeAxis",reconfigure:"onTimeAxisReconfigure",thisObj:n};n.partner&&!t||e&&e===t||(e&&e.owner===n&&e.destroy(),n.detachListeners("timeAxis"),t!=null&&t.isTimeAxis||(t=E.assign({owner:n,viewPreset:n.viewPreset,autoAdjust:n.autoAdjustTimeAxis,weekStartDay:n.weekStartDay,forceFullTicks:n.fillTicks&&n.snap},t),n.startDate&&(t.startDate=n.startDate),n.endDate&&(t.endDate=n.endDate),n.workingTime&&n.applyWorkingTime(t),t=new fe(t)),t.ion(i),n._timeAxis=t)}onTimeAxisReconfigure({config:t,oldConfig:n}){t&&(!n||n.startDate-t.startDate||n.endDate-t.endDate)&&this.trigger("dateRangeChange",{old:{startDate:n.startDate,endDate:n.endDate},new:{startDate:t.startDate,endDate:t.endDate}}),this.trigger("timeAxisChange",{config:t})}get timeAxis(){return this._timeAxis||(this.timeAxis=null),this._timeAxis}updateForceFit(t){this._timeAxisViewModel&&(this._timeAxisViewModel.forceFit=t)}set workingTime(t){this._workingTime=t,this.isConfiguring||this.applyWorkingTime(this.timeAxis)}get workingTime(){return this._workingTime}applyWorkingTime(t){var n;const e=this,i=e._workingTime;if(i){let r=null;i.fromHour>=0&&i.fromHour<24&&i.toHour>i.fromHour&&i.toHour<=24&&i.toHour-i.fromHour<24&&(r={from:i.fromHour,to:i.toHour});let s=null;i.fromDay>=0&&i.fromDay<7&&i.toDay>i.fromDay&&i.toDay<=7&&i.toDay-i.fromDay<7&&(s={from:i.fromDay,to:i.toDay}),r||s?t.include={hour:r,day:s}:t.include=null}else t.include=null;e.isPainted&&(e.timeAxisColumn.refreshHeader(),(n=e.features.columnLines)==null||n.refresh(),e.refreshWithTransition())}updateStartDate(t){this.setStartDate(t)}setStartDate(t,n=!0){const e=this,i=e._timeAxis,{startDate:r,endDate:s,mainUnit:a}=i||Ce;if(typeof t=="string"&&(t=f.parse(t)),i&&s){if(t){let o=s;if(n&&r){const l=f.diff(r,s,a,!0);o=f.add(t,l,a)}e.setTimeSpan(t,o)}}else e._tempStartDate=t}get startDate(){var t;let n=((t=this._timeAxis)==null?void 0:t.startDate)||this._tempStartDate;if(!n){n=new Date;const{workingTime:e}=this;if(e)for(;!ri(n,e);)n.setHours(n.getHours()+1);this._tempStartDate=n}return n}changeEndDate(t){typeof t=="string"&&(t=f.parse(t)),this.setEndDate(t)}setEndDate(t,n=!1){const e=this,i=e._timeAxis,{startDate:r,endDate:s,mainUnit:a}=i||Ce;if(typeof t=="string"&&(t=f.parse(t)),i&&r){if(t){let o=r;if(n&&s){const l=f.diff(r,s,a,!0);o=f.add(t,-l,a)}e.setTimeSpan(o,t)}}else e._tempEndDate=t}get endDate(){const t=this;return t._timeAxis?t._timeAxis.endDate:t._tempEndDate||f.add(t.startDate,t.viewPreset.defaultSpan,t.viewPreset.mainHeader.unit)}changeVisibleDate(t){if(t instanceof Date)return{date:t,block:this.isConfiguring?"start":"nearest"};if(t instanceof Object)return{date:t.date,block:t.block||this.isConfiguring?"start":"nearest",...t}}updateVisibleDate(t){const n=this;n.infiniteScroll&&n.isConfiguring||(n.isPainted?n.scrollToDate(t.date,t):n.ion({paint:()=>n.scrollToDate(t.date,t),once:!0}))}get features(){return super.features}set features(t){t=t===!0?{}:t,"regionResize"in t||(t.regionResize=!0),super.features=t}onLocaleChange(){super.onLocaleChange();const t=this.timeAxis.autoAdjust;this.timeAxis.reconfigure({autoAdjust:!1}),this.timeAxis.autoAdjust=t}onBodyResize(t,n,{width:e,height:i}){this.isVertical&&n&&e!==n.width&&delete this.timeAxisSubGrid._width;const r=this.timeAxisSubGrid.element.offsetWidth;this._bodyRectangle&&n&&i!==n.height&&this.onSchedulerViewportResize(r,i,r,n.height)}onSchedulerViewportResize(t,n,e,i){if(this.isPainted){const r=this,{isHorizontal:s,partneredWith:a}=r;r.currentOrientation.onViewportResize(t,n,e,i),r.updateViewModelAvailableSpace(s?t:Math.floor(n)),a&&!r.isSyncingFromPartner&&r.syncPartnerSubGrids(),r.trigger("timelineViewportResize",{width:t,height:n,oldWidth:e,oldHeight:i})}}updateViewModelAvailableSpace(t){this.timeAxisViewModel.availableSpace=t}onTimeAxisViewModelUpdate(){!this._viewPresetChanging&&!this.timeAxisSubGrid.collapsed&&(this.updateCanvasSize(),this.currentOrientation.onTimeAxisViewModelUpdate())}syncPartnerSubGrids(){this.partneredWith.forEach(t=>{t.isSyncingFromPartner||(t.isSyncingFromPartner=!0,this.eachSubGrid(n=>{const e=t.subGrids[n.region];e.width!==n.width&&(n.collapsed?e.collapse():(e.collapsed&&e.expand(),n.flex?n.flex!==e.flex&&(e.flex=n.flex):e.width=n.width))}),t.isSyncingFromPartner=!1)})}get currentOrientation(){throw new Error("Implement in subclass")}get isHorizontal(){return!0}get foregroundCanvas(){return this._foregroundCanvas}get svgCanvas(){const t=this;if(!t._svgCanvas){const n=t._svgCanvas=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("id",He.generateId("svg")),n.classList.add("b-sch-canvas","b-sch-dependencies-canvas"),n.retainElement=!0,t.timeAxisSubGridElement.appendChild(n),t.trigger("svgCanvasCreated",{svg:n})}return t._svgCanvas}get timeAxisSubGridElement(){var t;return this._timeAxisSubGridElement||(this.getConfig("regions"),this._timeAxisSubGridElement=(t=this.timeAxisColumn)==null?void 0:t.subGridElement),this._timeAxisSubGridElement}updateCanvasSize(){const t=this;let n=!1;if(t.isVertical){const{totalSize:e}=t.timeAxisViewModel;t.isPainted&&t.refreshTotalHeight(e+t._rowBorderHeight,!0),t.suppressFit&&T.setLength(t.foregroundCanvas,"height",e),n=!0}return n}getHeaderDomConfigs(t){}getForegroundDomConfigs(t){}async onStoreDataChange({action:t}){var n;const e=this;e.isVisible?(t==="dataset"&&((n=e.project)!=null&&n.isRepopulatingStores)&&await e.project.await("refresh",!1),super.onStoreDataChange(...arguments)):e.whenVisible("refresh",e,[!0])}refresh(t=!0){const n=this;n.isPainted&&!n.refreshSuspended&&(n.isVertical||n.hasVisibleEvents||n.timeAxisSubGridElement.querySelector(n.eventSelector)?!n.project||n.isEngineReady?n.refreshRows(!1,t):(n.refreshAfterProjectRefresh=!0,n.currentOrientation.refreshAllWhenReady=!0):n.rowManager.trigger("refresh"))}render(){const t=this,{total:n}=t.resourceMarginObject,e=t.timeAxisSubGridElement,i=t._foregroundCanvas=T.createElement({className:"b-sch-canvas b-sch-foreground-canvas",style:`font-size:${t.rowHeight-n}px`,parent:e});t.timeAxisSubGrid.insertRowsBefore=i,t.isVertical&&t.suppressFit&&t.updateCanvasSize(),super.render(...arguments)}refreshRows(t=!1,n=!0){const e=this;e.isConfiguring||(e.currentOrientation.refreshRows(n),super.refreshRows(t))}updateHideHeaders(t){const n=this,e=n.isPainted?n.scrollLeft:0;super.updateHideHeaders(t),n.isPainted&&(t||n.timeAxisColumn.refreshHeader(null,!0),n.nextAnimationFrame().then(()=>n.scrollLeft=e))}updateHideRowHover(t){this.timeAxisSubGridElement.classList.toggle("b-hide-row-hover",t)}getCellDataFromEvent(t,n){return n&&(n=!t.target.closest(".b-sch-foreground-canvas")),super.getCellDataFromEvent(t,n)}onCellNavigate(t,n,e){var i,r;const s=e.target;(i=e.cell)!=null&&i.classList.contains("b-timeaxis-cell")&&!((r=he.currentMouseDown)!=null&&r.target.classList.contains("b-grid-cell"))&&(this.preventDragSelect=!0),(!(s!=null&&s.matches(this.eventSelector))||this.selectResourceOnEventNavigate!==!1)&&(!(s!=null&&s.matches(".b-timeaxis-cell"))||this.selectResourceOnScheduleClick!==!1)&&super.onCellNavigate(...arguments)}runWithTransition(t,n=this.transitionDuration){const e=this;e.isVisible&&e._animationSuspendedCounter===0&&((n==null||n===!0)&&(n=e.transitionDuration),n&&e.enableEventAnimations&&(e.hasTimeout("exitTransition")||(e.isAnimating=!0),et.delay=n+50,e.setTimeout(et))),t()}suspendAnimations(){this._animationSuspendedCounter++}resumeAnimations(){this._animationSuspendedCounter--}exitTransition(){this.isAnimating=!1,this.trigger("transitionend")}async waitForAnimations(){!this.isEngineReady&&this.project&&await this.project.await("dataReady",!1),await super.waitForAnimations()}refreshWithTransition(t,n){const e=this;!e.refreshSuspended&&e.isPainted&&(e.rowManager.topRow?e.runWithTransition(()=>e.refresh(t),n):e.rowManager.reinitialize())}get visibleDateRange(){return this.currentOrientation.visibleDateRange}isRowNumberSelecting(...t){return super.isRowNumberSelecting(...t)||t.some(n=>{var e;return n.column?n.column.isTimeAxisColumn:(e=n.cell)==null?void 0:e.closest(".b-timeaxis-cell")})}formatDuration(t,n=this.durationDisplayPrecision){const e=Math.pow(10,n);return Math.round(t*e)/e}beginListeningForBatchedUpdates(){var t;this.listenToBatchedUpdates=(this.listenToBatchedUpdates||0)+1,(t=this.syncSplits)==null||t.call(this,n=>n.beginListeningForBatchedUpdates())}endListeningForBatchedUpdates(){var t;this.listenToBatchedUpdates&&(this.listenToBatchedUpdates-=1),(t=this.syncSplits)==null||t.call(this,n=>n.endListeningForBatchedUpdates())}onConnectedCallback(t,n){t&&!n&&(this.timeAxisSubGrid.scrollable.x+=.5)}updateRtl(t){const n=this,{isConfiguring:e}=n;let i;e||(i=n.visibleDateRange),super.updateRtl(t),e||(n.currentOrientation.clearAll(),n.infiniteScroll?(n.shiftToDate(i.startDate),n.scrollToDate(i.startDate,{block:"start"})):n.timelineScroller.position+=.5)}applyStartEndParameters(t){const n=this,e=n.eventStore.modelClass.fieldMap.startDate;n.passStartEndParameters&&(t[n.startParamName]=e.print(n.startDate),t[n.endParamName]=e.print(n.endDate))}};b(O,"$name","TimelineBase"),b(O,"type","timelinebase"),b(O,"configurable",{animateTreeNodeToggle:!1,partnerSharedConfigs:{value:["timeAxisViewModel","timeAxis","viewPreset","infiniteScroll"],$config:{merge:"distinct"}},startDate:{$config:{equal:"date"},value:null},endDate:{$config:{equal:"date"},value:null},partner:null,stickyHeaders:!0,visibleDate:null,eventCls:null,forceFit:!1,timeZone:null,hideRowHover:{$config:"lazy",value:!0}}),O.initClass(),Z.setVersion("scheduler","5.6.2"),O._$name="TimelineBase";var it=t=>!t||Array.isArray(t)?t:[t],nt=(t,n,e)=>t&&t[n]!==!0?t[n]:e,rt=t=>{var n;return n=class extends(t||R){get dateBounds(){return[this.date]}get description(){const e=this,{descriptionRenderer:i}=e;return i?e.callback(i,e,[e]):e.formattedDescription}get formattedDescription(){var e;const i=this,{dateBounds:r,dateFormat:s}=i,a=(e=i.descriptionFormat)!=null?e:it(i.defaultDescriptionFormat),o=nt(a,0,s),l=r.length>1&&(a==null?void 0:a.length)>1&&f.format(r[0],o)!==f.format(r[1],o);let c=f.format(r[0],o);return l&&(c=f.formatRange(r,nt(a,1,`S${s}${i.dateSeparator}E${s}`))),c}changeDescriptionFormat(e){return it(e)}get widgetClass(){}},b(n,"$name","Describable"),b(n,"configurable",{dateFormat:"MMMM d, YYYY",dateSeparator:" - ",descriptionFormat:null,descriptionRenderer:null}),n},st=t=>class extends(t||R){static get $name(){return"SchedulerDom"}getElementFromAssignmentRecord(e,i=!1,r=!1){var s,a,o,l,c,u;if(this.isPainted&&e){let d=(s=this.foregroundCanvas.syncIdMap)==null?void 0:s[e.id];if(!d&&((a=e.resource)!=null&&a.hasLinks))for(const h of e.resource.$links){if(d=(o=this.foregroundCanvas.syncIdMap)==null?void 0:o[`${e.id}_${h.id}`],d)break;if(r&&(d=(l=this.foregroundCanvas.releasedIdMap)==null?void 0:l[`${e.id}_${h.id}`],d))break}return!d&&r&&(d=(c=this.foregroundCanvas.releasedIdMap)==null?void 0:c[e.id]),i?d:(u=d==null?void 0:d.syncIdMap)==null?void 0:u.event}return null}getElementFromEventRecord(e,i=(a=>(a=e.resources)==null?void 0:a[0])(),r=!1,s=!1){var a;if(e.isResourceTimeRange){const l=(a=this.foregroundCanvas.syncIdMap)==null?void 0:a[e.domId];return r?l:l==null?void 0:l.syncIdMap.event}const o=this.assignmentStore.getAssignmentForEventAndResource(e,i);return this.getElementFromAssignmentRecord(o,r,s)}getElementsFromEventRecord(e,i,r=!1,s=!1){return i?[this.getElementFromEventRecord(e,i,r,s)]:e.resources.reduce((a,o)=>{const l=this.getElementFromEventRecord(e,o,r,s);return l&&a.push(l),a},[])}resolveResourceRecord(e,i){return this.currentOrientation.resolveRowRecord(e,i)}resolveRowRecord(e){return this.resolveResourceRecord(e)}resolveEventRecord(e){e instanceof Event&&(e=e.target);const i=e==null?void 0:e.closest(this.eventSelector);if(i){if(i.dataset.eventId)return this.eventStore.getById(i.dataset.eventId);if(i.dataset.assignmentId)return this.assignmentStore.getById(i.dataset.assignmentId).event}return null}resolveTimeSpanRecord(e){return this.resolveEventRecord(e)}resolveAssignmentRecord(e,i=!1){const r=e.closest(i?"[data-assignment-id][data-event-id]":this.eventSelector),s=r&&this.assignmentStore.getById(r.dataset.assignmentId),a=r&&this.eventStore.getById(r.dataset.eventId);return this.assignmentStore.getOccurrence(s,a)}isRowVisible(e){return this.store.indexOf(e)>=0}get widgetClass(){}},at=t=>class extends(t||R){static get $name(){return"SchedulerDomEvents"}getTimeSpanMouseEventParams(e,i){const r=this.resolveEventRecord(e);return r&&{eventRecord:r,resourceRecord:this.resolveResourceRecord(e),assignmentRecord:this.resolveAssignmentRecord(e),eventElement:e,event:i}}getScheduleMouseEventParams(e,i){return{resourceRecord:this.isVertical?this.resolveResourceRecord(i):this.store.getById(e.id)}}onElementKeyDown(e){const i=super.onElementKeyDown(e),r=this;return r.selectedEvents.length&&r.trigger(r.scheduledEventName+"KeyDown",{eventRecords:r.selectedEvents,assignmentRecords:r.selectedAssignments,event:e,eventRecord:r.selectedEvents,assignmentRecord:r.selectedAssignments}),i}onElementKeyUp(e){super.onElementKeyUp(e);const i=this;i.selectedEvents.length&&i.trigger(i.scheduledEventName+"KeyUp",{eventRecords:i.selectedEvents,assignmentRecords:i.selectedAssignments,event:e,eventRecord:i.selectedEvents,assignmentRecord:i.selectedAssignments})}get widgetClass(){}},be=class extends R{static get defaultConfig(){return{nbrOfBandsByResource:{},bandIndexToPxConvertFn:null,bandIndexToPxConvertThisObj:null}}clearCache(t){t?delete this.nbrOfBandsByResource[t.id]:this.nbrOfBandsByResource={}}applyLayout(t,n){return this.nbrOfBandsByResource[n.id]=this.layoutEventsInBands(t,n)}layoutEventsInBands(t,n){throw new Error("Implement in subclass")}};be._$name="HorizontalLayout";var De=class extends be{static get $name(){return"HorizontalLayoutStack"}static get configurable(){return{type:"stack"}}layoutEventsInBands(t,n,e=!1){let i=0;do{let r=0,s=t[0];for(;s;)e||(s.top=this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,i,s.eventRecord,s.resourceRecord)),t.splice(r,1),r=this.findClosestSuccessor(s,t),s=t[r];i++}while(t.length>0);return i}findClosestSuccessor(t,n){var e,i;const{endMS:r,group:s}=t,a=((e=t.eventRecord)==null?void 0:e.duration)===0;let o=1/0,l,c,u,d;for(let h=0,m=n.length;h<m;h++)if(u=n[h],c=u.startMS-r,d=u.endMS-u.startMS===0&&!((i=u.eventRecord)!=null&&i.meta.isDragCreating),c>=0&&c<o&&(c>0||!d||!a)&&!(c===0&&d&&!a)){if(this.grouped&&s!==u.group)break;l=h,o=c}return l}};De._$name="HorizontalLayoutStack";var ot=(t,n,e,i)=>e<=t&&t<i||t<=e&&e<n,we=t=>class extends(t||R){static get $name(){return"PackMixin"}static get defaultConfig(){return{coordProp:"top",sizeProp:"height",inBandCoordProp:"inBandTop",inBandSizeProp:"inBandHeight"}}isSameGroup(e,i){return this.grouped?e.group===i.group:!0}packEventsInBands(e,i){const r=this,{coordProp:s,sizeProp:a}=r;let o,l,c,u;for(let d=0,h=e.length;d<h;d++){if(l=e[d],o=r.findStartSlot(e,l),c=r.getCluster(e,d),c.length>1){for(l[s]=o.start,l[a]=o.end-o.start,u=1;u<c.length-1&&c[u+1].start-l.start===0;)u++;const v=r.findStartSlot(e,c[u]);v&&v.start<.8&&(c.length=u)}const m=c.length,g=(o.end-o.start)/m;for(u=0;u<m;u++)i(c[u],u,o,g);d+=m-1}return 1}findStartSlot(e,i){const{inBandSizeProp:r,inBandCoordProp:s,coordProp:a,sizeProp:o}=this,l=this.getPriorOverlappingEvents(e,i);let c;if(l.length===0)return{start:0,end:1};for(c=0;c<l.length;c++){const u=l[c],d=s in u?s:a,h=r in u?r:o;if(c===0&&u[d]>0)return{start:0,end:u[d]};if(u[d]+u[h]<(c<l.length-1?l[c+1][d]:1))return{start:u[d]+u[h],end:c<l.length-1?l[c+1][d]:1}}return!1}getPriorOverlappingEvents(e,i){const{startMS:r,endMS:s}=i,a=[];for(let o=0,l=e.indexOf(i);o<l;o++){const c=e[o];this.isSameGroup(c,i)&&ot(r,s,c.startMS,c.endMS)&&a.push(c)}return a.sort(this.sortOverlappers.bind(this)),a}sortOverlappers(e,i){const{coordProp:r}=this;return e[r]-i[r]}getCluster(e,i){const r=e[i],s=[r];if(i>=e.length-1)return s;let{startMS:a,endMS:o}=r;for(let l=i+1,c=e.length;l<c;l++){const u=e[l];if(!this.isSameGroup(u,r)||!ot(a,o,u.startMS,u.endMS))break;s.push(u),a=Math.max(a,u.startMS),o=Math.min(u.endMS,o)}return s}},Ee=class extends be.mixin(we){static get $name(){return"HorizontalLayoutPack"}static get configurable(){return{type:"pack"}}layoutEventsInBands(t){const n=this.packEventsInBands(t,(e,i,r,s)=>{e.height=s,e.top=r.start+i*s});return t.forEach(e=>{Object.assign(e,this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,e.top,e.height,e.eventRecord,e.resourceRecord))}),n}};Ee._$name="HorizontalLayoutPack";var lt=t=>{var n;return n=class extends(t||R){get resourceColumns(){var e;return((e=this.timeAxisColumn)==null?void 0:e.resourceColumns)||this._resourceColumns}get resourceColumnWidth(){var e;return((e=this.resourceColumns)==null?void 0:e.columnWidth)||null}getResourceMarginObject(e){var i;if(e!=null&&e.resourceMargin){const r=(i=e==null?void 0:e.resourceMargin)!=null?i:this.resourceMargin;return typeof r=="number"?{start:r,end:r,total:r*2}:(r.total=r.start+r.end,r)}else return this.resourceMarginObject}getBarMargin(e){var i;return(i=e==null?void 0:e.barMargin)!=null?i:this.barMargin}getResourceHeight(e){var i;return(i=e.rowHeight)!=null?i:this.isHorizontal?this.rowHeight:this.getResourceWidth(e)}getResourceWidth(e){var i;return(i=e.columnWidth)!=null?i:this.resourceColumnWidth}getAppliedResourceHeight(e){var i;const r=this.getRowById(e);return(i=r==null?void 0:r.maxRequestedHeight)!=null?i:this.getResourceHeight(e)}getResourceLayoutSettings(e,i=null){const r=this.getResourceMarginObject(e,i),s=this.getAppliedResourceHeight(e,i);return{barMargin:this.getBarMargin(e,i),contentHeight:Math.max(s-r.total,1),rowHeight:s,resourceMarginObject:r}}get widgetClass(){}},b(n,"$name","SchedulerResourceRendering"),b(n,"configurable",{resourceMargin:null,resourceColumns:null,resourceImagePath:null,defaultResourceImageName:null,resourceImageExtension:".jpg"}),n},ct=t=>class extends lt(t||R){static get $name(){return"SchedulerEventRendering"}static get configurable(){return{milestoneTextPosition:"outside",milestoneAlign:"center",milestoneCharWidth:10,milestoneLayoutMode:"default",eventLayout:"stack",overlappingEventSorter:null,horizontalEventSorterFn:null,useInitialAnimation:!0,eventRenderer:null,eventRendererThisObj:null,eventBarTextField:"name",eventBodyTemplate:null,horizontalLayoutPackClass:Ee,horizontalLayoutStackClass:De,isFirstRender:!0,initialAnimationDuration:2e3,narrowEventWidth:10,internalEventLayout:null,eventPositionMode:"translate",eventScrollMode:"move"}}changeEventLayout(e){return this.internalEventLayout=e,this.internalEventLayout.type}changeInternalEventLayout(e){return this.getEventLayout(e)}updateInternalEventLayout(e,i){const r=this;i&&r.element.classList.remove(`b-eventlayout-${i.type}`),r.element.classList.add(`b-eventlayout-${e.type}`),r.isConfiguring||(r.refreshWithTransition(),r.trigger("stateChange"))}changeHorizontalEventSorterFn(e){Z.deprecate("Scheduler","6.0.0","Replaced by overlappingEventSorter()"),this.overlappingEventSorter=e}updateOverlappingEventSorter(e){this.isConfiguring||this.refreshWithTransition()}updateEventBodyTemplate(){Z.deprecate("Scheduler","6.0.0","Return markup/DomConfigs from eventRenderer() instead")}getEventLayout(e){return e!=null&&e.isModel&&(e=e.eventLayout||this.internalEventLayout),typeof e=="string"&&(e={type:e}),e}getEventLayoutHandler(e){const i=this;if(!i.isHorizontal)return null;const{timeAxisViewModel:r,horizontal:s}=i,{type:a}=e;switch(i.layouts||(i.layouts={}),a){case"stack":return i.layouts.horizontalStack||(i.layouts.horizontalStack=new i.horizontalLayoutStackClass(E.assign({scheduler:i,timeAxisViewModel:r,bandIndexToPxConvertFn:s.layoutEventVerticallyStack,bandIndexToPxConvertThisObj:s},e))),i.layouts.horizontalStack;case"pack":return i.layouts.horizontalPack||(i.layouts.horizontalPack=new i.horizontalLayoutPackClass(E.assign({scheduler:i,timeAxisViewModel:r,bandIndexToPxConvertFn:s.layoutEventVerticallyPack,bandIndexToPxConvertThisObj:s},e))),i.layouts.horizontalPack;default:return null}}getEventsToRender(e,i){return i}repaintEventsForResource(e){this.currentOrientation.repaintEventsForResource(e)}repaintEvent(e){this.eventStore.getResourcesForEvent(e).forEach(r=>this.repaintEventsForResource(r))}getEventStyle(e,i){return e.eventStyle||i.eventStyle||this.eventStyle}getEventColor(e,i){var r,s;return e.eventColor||((r=e.event)==null?void 0:r.eventColor)||((s=e.parent)==null?void 0:s.eventColor)||i.eventColor||this.eventColor}generateRenderData(e,i,r={viewport:!0}){var s,a;const o=this,l=o.currentOrientation.getTimeSpanRenderData(e,i,r),{isEvent:c}=e,{eventResize:u}=o.features,d=!e.meta.isDragCreating&&e.isMilestone,h=c&&e.assignments.find(g=>g.resourceId===i.$originalId),m={className:"b-sch-event-content",role:"presentation",dataset:{taskBarFeature:"content"}};if(l){l.tabIndex="0";let g=e.isResizable;u&&g&&(l.startsOutsideView&&(g===!0?g="end":g==="start"&&(g=!1)),l.endsOutsideView&&(g===!0?g="start":g==="end"&&(g=!1)),g&&(o.isHorizontal?!o.rtl&&!u.leftHandle||o.rtl&&!u.rightHandle?g=g==="start"?!1:"end":(!o.rtl&&!u.rightHandle||o.rtl&&!u.leftHandle)&&(g=g==="end"?!1:"start"):u.topHandle?u.bottomHandle||(g=g==="end"?!1:"start"):g=g==="start"?!1:"end"));const v=!!(e.hasPersistableChanges||h!=null&&h.hasPersistableChanges),p={[i.cls]:i.cls,[o.generatedIdCls]:!e.isOccurrence&&e.hasGeneratedId,[o.dirtyCls]:v,[o.committingCls]:e.isCommitting,[o.endsOutsideViewCls]:l.endsOutsideView,[o.startsOutsideViewCls]:l.startsOutsideView,"b-clipped-start":l.clippedStart,"b-clipped-end":l.clippedEnd,"b-iscreating":e.isCreating,"b-rtl":o.rtl},y={[`${o.eventCls}-parent`]:i.isParent,"b-readonly":e.readOnly||(h==null?void 0:h.readOnly),"b-linked-resource":i.isLinked,"b-original-resource":i.hasLinks},C=e.isResourceTimeRange?new I:e.internalCls.clone(),S=e.isResourceTimeRange?e.internalCls.clone():new I;if(l.wrapperStyle="",l.isWrap=!0,c){const x=h&&o.isAssignmentSelected(h);E.assign(p,{[o.eventCls]:1,"b-milestone":d,"b-sch-event-narrow":!d&&l.width<o.narrowEventWidth,[o.fixedEventCls]:e.isDraggable===!1,[`b-sch-event-resizable-${g}`]:!!(u&&!e.readOnly),[o.eventSelectedCls]:x,[o.eventAssignHighlightCls]:o.eventAssignHighlightCls&&!x&&o.isEventSelected(e),"b-recurring":e.isRecurring,"b-occurrence":e.isOccurrence,"b-inactive":e.inactive}),l.eventId=e.id;const F=o.getEventStyle(e,i),M=o.getEventColor(e,i),j=o.isFirstRender&&o.useInitialAnimation&&globalThis.bryntum.noAnimations!==!0;if(E.assign(y,{[`${o.eventCls}-wrap`]:1,"b-milestone-wrap":d,[o.navigator.focusCls]:e.assignments.some(oe=>oe===o.activeAssignment)}),j){const oe=l.row?l.row.index:(l.top-o.scrollTop)/o.tickSize,Ie=oe/20*1e3;l.wrapperStyle=`animation-delay: ${Ie}ms;`,o.maxDelay=Math.max(o.maxDelay||0,Ie),o.initialAnimationDetacher||(o.initialAnimationDetacher=L.on({element:o.foregroundCanvas,delegate:o.eventSelector,once:!0,animationend:()=>o.setTimeout({fn:"stopInitialAnimation",delay:o.maxDelay,cancelOutstanding:!0}),expires:{alt:"stopInitialAnimation",delay:o.initialAnimationDuration+o.maxDelay},thisObj:o}))}l.eventColor=M,l.eventStyle=F,l.assignmentRecord=l.assignment=h}if(l.wrapperCls=E.assign(S,y),l.cls=E.assign(C,p),l.iconCls=new I(e.getValue(o.eventBarIconClsField)||e.iconCls),e.isResourceTimeRange?(l.style="",l.wrapperStyle+=e.style||""):l.style=e.style||"",l.resource=l.resourceRecord=i,l.resourceId=l.rowId,c){let x=null,F=null,M;if(o.eventRenderer){const j=o.eventRenderer.call(o.eventRendererThisObj||o,{eventRecord:e,resourceRecord:i,assignmentRecord:l.assignmentRecord,renderData:l});typeof l.cls=="string"&&(l.cls=new I(l.cls)),typeof l.wrapperCls=="string"&&(l.wrapperCls=new I(l.wrapperCls)),typeof l.iconCls=="string"&&(l.iconCls=new I(l.iconCls)),o.eventBodyTemplate?M=o.eventBodyTemplate(j):M=j}else o.eventBodyTemplate?M=o.eventBodyTemplate(e):o.eventBarTextField&&(M=P.encodeHtml(e.getValue(o.eventBarTextField)||""));!o.eventBodyTemplate||Array.isArray(M)?(m.children=[],d&&(o.milestoneLayoutMode==="default"||o.milestoneTextPosition==="always-outside")&&M!=null&&M!==""&&m.children.unshift(F={tag:"label",children:[]}),(s=l.iconCls)!=null&&s.length&&m.children.unshift({tag:"i",className:l.iconCls}),Array.isArray(M)?(F||m).children.push(...M):P.isHtml(M)?m.children.length?x={tag:"span",class:"b-event-text-wrap",html:M}:(m.children=null,m.html=M):typeof M=="string"||typeof M=="object"?x=M:M!=null&&(x=String(M)),x!=null&&((F||m).children.push(x),l.cls.add("b-has-content")),(m.html!=null||m.children.length)&&l.children.push(m)):(m.html=M,l.children.push(m))}const{eventStyle:D,eventColor:w,wrapperCls:A}=l;if(A[`b-sch-style-${D||"none"}`]=1,T.isNamedColor(w))A[`b-sch-color-${w}`]=w;else if(w){const x=D?"color":"background-color",F=`${x}:${w};`;l.style=F+l.style,A["b-sch-custom-color"]=1,l._customColorStyle=F}else A["b-sch-color-none"]=1;l.style&&d&&m&&(m.style=l.style,delete l.style),l.cls["b-sch-event-withicon"]=(a=l.iconCls)==null?void 0:a.length,l.eventContent=m,l.wrapperChildren=[],o.onEventDataGenerated(l)}return l}onEventDataGenerated(e){}changeUseInitialAnimation(e){return e===!0?"fade-in":e}updateUseInitialAnimation(e,i){const{classList:r}=this.element;i&&r.remove(`b-initial-${i}`),e&&(r.add(`b-initial-${e}`),z.isFirefox&&r.add("b-prevent-event-transitions"))}restartInitialAnimation(e){var i;const r=this;(i=r.initialAnimationDetacher)==null||i.call(r),r.initialAnimationDetacher=null,r.useInitialAnimation=e,r.isFirstRender=!0,r.refresh()}stopInitialAnimation(){const e=this;e.initialAnimationDetacher(),e.isFirstRender=!1,e.useInitialAnimation=!1,z.isFirefox&&e.setTimeout(()=>e.element.classList.remove("b-prevent-event-transitions"),100)}getMilestoneLabelWidth(e,i){const r=this,s=r.milestoneLayoutMode,a=r.getResourceLayoutSettings(i).contentHeight;if(s==="measure"){const o=P.encodeHtml(e.name),l=r.getEventColor(e,i),c=r.getEventStyle(e,i),u=r.milestoneMeasureElement||(r.milestoneMeasureElement=T.createElement({className:{"b-sch-event-wrap":1,"b-milestone-wrap":1,"b-measure":1,[`b-sch-color-${l}`]:l,[`b-sch-style-${c}`]:c},children:[{className:"b-sch-event b-milestone",children:[{className:"b-sch-event-content",children:[{tag:"label"}]}]}],parent:r.foregroundCanvas}));if(u.retainElement=!0,u.style.fontSize=`${a}px`,r.milestoneTextPosition==="always-outside"){const d=u.firstElementChild.firstElementChild.firstElementChild;d.innerHTML=o;const h=k.from(d,d.parentElement);return h.left+h.width+2}else return u.firstElementChild.firstElementChild.innerHTML=`<label></label>${o}`,u.firstElementChild.offsetWidth}return s==="estimate"?e.name.length*r.milestoneCharWidth+(r.milestoneTextPosition==="always-outside"?a:0):s==="data"?e.milestoneWidth:0}updateMilestoneLayoutMode(e){const i=this,r=i.milestoneTextPosition==="always-outside";i.element.classList.toggle("b-sch-layout-milestones",e!=="default"&&!r),i.element.classList.toggle("b-sch-layout-milestone-labels",e!=="default"&&r),i.isConfiguring||i.refreshWithTransition()}updateMilestoneTextPosition(e){this.element.classList.toggle("b-sch-layout-milestone-text-position-inside",e==="inside"),this.updateMilestoneLayoutMode(this.milestoneLayoutMode)}updateMilestoneAlign(){this.isConfiguring||this.refreshWithTransition()}updateMilestoneCharWidth(){this.isConfiguring||this.refreshWithTransition()}get widgetClass(){}},ut=["assignmentStore","dependencyStore","eventStore","resourceStore"],dt=t=>{var n,e;return e=class extends(t||R){constructor(){super(...arguments),Zt(this,n,void 0)}static get $name(){return"ProjectConsumer"}static get declarable(){return["projectStores"]}static get configurable(){return{projectModelClass:It,project:{},destroyStores:null,projectSubscribers:[]}}startConfigure(i){this.getConfig("project"),super.startConfigure(i)}changeProject(i,r){const s=this,{projectStoreNames:a,projectDataNames:o}=s.constructor;if(s.projectCallbacks=new Set,i){if(s.buildingProjectConfig=!0,!i.isModel){if(s.isConfiguring){s._project=i;const{crudManager:u}=s;if(u){const{isCrudManager:d}=u;for(const h of a)u[h]&&(s[h]=u[h],d||delete u[h])}s.getConfig("projectStores");for(const d of o)s.getConfig(d)}const{eventStore:l}=i;let{sharedProject:c}=s;if(l&&!l.isEventStoreMixin&&l.autoLoad&&!l.count&&(l.autoLoad=!1,s.delayAutoLoad=!0),c&&ut.some(u=>i[u]&&i[u]!==c[u])){for(const u of ut)i[u]&&i[u]===c[u]&&(i[u]=i[u].chain());c=null}i=c||new s.projectModelClass(i),delete s._project}s.buildingProjectConfig=!1}return i}updateProject(i,r){var s;const a=this,{projectListeners:o,crudManager:l}=a;if(a.detachListeners("projectConsumer"),delete a._crudManager,i){o.thisObj=a,i.ion(o),i.isCrudManager?a.crudManager=i:l&&(l.project=i,a.crudManager=l),a.projectSubscribers.forEach(c=>{c.detachFromProject(r),c.attachToProject(i)});for(const c of a.constructor.projectStoreNames)a[c]=i[c];a.delayAutoLoad&&(i.eventStore.autoLoad=!0,i.eventStore.load()),(s=i.stm)==null||s.ion({name:"projectConsumer",restoringStart:"onProjectRestoringStart",restoringStop:"onProjectRestoringStop",thisObj:a})}a.trigger("projectChange",{project:i})}changeCrudManager(i){if(this.buildingProjectConfig)this._crudManager=i.isCrudManager?i:Object.assign({},i);else return super.changeCrudManager(i)}onProjectDataReady(){const i=this;i.whenVisible(()=>{i.projectCallbacks.size&&(i.projectCallbacks.forEach(r=>r()),i.projectCallbacks.clear())},null,null,"onProjectDataReady")}onProjectRestoringStart({stm:i}){const{rawQueue:r}=i;r.length&&r[r.length-1].length>1&&($e(this,n,!0),this.suspendRefresh())}onProjectRestoringStop(){Kt(this,n)&&($e(this,n,!1),this.resumeRefresh(!0))}onBeforeTimeZoneChange(){}onTimeZoneChange({timeZone:i,oldTimeZone:r}){const s=this;if(s.startDate&&s.timeAxis.timeZone!==i){const a=r!=null?Ve.fromTimeZone(s.startDate,r):s.startDate;s.startDate=i!=null?Ve.toTimeZone(a,i):a,s.timeAxis.timeZone=i}}onStartApplyChangeset(){this.suspendRefresh()}onEndApplyChangeset(){this.resumeRefresh(!0)}whenProjectReady(i){this.isEngineReady?i():this.projectCallbacks.add(i)}get isEngineReady(){var i,r;return!!((r=(i=this.project).isEngineReady)!=null&&r.call(i))}doDestroy(){super.doDestroy(),this.destroyStores&&!this.project.isDestroyed&&this.project.destroy()}get projectStores(){const{projectStoreNames:i}=this.constructor;return i.map(r=>this[r])}static get projectStoreNames(){return Object.keys(this.projectStores)}static get projectDataNames(){return this.projectStoreNames.reduce((i,r)=>{const{dataName:s}=this.projectStores[r];return s&&i.push(s),i},[])}static setupProjectStores(i,r){const{projectStores:s}=i;if(s){const a={name:"projectConsumer",dataReady:"onProjectDataReady",change:"relayProjectDataChange",beforeTimeZoneChange:"onBeforeTimeZoneChange",timeZoneChange:"onTimeZoneChange",startApplyChangeset:"onStartApplyChangeset",endApplyChangeset:"onEndApplyChangeset"},o={projectListeners:a};let l;for(const c in s){const{dataName:u}=s[c];o[c]=o[u]=null,u&&(Object.defineProperty(r.class.prototype,u,{configurable:!0,get(){var d;return(d=this.project[c])==null?void 0:d.records}}),this.createDataUpdater(c,u,l,r)),this.createStoreDescriptor(r,c,s[c],a),l=u}this.setupConfigs(r,o)}}static createDataUpdater(i,r,s,a){a.class.prototype[`update${P.capitalize(r)}`]=function(o){const{project:l}=this;s&&this.getConfig(s),this.buildingProjectConfig?l[`${r}Data`]=o:l[i].data=o}}static createStoreDescriptor(i,r,{listeners:s},a){const{prototype:o}=i.class,l=P.capitalize(r);a[`${r}Change`]=function({store:c}){this[r]=c},o[`change${l}`]=function(c,u){const d=this,{project:h}=d,m=c==null?void 0:c.project;if(d.buildingProjectConfig){m!=null&&m.isProjectModel&&(d.sharedProject=m),h[r]=c;return}return d.initializingProject||h[r]!==c&&(h[`set${l}`](c),c=h[r]),c!==u&&(s&&(s.thisObj=d,s.name=`${r}Listeners`,s.startApplyChangeset="onProjectStoreStartApplyChangeset",s.endApplyChangeset="onProjectStoreEndApplyChangeset",d.detachListeners(s.name),c.ion(s)),d[`_${r}`]=c,d.projectSubscribers.forEach(g=>{var v;(v=g[`attachTo${l}`])==null||v.call(g,c)}),d[`_${r}`]=null),c}}onProjectStoreStartApplyChangeset(){this.suspendRefresh()}onProjectStoreEndApplyChangeset(){this.resumeRefresh(!0)}relayProjectDataChange(i){if(!((i.isExpand||i.isCollapse)&&!i.records[0].fieldMap.expanded.persist))return this.trigger("dataChange",{project:i.source,...i,source:this})}get widgetClass(){}},n=new WeakMap,e},ht=t=>class extends dt(t||R){static get $name(){return"SchedulerStores"}static get projectStores(){return{resourceStore:{dataName:"resources"},eventStore:{dataName:"events",listeners:{batchedUpdate:"onEventStoreBatchedUpdate",changePreCommit:"onInternalEventStoreChange",commitStart:"onEventCommitStart",commit:"onEventCommit",exception:"onEventException",idchange:"onEventIdChange",beforeLoad:"onBeforeLoad"}},assignmentStore:{dataName:"assignments",listeners:{changePreCommit:"onAssignmentChange",commitStart:"onAssignmentCommitStart",commit:"onAssignmentCommit",exception:"onAssignmentException",beforeRemove:{fn:"onAssignmentBeforeRemove",prio:-1e3}}},dependencyStore:{dataName:"dependencies"},calendarManagerStore:{},timeRangeStore:{},resourceTimeRangeStore:{}}}static get configurable(){return{store:null,startParamName:"startDate",endParamName:"endDate",passStartEndParameters:Z.checkVersion("core","6.0",">="),crudManagerClass:null,crudManager:null}}updateProject(e,i){super.updateProject(e,i),this.detachListeners("schedulerStores"),e.ion({name:"schedulerStores",refresh:"onProjectRefresh",thisObj:this})}onProjectRefresh({isInitialCommit:e}){const i=this;i.isVisible?(e&&i.isVertical&&(i.refreshAfterProjectRefresh=!1,i.refreshWithTransition()),i.refreshAfterProjectRefresh&&(i.refreshWithTransition(!1,!e),i.refreshAfterProjectRefresh=!1),i.navigateToAfterRefresh&&(i.navigateTo(i.navigateToAfterRefresh,{scrollIntoView:!1}),i.navigateToAfterRefresh=null)):i.whenVisible("refresh",i,[!0])}changeCrudManager(e){const i=this;e&&!e.isCrudManager&&(e=i.crudManagerClass.new({scheduler:i},e)),i._crudManager=e,i.bindCrudManager(e)}get store(){return!this._store&&this.isVertical&&(this._store=new me({data:[{id:"verticalTimeAxisRow",cls:"b-verticaltimeaxis-row"}]})),super.store}set store(e){super.store=e}refreshFromRowOnStoreAdd(e,{isExpand:i,records:r}){const s=arguments;this.runWithTransition(()=>{this.currentOrientation.suspended=!i&&!r.some(a=>a.isLinked),super.refreshFromRowOnStoreAdd(e,...s),this.currentOrientation.suspended=!1},!i)}onStoreAdd(e){super.onStoreAdd(e),this.isPainted&&this.calculateRowHeights(e.records)}onStoreUpdateRecord({source:e,record:i,changes:r}){let s=0;"assigned"in r&&s++,"calendar"in r&&s++,s!==Object.keys(r).length&&super.onStoreUpdateRecord(...arguments)}updateResourceStore(e){e&&this.isHorizontal&&(e.metaMapId=this.id,this.store=e)}get usesDisplayStore(){return this.store!==this.resourceStore}onEventIdChange(e){this.currentOrientation.onEventStoreIdChange&&this.currentOrientation.onEventStoreIdChange(e)}onEventStoreBatchedUpdate(e){if(this.listenToBatchedUpdates)return this.onInternalEventStoreChange(e)}onInternalEventStoreChange(e){!this.isPainted||!this._mode||e.isAssign||this.assignmentStore.isRemovingAssignment||(this.isVisible?this.currentOrientation.onEventStoreChange(e):this.whenVisible(this.onInternalEventStoreChange,this,[e]))}onEventCommit({changes:e}){let i=[...e.added,...e.modified].map(r=>this.eventStore.getResourcesForEvent(r));i=Array.prototype.concat.apply([],i),new Set(i).forEach(r=>this.repaintEventsForResource(r))}onEventCommitStart({changes:e}){const{currentOrientation:i,committingCls:r}=this;[...e.added,...e.modified].forEach(s=>s.assignments.forEach(a=>i.toggleCls(a,r,!0)))}onEventException({action:e}){if(e==="commit"){const{changes:i}=this.eventStore;[...i.added,...i.modified,...i.removed].forEach(r=>this.repaintEvent(r))}}onAssignmentCommit({changes:e}){this.repaintEventsForAssignmentChanges(e)}onAssignmentCommitStart({changes:e}){const{currentOrientation:i,committingCls:r}=this;[...e.added,...e.modified].forEach(s=>{i.toggleCls(s,r,!0)})}onAssignmentException({action:e}){e==="commit"&&this.repaintEventsForAssignmentChanges(this.assignmentStore.changes)}repaintEventsForAssignmentChanges(e){const i=[...e.added,...e.modified,...e.removed].map(r=>r.getResource());new Set(i).forEach(r=>this.repaintEventsForResource(r))}onAssignmentBeforeRemove({records:e,removingAll:i}){if(i)return;const r=this,{activeAssignment:s}=r,a=e.includes(s);let o;if(!r.isConfiguring&&(r.navigateToAfterRefresh||s&&a)){e.includes(r.navigateToAfterRefresh)&&(r.navigateToAfterRefresh=null);const l=r.getElementFromAssignmentRecord(s,!0);if(a&&l){const c=r.timeAxisSubGrid.rectangle().intersect(r._bodyRectangle),u=k.from(l),d=u.center,h=r.isHorizontal?"y":"x",m=({element:v,distance:p,center:y,edgeDistance:C},{element:S,distance:D,center:w,edgeDistance:A})=>{if(v.dataset.resourceId!==S.dataset.resourceId){if(Math.abs(y[h]-d[h])<Math.abs(w[h]-d[h]))return-1;if(Math.abs(y[h]-d[h])>Math.abs(w[h]-d[h]))return 1}return Math.min(C,p)-Math.min(A,D)||w[h]-y[h]},g=Array.from(r.foregroundCanvas.querySelectorAll(r.navigator.itemSelector)).reduce((v,p)=>{if(p!==l){const y=k.from(p).intersect(c),C=y&&r.resolveAssignmentRecord(p);if(C){const{center:S}=y,D=d.getDelta(S),w=S.y<d.y?u.y-y.bottom:S.y>d.y?y.y-u.bottom:0,A=S.x<d.x?u.x-y.right:S.x>d.x?y.x-u.right:0;v.push({element:p,assignment:C,center:S,distance:Math.sqrt(D[0]**2+D[1]**2),edgeDistance:Math.max(w,A)})}}return v},[]).sort(m)[0];g&&(o=g.assignment)}o?(r.navigateTo(o,{scrollIntoView:!1}),r.navigateToAfterRefresh=o):T.focusWithoutScrolling(r.focusElement)}}set timeRanges(e){this.project.timeRanges=e}get timeRanges(){return this.project.timeRanges}set resourceTimeRanges(e){this.project.resourceTimeRanges=e}get resourceTimeRanges(){return this.project.resourceTimeRanges}onBeforeLoad({params:e}){this.applyStartEndParameters(e)}getResourcesEventsPerTick(e,i){const{timeAxis:r,resourceStore:s}=this,a=[];return e=e||s.records,e.forEach(o=>{o.events.forEach(l=>{if(!r.isTimeSpanInAxis(l)||i&&!i.call(this,{resource:o,event:l}))return;let c=Math.floor(r.getTickFromDate(l.startDate)),u=Math.ceil(r.getTickFromDate(l.endDate));c==-1&&(c=0),u===-1&&(u=r.ticks.length);do a[c]?a[c].push(l):a[c]=[l];while(++c<u)})}),a}get widgetClass(){}},K={block:"nearest",edgeOffset:20},mt=t=>class extends(t||R){static get $name(){return"SchedulerScroll"}async scrollEventIntoView(e,i=K){const r=this,s=e.resources||[e];if(s.length>1)throw new Error("scrollEventIntoView() is not applicable for events with multiple assignments, please use scrollResourceEventIntoView() instead.");s.length||console.warn("You have asked to scroll to an event which is not assigned to a resource"),await r.scrollResourceEventIntoView(s[0],e,i)}scrollAssignmentIntoView(e,...i){return this.scrollResourceEventIntoView(e.resource,e.event,...i)}async scrollResourceEventIntoView(e,i,r=K){var s,a;const o=this,l=i.startDate,c=i.endDate,u=i.isScheduled&&l<o.timeAxis.startDate|(c>o.timeAxis.endDate)<<1;arguments.length>3&&(r=arguments[3]);let d;if(r.edgeOffset==null&&(r.edgeOffset=20),u&&r.extendTimeAxis!==!1){const h=o.timeAxis.endDate-o.timeAxis.startDate;if(u===3)await o.setTimeSpan(new Date(l.getTime()-h/2),new Date(c.getTime()+h/2));else if(o.infiniteScroll){const{visibleDateRange:m}=o,g=m.endMS-m.startMS,v=u&1?1:-1;await o.setTimeSpan(new Date(l.getTime()-h/2),new Date(l.getTime()+h/2),{visibleDate:new Date(c.getTime()+v*g)})}else u&1?await o.setTimeSpan(new Date(l),new Date(l.getTime()+h)):await o.setTimeSpan(new Date(c.getTime()-h),new Date(c))}if(!o.isDestroyed)if(o.store.tree&&await((s=o.expandTo)==null?void 0:s.call(o,e)),(a=o.features.nestedEvents)!=null&&a.enabled&&i.parent&&!i.parent.isRoot&&await o.scrollEventIntoView(i.parent),d=o.getElementFromEventRecord(i,e),d){if(T.isFocusable(d)||(d=d.parentNode),await o.timeAxisSubGrid.scrollable.scrollIntoView(d,r),o.isDestroyed)return;let m;do if(m=o.getElementFromEventRecord(i,e),m||await ue.animationFrame(),o.isDestroyed)return;while(!m)}else u===3&&r.extendTimeAxis===!1?console.warn("You have asked to scroll to an event which is outside the current view and extending timeaxis is disabled"):!i.isOccurrence&&!o.eventStore.isAvailable(i)?console.warn("You have asked to scroll to an event which is not available"):i.isScheduled?await o.scrollUnrenderedEventIntoView(e,i,r):await o.scrollResourceIntoView(e,r)}scrollUnrenderedEventIntoView(e,i,r=K){return new Promise(async s=>{const a=this,o=a.timeAxisSubGrid.scrollable,l=o.viewport,{rowManager:c}=a,u=o.y;if(!l){s();return}let d,h,m=0;do{if(++m>=50)throw new Error(`Too many preparational scrolls during 'scrollIntoView' for event id = ${i.id}`);const v=a.getResourceEventBox(i,e);if(!v){s();return}v.x=Math.ceil(v.x),v.y=Math.ceil(v.y),a.rtl&&v.translate(-a.timeAxisViewModel.totalSize+l.width,0),v.translate(l.x-o.scrollLeft,l.y-o.y);const p=Object.assign({},K);h===void 0&&(h=o.getDeltaTo(v,p));const y=o.scrollIntoView(v,p);if(await y,y.cancelled||a.isDestroyed||(await ue.animationFrame(),a.isDestroyed))return s(),!0;d=a.getElementFromEventRecord(i,e)}while(!d);o.suspendEvents(),h.yDelta>=0?o.y=Math.max(c.topRow.top-o.viewport.height,u):o.y=Math.min(c.bottomRow.bottom,u),a.fixElementHeights(),o.resumeEvents();const g=o.scrollIntoView(d,Object.assign({},r,{elementAfterScroll:()=>a.getElementFromEventRecord(i,e)}));if(await g,g.canceled||a.isDestroyed)return s(),!0;await ue.animationFrame(),s()})}scrollResourceIntoView(e,i=K){return this.isVertical?this.currentOrientation.scrollResourceIntoView(e,i):this.scrollRowIntoView(e,i)}get widgetClass(){}},gt=t=>class extends(t||R){static get $name(){return"SchedulerRegions"}getScheduleRegion(e,i,r=!0,s){return this.currentOrientation.getScheduleRegion(...arguments)}getResourceRegion(e,i,r){return this.currentOrientation.getRowRegion(...arguments)}getAssignmentEventBox(e,i){return this.getResourceEventBox(e.event,e.resource,i)}getResourceEventBox(e,i,r=!1,s=!1){return this.currentOrientation.getResourceEventBox(...arguments)}getItemBox(e,i=!1){return e.resources.map(r=>this.getResourceEventBox(e,r,i))}get widgetClass(){}},ft=["eventLayout","mode","eventColor","eventStyle","tickSize","fillTicks"],vt=t=>class extends(t||R){static get $name(){return"SchedulerState"}getState(){return E.copyProperties(super.getState(),this,ft)}applyState(e){var i;this.suspendRefresh();let r=ft.slice();(e==null?void 0:e.eventLayout)==="layoutFn"&&(delete e.eventLayout,r.splice(r.indexOf("eventLayout"),1)),(i=e==null?void 0:e.zoomLevelOptions)!=null&&i.width&&(r=r.filter(s=>s!=="tickSize")),E.copyProperties(this,e,r),super.applyState(e),this.resumeRefresh(!0,!1)}get widgetClass(){}},pt=t=>class extends(t||R){static get $name(){return"EventSelection"}static get configurable(){return{highlightPredecessors:!1,highlightSuccessors:!1,deselectOnClick:!1,deselectAllOnScheduleClick:!0,selectResourceOnEventNavigate:!0,selectResourceOnScheduleClick:!0,selectedCollection:{}}}static get defaultConfig(){return{multiEventSelect:!1,eventSelectionDisabled:!1,eventSelectedCls:"b-sch-event-selected",triggerSelectionChangeOnRemove:!1,maintainSelectionOnDatasetChange:!0,eventAssignHighlightCls:"b-sch-event-assign-selected"}}afterConstruct(){var e;super.afterConstruct(),(e=this.navigator)==null||e.ion({navigate:"onEventNavigate",thisObj:this})}changeSelectedCollection(e){return e.isCollection||(e=new de(e)),e}updateSelectedCollection(e){const i=this;e.owner||(e.owner=i),e.ion({change:(...r)=>i.project.deferUntilRepopulationIfNeeded("onSelectedCollectionChange",(...s)=>!i.isDestroying&&i.onSelectedCollectionChange(...s),r),beforeSplice:"onBeforeSelectedCollectionSplice",thisObj:i})}get selectedCollection(){return this._selectedCollection}getActionType(e,i,r,s){return s&&e.length>0&&r.length===e.length&&i.length===0||!s&&e.length===0&&r.length>0?"clear":i.length>0&&r.length>0?"update":i.length>0?"select":"deselect"}getEventsFromAssignments(e){return G.unique(e.map(i=>i.event))}get selectedEvents(){return this.getEventsFromAssignments(this.selectedCollection.values)}set selectedEvents(e){const i=[];e=G.asArray(e),e==null||e.forEach(r=>{this.isEventSelectable(r)!==!1&&(r.isOccurrence?r.assignments.forEach(s=>{i.push(this.assignmentStore.getOccurrence(s,r))}):i.push(...r.assignments))}),this.selectedCollection.splice(0,this.selectedCollection.count,i)}get selectedAssignments(){return this.selectedCollection.values}set selectedAssignments(e){this.selectedCollection.splice(0,this.selectedCollection.count,e||[])}isEventSelected(e){const{selectedCollection:i}=this;return!!(i.count&&i.includes(e.assignments))}isEventSelectable(e){}isAssignmentSelected(e){return this.selectedCollection.includes(e)}select(e,i=!1){e.isAssignment?this.selectAssignment(e,i):this.selectEvent(e,i)}selectEvent(e,i=!1){this.isEventSelected(e)||this.selectEvents([e],i)}selectAssignment(e,i=!1,r){this.isAssignmentSelected(e)||(i?this.selectedCollection.add(e):this.selectedAssignments=e)}deselect(e){e.isAssignment?this.deselectAssignment(e):this.deselectEvent(e)}deselectEvent(e){this.isEventSelected(e)&&this.selectedCollection.remove(...e.assignments)}deselectAssignment(e){this.isAssignmentSelected(e)&&this.selectedCollection.remove(e)}selectEvents(e,i=!1){if(i){const r=e.reduce((s,a)=>(this.isEventSelectable(a)!==!1&&s.push(...a.assignments),s),[]);this.selectedCollection.add(r)}else this.selectedEvents=e}deselectEvents(e){this.selectedCollection.remove(e.reduce((i,r)=>(i.push(...r.assignments),i),[]))}selectAssignments(e){this.selectedCollection.add(e)}deselectAssignments(e){this.selectedCollection.remove(e)}clearEventSelection(){this.selectedAssignments=[]}onBeforeSelectedCollectionSplice({toAdd:e,toRemove:i,index:r}){const s=this,a=s._selectedCollection.values,o=e,l=i>0?a.slice(r,i+r):[],c=s.getActionType(a,o,l,!0);if(!(e.length===0&&i===0)&&(s.trigger("beforeEventSelectionChange",{action:c,selection:s.getEventsFromAssignments(a)||[],selected:s.getEventsFromAssignments(o)||[],deselected:s.getEventsFromAssignments(l)||[]})===!1||s.trigger("beforeAssignmentSelectionChange",{action:c,selection:a,selected:o,deselected:l})===!1))return!1}onSelectedCollectionChange({added:e,removed:i}){const r=this,s=r.selectedAssignments,a=e||[],o=i||[];function l(c,u){const d=c.event;if(d){const{eventAssignHighlightCls:g}=r,v=r.getElementFromAssignmentRecord(c,!1,!0);r.currentOrientation.toggleCls(c,r.eventSelectedCls,u,!1,!0),g&&r.getElementsFromEventRecord(d,null,!1,!0).forEach(p=>{if(p!==v){const y=r.resolveAssignmentRecord(p,!0);r.currentOrientation.toggleCls(y,g,u,!1,!0),u&&!p.parentElement.isReleased&&(p.style.animation="none",p.offsetHeight,p.style.animation=""),p.classList.toggle(g,u)}})}}if(o.forEach(c=>l(c,!1)),a.forEach(c=>l(c,!0)),(r.highlightSuccessors||r.highlightPredecessors)&&r.highlightLinkedEvents(r.selectedEvents),r.$selectedAssignments=s.map(c=>({eventId:c.eventId,resourceId:c.resourceId})),!r.silent){const c=this.getActionType(s,a,o);r.trigger("assignmentSelectionChange",{action:c,selection:s,selected:a,deselected:o}),r.trigger("eventSelectionChange",{action:c,selection:r.selectedEvents,selected:r.getEventsFromAssignments(a),deselected:r.getEventsFromAssignments(o)})}}onAssignmentChange(e){super.onAssignmentChange(e);const i=this,{action:r,records:s}=e;if(i.silent=!i.triggerSelectionChangeOnRemove,r==="remove")i.deselectAssignments(s);else if(r==="removeall"&&!i.eventStore.isSettingData)i.clearEventSelection();else if(r==="dataset"&&i.$selectedAssignments)if(!i.maintainSelectionOnDatasetChange)i.clearEventSelection();else{const a=i.$selectedAssignments.map(o=>s.find(l=>l.eventId===o.eventId&&l.resourceId===o.resourceId));i.selectedAssignments=G.clean(a)}i.silent=!1}onInternalEventStoreChange({source:e,action:i,records:r}){!e.isResourceTimeRangeStore&&i==="dataset"&&!r.length&&this.clearEventSelection(),super.onInternalEventStoreChange(...arguments)}onAssignmentSelectionClick(e,i){const r=this;r.isAssignmentSelected(i)?(r.deselectOnClick||e.ctrlKey)&&r.deselectAssignment(i,r.multiEventSelect,e):this.isEventSelectable(i.event)!==!1&&r.selectAssignment(i,e.ctrlKey&&r.multiEventSelect,e)}onEventNavigate({event:e,item:i}){if(!this.eventSelectionDisabled){const r=i&&(i.nodeType===Element.ELEMENT_NODE?this.resolveAssignmentRecord(i):i);r?this.onAssignmentSelectionClick(e,r):this.deselectAllOnScheduleClick&&this.clearEventSelection()}}changeHighlightSuccessors(e){return this.changeLinkedEvents(e)}changeHighlightPredecessors(e){return this.changeLinkedEvents(e)}changeLinkedEvents(e){const i=this;return e?(i.highlighted=i.highlighted||new Set,i.highlightLinkedEvents(i.selectedEvents)):i.highlighted&&i.highlightLinkedEvents(),e}highlightLinkedEvents(e=[]){const i=this,{highlighted:r,eventStore:s}=i,a=i.features.dependencies;r.forEach(o=>{e.includes(o)||(o.meta.highlight=!1,r.delete(o),s.includes(o)&&o.dependencies.forEach(l=>a.unhighlight(l,"b-highlight")))}),e.forEach(o=>{const l=[o];for(;l.length;){const c=l.pop();r.add(c),i.highlightSuccessors&&c.outgoingDeps.forEach(u=>{a.highlight(u,"b-highlight"),!r.has(u.toEvent)&&l.push(u.toEvent)}),i.highlightPredecessors&&c.incomingDeps.forEach(u=>{a.highlight(u,"b-highlight"),!r.has(u.fromEvent)&&l.push(u.fromEvent)})}r.forEach(c=>c.meta.highlight=!0)}),i.element.classList.toggle("b-highlighting",e.length>0),i.refreshWithTransition()}onEventDataGenerated(e){(this.highlightSuccessors||this.highlightPredecessors)&&(e.cls["b-highlight"]=e.eventRecord.meta.highlight),super.onEventDataGenerated(e)}updateProject(e,i){this.clearEventSelection(),super.updateProject(e,i)}doDestroy(){var e;((e=this._selectedCollection)==null?void 0:e.owner)===this&&this._selectedCollection.destroy(),super.doDestroy()}get widgetClass(){}},St=t=>t.preventDefault(),si={ArrowRight:1,ArrowLeft:1,ArrowUp:1,ArrowDown:1},ai={animate:100},oi=Object.freeze({}),yt=t=>class extends _e(t||R){static get $name(){return"EventNavigation"}static get configurable(){return{navigator:{allowCtrlKey:!0,scrollSilently:!0,keys:{Space:"onEventSpaceKey",Enter:"onEventEnterKey",Delete:"onDeleteKey",Backspace:"onDeleteKey",ArrowUp:"onArrowUpKey",ArrowDown:"onArrowDownKey",Escape:"onEscapeKey",Tab:"onTab","SHIFT+Tab":"onShiftTab"}},isNavigationKey:{ArrowDown:1,ArrowUp:1,ArrowLeft:1,ArrowRight:1}}}static get defaultConfig(){return{focusCls:"b-active",enableDeleteKey:!0,onDeleteKeyBuffer:500,navigatePreviousBuffer:200,navigateNextBuffer:200,testConfig:{onDeleteKeyBuffer:1}}}construct(e){const i=this;i.isInTimeAxis=i.isInTimeAxis.bind(i),i.onDeleteKey=i.throttle(i.onDeleteKey,i.onDeleteKeyBuffer,i),super.construct(e)}changeNavigator(e){const i=this;return i.getConfig("subGridConfigs"),new Ut(i.constructor.mergeConfigs({ownerCmp:i,target:i.timeAxisSubGridElement,processEvent:i.processEvent,itemSelector:`.${i.eventCls}-wrap`,focusCls:i.focusCls,navigatePrevious:i.throttle(i.navigatePrevious,{delay:i.navigatePreviousBuffer,throttled:St}),navigateNext:i.throttle(i.navigateNext,{delay:i.navigateNextBuffer,throttled:St})},e))}doDestroy(){this.navigator.destroy(),super.doDestroy()}isInTimeAxis(e){return!e.instanceMeta(this).excluded&&this.timeAxis.isTimeSpanInAxis(e)}onElementKeyDown(e){var i,r,s;const a=this,{navigator:o}=a;if(((i=a.focusedCell)==null?void 0:i.rowIndex)!==-1&&((r=a.focusedCell)==null?void 0:r.column)===a.timeAxisColumn&&!e.target.closest(o.itemSelector)&&e.key==="Enter"){const l=a.getFirstVisibleAssignment();if(l)return a.navigateTo(l,{uiEvent:e}),!1}else(s=super.onElementKeyDown)==null||s.call(this,e)}getFirstVisibleAssignment(e=this.focusedCell){var i,r,s;const a=this,{currentOrientation:o,rowManager:l,eventStore:c}=a;if(a.isHorizontal){let u=o.rowMap.get(l.getRow(e.rowIndex));if(u!=null&&u.length)return(i=u[0])==null?void 0:i.elementData.assignmentRecord;if(u=(r=o.resourceMap.get(e.id))==null?void 0:r.eventsData,u!=null&&u.length)return(s=u.filter(d=>c.isAvailable(d.eventRecord))[0])==null?void 0:s.assignmentRecord}else{const u=[...o.resourceMap.values()][0],d=u&&Object.values(u);if(d!=null&&d.length)return d.filter(h=>c.isAvailable(h.renderData.eventRecord))[0].renderData.assignmentRecord}}onGridBodyFocusIn(e){var i;const r=e.target.closest(this.focusableSelector);if(this.timeAxisSubGridElement.contains(e.target)){const s=this,{navigationEvent:a}=s,{target:o}=e,l=o.closest(s.navigator.itemSelector),c=l?s.normalizeCellContext({rowIndex:s.isVertical?0:s.resourceStore.indexOf(s.resolveResourceRecord(o)),column:s.timeAxisColumn,target:o}):new Mt(o);if(l){const{_focusedCell:u}=s;s._focusedCell=c,(i=s.onCellNavigate)==null||i.call(s,s,u,c,a,!0);return}if(r&&(!a||si[a.key])){const u=s.getFirstVisibleAssignment(c);if(u){s.navigateTo(u,{scrollIntoView:!!(a&&a.type!=="mousedown"),uiEvent:a||e});return}}}r&&super.onGridBodyFocusIn(e)}accessibleFocusCell(e,i){const r=this;if(e=r.normalizeCellContext(e),e.columnId!==r.timeAxisColumn.id)return super.focusCell(e,i)}normalizeTarget(e){return e.assignmentRecord}getPrevious(e,i){const r=this,{resourceStore:s}=r,{eventSorter:a}=r.currentOrientation,{startDate:o,endDate:l}=r.timeAxis,c=e.event,u=r.eventStore.getEvents({resourceRecord:e.resource,startDate:o,endDate:l}).filter(this.isInTimeAxis).sort(a);let d=e.resource,h=u[u.indexOf(c)-1];if(!h)for(let m=s.indexOf(d)-1;(!h||i&&h===c)&&m>=0;m--){d=s.getAt(m);const g=r.eventStore.getEvents({resourceRecord:d,startDate:o,endDate:l}).filter(r.isInTimeAxis).sort(a);h=g.length&&g[g.length-1]}return r.assignmentStore.getAssignmentForEventAndResource(h,d)}navigatePrevious(e){const i=this,r=i.getPrevious(i.normalizeTarget(e));return e.preventDefault(),r?(e.ctrlKey||i.clearEventSelection(),i.navigateTo(r,{uiEvent:e})):i.doGridNavigation(e)}getNext(e,i){const r=this,{resourceStore:s}=r,{eventSorter:a}=r.currentOrientation,{startDate:o,endDate:l}=r.timeAxis,c=e.event,u=r.eventStore.getEvents({resourceRecord:e.resource,startDate:o,endDate:l}).filter(this.isInTimeAxis).sort(a);let d=e.resource,h=u[u.indexOf(c)+1];if(!h)for(let m=s.indexOf(d)+1;(!h||i&&h===c)&&m<s.count;m++)d=s.getAt(m),h=r.eventStore.getEvents({resourceRecord:d,startDate:o,endDate:l}).filter(r.isInTimeAxis).sort(a)[0];return r.assignmentStore.getAssignmentForEventAndResource(h,d)}navigateNext(e){const i=this,r=i.getNext(i.normalizeTarget(e));return e.preventDefault(),r?(e.ctrlKey||i.clearEventSelection(),i.navigateTo(r,{uiEvent:e})):i.doGridNavigation(e)}doGridNavigation(e){!e.handled&&e.key.indexOf("Arrow")===0&&this[`navigate${e.key.substring(5)}ByKey`](e)}async navigateTo(e,{scrollIntoView:i=!0,uiEvent:r={}}=oi){const s=this,{navigator:a}=s,{skipScrollIntoView:o}=a;e&&(i?(a.disabled=!0,await s.scrollAssignmentIntoView(e,ai),a.disabled=!1):a.skipScrollIntoView=!0,!s.isDestroyed&&this.getElementFromAssignmentRecord(e)&&(s.activeAssignment=e,a.skipScrollIntoView=o,a.trigger("navigate",{event:r,item:s.getElementFromAssignmentRecord(e).closest(a.itemSelector)})))}set activeAssignment(e){const i=this.getElementFromAssignmentRecord(e,!0);i&&(this.navigator.activeItem=i)}get activeAssignment(){const{activeItem:e}=this.navigator;if(e)return this.resolveAssignmentRecord(e)}get previousActiveEvent(){const{previousActiveItem:e}=this.navigator;if(e)return this.resolveEventRecord(e)}processEvent(e){const i=this,r=e.target.closest(i.eventSelector);return!i.navigator.disabled&&r&&(e.assignmentRecord=i.resolveAssignmentRecord(r),e.eventRecord=i.resolveEventRecord(r),e.resourceRecord=i.resolveResourceRecord(r)),e}onDeleteKey(e){const i=this;if(!i.readOnly&&i.enableDeleteKey){const r=i.eventStore.usesSingleAssignment?i.selectedEvents:i.selectedAssignments;i.removeEvents(r.filter(s=>!s.readOnly))}}onArrowUpKey(e){this.focusCell({rowIndex:this.focusedCell.rowIndex-1,column:this.timeAxisColumn}),e.handled=!0}onArrowDownKey(e){this.focusedCell.rowIndex<this.resourceStore.count-1&&(this.focusCell({rowIndex:this.focusedCell.rowIndex+1,column:this.timeAxisColumn}),e.handled=!0)}onEscapeKey(e){e.target.closest(".b-dragging")||(this.focusCell({rowIndex:this.focusedCell.rowIndex,column:this.timeAxisColumn}),e.handled=!0)}onEventSpaceKey(e){}onEventEnterKey(e){}get isActionableLocation(){if(!this.navigator.activeItem)return super.isActionableLocation}get widgetClass(){}},Ct=t=>{var n;return n=class extends t{static get $name(){return"TransactionalFeatureMixin"}get widgetClass(){}get transactionalFeaturesEnabled(){var e;return this.enableTransactionalFeatures&&((e=this.project)==null?void 0:e.queue)}},b(n,"configurable",{enableTransactionalFeatures:!1,testConfig:{enableTransactionalFeatures:!1}}),n},xe=t=>class extends t{static get $name(){return"AttachToProjectMixin"}async afterConstruct(){var e;super.afterConstruct();const i=this,r=i.client||i.grid,{project:s}=r;(e=r.projectSubscribers)==null||e.push(i),s&&(i.attachToProject(s),i.attachToResourceStore(s.resourceStore),i.attachToEventStore(s.eventStore),i.attachToAssignmentStore(s.assignmentStore),i.attachToDependencyStore(s.dependencyStore),i.attachToCalendarManagerStore(s.calendarManagerStore))}attachToProject(e){var i;this.detachListeners("project"),this._project=e,(i=super.attachToProject)==null||i.call(this,e)}detachFromProject(e){var i;(i=super.detachFromProject)==null||i.call(this,e)}attachToEventStore(e){var i;this.detachListeners("eventStore"),(i=super.attachToEventStore)==null||i.call(this,e)}attachToResourceStore(e){var i;this.detachListeners("resourceStore"),(i=super.attachToResourceStore)==null||i.call(this,e)}attachToAssignmentStore(e){var i;this.detachListeners("assignmentStore"),(i=super.attachToAssignmentStore)==null||i.call(this,e)}attachToDependencyStore(e){var i;this.detachListeners("dependencyStore"),(i=super.attachToDependencyStore)==null||i.call(this,e)}attachToCalendarManagerStore(e){var i;this.detachListeners("calendarManagerStore"),(i=super.attachToCalendarManagerStore)==null||i.call(this,e)}get project(){return this._project}get calendarManagerStore(){return this.project.calendarManagerStore}get assignmentStore(){return this.project.assignmentStore}get resourceStore(){return this.project.resourceStore}get eventStore(){return this.project.eventStore}get dependencyStore(){return this.project.dependencyStore}},li={releaseElement:1,reuseElement:1},ci={newElement:1,reuseOwnElement:1,reuseElement:1},Re=9999999,ui=({startDateMS:t},{startDateMS:n})=>t-n,di={startDate:1,endDate:1,duration:1};function bt(t,n,e,i,r){var s,a;const{timeAxis:o}=t,l=n.isBatchUpdating&&!r?n.get(i):n[i],c=(s=n.hasBatchedChange)==null?void 0:s.call(n,i);if(t.fillTicks&&(!((a=n.meta)!=null&&a.isResizing)||!c)){let d=o.getTickFromDate(l);if(d>=0){e&&d===Math.round(d)&&d>0&&d--;const h=Math.floor(d);return o.getAt(h)[i].getTime()}}return l==null?void 0:l.getTime()}var ie=class extends R.mixin(xe){static get configurable(){return{bufferSize:150,verticalBufferSize:150}}static get properties(){return{resourceMap:new Map,rowMap:new Map,eventConfigs:[],isFirstRefresh:!0,toDrawOnProjectRefresh:new Set,toDrawOnDataReady:new Set}}construct(t){const n=this;n.client=n.scheduler=t,n.eventSorter=n.eventSorter.bind(t),n.scrollBuffer=t.scrollBuffer,t.scrollable.ion({scroll:"onEarlyScroll",prio:1,thisObj:n}),t.rowManager.ion({name:"rowManager",renderDone:"onRenderDone",removeRows:"onRemoveRows",translateRow:"onTranslateRow",offsetRows:"onOffsetRows",beforeRowHeight:"onBeforeRowHeightChange",thisObj:n}),super.construct({})}init(){}updateVerticalBufferSize(){const{rowManager:t}=this.scheduler;this.scheduler.isPainted&&t.renderRows(t.rows)}get visibleDateRange(){return this._visibleDateRange}getDateFromXY(t,n,e,i=!1){const{scheduler:r}=this;let s=t[0];return e||(s=this.translateToScheduleCoordinate(s)),s=r.getRtlX(s),r.timeAxisViewModel.getDateFromPosition(s,n,i)}translateToScheduleCoordinate(t){const{scheduler:n}=this,{scrollable:e}=n.timeAxisSubGrid;let i=t-n.timeAxisSubGridElement.getBoundingClientRect().left-globalThis.scrollX;return n.rtl?i+=e.maxX-Math.abs(n.scrollLeft):i+=n.scrollLeft,i}translateToPageCoordinate(t){const{scheduler:n}=this,{scrollable:e}=n.timeAxisSubGrid;let i=t+n.timeAxisSubGridElement.getBoundingClientRect().left;return n.rtl?i-=e.maxX-Math.abs(n.scrollLeft):i-=n.scrollLeft,i}getScheduleRegion(t,n,e=!0,i,r=!1){var s;const a=this,{scheduler:o}=a,{timeAxisSubGridElement:l,timeAxis:c}=o,{start:u,end:d}=(!r||t)&&o.getResourceMarginObject(t)||{start:0,end:0};let h;if(t){const y=o.getRowById(t.id),C=n&&o.getElementsFromEventRecord(n,t)[0];if(h=y?k.from(y.getElement("normal"),l):o.getRecordCoords(t,!0),C){const S=k.from(C,l);h.y=S.y,h.bottom=S.bottom}else h.y=h.y+u,h.bottom=h.bottom-d}else h=k.from(l).moveTo(null,0),h.width=l.scrollWidth,h.y=h.y+u,h.bottom=h.bottom-d;const m=c.startDate,g=c.endDate;i=(i==null?void 0:i.start)&&i||((s=o.getDateConstraints)==null?void 0:s.call(o,t,n))||{start:m,end:g};let v=o.getCoordinateFromDate(i.start?f.max(m,i.start):m),p=o.getCoordinateFromDate(i.end?f.min(g,i.end):g);return e||(v=a.translateToPageCoordinate(v),p=a.translateToPageCoordinate(p)),h.left=Math.min(v,p),h.right=Math.max(v,p),h}getRowRegion(t,n,e){const{scheduler:i}=this,{timeAxis:r}=i,s=i.getRowById(t.id);if(!s)return null;const a=r.startDate,o=r.endDate,l=n?f.max(a,n):a,c=e?f.min(o,e):o,u=i.getCoordinateFromDate(l),d=i.getCoordinateFromDate(c,!0,!0),h=s.top,m=Math.min(u,d),g=h+s.offsetHeight;return new k(m,h,Math.max(u,d)-m,g-h)}getResourceEventBox(t,n,e,i=!1){var r;const{scheduler:s}=this,a=this.resourceMap.get(n.id);let o=null,l=!1;if(a&&(o=a.eventsData.find(c=>c.eventRecord===t)),o||(o=this.getTimeSpanRenderData(t,n,{viewport:!0,timeAxis:e}),l=!0),o){const c=(r=o.height)!=null?r:s.getResourceLayoutSettings(n).contentHeight,u=s.rowManager.getRecordCoords(n,!0,i),d=o.top+u.top,h=new k(o.left,d,o.width,c);return h.layout=!l,h.rowTop=u.top,h.rowBottom=u.bottom,h.resourceId=n.id,h}return null}resolveRowRecord(t){const n=this,{scheduler:e}=n,i=t.nodeType?t:t.target,r=i.nodeType===Element.TEXT_NODE?i.parentElement:i,s=r.closest(e.eventSelector);return s?n.resourceStore.getById(s.dataset.resourceId):!r.closest(".b-grid-row")&&r.dataset.resourceId?n.resourceStore.getById(r.dataset.resourceId):e.getRecordFromElement(r)}attachToProject(t){super.attachToProject(t),this.refreshAllWhenReady=!0,this.scheduler.isConfiguring||this.clearAll({clearDom:!0}),t==null||t.ion({name:"project",refresh:"onProjectRefresh",commitFinalized:"onProjectCommitFinalized",thisObj:this})}onProjectCommitFinalized(){const{scheduler:t,toDrawOnDataReady:n,project:e}=this;t.isVisible?t.isPainted&&!t.refreshSuspended&&(!n.size&&e.timeZone!=null&&e.ignoreRecordChanges&&e.resourceStore.forEach(i=>n.add(i.id)),n.size&&(this.clearResources(n),this.refreshResources(n)),n.clear()):t.whenVisible("refreshRows")}onProjectRefresh({isCalculated:t,isInitialCommit:n}){const e=this,{scheduler:i,toDrawOnProjectRefresh:r}=e;if(i.isVisible){if(i.isPainted&&!i.isConfiguring&&!i.refreshSuspended){if(e.refreshAllWhenReady||n&&t){i.calculateAllRowHeights(!0);const{rowManager:s}=i;s.topRow?(e.clearAll(),i.refreshAfterProjectRefresh||(s.topRow.dataIndex>=i.store.count?i.renderRows(!1):i.refreshWithTransition(!1,!e.isFirstRefresh&&t&&!n)),e.isFirstRefresh=!1):s.reinitialize(),e.refreshAllWhenReady=!1}else r.size&&e.refreshResources(r);r.clear()}}else i.whenVisible("refresh",i,[!0])}attachToAssignmentStore(t){this.refreshAllWhenReady=!0,super.attachToAssignmentStore(t),t&&t.ion({name:"assignmentStore",changePreCommit:"onAssignmentStoreChange",refreshPreCommit:"onAssignmentStoreRefresh",thisObj:this})}onAssignmentStoreChange({source:t,action:n,records:e=[],replaced:i,changes:r}){const s=this,{scheduler:a}=s,o=new Set(e.flatMap(l=>{var c,u,d;return[l.resourceId,...(d=(u=(c=l.resource)==null?void 0:c.$links)==null?void 0:u.map(h=>h.id))!=null?d:[]]}));if(!(s.resourceStore.isRemoving||s.resourceStore.isChangingId))switch(n){case"dataset":{s.eventStore.usesSingleAssignment||(o.size?s.refreshResourcesWhenReady(o):(s.clearAll(),a.refreshWithTransition()));return}case"add":case"remove":case"updateMultiple":s.refreshResourcesWhenReady(o);return;case"removeall":s.refreshAllWhenReady=!0;return;case"replace":i.forEach(([l,c])=>{o.add(l.resourceId),o.add(c.resourceId)}),s.refreshResourcesWhenReady(o);return;case"filter":s.clearAll(),a.calculateAllRowHeights(!0),a.refreshWithTransition();return;case"update":{("eventId"in r||"resourceId"in r||"id"in r)&&("resourceId"in r&&o.add(r.resourceId.oldValue),t===a.project.assignmentStore?s.refreshResourcesOnDataReady(o):s.refreshResources(o));break}case"clearchanges":{const{added:l,modified:c,removed:u}=r;c.length?a.refreshWithTransition():(l.forEach(d=>o.add(d.resourceId)),u.forEach(d=>o.add(d.resourceId)),s.refreshResourcesOnDataReady(o))}}}onAssignmentStoreRefresh({action:t,records:n}){t==="batch"&&(this.clearAll(),this.scheduler.refreshWithTransition())}attachToEventStore(t){this.refreshAllWhenReady=!0,super.attachToEventStore(t),t&&t.ion({name:"eventStore",addConfirmed:"onEventStoreAddConfirmed",refreshPreCommit:"onEventStoreRefresh",thisObj:this})}onEventStoreAddConfirmed({record:t}){for(const n of this.client.getElementsFromEventRecord(t))n.classList.remove("b-iscreating")}onEventStoreRefresh({action:t}){if(t==="batch"){const{scheduler:n}=this;n.isEngineReady&&n.isPainted&&(this.clearAll(),n.refreshWithTransition())}}onEventStoreChange({action:t,records:n=[],record:e,replaced:i,changes:r,source:s}){var a,o;const l=this,{scheduler:c}=l,u=s.isResourceTimeRangeStore,d=new Set;if(c.isPainted)if(n.forEach(h=>{var m;const g=(m=h.$linkedResources)==null?void 0:m.filter(v=>l.resourceStore.includes(v));g==null||g.forEach(v=>d.add(v.id))}),u){switch(t){case"removeall":case"dataset":l.clearAll(),c.refreshWithTransition();return}l.refreshResources(d)}else{switch(t){case"batch":case"sort":case"group":case"move":return;case"remove":return;case"clearchanges":l.clearAll(),c.refreshWithTransition();return;case"dataset":{l.clearAll(),c.isEngineReady?c.refreshWithTransition():l.refreshAllWhenReady=!0;return}case"add":case"updateMultiple":break;case"replace":i.forEach(([,h])=>{h.resources.map(m=>d.add(m.id))});break;case"removeall":case"filter":if(!c.isEngineReady){l.refreshAllWhenReady=!0;return}l.clearAll(),c.calculateAllRowHeights(!0),c.refreshWithTransition();return;case"update":{const h=e.$entity?!Object.keys(r).some(g=>!e.$entity.getField(g)):!Object.keys(r).some(g=>!di[g]);let m=0;if("startDate"in r&&m++,"endDate"in r&&m++,"duration"in r&&m++,"resourceId"in r&&d.add(r.resourceId.oldValue),d.size&&(!h||m&&!("duration"in r&&m===1)||"percentDone"in r||"inactive"in r||"constraintDate"in r||"constraintType"in r||"segments"in r)){const{eventResize:g,eventDragCreate:v}=c.features;if(e.isBatchUpdating&&(g!=null&&g.isResizing&&g.lockLayout||v!=null&&v.isResizing&&v.lockLayout)){for(const p of d)l.refreshEventsForResource(c.resourceStore.getById(p),void 0,!1);l.onRenderDone()}else(a=l.project)!=null&&a.propagatingLoadChanges||(o=l.project)!=null&&o.isWritingData?l.refreshResourcesOnDataReady(d):l.refreshResources(d)}return}}l.refreshResourcesWhenReady(d)}}attachToResourceStore(t){this.refreshAllWhenReady=!0,super.attachToResourceStore(t),t&&(this.clearAll({clearLayoutCache:!0}),t.ion({name:"resourceStore",changePreCommit:"onResourceStoreChange",thisObj:this}))}get resourceStore(){return this.client.store}onResourceStoreChange({action:t,isExpand:n,records:e,changes:i}){const r=this,s=e==null?void 0:e.flatMap(a=>a.isLinked?[a.id,a.$originalId]:[a.id]);if(r.scheduler.isPainted){switch(t){case"add":n||(e.every(a=>a.isLinked)?r.refreshResources(s):r.refreshResourcesWhenReady(s));return;case"update":{!r.project.isChangeTrackingSuspended&&!i.isLeaf&&r.refreshResources(s);return}case"filter":return;case"removeall":r.clearAll({clearLayoutCache:!0});return;case"dataset":return}s&&r.clearResources(s)}}onTranslateRow({row:t}){t.id!=null&&this.refreshEventsForResource(t,!1)}onOffsetRows(){this.clearAll(),this.doUpdateTimeView()}calculateRowHeight(t){var n,e;const{scheduler:i}=this,r=i.getResourceHeight(t),s=i.getEventLayout(t),a=s.type,o=(n=i.features.eventResize)==null?void 0:n.lockLayout;if(a==="stack"&&i.isEngineReady&&!t.isSpecialRow&&((e=t.assigned)==null?void 0:e.size)>1){const{assignmentStore:l,eventStore:c,timeAxis:u}=i,{barMargin:d,resourceMarginObject:{total:h},contentHeight:m}=i.getResourceLayoutSettings(t),g=(c.isFiltered||l.isFiltered)&&(C=>C.assignments.some(S=>S.resource===t.$original&&l.includes(S))),v=c.getEvents({resourceRecord:t,includeOccurrences:i.enableRecurringEvents,startDate:u.startDate,endDate:u.endDate,filter:g}).sort(ui).map(C=>{var S;const D=C.isBatchUpdating&&!(o&&((S=C.meta)!=null&&S.isResizing)),w=D?C.get("startDate"):C.startDate,A=D?C.get("endDate"):C.endDate||w;return{eventRecord:C,resourceRecord:t,startMS:w.getTime(),endMS:A.getTime()}}),p=i.getEventLayoutHandler(s),y=p.layoutEventsInBands(v,t,!0);return p.type==="layoutFn"?y:y*m+(y-1)*d+h}return r}doUpdateTimeView(){const{scrollable:t}=this.scheduler.timeAxisSubGrid;this.updateFromHorizontalScroll(t.x,!0)}onTimeAxisViewModelUpdate(){const t=this,{scheduler:n}=t;t.clearAll(),n.refreshSuspended&&(t.detachListeners("renderingSuspend"),n.ion({name:"renderingSuspend",resumeRefresh({trigger:e}){n.isEngineReady&&e&&t.doUpdateTimeView()},thisObj:t,once:!0})),t.doUpdateTimeView()}getConnectorStartSide(t){return"start"}getConnectorEndSide(t){return"end"}refreshRows(t){t&&this.clearAll()}onLocaleChange(){this.clearAll()}onViewportResize(t,n,e,i){n>i&&this.onRenderDone()}onDragAbort({context:t,dragData:n}){this.resourceStore.indexOf(n.record.resource)<this.scheduler.topRow.dataIndex&&t.element.remove()}toggleCls(t,n,e=!0,i=!1,r=!1){const s=this.client.getElementFromAssignmentRecord(t,i,r),a=this.resourceMap.get(t.isModel?t.get("resourceId"):t.resourceId),o=a==null?void 0:a.eventsData.find(l=>l.eventId===t.eventId);o&&(o[i?"wrapperCls":"cls"][n]=e),s&&(s.classList.toggle(n,e),s.lastDomConfig.className[n]=e)}onRemoveRows({rows:t}){t.forEach(n=>this.rowMap.delete(n)),this.onRenderDone()}onEarlyScroll(){this.rendererCalled=!1}updateFromVerticalScroll(){this.fromScroll=!0,this.rendererCalled||this.onRenderDone()}updateFromHorizontalScroll(t,n){var e,i;const r=this,{scheduler:s,scrollBuffer:a}=r,o=a===-1,{timeAxisSubGrid:l,timeAxis:c,rtl:u}=s,{width:d}=l,{totalSize:h}=s.timeAxisViewModel,m=t,g=l.scrollable.maxX!==0&&Math.abs(l.scrollable.maxX)<=Math.round(m)+5,v=o?c.startDate:s.getDateFromCoord({coord:Math.max(0,m-a),ignoreRTL:!0}),p=g||o?c.endDate:s.getDateFromCoord({coord:m+d+a,ignoreRTL:!0})||c.endDate;if(v&&!s._viewPresetChanging&&(!o||n||v-(((e=r._visibleDateRange)==null?void 0:e.startDate)||0)||p-(((i=r._visibleDateRange)==null?void 0:i.endDate)||0))){r._visibleDateRange={startDate:v,endDate:p,startMS:v.getTime(),endMS:p.getTime()},r.viewportCoords=o?{left:0,right:h}:u?{left:h-t-d+a,right:h-t-a}:{left:t-a,right:t+d+a};const y=s.timeView.range={startDate:v,endDate:p};if(s.internalOnVisibleDateRangeChange(y),!s.refreshSuspended&&s.rowManager.rows.length){if(s.rowManager.rows[0].id===null)return;r.fromScroll=!0,s.rowManager.rows.forEach(C=>r.refreshEventsForResource(C,!1,!1)),r.onRenderDone()}}}repaintEventsForResource(t){this.refreshResources([t.id])}onBeforeRowHeightChange(){this.clearAll()}refreshResourcesOnDataReady(t){t.forEach(n=>this.toDrawOnDataReady.add(n))}refreshResourcesWhenReady(t){this.clearResources(t),t.forEach(n=>this.toDrawOnProjectRefresh.add(n))}refreshResources(t,n=!0){const e=this,{scheduler:i}=e;if(e.clearResources(t),!i.refreshSuspended){const r=[],s=[];t.forEach(a=>{const o=i.getRowById(a);o?r.push(o):s.push(o)}),i.runWithTransition(()=>{i.calculateRowHeights(s.map(a=>this.resourceStore.getById(a)),!0),i.rowManager.renderRows(r)},n)}}layoutEventVerticallyStack(t,n,e){const{barMargin:i,resourceMarginObject:{start:r},contentHeight:s}=this.scheduler.getResourceLayoutSettings(e,n.parent);return t===0?r:r+t*s+t*i}layoutEventVerticallyPack(t,n,e,i){const{barMargin:r,resourceMarginObject:{start:s},contentHeight:a}=this.scheduler.getResourceLayoutSettings(i,e.parent),o=1/n,l=t*o,c=(a-(o-1)*r)*n;return{top:s+l*c+l*r,height:c}}addTemporaryDragElement(t,n=t.resource){const{scheduler:e}=this,i=e.generateRenderData(t,n,{timeAxis:!0,viewport:!0});i.absoluteTop=i.row?i.top+i.row.top:e.getResourceEventBox(t,n,!0).top;const r=this.renderEvent(i),{dataset:s}=r;delete r.tabIndex,delete s.eventId,delete s.resourceId,delete s.assignmentId,delete s.syncId,s.transient=!0,r.parent=this.scheduler.foregroundCanvas,r.retainElement=!0;const a=T.createElement(r);return a.innerElement=a.firstChild,t.instanceMeta(e).hasTemporaryDragElement=!0,a}eventSorter(t,n){if(this.overlappingEventSorter)return this.overlappingEventSorter(t.eventRecord||t,n.eventRecord||n);const e=t.isModel?t.startDateMS:t.dataStartMS||t.startMS,i=t.isModel?t.endDateMS:t.dataEndMS||t.endMS,r=n.isModel?n.startDateMS:n.dataStartMS||n.startMS,s=n.isModel?n.endDateMS:n.dataEndMS||n.endMS,a=t.isModel?t.name:t.eventRecord.name,o=n.isModel?n.name:n.eventRecord.name;return e-r||s-i||(a<o?-1:a==o?0:1)}calculateMS(t,n,e,i,r){var s,a;const o=this,{scheduler:l}=o,{timeAxisViewModel:c}=l;let u=bt(l,t,!1,n,i),d=bt(l,t,!0,e,i),h=d-u;if(l.milestoneLayoutMode!=="default"&&h===0){const p=c.getSingleUnitInPixels("minute");if(h=l.getMilestoneLabelWidth(t,r)*(1/p)*60*1e3,l.milestoneTextPosition==="always-outside"){const S=l.getResourceLayoutSettings(r,t.parent).contentHeight,D=S*(1/p)*60*1e3;u-=D/2,d=u+h}else switch(l.milestoneAlign){case"start":case"left":d=u+h;break;case"end":case"right":d=u,u=d-h;break;default:d=u+h/2,u=d-h;break}}const m=u,g=d,v=h;return(s=t.meta)!=null&&s.isResizing&&((a=l.features.eventResize)!=null&&a.lockLayout)&&(u=t.startDate.getTime(),d=t.endDate.getTime(),h=g-m),{startMS:u,endMS:d,durationMS:h,elementStartMS:m,elementEndMS:g,elementDurationMS:v}}setupRenderData(t,n){var e;const i=this,{scheduler:r}=i,{timeAxis:s,timeAxisViewModel:a}=r,{preamble:o,postamble:l}=t,c=i.isProHorizontalRendering&&((e=r.features.eventBuffer)==null?void 0:e.enabled)&&(o||l)&&!t.isMilestone,u=a.getSingleUnitInPixels("minute"),{isBatchUpdating:d}=t,h=c?"wrapStartDate":"startDate",m=c?"wrapEndDate":"endDate",g=d&&!c?t.get(h):t[h],v=d&&!c?t.get(m):t[m]||g,p=s.startMS,y=s.endMS,C=i.calculateMS(t,h,m,c,n),{startMS:S,endMS:D,durationMS:w}=C,A=S<p|(S>y)<<1,x=D>y|(D<=p)<<1,F=w/(1e3*60),M=x?u*F:null,j=r.getRowById(n);return{eventRecord:t,taskRecord:t,start:g,end:v,rowId:n.id,children:[],startsOutsideView:A,endsOutsideView:x,width:M,row:j,useEventBuffer:c,...C}}fillTimeSpanHorizontalPosition(t){const{elementStartMS:n,elementEndMS:e,elementDurationMS:i}=t,r=n!=null&&e!=null&&this.calculateHorizontalPosition(t,n,e,i);return r?(Object.assign(t,r),!0):!1}calculateHorizontalPosition(t,n,e,i){const{scheduler:r}=this,{timeAxis:s,timeAxisViewModel:a}=r,{startsOutsideView:o,endsOutsideView:l,eventRecord:c}=t,u=s.startMS,d=a.getSingleUnitInPixels("minute");let h=null,m=r.getCoordinateFromDate(e,{local:!0,respectExclusion:!0,isEnd:!0}),g,v=!1,p=!1;if(o?(g=(n-u)/(1e3*60)*d,r.rtl&&(g=a.totalSize-g)):(g=r.getCoordinateFromDate(n,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:m!==-1}),v=g===-1),l){const y=a.totalSize-g,C=e-s.endMS,S=C/(1e3*60);h=r.rtl?d*i/(1e3*60):y+d*S,z.isSafari&&r.features.stickyEvents&&s.endMS?m=r.getCoordinateFromDate(s.endMS):m=g+h*(r.rtl?-1:1)}else p=m===-1;return p&&!v&&(m=r.getCoordinateFromDate(e,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0})),h>Re&&(o===1?l===1?(g=-100,m=r.timeAxisColumn.width+100):g=m-Re:l===1&&(m=g+Re)),v&&p&&(g=r.getCoordinateFromDate(n,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:!0,max:e}),m=r.getCoordinateFromDate(e,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0,min:n}),g===m)?(c.instanceMeta(r).excluded=!0,null):{left:Math.min(g,m),width:Math.abs(m-g)||(c.isMilestone&&!c.meta.isDragCreating?0:6),clippedStart:v,clippedEnd:p}}fillTimeSpanVerticalPosition(t,n){const{scheduler:e}=this,{start:i,end:r}=t,{resourceMarginObject:{start:s},contentHeight:a}=e.getResourceLayoutSettings(n);e.fillTicks&&(t.dataStartMS=i.getTime(),t.dataEndMS=r.getTime()),t.top=Math.max(0,s),e.managedEventSizing&&(t.height=a)}getTimeSpanRenderData(t,n,e=!1){const i=this.setupRenderData(t,n);return this.fillTimeSpanHorizontalPosition(i)?(this.fillTimeSpanVerticalPosition(i,n),i):null}layoutEvents(t,n,e=!1,i,r){const s=this,{scheduler:a}=s,{timeAxis:o}=a,l=n.reduce((m,g)=>{if(e||o.isTimeSpanInAxis(g)){const v=a.generateRenderData(g,t,e);v&&m.push(v)}return m},[]);l.sort(r!=null?r:s.eventSorter);let c=a.getAppliedResourceHeight(t,i);const u=l.filter(({eventRecord:m})=>m.isEvent&&!m.meta.excludeFromLayout),d=a.getEventLayout(t,i),h=a.getEventLayoutHandler(d);if(h){const{barMargin:m,resourceMarginObject:{total:g},contentHeight:v}=a.getResourceLayoutSettings(t,i),p=h.applyLayout(u,t)||1;h.type==="layoutFn"?c=p:c=p*v+(p-1)*m+g}else if(u.length>0)for(let m=0;m<u.length;m++){const g=u[m];g.wrapperStyle+=`;z-index:${m+5}`}return{rowHeight:c,eventsData:l}}layoutResourceEvents(t,n=!1){const e=this,{scheduler:i}=e,{eventStore:r,assignmentStore:s,timeAxis:a}=i,o=r.getEvents({includeOccurrences:i.enableRecurringEvents,resourceRecord:t,startDate:a.startDate,endDate:a.endDate,filter:(s.isFiltered||r.isFiltered)&&(c=>c.assignments.some(u=>u.resource===t.$original&&s.includes(u)))}),l=i.getEventsToRender(t,o)||[];return e.layoutEvents(t,l,n)}renderEvent(t,n){const{scheduler:e}=this,{resourceRecord:i,assignmentRecord:r,eventRecord:s}=t,a=r?this.assignmentStore.getOccurrence(r,s).id:t.eventId,o={className:t.cls,style:t.style||"",children:t.children,role:"presentation",dataset:{taskFeature:"event"},syncOptions:{syncIdField:"taskBarFeature"}},l={className:t.wrapperCls,tabIndex:"tabIndex"in t?t.tabIndex:-1,children:[o,...t.wrapperChildren],style:{top:t.absoluteTop,left:t.left,height:t.fillSize?n:t.height,width:t.width,style:t.wrapperStyle,fontSize:t.height+"px"},dataset:{resourceId:i.id,eventId:t.eventId,syncId:i.isLinked?`${a}_${i.id}`:a},elementData:t,retainElement:(r==null?void 0:r.instanceMeta(e).retainElement)||s.instanceMeta(e).retainElement,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}};return t.fillSize&&(t.height=n),t.zIndex&&(l.zIndex=t.zIndex),r&&(l.dataset.assignmentId=r.id),t.elementConfig=l,e.afterRenderEvent({renderData:t,rowHeight:n,domConfig:l}),l}refreshEventsForResource(t,n=!0,e=!0){const i=this,r=i.scheduler.store.getById(t.isRow?t.id:t),s=i.scheduler.rowManager.getRowFor(r);n&&i.clearResources([r]),s&&r&&(i.renderer({row:s,record:r}),n&&e&&i.onRenderDone())}getResourceLayout(t){const n=this;let e=n.resourceMap.get(t.id);if(!e||e.invalid){if(n.suspended)return;e=n.layoutResourceEvents(t,!1),n.resourceMap.set(t.id,e)}return e}getEventDOMConfigForCurrentView(t,n,e,i){const r=this,{bufferSize:s,scheduler:a}=r,{labels:o,eventBuffer:l}=a.features,c=(l==null?void 0:l.enabled)||(o==null?void 0:o.enabled)&&(o.left||o.right||o.before||o.after),{eventsData:u}=t,d=r.fromScroll?r.rowMap.get(n):null,h=[];let m,g;for(let v=0;v<u.length;v++){const p=u[v];if(m=e,g=i,(c||p.width===0)&&(m-=s,g+=s),p.left+p.width>=m&&p.left<=g){p.absoluteTop=p.top+n.top;const y=d==null?void 0:d.find(C=>C.elementData.eventId===p.eventId&&C.elementData.resourceId===p.resourceId);h.push(y!=null?y:r.renderEvent(p,t.rowHeight))}}return h}renderer({row:t,record:n,size:e={}}){const i=this;if(n.isSpecialRow){i.rowMap.delete(t);return}const{left:r,right:s}=i.viewportCoords,a=i.getResourceLayout(n);if(!a)return;e.height=a.rowHeight,e.transient=!0;const o=i.getEventDOMConfigForCurrentView(a,t,r,s);i.rowMap.set(t,o),i.rendererCalled=!0}onRenderDone(){var t;const{scheduler:n,rowMap:e,verticalBufferSize:i}=this,r=[],s=(t=n._scrollTop)!=null?t:0,a=s-i,o=s+n._bodyRectangle.height+i,l=i<0,c=!n.managedEventSizing;e.forEach((u,d)=>{if(l||d.bottom>a&&d.top<o)for(let h=0;h<u.length;h++){const m=u[h],g=m.elementData,{absoluteTop:v,eventRecord:p}=g;(l||c||p.meta.isDragCreating||p.meta.isResizing||v+g.height>a&&v<o)&&r.push(m)}for(let h=0;h<u.length;h++)u[h]={...u[h]}}),this.fromScroll=!1,this.visibleEventDOMConfigs=r,q.sync({domConfig:{onlyChildren:!0,children:r},targetElement:n.foregroundCanvas,syncIdField:"syncId",callback({action:u,domConfig:d,lastDomConfig:h,targetElement:m,jsx:g}){var v,p,y;const{reactComponent:C}=n,S=li[u],D=ci[u];if(!S&&((v=n.processEventContent)==null||v.call(n,{jsx:g,action:u,domConfig:d,targetElement:m,isRelease:S,reactComponent:C})),!(u==="none"||!((p=d==null?void 0:d.elementData)!=null&&p.isWrap))){if(S&&(h!=null&&h.elementData)){const{eventRecord:w,resourceRecord:A,assignmentRecord:x}=h.elementData,F={renderData:h.elementData,element:m,eventRecord:w,resourceRecord:A,assignmentRecord:x};(y=n.processEventContent)==null||y.call(n,{isRelease:S,targetElement:m,reactComponent:C,assignmentRecord:x}),m===T.getActiveElement(m)&&n.focusElement.focus(),n.trigger("releaseEvent",F)}if(D){const{eventRecord:w,resourceRecord:A,assignmentRecord:x}=d.elementData,F={renderData:d.elementData,element:m,isReusingElement:u==="reuseElement",isRepaint:u==="reuseOwnElement",eventRecord:w,resourceRecord:A,assignmentRecord:x};u==="reuseElement"&&n.isAnimating&&T.addTemporaryClass(m,"b-reusing-own",50,n,`b-reusing-own-${(x||w).id}`),n.trigger("renderEvent",F)}}}})}clearResources(t){t=G.asArray(t),t.map(je.asId).forEach(e=>{const i=this.resourceMap.get(e);i&&(i.invalid=!0);const r=this.scheduler.getRowById(e);r&&this.rowMap.delete(r)})}clearAll({clearDom:t=!1,clearLayoutCache:n=!1}={}){const e=this,{layouts:i,foregroundCanvas:r}=e.scheduler;if(n&&i)for(const s in i)i[s].clearCache();if(r&&t){r.syncIdMap=r.lastDomConfig=r.releasedIdMap=null;for(const s of r.children)s.lastDomConfig=s.elementData=null}e.resourceMap.clear(),e.rowMap.clear()}};b(ie,"$name","HorizontalRendering"),ie._$name="HorizontalRendering";var Dt=class extends we(){static get defaultConfig(){return{coordProp:"leftFactor",sizeProp:"widthFactor"}}applyLayout(t,n,e,i,r,s,a){const o=this,l=a.type;return o.packEventsInBands(t,(c,u,d,h)=>{if(l==="none")c.width=n-i,c.left+=e;else{c.widthFactor=h;const m=c.leftFactor=d.start+u*h,g=Math.round(1/h),v=m/h,p=n-i-r*(g-1);l==="mixed"&&g===2?(c.left+=m*n/5+r,c.width=n-m*n/5-r*2,c.zIndex=5+v):(c.width=h*p,c.left+=m*p+e+r*v)}c.cls["b-sch-event-narrow"]=c.width<o.scheduler.narrowEventWidth})}};Dt._$name="VerticalLayout";var hi={releaseElement:1,reuseElement:1},mi={newElement:1,reuseOwnElement:1,reuseElement:1},gi={startDate:1,endDate:1,duration:1},fi=Object.freeze({}),Ae=class extends R.mixin(_e,xe){static get properties(){return{eventMap:new Map,resourceMap:new Map,releasedElements:{},toDrawOnProjectRefresh:new Set,resourceBufferSize:1}}construct(t){this.client=this.scheduler=t,this.verticalLayout=new Dt({scheduler:t}),super.construct({})}init(){const t=this,{scheduler:n,resourceColumns:e}=t;e.resourceStore=t.resourceStore,e.ion({name:"resourceColumns",columnWidthChange:"onResourceColumnWidthChange",thisObj:t}),t.initialized=!0,n.isPainted&&t.renderer(),e.availableWidth=n.timeAxisSubGridElement.offsetWidth}resolveRowRecord(t,n){const e=this,{scheduler:i}=e,r=t.nodeType?null:t,s=r?r.target:t,a=r?[r.borderOffsetX,r.borderOffsetY]:n,o=s.nodeType===Element.TEXT_NODE?s.parentElement:s,l=o.closest(i.eventSelector);if(l)return i.resourceStore.getById(l.dataset.resourceId);if(!s.closest(".b-sch-timeaxis-cell"))return null;if(!a)throw new Error(`Vertical mode needs coordinates to resolve this element. Can also be called with a browser
                event instead of element to extract element and coordinates from`);if(i.variableColumnWidths||i.resourceStore.isGrouped){let u=0;for(const d of e.resourceStore)if(d.isSpecialRow||(u+=d.columnWidth||e.resourceColumns.columnWidth),u>=a[0])return d;return null}const c=Math.floor(a[0]/e.resourceColumns.columnWidth);return e.allResourceRecords[c]}toggleCls(t,n,e=!0,i=!1){var r;const s=(r=this.eventMap.get(t.eventId))==null?void 0:r[t.resourceId];if(s){s.renderData[i?"wrapperCls":"cls"][n]=e;const a=this.client.getElementFromAssignmentRecord(t,i);a&&a.classList[e?"add":"remove"](n)}}getDateFromXY(t,n,e,i=!1){let r=t[1];return e||(r=this.translateToScheduleCoordinate(r)),this.scheduler.timeAxisViewModel.getDateFromPosition(r,n,i)}translateToScheduleCoordinate(t){return t-this.scheduler.timeAxisSubGridElement.getBoundingClientRect().top-globalThis.scrollY}translateToPageCoordinate(t){return t+this.scheduler.timeAxisSubGridElement.getBoundingClientRect().top+globalThis.scrollY}getResourceEventBox(t,n){var e,i,r;const s=t.id,a=n.id;let{renderData:o}=((e=this.eventMap.get(s))==null?void 0:e[a])||fi;return o||(this.layoutResourceEvents(this.scheduler.resourceStore.getById(a)),o=(r=(i=this.eventMap.get(s))==null?void 0:i[a])==null?void 0:r.renderData),o?new k(o.left,o.top,o.width,o.bottom-o.top):null}getScheduleRegion(t,n,e){var i;const r=this,{scheduler:s}=r,a=k.from(s.timeAxisSubGridElement,s.timeAxisSubGridElement);t&&(a.left=r.allResourceRecords.indexOf(t)*s.resourceColumnWidth,a.right=a.left+s.resourceColumnWidth);const o=s.timeAxis.startDate,l=s.timeAxis.endDate,c=((i=s.getDateConstraints)==null?void 0:i.call(s,t,n))||{start:o,end:l},u=s.getCoordinateFromDate(f.max(o,c.start)),d=s.getCoordinateFromDate(f.min(l,c.end));return e?(a.top=u,a.bottom=d):(a.top=r.translateToPageCoordinate(u),a.bottom=r.translateToPageCoordinate(d)),a}getRowRegion(t,n,e){const i=this,{scheduler:r}=i,s=i.allResourceRecords.indexOf(t)*r.resourceColumnWidth,a=r.timeAxis.startDate,o=r.timeAxis.endDate,l=n?f.max(a,n):a,c=e?f.min(o,e):o,u=r.getCoordinateFromDate(l),d=r.getCoordinateFromDate(c,!0,!0),h=Math.min(u,d),m=Math.abs(u-d);return new k(s,h,r.resourceColumnWidth,m)}get visibleDateRange(){const t=this.scheduler,n=t.scrollable.y,e=t.scrollable.clientHeight,i=t.getDateFromCoordinate(n)||t.timeAxis.startDate,r=t.getDateFromCoordinate(n+e)||t.timeAxis.endDate;return{startDate:i,endDate:r,startMS:i.getTime(),endMS:r.getTime()}}onResourceColumnWidthChange({width:t,oldWidth:n}){const e=this,{scheduler:i}=e;e.resourceColumns.width=i.timeAxisColumn.width=e.allResourceRecords.length*t,e.clearAll(),e.refresh(Math.abs(t-n)>30)}attachToProject(t){super.attachToProject(t),t&&t.ion({name:"project",refresh:"onProjectRefresh",thisObj:this})}onProjectRefresh(){const t=this,{scheduler:n,toDrawOnProjectRefresh:e}=t;n.isVisible?n.rendered&&!n.refreshSuspended&&(t.refreshAllWhenReady?(t.clearAll(),t.refresh(),t.refreshAllWhenReady=!1):e.size&&t.refresh(),e.clear()):n.whenVisible("refresh",n,[!0])}attachToEventStore(t){super.attachToEventStore(t),this.refreshAllWhenReady=!0,t&&t.ion({name:"eventStore",addConfirmed:"onEventStoreAddConfirmed",refreshPreCommit:"onEventStoreRefresh",thisObj:this})}onEventStoreAddConfirmed({record:t}){for(const n of this.client.getElementsFromEventRecord(t))n.classList.remove("b-iscreating")}onEventStoreRefresh({action:t}){t==="batch"&&(this.refreshAllWhenReady=!0)}onEventStoreChange({action:t,records:n=[],record:e,replaced:i,changes:r,isAssign:s}){const a=this,o=new Set;switch(n.forEach(l=>{var c;const u=(c=l.$linkedResources)==null?void 0:c.filter(d=>a.resourceStore.includes(d));u==null||u.forEach(d=>o.add(d.id))}),t){case"sort":case"group":case"move":case"remove":case"batch":return;case"dataset":a.refreshAllResourcesWhenReady();return;case"add":case"updateMultiple":break;case"replace":i.forEach(([,l])=>{l.resources.map(c=>o.add(c.id))}),a.clearResources(o);break;case"removeall":case"filter":a.clearAll(),a.refresh();return;case"update":{const l=e.$entity?!Object.keys(r).some(u=>!e.$entity.getField(u)):!Object.keys(r).some(u=>!gi[u]);let c=0;"startDate"in r&&c++,"endDate"in r&&c++,"duration"in r&&c++,(!l||c||"percentDone"in r||"inactive"in r||"segments"in r)&&(a.shouldWaitForInitializeAndEngineReady?a.refreshResourcesWhenReady(o):(a.clearResources(o),a.refresh()));return}}a.refreshResourcesWhenReady(o)}attachToResourceStore(t){const n=this;super.attachToResourceStore(t),n.refreshAllWhenReady=!0,n.resourceColumns&&(n.resourceColumns.resourceStore=t),t.ion({name:"resourceStore",changePreCommit:"onResourceStoreChange",refreshPreCommit:"onResourceStoreRefresh",load:()=>n.scheduler.unmaskBody(),thisObj:n,prio:1}),n.initialized&&n.scheduler.isPainted&&(n.firstResource=n.lastResource=null,n.clearAll(),n.renderer())}onResourceStoreChange({source:t,action:n,records:e=[],record:i,replaced:r,changes:s}){const a=this,o=r?r.map(u=>u[1]):e,l=new Set(o.map(u=>u.id));a.firstResource=a.lastResource=null,t._allResourceRecords=null;const{allResourceRecords:c}=t;if(a.scheduler.isEngineReady){switch(n){case"update":s!=null&&s.id?a.clearResources([s.id.oldValue,s.id.value]):a.clearResources([i.id]);break;case"filter":a.clearAll();break}s&&"columnWidth"in s&&a.clearAll(),a.refresh(!0)}else{switch(n){case"dataset":case"remove":case"removeall":a.refreshAllResourcesWhenReady();return;case"replace":case"add":if(!t.isGrouped){const u=o.reduce((d,h)=>Math.min(d,c.indexOf(h)),c.length);for(let d=u;d<c.length;d++)l.add(c[d].id)}}a.refreshResourcesWhenReady(l)}}onResourceStoreRefresh({action:t}){const n=this;(t==="sort"||t==="group")&&(n.firstResource=n.lastResource=n.resourceStore._allResourceRecords=null,n.clearAll(),n.refresh())}attachToAssignmentStore(t){super.attachToAssignmentStore(t),this.refreshAllWhenReady=!0,t&&t.ion({name:"assignmentStore",changePreCommit:"onAssignmentStoreChange",refreshPreCommit:"onAssignmentStoreRefresh",thisObj:this})}onAssignmentStoreChange({action:t,records:n=[],replaced:e,changes:i}){const r=this,s=new Set(n.map(a=>a.resourceId));if(r.scheduler.isEngineReady){switch(t){case"remove":r.clearResources(s);break;case"filter":r.clearAll();break;case"update":{if("resourceId"in i&&s.add(i.resourceId.oldValue),!Object.keys(i).filter(a=>a!=="resource"&&a!=="event").length)return;r.clearResources(s)}}r.refresh(!0)}else{switch(i&&"resourceId"in i&&s.add(i.resourceId.oldValue),t){case"removeall":r.refreshAllResourcesWhenReady();return;case"replace":e.forEach(([a,o])=>{s.add(a.resourceId),s.add(o.resourceId)})}r.refreshResourcesWhenReady(s)}}onAssignmentStoreRefresh({action:t,records:n}){t==="batch"&&(this.clearAll(),this.refreshAllResourcesWhenReady())}refreshRows(t){t&&(this.clearAll(),this.scheduler.refreshFromRerender=!1)}repaintEventsForResource(t){this.renderResource(t)}updateFromHorizontalScroll(t){t!==this.prevScrollX&&(this.renderer(),this.prevScrollX=t)}updateFromVerticalScroll(){this.renderer()}scrollResourceIntoView(t,n){const{scheduler:e}=this,i=this.allResourceRecords.indexOf(t)*e.resourceColumnWidth;return e.scrollHorizontallyTo(i,n)}get allResourceRecords(){return this.scheduler.resourceStore.allResourceRecords}onViewportResize(t){this.resourceColumns.availableWidth=t,this.renderer()}get resourceColumns(){var t;return(t=this.scheduler.timeAxisColumn)==null?void 0:t.resourceColumns}onLocaleChange(){this.clearAll()}onDragAbort(){}onBeforeRowHeightChange(){}onTimeAxisViewModelUpdate(){}updateElementId(){}releaseTimeSpanDiv(){}getConnectorStartSide(t){return"top"}getConnectorEndSide(t){return"bottom"}refreshResourcesWhenReady(t){this.clearResources(t),t.forEach(n=>this.toDrawOnProjectRefresh.add(n))}refreshAllResourcesWhenReady(){this.clearAll(),this.refreshAllWhenReady=!0}get resourceRange(){return this.getResourceRange(!0)}get visibleResources(){const{first:t,last:n}=this.getResourceRange();return{first:this.allResourceRecords[t],last:this.allResourceRecords[n]}}getResourceRange(t){const{scheduler:n,resourceStore:e}=this,{resourceColumnWidth:i,scrollX:r}=n,{scrollWidth:s}=n.timeAxisSubGrid.scrollable,a=t?this.resourceBufferSize:0,o=r-a,l=r+s+a;if(!(e!=null&&e.count))return{first:-1,last:-1};if(n.variableColumnWidths){let c,u=0,d,h=0;return this.allResourceRecords.forEach((m,g)=>{if(m.instanceMeta(n).insetStart=d=h,h=d+m.columnWidth,d>l)return!1;h>o&&c==null?c=g:d<l&&(u=g)}),{first:c,last:u}}else return{first:Math.max(Math.floor(r/i)-a,0),last:Math.min(Math.floor((r+n.timeAxisSubGrid.width)/i)+a,this.allResourceRecords.length-1)}}get dateRange(){const{scheduler:t}=this;let n=t.getDateFromCoordinate(Math.min(t.scrollTop+t.bodyHeight+t.tickSize-1,(t.virtualScrollHeight||t.scrollable.scrollHeight)-1));n||(n=t.timeAxis.last.endDate);let e=t.getDateFromCoordinate(Math.max(t.scrollTop-t.tickSize,0));return e||(e=t.timeAxis.first.startDate,n=t.getDateFromCoordinate(t.bodyHeight+t.tickSize-1)),{topDate:e,bottomDate:n}}getTimeSpanRenderData(t,n,e=!1){var i;const r=this,{scheduler:s}=r,{preamble:a,postamble:o}=t,{variableColumnWidths:l}=s,c=((i=s.features.eventBuffer)==null?void 0:i.enabled)&&r.isProVerticalRendering&&(a||o)&&!t.isMilestone,u=c?"wrapStartDate":"startDate",d=c?"wrapEndDate":"endDate",h=t.isBatchUpdating&&t.hasBatchedChange(u)&&!c?t.get(u):t[u],m=t.isBatchUpdating&&t.hasBatchedChange(d)&&!c?t.get(d):t[d],{resourceMarginObject:{total:g}}=s.getResourceLayoutSettings(n),v=s.getCoordinateFromDate(h),p=n.instanceMeta(s),y=l?p.insetStart:r.allResourceRecords.indexOf(n)*s.resourceColumnWidth,C=s.getResourceWidth(n),S=C-g,D=h.getTime(),w=m.getTime();let A=s.getCoordinateFromDate(m),x=A-v;return A===-1&&(x=Math.round((w-D)*s.timeAxisViewModel.getSingleUnitInPixels("millisecond")),A=v+x),{eventRecord:t,resourceRecord:n,left:y,top:v,bottom:A,resourceWidth:C,width:S,height:x,startDate:h,endDate:m,startDateMS:D,endDateMS:w,useEventBuffer:c,children:[],start:h,end:m,startMS:D,endMS:w}}eventSorter(t,n){const e=t.dataStartMs||t.startDateMS,i=t.dataEndMs||t.endDateMS,r=n.dataStartMs||n.startDateMS,s=n.dataEndMs||n.endDateMS,a=t.isModel?t.name:t.eventRecord.name,o=n.isModel?n.name:n.eventRecord.name;return e-r||s-i||(a<o?-1:a==o?0:1)}layoutEvents(t,n,e=!1,i,r){const s=this,{scheduler:a}=s,{variableColumnWidths:o}=a,{id:l}=t,c=t.instanceMeta(a),u=i?`${l}-${i.id}`:l,d=s.resourceMap.set(u,{}).get(u),h=s.allResourceRecords.indexOf(t),{barMargin:m,resourceMarginObject:{start:g,total:v}}=a.getResourceLayoutSettings(t,i),p=n.reduce((y,C)=>{if(C.isScheduled){const S=a.generateRenderData(C,t,!1),D={renderData:S},w=E.getMapPath(s.eventMap,S.eventId,{});w[l]=D,d[S.eventId]=D,S.fillSize?(S.left=o?c.insetStart:h*a.resourceColumnWidth,S.width=a.getResourceWidth(t)):y.push(S)}return y},[]);return p.sort(r!=null?r:s.eventSorter),s.verticalLayout.applyLayout(p,a.getResourceWidth(t,i),g,v,m,h,a.getEventLayout(t,i)),d}layoutResourceEvents(t){const n=this,{scheduler:e}=n,{assignmentStore:i,eventStore:r,timeAxis:s}=e;let a=r.getEvents({includeOccurrences:e.enableRecurringEvents,resourceRecord:t,startDate:s.startDate,endDate:s.endDate,filter:(i.isFiltered||r.isFiltered)&&(o=>o.assignments.some(l=>l.resource===t&&i.includes(l)))});return a=e.getEventsToRender(t,a),n.layoutEvents(t,a)}addTemporaryDragElement(t){const{scheduler:n}=this,e=n.generateRenderData(t,t.resource,{timeAxis:!0,viewport:!0});e.top=e.row?e.top+e.row.top:n.getResourceEventBox(t,t.resource,!0).top;const i=this.renderEvent({renderData:e}),{dataset:r}=i;delete i.tabIndex,delete r.eventId,delete r.resourceId,delete r.assignmentId,delete r.syncId,r.transient=!0,i.parent=this.scheduler.foregroundCanvas,i.retainElement=!0;const s=T.createElement(i);return s.innerElement=s.firstChild,t.instanceMeta(n).hasTemporaryDragElement=!0,s}renderEvent(t){const{scheduler:n}=this,e=t.renderData,{resourceRecord:i,assignmentRecord:r,eventRecord:s}=e,a={className:e.wrapperCls,tabIndex:-1,children:[{role:"presentation",className:e.cls,style:(e.internalStyle||"")+(e.style||""),children:e.children,dataset:{taskFeature:"event"},syncOptions:{syncIdField:"taskBarFeature"}},...e.wrapperChildren],style:{top:e.top,[n.rtl?"right":"left"]:e.left,height:s.isMilestone?"1em":e.height,width:e.width,style:e.wrapperStyle||"",fontSize:s.isMilestone?Math.min(e.width,40):null},dataset:{resourceId:i.id,eventId:e.eventId,syncId:r?this.assignmentStore.getOccurrence(r,s).id:e.eventId},elementData:t,retainElement:(r||s).instanceMeta(this.scheduler).retainElement,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}};return a.className["b-sch-vertical"]=1,e.zIndex&&(a.zIndex=e.zIndex),r&&(a.dataset.assignmentId=r.id),e.elementConfig=t.elementConfig=a,n.afterRenderEvent({renderData:e,domConfig:a}),a}renderResource(t){var n;const e=this,{topDateMS:i,bottomDateMS:r}=e,s=[];let a=e.resourceMap.get(t.id);a||(a=e.layoutResourceEvents(t));for(const o in a){const l=a[o],{endDateMS:c,startDateMS:u,eventRecord:d}=l.renderData;if(c>=i&&u<=r&&!d.instanceMeta(e.scheduler).hasTemporaryDragElement){const h=((n=l.elementConfig)==null?void 0:n.className)!=="b-released"&&l.elementConfig||e.renderEvent(l);s.push(h)}}return s}isEventElement(t){const n=t&&t.className;return n&&n[this.scheduler.eventCls+"-wrap"]}get shouldWaitForInitializeAndEngineReady(){return!this.initialized||!this.scheduler.isEngineReady&&!this.scheduler.isCreating}renderer(){const t=this,{scheduler:n}=t,{first:e,last:i}=t.resourceRange,{topDate:r,bottomDate:s}=t.dateRange,a=[],o=[];if(!t.shouldWaitForInitializeAndEngineReady){if(!f.isEqual(r,t.topDate)||!f.isEqual(s,t.bottomDate)){t.topDate=r,t.bottomDate=s,t.topDateMS=r.getTime(),t.bottomDateMS=s.getTime();const l=t.timeView.range={startDate:r,endDate:s};n.internalOnVisibleDateRangeChange(l)}if(e!==-1&&i!==-1)for(let l=e;l<=i;l++)a.push.apply(a,t.renderResource(t.allResourceRecords[l]));if(n.getForegroundDomConfigs(o),a.push.apply(a,o),q.sync({domConfig:{onlyChildren:!0,children:a},targetElement:n.foregroundCanvas,syncIdField:"syncId",callback({action:l,domConfig:c,lastDomConfig:u,targetElement:d,jsx:h}){var m,g,v;const{reactComponent:p}=n;if(t.isEventElement(c)||h||(m=c==null?void 0:c.elementData)!=null&&m.jsx){const y=hi[l],C=mi[l];if((g=n.processEventContent)!=null&&g.call(n,{action:l,domConfig:c,isRelease:!1,targetElement:d,reactComponent:p,jsx:h}))return;if(y&&t.isEventElement(u)&&!u.isReleased){const S=u.elementData.renderData,D={renderData:S,assignmentRecord:S.assignmentRecord,eventRecord:S.eventRecord,resourceRecord:S.resourceRecord,element:d};(v=n.processEventContent)==null||v.call(n,{isRelease:y,targetElement:d,reactComponent:p,assignmentRecord:S.assignmentRecord}),d===T.getActiveElement(d)&&n.focusElement.focus(),n.trigger("releaseEvent",D)}if(C){const S=c.elementData.renderData,D={renderData:S,assignmentRecord:S.assignmentRecord,eventRecord:S.eventRecord,resourceRecord:S.resourceRecord,element:d,isReusingElement:l==="reuseElement",isRepaint:l==="reuseOwnElement"};D.reusingElement=l==="reuseElement",n.trigger("renderEvent",D)}}}}),t.firstResource!==e||t.lastResource!==i){const l=t.resourceColumns.visibleResources={firstResource:e,lastResource:i};t.firstResource=e,t.lastResource=i,n.onVisibleResourceRangeChange(l),n.trigger("resourceRangeChange",l)}}}refresh(t){this.scheduler.runWithTransition(()=>this.renderer(),t)}refreshResources(t){this.clearResources(t),this.refresh()}refreshEventsForResource(t,n=!0,e=!0){this.refreshResources([t.id])}onRenderDone(){}get timeView(){return this.scheduler.timeView}clearResources(t){const{resourceMap:n,eventMap:e}=this;t.forEach(i=>{n.has(i)&&(Object.values(n.get(i)).forEach(({renderData:{eventId:r}})=>{delete e.get(r)[i]}),n.delete(i))})}clearAll(){this.resourceMap.clear(),this.eventMap.clear()}};Ae._$name="VerticalRendering";function vi(t,n){return t===n.length-1}function pi(t,n){return n===t.cells[t.cells.length-1]}var X=class extends Be{constructor(){super(...arguments),b(this,"startDate",null),b(this,"endDate",null),b(this,"levels",[]),b(this,"size",null)}set range({startDate:t,endDate:n}){var e;const i=this;if(i.startDate-t||i.endDate-n){const{client:r}=i;if(i.startDate=t,i.endDate=n,i.sizeProperty==="width"&&(r!=null&&r.hideHeaders)||i.sizeProperty==="height"&&((e=r==null?void 0:r.verticalTimeAxisColumn)!=null&&e.hidden))return;i.refresh()}}buildCells(t=this.startDate,n=this.endDate){var e;const i=this,{sizeProperty:r}=i,{stickyHeaders:s,isVertical:a}=i.client||{},o=[],{length:l}=i.levels,c=i.levels.map((u,d)=>{var h;const m=s&&(a||d<l-1);return{className:{"b-sch-header-row":1,[`b-sch-header-row-${u.position}`]:1,"b-sch-header-row-main":d===i.model.viewPreset.mainHeaderLevel,"b-lowest":vi(d,i.levels),"b-sticky-header":m},syncOptions:{releaseThreshold:5,syncIdField:"tickIndex"},dataset:{headerFeature:`headerRow${d}`,headerPosition:u.position},children:(h=u.cells)==null?void 0:h.filter(g=>g.start<n&&g.end>t).map((g,v)=>({role:"presentation",className:{"b-sch-header-timeaxis-cell":1,[g.headerCellCls]:g.headerCellCls,[`b-align-${g.align}`]:g.align,"b-last":pi(u,g)},dataset:{tickIndex:g.index,...globalThis.DEBUG&&{date:g.start.getTime()}},style:{[i.positionProperty]:g.coord,[r]:g.width,[`min-${r}`]:g.width},children:[{tag:"span",role:"presentation",className:{"b-sch-header-text":1,"b-sticky-header":m},html:g.value}]}))}});return(e=i.client)==null||e.getHeaderDomConfigs(o),c.push(...o),{onlyChildren:!0,syncOptions:{releaseThreshold:0},children:c}}render(t){super.render(t),this.refresh(!0)}refresh(t=!this.levels.length){const n=this,{columnConfig:e}=n.model,{levels:i}=n,r=i.length;if(t){i.length=0,e.forEach((a,o)=>i[o]={position:o,cells:a}),n.size=i[0].cells.reduce((a,o)=>a+o.width,0);const{parentElement:s}=n.element;s&&(i.length!==r||t)&&(s.classList.remove(`b-sch-timeaxiscolumn-levels-${r}`),s.classList.add(`b-sch-timeaxiscolumn-levels-${i.length}`))}!n.startDate||!n.endDate||(q.sync({domConfig:n.buildCells(),targetElement:n.element,syncIdField:"headerFeature"}),n.trigger("refresh"))}get widgetClass(){return"b-timeaxis"}};b(X,"$name","TimeAxisBase"),b(X,"configurable",{compactCellWidthThreshold:15,model:null,cls:null,sizeProperty:null,positionProperty:null}),X._$name="TimeAxisBase";var V=class extends X{get positionProperty(){var t;return(t=this.owner)!=null&&t.rtl?"right":"left"}get width(){return this.size}onModelUpdate(){var t;!((t=this.owner)!=null&&t.hideHeaders)&&this.model.availableSpace>0&&this.model.availableSpace!==this.width&&this.refresh(!0)}updateModel(t){this.detachListeners("tavm"),t==null||t.ion({name:"tavm",update:"onModelUpdate",thisObj:this})}};b(V,"$name","HorizontalTimeAxis"),b(V,"type","horizontaltimeaxis"),b(V,"configurable",{model:null,sizeProperty:"width"}),V._$name="HorizontalTimeAxis";var B=class extends Be{constructor(){super(...arguments),b(this,"firstResource",-1),b(this,"lastResource",-1)}construct(t){const n=this;t.scheduler._resourceColumns=n,super.construct(t),n.imagePath!=null&&n.element.classList.add("b-has-images"),L.on({element:n.element,delegate:".b-resourceheader-cell",capture:!0,click:"onResourceMouseEvent",dblclick:"onResourceMouseEvent",contextmenu:"onResourceMouseEvent",thisObj:n})}changeShowAvatars(t){var n;return(n=this.avatarRendering)==null||n.destroy(),t&&(this.avatarRendering=new _t({element:this.element})),t}updateShowAvatars(){this.isConfiguring||this.refresh()}updateResourceStore(t){const n=this;n.detachListeners("resourceStore"),t&&(t.ion({name:"resourceStore",changePreCommit:"onResourceStoreDataChange",thisObj:n}),t.count&&n.onResourceStoreDataChange({}))}onResourceStoreDataChange({action:t}){const n=this;n.getConfig("fillWidth"),n.getConfig("fitWidth"),n.updateWidthCache();const{element:e}=n,i=n.totalWidth;n.scheduler.variableColumnWidths?n._fillWidth=n._fitWidth=!1:(n._fillWidth=n.configuredFillWidth,n._fitWidth=n.configuredFitWidth),i!==n.width&&(T.setLength(e,"width",i),n.column.set("width",i,n.column.grid.isConfiguring)),t==="removeall"&&(e.innerHTML=""),(t==="remove"||t==="add"||t==="filter"||n.fitWidth||n.fillWidth)&&n.refreshWidths(),n.column.grid.toggleEmptyText()}get totalWidth(){return this.updateWidthCache()}updateWidthCache(){let t=0;const{scheduler:n}=this;return n.variableColumnWidths=!1,n.resourceStore.forEach(e=>{e.instanceMeta(n).insetStart=t,e.instanceMeta(n).insetEnd=t+(e.columnWidth||n.resourceColumnWidth),e.columnWidth==null?t+=n.resourceColumnWidth:(t+=e.columnWidth,n.variableColumnWidths=!0)}),t}changeColumnWidth(t){return this.refreshingWidths||(this.configuredColumnWidth=t),t}updateColumnWidth(t,n){const e=this;e.refreshingWidths||e.refreshWidths(),e.isConfiguring||(e.resourceStore.isGrouped&&e.updateWidthCache(),e.refresh(),e.trigger("columnWidthChange",{width:t,oldWidth:n}))}changeFillWidth(t){return this.configuredFillWidth=t}updateFillWidth(){this.isConfiguring||this.refreshWidths()}changeFitWidth(t){return this.configuredFitWidth=t}updateFitWidth(){this.isConfiguring||this.refreshWidths()}getImageURL(t){return P.joinPaths([this.imagePath||"",t||""])}updateImagePath(){this.isConfiguring||this.refresh()}updateAvailableWidth(t){this.refreshWidths()}refreshWidths(){var t;const n=this,{availableWidth:e,configuredColumnWidth:i}=n,r=(t=n.resourceStore)==null?void 0:t.count;if(!e||!r||n.scheduler.variableColumnWidths)return;n.refreshingWidths=!0;const s=n.fitWidth||n.fillWidth&&i*r<e,a=s?Math.floor(e/r):i,o=n.column.grid.enableEventAnimations&&Math.abs(n._columnWidth-a)>30;T.addTemporaryClass(n.element,"b-animating",o?300:0,n),n.columnWidth=a,n.refreshingWidths=!1}set visibleResources({firstResource:t,lastResource:n}){this.firstResource=t,this.lastResource=n,this.updateWidthCache(),this.refresh()}refresh(){var t,n;const e=this,{firstResource:i,scheduler:r,resourceStore:s,lastResource:a}=e,{variableColumnWidths:o}=r,l=s.isGrouped&&s.groupers[0].field,c=[];if(e.element.classList.toggle("b-grouped",!!l),!e.column.grid.isConfiguring&&i>-1&&a>-1&&a<s.count){let u;for(let d=i;d<=a;d++){const h=s.allResourceRecords[d],m=(t=h.groupParent)==null?void 0:t.get(s.id),g=m==null?void 0:m.groupChildren;if(l&&m.id!==(u==null?void 0:u.dataset.resourceId)){const S=g[0].instanceMeta(r).insetStart,D=g[g.length-1].instanceMeta(r).insetEnd-S;u={className:"b-resourceheader-group-cell",dataset:{resourceId:m.id},style:{left:S,width:D},children:[{tag:"span",html:P.encodeHtml(g[0][l])},{className:"b-resourceheader-group-children",children:[]}]},c.push(u)}const v=h.instanceMeta(r),p=h.columnWidth||e.columnWidth,y=l?v.insetStart-u.style.left:o?v.insetStart:d*e.columnWidth,C={className:new I({"b-resourceheader-cell":1}),dataset:{resourceId:h.id},style:{[r.rtl?"right":"left"]:y,width:p},children:[]};if(e.headerRenderer){const S=e.headerRenderer({elementConfig:C,resourceRecord:h});S&&(typeof S=="string"?C.html=S:typeof S=="object"&&(C.children=[S]))}else{let S;if(h.imageUrl)S=h.imageUrl;else if(e.imagePath!=null&&h.image!==!1){const D=h.image||((n=h.name)==null?void 0:n.toLowerCase())+e.imageExtension;S=e.getImageURL(D)}C.children.push(e.showAvatars&&e.avatarRendering.getResourceAvatar({resourceRecord:h,initials:h.initials,color:h.eventColor,iconCls:h.iconCls,defaultImageUrl:e.defaultImageName&&e.getImageURL(e.defaultImageName),imageUrl:S}),{tag:"span",className:"b-resource-name",html:P.encodeHtml(h.name)})}l?u.children[1].children.push(C):c.push(C)}}q.sync({domConfig:{onlyChildren:!0,children:c},targetElement:e.element,syncIdField:"resourceId",callback:({jsx:u,targetElement:d,domConfig:h})=>{var m;(m=r.processResourceHeader)==null||m.call(r,{jsx:u,targetElement:d,domConfig:h})}})}onResourceMouseEvent(t){const n=t.target.closest(".b-resourceheader-cell"),e=this.resourceStore.getById(n.dataset.resourceId);this.trigger("resourceHeader"+P.capitalize(t.type),{resourceRecord:e,event:t})}getCurrentConfig(t){const n=super.getCurrentConfig(t);return delete n.resourceStore,delete n.column,delete n.type,n}};b(B,"$name","ResourceHeader"),b(B,"type","resourceheader"),b(B,"configurable",{resourceStore:null,headerRenderer:null,showAvatars:{value:!0,$config:"nullify"},fillWidth:!0,fitWidth:!1,columnWidth:150,imagePath:null,imageExtension:null,defaultImageName:null,availableWidth:null}),B._$name="ResourceHeader";var ne=class extends Oe(kt){constructor(){super(...arguments),b(this,"headerHoverable",!1)}static get fields(){return[{name:"locked",persist:!1},{name:"flex",persist:!1},{name:"width",persist:!1},{name:"cellCls",persist:!1},{name:"field",persist:!1},"mode"]}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,resizable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,cls:"b-sch-timeaxiscolumn",needWidth:!0,mode:null,region:"normal",exportable:!1,htmlEncode:!1}}static get type(){return"timeAxis"}construct(t){const n=this;super.construct(...arguments),n.thisObj=n,n.grid._timeAxisColumn=n,n.timeAxisViewModel=n.grid.timeAxisViewModel,n.mode=n.mode,n.grid.ion({paint:"onTimelinePaint",thisObj:n,once:!0})}static get autoExposeFields(){return!0}doDestroy(){var t,n;(t=this.resourceColumns)==null||t.destroy(),(n=this.timeAxisView)==null||n.destroy(),super.doDestroy()}set mode(t){const n=this,{grid:e}=n;n.set("mode",t),t==="horizontal"?n.timeAxisView=new V({model:n.timeAxisViewModel,compactCellWidthThreshold:n.compactCellWidthThreshold,owner:e,client:e}):t==="vertical"&&(n.resourceColumns=B.new({column:n,scheduler:e,resourceStore:e.resourceStore,imagePath:e.resourceImagePath,imageExtension:e.resourceImageExtension,defaultImageName:e.defaultResourceImageName},e.resourceColumns||{}),n.relayEvents(n.resourceColumns,["resourceheaderclick","resourceheaderdblclick","resourceheadercontextmenu"]))}get mode(){return this.get("mode")}onViewModelUpdate({source:t}){const n=this;n.grid.timeAxisSubGrid.collapsed||(n.mode==="horizontal"?(n.refreshHeader(!0),n.width=t.totalSize,n.grid.refresh(),n.subGrid.refreshFakeScroll()):n.mode==="vertical"&&n.grid.refreshRows())}onTimelinePaint({firstPaint:t}){var n;const e=this;e.subGrid.insertRowsBefore&&t&&(e.subGridElement.classList.add("b-timeline-subgrid"),e.mode==="vertical"&&(e.refreshHeader(),(n=e.grid)==null||n.onHeightChange()))}refreshHeader(t){const n=this,{element:e}=n;e&&(n.mode==="horizontal"?(!t&&n.timeAxisViewModel.update(void 0,void 0,!0),n.timeAxisView.rendered?n.timeAxisView.refresh(!0):(e.innerHTML="",n.timeAxisView.render(e))):n.mode==="vertical"&&(n.resourceColumns.currentElement?n.resourceColumns.refresh():(e.innerHTML="",n.resourceColumns.render(e))))}internalRenderer(t){const{grid:n}=this;return n.project.isInitialCommitPerformed||n.project.isDelayingCalculation?(n.currentOrientation.renderer(t),super.internalRenderer(t)):""}get timeAxisViewModel(){return this._timeAxisViewModel}set timeAxisViewModel(t){const n=this;n.detachListeners("tavm"),t==null||t.ion({name:"tavm",update:"onViewModelUpdate",prio:-1e4,thisObj:n}),n._timeAxisViewModel=t,n.timeAxisView&&(n.timeAxisView.model=t)}getState(){const t=super.getState();return delete t.width,delete t.flex,t}};b(ne,"$name","TimeAxisColumn"),Le.registerColumnType(ne),ne._$name="TimeAxisColumn";var wt=class extends X{static get $name(){return"VerticalTimeAxis"}static get configurable(){return{cls:"b-verticaltimeaxis",sizeProperty:"height",positionProperty:"top",wrapText:!0}}buildHorizontalCells(){const t=this,{client:n}=t,e=n==null?void 0:n.stickyHeaders,i=[],r=t.levels.reduce((s,a,o)=>{var l;return a.cells&&s.push(...(l=a.cells)==null?void 0:l.filter(c=>c.start<t.endDate&&c.end>t.startDate).map((c,u,d)=>({role:"presentation",className:{"b-sch-header-timeaxis-cell":1,[c.headerCellCls]:c.headerCellCls,[`b-align-${c.align}`]:c.align,"b-last":u===d.length-1,"b-lowest":o===t.levels.length-1},dataset:{tickIndex:c.index,cellId:`${o}-${c.index}`,headerPosition:o,...globalThis.DEBUG&&{date:c.start.getTime()}},style:{top:c.coord,height:c.width,minHeight:c.width},children:[{role:"presentation",className:{"b-sch-header-text":1,"b-sticky-header":e},html:c.value}]}))),s},[]);return n==null||n.getHeaderDomConfigs(i),r.push(...i),{className:t.widgetClassList,dataset:{headerFeature:"headerRow0",headerPosition:0},syncOptions:{releaseThreshold:5,syncIdField:"cellId"},children:r}}get height(){return this.size}};wt._$name="VerticalTimeAxis";var re=class extends Rt{static get type(){return"verticalTimeAxis"}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,minWidth:0,resizable:!1,cellCls:"b-verticaltimeaxiscolumn",locked:!0,flex:1,alwaysClearCell:!1}}get isFocusable(){return!1}construct(t){super.construct(...arguments),this.view=new wt({model:this.grid.timeAxisViewModel,client:this.grid})}renderer({cellElement:t,size:n}){this.view.render(t),n.height=this.view.height}getCurrentConfig(t){const n=super.getCurrentConfig(t);return delete n.id,delete n.region,delete n.type,delete n.field,delete n.ariaLabel,delete n.cellAriaLabel,n}};b(re,"$name","VerticalTimeAxisColumn"),Le.registerColumnType(re),re._$name="VerticalTimeAxisColumn";var Si=["eventStore","taskStore","assignmentStore","resourceStore","dependencyStore","timeRangeStore","resourceTimeRangeStore"],yi=["events","tasks","resources","assignments","dependencies","timeRanges","resourceTimeRanges"],Et=t=>class extends t{static get $name(){return"CurrentConfig"}preProcessCurrentConfigs(e){for(const i of yi)delete e[i];super.preProcessCurrentConfigs(e)}getCurrentConfig(e){const i=this.project.getCurrentConfig(e),r=super.getCurrentConfig(e);if(i){r.project=i;const{crudManager:s}=r;if(s)for(const a of Si)s[a]&&(i[a]=s[a]);Object.keys(i).length===0&&delete r.project}return delete r.data,delete r.crudManager,r}get widgetClass(){}},Ci={month:"MMMM, YYYY",week:["MMMM YYYY (Wp)","S{MMM} - E{MMM YYYY} (S{Wp})"],day:"MMMM D, YYYY"},H=class extends O.mixin(zt,rt,st,at,ht,mt,vt,ct,gt,pt,yt,Et,Ct){constructor(){super(...arguments),b(this,"timeCellSelector",".b-sch-timeaxis-cell"),b(this,"resourceTimeRangeSelector",".b-sch-resourcetimerange")}static get defaultConfig(){return{mode:"horizontal",eventCls:"b-sch-event",timeCellCls:"b-sch-timeaxis-cell",overScheduledEventClass:"b-sch-event-hover",allowOverlap:!0,rowHeight:60,preCalculateHeightLimit:1e4,crudManagerClass:Pt,testConfig:{loadMaskError:{autoClose:10,showDelay:0}}}}afterConstruct(){const t=this;super.afterConstruct(),t.ion({scroll:"onVerticalScroll",thisObj:t}),t.createEventOnDblClick&&t.ion({scheduledblclick:t.onTimeAxisCellDblClick})}onPaintOverride(){}get store(){return super.store}set store(t){super.store=t}get visibleResources(){var t,n;const e=this;return e.isVertical?e.currentOrientation.visibleResources:{first:e.store.getById((t=e.firstVisibleRow)==null?void 0:t.id),last:e.store.getById((n=e.lastVisibleRow)==null?void 0:n.id)}}onLocaleChange(){this.currentOrientation.onLocaleChange(),super.onLocaleChange()}onTimeAxisCellDblClick({date:t,resourceRecord:n,row:e}){this.createEvent(t,n,e)}onVerticalScroll({scrollTop:t}){this.currentOrientation.updateFromVerticalScroll(t)}onEventCreated(t){}get isHorizontal(){return this.mode==="horizontal"}get isVertical(){return this.mode==="vertical"}get mode(){return this._mode}set mode(t){const n=this;n._mode=t,n[t]||(n.element.classList.add(`b-sch-${t}`),t==="horizontal"?(n.horizontal=new ie(n),n.isPainted&&n.horizontal.init()):t==="vertical"&&(n.vertical=new Ae(n),n.rendered&&n.vertical.init()))}get currentOrientation(){return this[this.mode]}onElementKeyDown(t){return super.onElementKeyDown(t)}onElementKeyUp(t){return super.onElementKeyUp(t)}onElementMouseOver(t){return super.onElementMouseOver(t)}onElementMouseOut(t){return super.onElementMouseOut(t)}processEventDrop(){}processCrossSchedulerEventDrop(){}beforeEventDragStart(){}afterEventDragStart(){}afterEventDragAbortFinalized(){}checkEventDragValidity(){}afterEventResizeStart(){}afterRenderEvent(){}get hasEventEditor(){return!!this.eventEditingFeature}get eventEditingFeature(){const{eventEdit:t,taskEdit:n,simpleEventEdit:e}=this.features;return t!=null&&t.enabled?t:n!=null&&n.enabled?n:e!=null&&e.enabled?e:null}editEvent(t,n,e){const i=this,{eventStore:r,assignmentStore:s}=i;if(!i.hasEventEditor)return!1;if(t.eventStore!==r){const{enableEventAnimations:a}=i,o=[];t.isCreating=!0;let l=[];if(n&&(o.push(n),l=s.assignEventToResource(t,n)),i.trigger("beforeEventAdd",{eventRecord:t,resourceRecords:o,assignmentRecords:l})===!1)return s==null||s.remove(l),!1;i.enableEventAnimations=!1,r.add(t),i.project.commitAsync().then(()=>i.enableEventAnimations=a),i.refreshRows()}}async createEvent(t,n){var e,i;const r=this,{enableEventAnimations:s,eventStore:a,assignmentStore:o,hasEventEditor:l}=r,c=[n],u=r.createEventOnDblClick.useEventModelDefaults,d=u?a.modelClass.defaultValues.duration:1,h=u?a.modelClass.defaultValues.durationUnit:r.timeAxis.unit,m=a.createRecord({startDate:t,endDate:f.add(t,d,h),duration:d,durationUnit:h,name:r.L("L{Object.newEvent}")});if(r.readOnly||n.isSpecialRow||n.readOnly||!r.allowOverlap&&!r.isDateRangeAvailable(m.startDate,m.endDate,null,n))return;(e=r.eventEditingFeature)==null||e.captureStm(!0),m.isCreating=l,r.onEventCreated(m);const g=o==null?void 0:o.assignEventToResource(m,n);if(r.trigger("beforeEventAdd",{eventRecord:m,resourceRecords:c,assignmentRecords:g})===!1){o==null||o.remove(g),(i=r.eventEditingFeature)==null||i.freeStm(!1);return}r.enableEventAnimations=!1,a.add(m),r.project.commitAsync().then(()=>r.enableEventAnimations=s),r.isCreating=!0,r.refreshRows(),r.isCreating=!1,await r.scrollEventIntoView(m),r.trigger("eventAutoCreated",{eventRecord:m,resourceRecord:n}),l&&r.editEvent(m,n,r.getEventElement(m))}isDateRangeAvailable(t,n,e,i){return this.eventStore.isDateRangeAvailable(t,n,e,i)}async resumeRefresh(t=Z.checkVersion("core","6.0",">="),n=!0){super.resumeRefresh(!1);const e=this;if(!e.refreshSuspended&&t){if(!e.isEngineReady)return e.currentOrientation.refreshAllWhenReady=!0,e.project.commitAsync();e.isDestroyed||(n?e.refreshWithTransition():e.refresh())}}toggleEmptyText(){var t;const n=this;n.bodyContainer&&T.toggleClasses(n.bodyContainer,"b-grid-empty",!(n.resourceStore.count>0||(t=n.crudManager)!=null&&t.isLoading))}getRowHeight(t){if(this.isHorizontal){const n=this.currentOrientation.calculateRowHeight(t);return this.rowManager.storeKnownHeight(t.id,n),n}}calculateRowHeights(t,n=!1){const{store:e}=this;for(const i of t)i&&e.isAvailable(i)&&this.getRowHeight(i);n||this.rowManager.estimateTotalHeight(!0)}calculateAllRowHeights(t=!1){const{store:n,rowManager:e}=this,i=Math.min(n.count,this.preCalculateHeightLimit);if(i){e.clearKnownHeights();for(let r=0;r<i;r++)this.getRowHeight(n.getAt(r));t||e.estimateTotalHeight(!0)}}get dateBounds(){const t=this,n=[t.startDate];return t.range==="week"&&n.push(t.lastDate),n}get defaultDescriptionFormat(){return Ci[this.range]}get lastDate(){const t=this.endDate;return t&&f.add(t,-1,"day")}getEventRecord(t){return t=T.getEventElement(t),this.resolveEventRecord(t)}getResourceRecord(t){return this.resolveResourceRecord(t)}getEventElement(t){return this.getElementFromEventRecord(t)}changeRange(t){return f.normalizeUnit(t)}updateRange(t){if(!this.isConfiguring){const n=this.date,e=this.date=f.startOf(n,t);n.getTime()===e.getTime()&&this.updateDate(e)}}changeStepUnit(t){return f.normalizeUnit(t)}updateDate(t){const n=this,e=f.startOf(t,n.range);n.setTimeSpan(e,f.add(e,1,n.range)),n.visibleDate={date:f.max(t,n.timeAxis.startDate),block:"start",animate:!0},n.trigger("descriptionChange")}updateScrollBuffer(t){this.isConfiguring||(this.currentOrientation.scrollBuffer=t)}previous(){this.date=f.add(this.date,-1,this.stepUnit)}next(){this.date=f.add(this.date,1,this.stepUnit)}async scheduleEvent({startDate:t,eventRecord:n,resourceRecord:e,element:i}){const r=this;if(r.eventStore.includes(n)||([n]=r.eventStore.add(n)),n.startDate=t,n.assign(e),i){const s=k.from(i,r.foregroundCanvas);T.setTranslateXY(i,0,0),T.setTopLeft(i,s.y,s.x),q.addChild(r.foregroundCanvas,i,n.assignments[0].id)}await r.project.commitAsync()}};b(H,"$name","SchedulerBase"),b(H,"type","schedulerbase"),b(H,"configurable",{date:{value:null,$config:{equal:"date"}},stepUnit:"week",range:"week",getDateConstraints:null,verticalTimeAxisColumn:{},createEventOnDblClick:!0,scrollBuffer:0,schedulableAreaSelector:".b-sch-timeaxis-cell",scheduledEventName:"event",sortFeatureStore:"resourceStore",showEventColorPickers:null,updateTimelineContextOnScroll:!0}),H.initClass(),H._$name="SchedulerBase";var $=class extends Ht{colorSelected({color:t}){this.record&&(this.record.eventColor=t)}};b($,"$name","EventColorPicker"),b($,"type","eventcolorpicker"),b($,"configurable",{colorClasses:H.eventColors,colorClassPrefix:"b-sch-",colors:null,record:null}),$.initClass(),$._$name="EventColorPicker";var xt=class extends R{static get defaultConfig(){return{minuteHeight:8,minuteTop:2,hourHeight:8,hourTop:2,handLeft:10,div:document.createElement("div"),scheduler:null,template(t){return`<div class="b-sch-clockwrap b-sch-clock-${t.mode||this.mode} ${t.cls||""}">
                    <div class="b-sch-clock">
                        <div class="b-sch-hour-indicator">${f.format(t.date,"MMM")}</div>
                        <div class="b-sch-minute-indicator">${f.format(t.date,"D")}</div>
                        <div class="b-sch-clock-dot"></div>
                    </div>
                    <span class="b-sch-clock-text">${P.encodeHtml(t.text)}</span>
                </div>`}}}generateContent(t){return this.div.innerHTML=this.template(t)}updateDateIndicator(t,n){const e=t==null?void 0:t.querySelector(".b-sch-hour-indicator"),i=t==null?void 0:t.querySelector(".b-sch-minute-indicator");n&&e&&i&&z.isBrowserEnv&&(this.mode==="hour"?(e.style.transform=`rotate(${n.getHours()%12*30}deg)`,i.style.transform=`rotate(${n.getMinutes()*6}deg)`):(e.style.transform="none",i.style.transform="none"))}set mode(t){this._mode=t}get mode(){if(this._mode)return this._mode;const t=f.compareUnits(this.scheduler.timeAxisViewModel.timeResolution.unit,"day")<0,n=f.formatContainsHourInfo(this.scheduler.displayDateFormat);return t&&n?"hour":"day"}set template(t){this._template=t}get template(){return this._template}};xt._$name="ClockTemplate";var bi=t=>class extends(t||R){static get $name(){return"TaskEditStm"}getStmCapture(){return{stmInitiallyAutoRecord:this.stmInitiallyAutoRecord,stmInitiallyDisabled:this.stmInitiallyDisabled,transferred:!1}}applyStmCapture(e){this.stmInitiallyAutoRecord=e.stmInitiallyAutoRecord,this.stmInitiallyDisabled=e.stmInitiallyDisabled}captureStm(e=!1){const i=this,r=i.project,s=r.getStm();i.hasStmCapture||(i.hasStmCapture=!0,i.stmInitiallyDisabled=s.disabled,i.stmInitiallyAutoRecord=s.autoRecord,i.stmInitiallyDisabled?(s.enable(),s.autoRecord=!1):(i.stmInitiallyAutoRecord&&(s.autoRecord=!1),s.isRecording&&s.stopTransaction()),e&&this.startStmTransaction())}startStmTransaction(){this.project.getStm().startTransaction()}commitStmTransaction(){const e=this,i=e.project.getStm();if(!e.hasStmCapture)throw new Error("Does not have STM capture, no transaction to commit");i.enabled&&(i.stopTransaction(),e.stmInitiallyDisabled&&i.resetQueue())}async rejectStmTransaction(){var e;const i=this.project.getStm(),{client:r}=this;if(!this.hasStmCapture)throw new Error("Does not have STM capture, no transaction to reject");i.enabled&&((e=i.transaction)!=null&&e.length?(r.suspendRefresh(),i.rejectTransaction(),await r.resumeRefresh(!0)):i.stopTransaction())}enableStm(){this.project.getStm().enable()}disableStm(){this.project.getStm().disable()}async freeStm(e=null){const i=this,r=i.project.getStm(),{stmInitiallyDisabled:s,stmInitiallyAutoRecord:a}=i;if(!i.hasStmCapture)return;let o;i.rejectingStmTransaction=!0,e===!0?o=i.commitStmTransaction():e===!1&&(o=i.rejectStmTransaction()),await o,r.isDestroying||(r.disabled=s,r.autoRecord=a),i.isDestroying||(i.rejectingStmTransaction=!0,i.hasStmCapture=!1)}},se=class extends jt{};se._$name="TimeSpanMenuBase";var U=class extends ee{buildItems(){return[...this.addNone?[{text:"L{None}",value:"NONE"}]:[],{value:"DAILY",text:"L{Daily}"},{value:"WEEKLY",text:"L{Weekly}"},{value:"MONTHLY",text:"L{Monthly}"},{value:"YEARLY",text:"L{Yearly}"}]}};b(U,"$name","RecurrenceFrequencyCombo"),b(U,"type","recurrencefrequencycombo"),b(U,"configurable",{editable:!1,displayField:"text",valueField:"value",localizeDisplayFields:!0,addNone:!1}),U.initClass(),U._$name="RecurrenceFrequencyCombo";var Te=class extends ee{static get $name(){return"RecurrenceDaysCombo"}static get type(){return"recurrencedayscombo"}static get defaultConfig(){const t=["SU","MO","TU","WE","TH","FR","SA"],n=t.join(",");return{allDaysValue:n,editable:!1,defaultValue:n,workingDaysValue:t.filter((e,i)=>!f.nonWorkingDays[i]).join(","),nonWorkingDaysValue:t.filter((e,i)=>f.nonWorkingDays[i]).join(","),splitCls:"b-recurrencedays-split",displayField:"text",valueField:"value"}}buildItems(){const t=this;return t._weekDays=null,t.weekDays.concat([{value:t.allDaysValue,text:t.L("L{day}"),cls:t.splitCls},{value:t.workingDaysValue,text:t.L("L{weekday}")},{value:t.nonWorkingDaysValue,text:t.L("L{weekend day}")}])}get weekDays(){const t=this;if(!t._weekDays){const n=f.weekStartDay,e=f.getDayNames().map((i,r)=>({text:i,value:J.encodeDay(r)}));t._weekDays=e.slice(n).concat(e.slice(0,n))}return t._weekDays}set value(t){const n=this;t&&Array.isArray(t)&&(t=t.join(",")),(!t||!n.store.findRecord("value",t))&&(t=n.defaultValue),super.value=t}get value(){let t=super.value;return t&&Array.isArray(t)&&(t=t.join(",")),t}};Te.initClass(),Te._$name="RecurrenceDaysCombo";var Me=class extends ce{static get $name(){return"RecurrenceDaysButtonGroup"}static get type(){return"recurrencedaysbuttongroup"}static get defaultConfig(){return{defaults:{cls:"b-raised",toggleable:!0}}}construct(t={}){const n=this;t.columns=7,t.items=n.buildItems(),super.construct(t)}updateItemText(t){const n=J.decodeDay(t.value)[0];t.text=f.getDayName(n).substring(0,3)}buildItems(){const t=this;if(!t.__items){const n=f.weekStartDay,e=f.getDayNames().map((i,r)=>({text:i.substring(0,3),value:J.encodeDay(r)}));t.__items=e.slice(n).concat(e.slice(0,n))}return t.__items}set value(t){t&&Array.isArray(t)&&(t=t.join(",")),super.value=t}get value(){let t=super.value;return t&&Array.isArray(t)&&(t=t.join(",")),t}onLocaleChange(){this.items.forEach(this.updateItemText,this)}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}get widgetClassList(){const t=super.widgetClassList;return t.push("b-field"),t}};Me.initClass(),Me._$name="RecurrenceDaysButtonGroup";var Fe=class extends ce{static get $name(){return"RecurrenceMonthDaysButtonGroup"}static get type(){return"recurrencemonthdaysbuttongroup"}static get defaultConfig(){return{defaults:{toggleable:!0,cls:"b-raised"}}}get minValue(){return 1}get maxValue(){return 31}construct(t={}){const n=this;t.columns=7,t.items=n.buildItems(),super.construct(t)}buildItems(){const t=this,n=[];for(let e=t.minValue;e<=t.maxValue;e++)n.push({text:e+"",value:e});return n}get widgetClassList(){const t=super.widgetClassList;return t.push("b-field"),t}};Fe.initClass(),Fe._$name="RecurrenceMonthDaysButtonGroup";var ke=class extends ce{static get $name(){return"RecurrenceMonthsButtonGroup"}static get type(){return"recurrencemonthsbuttongroup"}static get defaultConfig(){return{defaults:{toggleable:!0,cls:"b-raised"}}}construct(t={}){const n=this;t.columns=4,t.items=n.buildItems(),super.construct(t)}buildItems(){return f.getMonthNames().map((t,n)=>({text:t.substring(0,3),value:n+1}))}updateItemText(t){t.text=f.getMonthName(t.value-1).substring(0,3)}onLocaleChange(){this.items.forEach(this.updateItemText,this)}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}get widgetClassList(){const t=super.widgetClassList;return t.push("b-field"),t}};ke.initClass(),ke._$name="RecurrenceMonthsButtonGroup";var Pe=class extends ee{static get $name(){return"RecurrenceStopConditionCombo"}static get type(){return"recurrencestopconditioncombo"}static get defaultConfig(){return{editable:!1,placeholder:"Never",displayField:"text",valueField:"value"}}buildItems(){return[{value:"never",text:this.L("L{Never}")},{value:"count",text:this.L("L{After}")},{value:"date",text:this.L("L{On date}")}]}set value(t){t=t||"never",super.value=t}get value(){return super.value}get recurrence(){return this._recurrence}set recurrence(t){let n=null;t.endDate?n="date":t.count&&(n="count"),this._recurrence=t,this.value=n}};Pe.initClass(),Pe._$name="RecurrenceStopConditionCombo";var ze=class extends ee{static get $name(){return"RecurrencePositionsCombo"}static get type(){return"recurrencepositionscombo"}static get defaultConfig(){return{editable:!1,splitCls:"b-sch-recurrencepositions-split",displayField:"text",valueField:"value",defaultValue:1,maxPosition:5}}buildItems(){return this.buildDayNumbers().concat([{value:"-1",text:this.L("L{position-1}"),cls:this.splitCls}])}buildDayNumbers(){return G.populate(this.maxPosition,t=>({value:t+1,text:this.L(`position${t+1}`)}))}set value(t){const n=this;t&&Array.isArray(t)&&(t=t.join(",")),(!t||!n.store.findRecord("value",t))&&(t=n.defaultValue),super.value=t}get value(){const t=super.value;return t?`${t}`.split(",").map(n=>parseInt(n,10)):[]}};ze.initClass(),ze._$name="RecurrencePositionsCombo";var N=class extends Nt{setupWidgetConfig(t){return z.isMobile&&!("editable"in t)&&(t.editable=!1),super.setupWidgetConfig(...arguments)}updateRecord(t){super.updateRecord(t);const n=this,{frequencyField:e,daysButtonField:i,monthDaysButtonField:r,monthsButtonField:s,monthDaysRadioField:a,positionAndDayRadioField:o,stopRecurrenceField:l}=n.widgetMap;if(t){const c=t.timeSpan,u=c==null?void 0:c.startDate;u&&((!t.days||!t.days.length)&&(i.value=[J.encodeDay(u.getDay())]),(!t.monthDays||!t.monthDays.length)&&(r.value=u.getDate()),(!t.months||!t.months.length)&&(s.value=u.getMonth()+1)),t.days&&t.positions?(o.check(),n.isPainted||a.uncheck()):(a.check(),n.isPainted||o.uncheck()),l.recurrence=t}else e.value="NONE"}syncEventRecord(t){const n=this.getValues(e=>e.name in t&&!e.disabled);"endDate"in n||(n.endDate=null),"count"in n||(n.count=null),t.set(n)}toggleStopFields(){const t=this,{countField:n,endDateField:e}=t.widgetMap;switch(t.widgetMap.stopRecurrenceField.value){case"count":n.show(),n.enable(),e.hide(),e.disable();break;case"date":n.hide(),n.disable(),e.show(),e.enable();break;default:n.hide(),e.hide(),n.disable(),e.disable()}}onMonthDaysRadioFieldChange({checked:t}){const{monthDaysButtonField:n}=this.widgetMap;n.disabled=!t||!this.isWidgetAvailableForFrequency(n)}onPositionAndDayRadioFieldChange({checked:t}){const{daysCombo:n,positionsCombo:e}=this.widgetMap;n.disabled=e.disabled=!t||!this.isWidgetAvailableForFrequency(n)}onStopRecurrenceFieldChange(){this.toggleStopFields()}isWidgetAvailableForFrequency(t,n=this.widgetMap.frequencyField.value){return!t.forFrequency||t.forFrequency.includes(n)}onFrequencyFieldChange({value:t,oldValue:n,valid:e}){const i=this,r=i.queryAll(o=>"forFrequency"in o),{intervalField:s,stopRecurrenceField:a}=i.widgetMap;if(e&&t){for(let o=0;o<r.length;o++){const l=r[o];i.isWidgetAvailableForFrequency(l,t)?(l.show(),l.enable()):(l.hide(),l.disable())}s.hidden=a.hidden=t==="NONE",t!=="NONE"&&(s.hint=i.L(`L{RecurrenceEditor.${t}intervalUnit}`)),n==="NONE"&&s.value==null&&(s.value=1),i.toggleFieldsState()}}toggleFieldsState(){const t=this,{widgetMap:n}=t;t.onMonthDaysRadioFieldChange({checked:n.monthDaysRadioField.checked}),t.onPositionAndDayRadioFieldChange({checked:n.positionAndDayRadioField.checked}),t.onStopRecurrenceFieldChange()}updateLocalization(){const{countField:t,intervalField:n,frequencyField:e}=this.widgetMap;t.hint=this.L("L{RecurrenceEditor.time(s)}"),e.value&&e.value!=="NONE"&&(n.hint=this.L(`L{RecurrenceEditor.${e.value}intervalUnit}`)),super.updateLocalization()}};b(N,"$name","RecurrenceEditorPanel"),b(N,"type","recurrenceeditorpanel"),b(N,"configurable",{cls:"b-recurrenceeditor",record:!1,addNone:!1,items:{frequencyField:{type:"recurrencefrequencycombo",name:"frequency",label:"L{RecurrenceEditor.Frequency}",weight:10,onChange:"up.onFrequencyFieldChange",addNone:"up.addNone"},intervalField:{type:"numberfield",weight:15,name:"interval",label:"L{RecurrenceEditor.Every}",min:1,required:!0},daysButtonField:{type:"recurrencedaysbuttongroup",weight:20,name:"days",forFrequency:"WEEKLY"},monthDaysRadioField:{type:"checkbox",weight:30,toggleGroup:"radio",forFrequency:"MONTHLY",label:"L{RecurrenceEditor.Each}",checked:!0,onChange:"up.onMonthDaysRadioFieldChange"},monthDaysButtonField:{type:"recurrencemonthdaysbuttongroup",weight:40,name:"monthDays",forFrequency:"MONTHLY"},monthsButtonField:{type:"recurrencemonthsbuttongroup",weight:50,name:"months",forFrequency:"YEARLY"},positionAndDayRadioField:{type:"checkbox",weight:60,toggleGroup:"radio",forFrequency:"MONTHLY|YEARLY",label:"L{RecurrenceEditor.On the}",onChange:"up.onPositionAndDayRadioFieldChange"},positionsCombo:{type:"recurrencepositionscombo",weight:80,name:"positions",forFrequency:"MONTHLY|YEARLY"},daysCombo:{type:"recurrencedayscombo",weight:90,name:"days",forFrequency:"MONTHLY|YEARLY",flex:1},stopRecurrenceField:{type:"recurrencestopconditioncombo",weight:100,label:"L{RecurrenceEditor.End repeat}",onChange:"up.onStopRecurrenceFieldChange"},countField:{type:"numberfield",weight:110,name:"count",min:2,required:!0,disabled:!0,label:" "},endDateField:{type:"datefield",weight:120,name:"endDate",hidden:!0,disabled:!0,label:" ",required:!0}}}),N.initClass(),N._$name="RecurrenceEditorPanel";var Y=class extends Ot{};b(Y,"$name","EventColorField"),b(Y,"type","eventcolorfield"),b(Y,"configurable",{picker:{type:"eventcolorpicker"},name:"eventColor"}),Y.initClass(),Y._$name="EventColorField";var Q=class extends se{static get $name(){return"EventMenu"}static get configurable(){return{processItems:null,type:"event"}}static get pluginConfig(){const t=super.pluginConfig;return t.chain.push("populateEventMenu"),t}get resourceStore(){return this.client.isHorizontal?this.client.store:this.client.resourceStore}getDataFromEvent(t){var n;const e=super.getDataFromEvent(t),i=e.targetElement,{client:r}=this,s=r.resolveEventRecord(i),a=s&&((n=r.resolveResourceRecord(i)||this.resourceStore.last)==null?void 0:n.$original),o=s&&r.resolveAssignmentRecord(i);return Object.assign(e,{date:r.getDateFromXY([t.pageX,t.pageY],null,!1),eventElement:i,eventRecord:s,resourceRecord:a,assignmentRecord:o})}getTargetElementFromEvent({target:t}){return t.closest(this.client.eventSelector)||t}shouldShowMenu(t){return t.eventRecord}showContextMenuFor(t,{targetElement:n,event:e}={}){this.disabled||!n&&(n=this.getElementFromRecord(t),!n)||T.triggerMouseEvent(n,this.triggerEvent)}getElementFromRecord(t){return this.client.getElementsFromEventRecord(t)[0]}populateEventMenu({items:t,eventRecord:n,assignmentRecord:e}){const{client:i}=this;t.deleteEvent={disabled:n.readOnly||(e==null?void 0:e.readOnly),hidden:i.readOnly},t.unassignEvent={disabled:n.readOnly||(e==null?void 0:e.readOnly),hidden:i.readOnly||i.eventStore.usesSingleAssignment},i.showEventColorPickers||i.showTaskColorPickers?t.eventColor={disabled:n.readOnly,hidden:i.readOnly}:t.eventColor={hidden:!0}}populateItemsWithData({items:t,eventRecord:n}){var e;super.populateItemsWithData(...arguments);const{client:i}=this;(i.showEventColorPickers||i.isSchedulerPro&&i.showTaskColorPickers)&&((e=t.eventColor)!=null&&e.menu)&&We.merge(t.eventColor.menu.colorMenu,{value:n.eventColor,record:n})}changeItems(t){const{client:n}=this;return We.merge({deleteEvent:{text:"L{SchedulerBase.Delete event}",icon:"b-icon b-icon-trash",weight:200,onItem({menu:e,eventRecord:i}){var r;const s=(r=e.focusInEvent)==null?void 0:r.relatedTarget;s&&(s.focus(),n.navigator.activeItem=s),n.removeEvents(n.isEventSelected(i)?n.selectedEvents:[i])}},unassignEvent:{text:"L{SchedulerBase.Unassign event}",icon:"b-icon b-icon-unassign",weight:300,onItem({menu:e,eventRecord:i,resourceRecord:r}){var s;const a=(s=e.focusInEvent)==null?void 0:s.relatedTarget;a&&(a.focus(),n.navigator.activeItem=a),n.isEventSelected(i)?n.assignmentStore.remove(n.selectedAssignments):i.unassign(r)}},eventColor:{text:"L{SchedulerBase.color}",icon:"b-icon b-icon-palette",separator:!0,menu:{colorMenu:{type:"eventcolorpicker"}}}},t)}};Q.featureClass="",Q._$name="EventMenu",le.registerFeature(Q,!0,"Scheduler"),le.registerFeature(Q,!1,"ResourceHistogram");var ae=class extends se{static get $name(){return"ScheduleMenu"}static get defaultConfig(){return{type:"schedule",items:null,processItems:null}}static get pluginConfig(){const t=super.pluginConfig;return t.chain.push("populateScheduleMenu"),t}shouldShowMenu(t){const{client:n}=this,{targetElement:e,resourceRecord:i}=t,r=n.timeAxisSubGridElement.contains(e);return!e.closest(n.eventSelector)&&r&&!(i&&i.isSpecialRow)}getDataFromEvent(t){var n,e;if(T.isDOMEvent(t)){const{client:i}=this,r=(n=i.getCellDataFromEvent)==null?void 0:n.call(i,t),s=(e=i.getDateFromDomEvent)==null?void 0:e.call(i,t,"floor"),a=i.resolveResourceRecord(t)||i.isVertical&&i.resourceStore.last;return E.assign(super.getDataFromEvent(t),r,{date:s,resourceRecord:a})}return t}populateScheduleMenu({items:t,resourceRecord:n,date:e}){const{client:i}=this;!i.readOnly&&i.eventStore&&(t.addEvent={text:"L{SchedulerBase.Add event}",icon:"b-icon b-icon-add",disabled:!n||n.readOnly||!n.isWorkingTime(e),weight:100,onItem(){i.createEvent(e,n,i.getRowFor(n))}})}};ae.featureClass="",ae._$name="ScheduleMenu",le.registerFeature(ae,!0,"Scheduler");export{xe as AttachToProjectMixin_default,xt as ClockTemplate,Et as CurrentConfig_default,rt as Describable_default,Y as EventColorField,$ as EventColorPicker,Q as EventMenu,yt as EventNavigation_default,pt as EventSelection_default,Ee as HorizontalLayoutPack,De as HorizontalLayoutStack,ie as HorizontalRendering,V as HorizontalTimeAxis,we as PackMixin_default,te as PresetStore,dt as ProjectConsumer_default,Se as RecurrenceConfirmationPopup,Me as RecurrenceDaysButtonGroup,Te as RecurrenceDaysCombo,N as RecurrenceEditorPanel,U as RecurrenceFrequencyCombo,Fe as RecurrenceMonthDaysButtonGroup,ke as RecurrenceMonthsButtonGroup,ze as RecurrencePositionsCombo,Pe as RecurrenceStopConditionCombo,qe as RecurringEvents_default,B as ResourceHeader,ae as ScheduleMenu,H as SchedulerBase,at as SchedulerDomEvents_default,st as SchedulerDom_default,ct as SchedulerEventRendering_default,gt as SchedulerRegions_default,lt as SchedulerResourceRendering_default,mt as SchedulerScroll_default,vt as SchedulerState_default,ht as SchedulerStores_default,bi as TaskEditStm_default,fe as TimeAxis,ne as TimeAxisColumn,ye as TimeAxisSubGrid,ve as TimeAxisViewModel,se as TimeSpanMenuBase,O as TimelineBase,Ne as TimelineDateMapper_default,Ye as TimelineDomEvents_default,Ze as TimelineEventRendering_default,Ke as TimelineScroll_default,Qe as TimelineState_default,Ge as TimelineViewPresets_default,pe as TimelineZoomable_default,Ct as TransactionalFeatureMixin_default,Ae as VerticalRendering,re as VerticalTimeAxisColumn,_ as ViewPreset,W as pm};
//# sourceMappingURL=chunk-MS4QMERY.js.map
