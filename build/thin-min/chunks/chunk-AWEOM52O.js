/*!
 *
 * Bryntum TaskBoard 5.6.2
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
import{TimeField as D}from"./chunk-6ZLMCHE5.js";import{DateHelper as f,EventHelper as F,Field as _,Layout as x,ObjectHelper as $,Widget as I,__publicField as o}from"./chunk-MZVS5JQA.js";var b=new Date(2e3,0,1),c=class extends _{doDestroy(){this.dateField.destroy(),this.timeField.destroy(),super.doDestroy()}get focusElement(){return this.dateField.input}get innerElements(){return[this.dateField.element,this.timeField.element]}internalOnKeyEvent(){}updateRevertOnEscape(e){this.timeField.revertOnEscape=e,this.dateField.revertOnEscape=e}changeTimeField(e){const i=this,t=D.new({revertOnEscape:i.revertOnEscape,syncInvalid(...n){const a=i.updatingInvalid;D.prototype.syncInvalid.apply(this,n),i.timeField&&!a&&i.syncInvalid()}},e);return F.on({element:t.element,keydown:"onTimeFieldKeyDown",thisObj:i}),i.readOnly&&(t.readOnly=!0),t}updateTimeField(e){const i=this;e.ion({change({userAction:t,value:n}){if(t&&!i.$settingValue){const a=i.dateField.value;i._isUserAction=!0,i.value=a?f.copyTimeValues(new Date(a),n||b):null,i._isUserAction=!1}},thisObj:i})}changeDateField(e){const i=this,t=(e==null?void 0:e.type)||"datefield",n=I.resolveType(e.type||"datefield"),a=I.create($.assign({type:t,revertOnEscape:i.revertOnEscape,syncInvalid(...s){const h=i.updatingInvalid;n.prototype.syncInvalid.apply(this,s),i.dateField&&!h&&i.syncInvalid()}},e));return F.on({element:a.element,keydown:"onDateFieldKeyDown",thisObj:i}),i.readOnly&&(a.readOnly=!0),a.ion({keydown:({event:s})=>{var h;s.key==="Tab"&&!s.shiftKey&&((h=this.timeField)!=null&&h.isVisible)&&(s.stopPropagation(),s.cancelBubble=!0)}}),a}get childItems(){return[this.dateField,this.timeField]}updateDateField(e){const i=this;e.ion({change({userAction:t,value:n}){t&&!i.$isInternalChange&&(i._isUserAction=!0,i.timeField.value=n,i.value=n,i._isUserAction=!1)},thisObj:i})}updateWeekStartDay(e){this.dateField&&(this.dateField.weekStartDay=e)}changeWeekStartDay(e){var i,t;return typeof e=="number"?e:(t=(i=this.dateField)==null?void 0:i.weekStartDay)!=null?t:f.weekStartDay}syncInputFieldValue(e=this.isConfiguring){super.syncInputFieldValue(!0);const i=this,{dateField:t,timeField:n}=i,a=t.highlightExternalChange,s=n.highlightExternalChange;!e&&!i.highlightExternalChange&&(e=!0),i.$isInternalChange=!0,t.highlightExternalChange=!1,t.highlightExternalChange=a,e&&(n.highlightExternalChange=t.highlightExternalChange=!1),n.value=t.value=i.inputValue,t.highlightExternalChange=a,n.highlightExternalChange=s,i.$isInternalChange=!1,i.syncInvalid()}onTimeFieldKeyDown(e){const i=this;if(e.key==="Enter"||e.key==="Tab"){const t=i.dateField.value;i._isUserAction=!0,i.value=t?f.copyTimeValues(new Date(t),i.timeField.value||b):null,i._isUserAction=!1}}onDateFieldKeyDown(e){const i=this;e.key==="Tab"&&!e.shiftKey?(e.stopPropagation(),e.preventDefault(),i.timeField.focus()):e.key==="Enter"&&(i.value=i.dateField.value)}updateRequired(e,i){this.timeField.required=this.dateField.required=e}updateReadOnly(e,i){super.updateReadOnly(e,i),this.isConfiguring||(this.timeField.readOnly=this.dateField.readOnly=e)}onDisabled(e){this.timeField.disabled=this.dateField.disabled=e}focus(){this.dateField.focus()}hasChanged(e,i){return!f.isEqual(e,i)}get isValid(){return this.timeField.isValid&&this.dateField.isValid}setError(e,i){[this.dateField,this.timeField].forEach(t=>t.setError(e,i))}getErrors(){const e=[...this.dateField.getErrors()||[],...this.timeField.getErrors()||[]];return e.length?e:null}clearError(e,i){[this.dateField,this.timeField].forEach(t=>t.clearError(e,i))}updateInvalid(){this.updatingInvalid=!0,[this.dateField,this.timeField].forEach(e=>e.updateInvalid()),this.updatingInvalid=!1}};o(c,"$name","DateTimeField"),o(c,"type","datetimefield"),o(c,"alias","datetime"),o(c,"configurable",{timeField:{},dateField:{keepTime:!0,step:"1 d"},weekStartDay:null,inputTemplate:()=>"",ariaElement:"element"}),c.initClass(),c._$name="DateTimeField";var p=["b-slide-out-left","b-slide-out-right","b-slide-in-left","b-slide-in-right"],u=class extends x{onChildAdd(e){super.onChildAdd(e);const i=this,{activeItem:t,owner:n}=i,a=n.activeIndex!=null?n.activeIndex:i.activeIndex||0,s=n.items.indexOf(e),h=t!=null?e===t:s===a;e.ion({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",thisObj:i}),h?(i._activeIndex=s,i._activeItem=e,e.show()):(e.$isDeactivating=!0,e.hide(),e.$isDeactivating=!1)}onChildRemove(e){super.onChildRemove(e);const i=this;i._activeItem===e&&i.activateSiblingOf(e),i._activeIndex=i.owner.items.indexOf(i._activeItem),e.un({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",thisObj:i})}onBeforeChildShow({source:e}){if(!this.owner.isConfiguring&&!e.$isActivating)return this.activeItem=e,!1}onBeforeChildHide({source:e}){if(!this.owner.isConfiguring&&!e.$isDeactivating)return this.activateSiblingOf(e),!1}activateSiblingOf(e){const{owner:i}=this,t=i.items.slice(),n=t.indexOf(e);t.splice(n,1),this.activeIndex=Math.min(n,t.length-1)}setActiveItem(e,i=this.activeIndex,t){var n;const a=this,{owner:s}=a,{items:h}=s,w=e instanceof I,l=h[i],r=s.items[e=w?h.indexOf(e):parseInt(e,10)],E=(t==null?void 0:t.animation)!==!1,g=!(t!=null&&t.silent),d={prevActiveIndex:i,prevActiveItem:l};if(r&&!r.$isActivating&&r!==l){const v=l&&l.element,C=r&&r.element;if(a.animateDetacher){const m=a.animateDetacher.event;if(m.activeItem===r)return m.promise;a.animateDetacher(),m.prevActiveItem.element.classList.remove(...p),m.activeItem.element.classList.remove(...p),a.animateDetacher=null}if(d.activeIndex=e,d.activeItem=r,g&&s.trigger("beforeActiveItemChange",d)===!1)return null;const y=a._activeIndex!==d.activeIndex;y&&(a._activeIndex=d.activeIndex),g&&((n=s.onBeginActiveItemChange)==null||n.call(s,d)),y&&(a._activeIndex=d.prevActiveIndex),E&&v&&s.isVisible&&a.animateCardChange?d.promise=a.cardChangeAnimation=new Promise((m,A)=>{const O=l.monitorResize;l.monitorResize=!1,a.contentElement.style.overflowX="hidden",l._hidden=!0,r.$isActivating=!0,r.show(),r.$isActivating=!1,v.classList.add(e>i?"b-slide-out-left":"b-slide-out-right"),C.classList.add(e<i?"b-slide-in-left":"b-slide-in-right"),s.isAnimating=!0,a.animateDetacher=F.onTransitionEnd({mode:"animation",element:C,thisObj:l,handler(){if(s.isAnimating=a.cardChangeAnimation=!1,!a.animateDetacher){a.setActiveItem(e,i,t);return}a.animateDetacher=null,C.classList.remove(...p),v&&(v.classList.remove(...p),l.$isDeactivating=!0,l._hidden=!1,l.hide(),l.monitorResize=O,l.$isDeactivating=!1),a.contentElement.style.overflowX="",a.onActiveItemChange(d,m,!g)}}),a.animateDetacher.reject=A,a.animateDetacher.event=d}):(r.$isActivating=!0,r.show(),r.focus(),r.$isActivating=!1,l&&(l.$isDeactivating=!0,l.hide(),l.$isDeactivating=!1),a.onActiveItemChange(d,null,!g))}return d}onActiveItemChange(e,i,t){const n=this;n._activeItem=e.activeItem,n._activeIndex=e.activeIndex,!t&&n.owner.trigger("activeItemChange",e),n.owner.containsFocus&&e.activeItem.focus(),i==null||i(e)}renderChildren(){const{owner:e}=this;e.contentElement.classList.toggle(this.hideChildHeaderCls,e.suppressChildHeaders),super.renderChildren()}changeActiveIndex(e){const{owner:i}=this;return i.isConfiguring&&!i._items?e:Math.min(e,i.items.length-1)}updateActiveIndex(e,i){this.owner.isConfiguring||this.setActiveItem(e,i)}updateActiveItem(e){this.owner.isConfiguring||this.setActiveItem(e,this.activeIndex)}get isChangingCard(){return!!this.animateDetacher}};o(u,"$name","Card"),o(u,"type","card"),o(u,"configurable",{containerCls:"b-card-container",itemCls:"b-card-item",hideChildHeaderCls:"b-hide-child-headers",animateCardChange:!0,activeItem:null,activeIndex:null}),u.initClass(),u._$name="Card";export{c as DateTimeField};
//# sourceMappingURL=chunk-AWEOM52O.js.map
