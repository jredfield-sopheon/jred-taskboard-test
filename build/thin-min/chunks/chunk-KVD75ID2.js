/*!
 *
 * Bryntum TaskBoard 5.6.2
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
import{StateTrackingManager as $r}from"./chunk-4LHHPUQ6.js";import{GridRowModel as Lr}from"./chunk-4NB7OJYA.js";import{AjaxHelper as Nr,AjaxStore as ee,ArrayHelper as N,Base as B,BrowserHelper as Br,DateHelper as T,DayTime as Je,Delayable_default as Ge,DomClassList as Tt,Duration as se,Events_default as bt,FunctionHelper as Vr,InstancePlugin as Yr,LoadMaskable_default as Ur,Mask as qr,Model as k,ObjectHelper as O,Objects as te,Store as $,StringHelper as q,TimeZoneHelper as z,VersionHelper as ie,__publicField as _}from"./chunk-MZVS5JQA.js";var Xe={startDate:1,endDate:1,constraintDate:1,deadlineDate:1},At=r=>{var s;return s=class extends r{get timeZone(){return this.getData("timeZone")}set timeZone(t){this.setData("timeZone",t)}setLocalDate(t,n){const e=this;e.set(t,e.timeZone!=null?z.toTimeZone(n,e.timeZone):n,!0),e.setData(t,e[t])}getLocalDate(t){return this.timeZone!=null&&this[t]?z.fromTimeZone(this[t],this.timeZone):this[t]}applyChangeset(t){if(this.timeZone!=null)for(const n in Xe)t[n]&&(this.setLocalDate(n,new Date(t[n])),delete t[n]);return super.applyChangeset(...arguments)}getFieldPersistentValue(t){var n,e;if(this.timeZone!=null){const i=(e=(n=t==null?void 0:t.field)!=null?n:t==null?void 0:t.name)!=null?e:t;if(Xe[i])return this.getLocalDate(i)}return super.getFieldPersistentValue(t)}convertToTimeZone(t){const n=this,e={...n.meta.modified},i={...Xe};n.isTask&&!n.manuallyScheduled&&(delete i.startDate,delete i.endDate);for(const a in i)n[a]!=null?(i[a]=n[a],n.timeZone!=null&&(i[a]=n.getLocalDate(a),e[a]&&(e[a]=z.fromTimeZone(e[a],n.timeZone)))):delete i[a];n.timeZone=t;for(const a in i)n.setLocalDate(a,i[a],!1),i[a]=1,n.timeZone!=null&&e[a]&&(e[a]=z.toTimeZone(e[a],n.timeZone));n.clearChanges(!0,!0,i),O.isEmpty(e)||(n.meta.modified=e,n.stores.forEach(a=>a.modified.add(n)))}},_(s,"$name","TimeZonedDatesMixin"),_(s,"fields",[{name:"timeZone",persist:!1}]),s},K=class extends k.mixin(At){construct(r,...s){const t=this;if(r!=null&&r.fullDuration){const{magnitude:n,unit:e}=r.fullDuration;r.duration=n,r.unit=e,delete r.fullDuration}super.construct(r,...s),t.normalize(),t.startDateMS&&t.endDateMS&&t.startDateMS>t.endDateMS&&console.error(`startDate > endDate for ${t.constructor.$name} record with id: ${t.id}`)}internalCalculateStartDate(r,s,t){return T.add(r,-s,t)}internalCalculateEndDate(r,s,t){return T.add(r,s,t)}internalCalculateDuration(r,s,t){return T.as(t,T.diff(r,s,"h"),"h")}internalNormalize(r,s,t,n){const e=this,i=t!=null;r&&s&&!i?e.setData("duration",e.internalCalculateDuration(r,s,n)):r&&!s&&i?e.setData("endDate",e.internalCalculateEndDate(r,t,n)):!r&&s&&i&&e.setData("startDate",e.internalCalculateStartDate(s,t,n))}normalize(){this.internalNormalize(this.startDate,this.endDate,this.duration,this.durationUnit||this.constructor.defaultValues.durationUnit)}get eventStore(){var r;const s=this;return s.isOccurrence?s.recurringTimeSpan.eventStore:(s._eventStore||(s._eventStore=(r=s.stores)==null?void 0:r.find(t=>t.isEventStore)),s._eventStore)}updateInternalCls(r){this._cls?this._cls.value=r:this._cls=new Tt(r)}set internalCls(r){this.updateInternalCls(r),this.set("cls",this._cls.value)}get internalCls(){const{cls:r}=this;return r!=null&&r.isDomClassList?r:(this.updateInternalCls(r),this.setData("cls",this._cls.value),this._cls)}get cls(){return this._cls||(this._cls=new Tt(super.get("cls"))),this._cls}set cls(r){this.internalCls=r}get startDate(){return this.get("startDate")}set startDate(r){this.setStartDate(r)}get endDate(){return this.get("endDate")}set endDate(r){this.setEndDate(r)}get endingDate(){const r=this,{endDate:s,startDate:t}=r;return s||T.add(t,r.duration,r.durationUnit)}get duration(){return this.get("duration")}set duration(r){this.setDuration(r,this.durationUnit)}get durationUnit(){return this.get("durationUnit")}setDuration(r,s=this.durationUnit){r=parseFloat(r),this.set({duration:r,durationUnit:s,...this.updateDatesFromDuration(r,s)})}updateDatesFromDuration(r,s,t=this.startDate,n=this.endDate){const e={};return t?e.endDate=this.internalCalculateEndDate(t,r,s):n&&(e.startDate=this.internalCalculateStartDate(n,r,s)),e}getDurationInUnit(r,s){const t=this;return t.startDate&&t.endDate?T.getDurationInUnit(t.startDate,t.endDate,r,s):T.as(r,t.duration,t.durationUnit)}get fullDuration(){return new se({unit:this.durationUnit,magnitude:this.duration})}set fullDuration(r){typeof r=="string"&&(r=T.parseDuration(r,!0,this.durationUnit)),this.setDuration(r.magnitude,r.unit)}setStartDate(r,s=!0){const t=this,n={startDate:r};if(r){let e;if(s)e=t.duration!=null;else if(t.endDate){if(n.duration=t.internalCalculateDuration(r,t.endDate,t.durationUnit),n.duration<0)throw new Error("Negative duration")}else e=t.duration!=null;e&&(n.endDate=t.internalCalculateEndDate(r,t.duration,t.durationUnit))}else n.duration=null;t.set(n)}setEndDate(r,s=!1){const t=this,n={endDate:r};if(r){let e;if(s===!0)e=t.duration!=null;else if(t.startDate){if(n.duration=t.internalCalculateDuration(t.startDate,r,t.durationUnit),n.duration<0)throw new Error("Negative duration")}else e=this.duration!=null;e&&(n.startDate=t.internalCalculateStartDate(r,t.duration,t.durationUnit))}t.set(n)}setStartEndDate(r,s,t){if(r>s)throw new Error("Start date must be less or equal to end date");this.set({startDate:r,endDate:s},null,t)}get dates(){const r=[],s=T.startOf(this.startDate,"day"),t=this.endDate;for(let n=s;n<t;n=T.add(n,1,"day"))r.push(n);return r}get startDateMS(){var r;return(r=this.batching&&this.hasBatchedChange("startDate")?this.get("startDate"):this.startDate)==null?void 0:r.getTime()}get endDateMS(){var r;return(r=this.batching&&this.hasBatchedChange("endDate")?this.get("endDate"):this.endDate)==null?void 0:r.getTime()}get durationMS(){const{endDateMS:r,startDateMS:s}=this;return r&&s?r-s:T.asMilliseconds(this.duration||0,this.durationUnit)}get isMilestone(){return this.duration===0}inSetNormalize(r){if(typeof r!="string"){let{startDate:s,endDate:t,duration:n,durationUnit:e=this.durationUnit}=r;typeof s=="string"&&(s=this.getFieldDefinition("startDate").convert(s)),typeof t=="string"&&(t=this.getFieldDefinition("endDate").convert(t)),"duration"in r?(s&&!t&&(t=this.internalCalculateEndDate(s,n,e)),!s&&t&&(s=this.internalCalculateStartDate(t,n,e))):s&&t&&(n=this.internalCalculateDuration(s,t,e));const i=Object.isFrozen(r)?O.clone(r):r;return s&&(i.startDate=s),t&&(i.endDate=t),n!=null&&(i.duration=n),i}}fieldToKeys(r,s){var t,n;const e=super.fieldToKeys(r,s);if(e.fullDuration){const{magnitude:i,unit:a}=e.fullDuration;e.duration=i,e.durationUnit=a}return!this.isEventModel&&!this.isTaskModel&&("duration"in e||e.durationUnit)&&!(e.startDate&&e.endDate)&&Object.assign(e,this.updateDatesFromDuration((t=e.duration)!=null?t:this.duration,(n=e.durationUnit)!=null?n:this.durationUnit,e.startDate,e.endDate)),e}inSet(r,s,t,n,e,i,a){var o;const l=this;e||(r=l.inSetNormalize(r)||r);const u=super.inSet(r,s,t,n,e,i,a);if(!((o=l.project)!=null&&o.isWritingData)&&r.startDate&&r.endDate){let c;r.startDate instanceof Date&&r.endDate instanceof Date?c=r.startDate>r.endDate:l.fieldMap.startDate.convert(r.startDate)>l.fieldMap.endDate.convert(r.endDate)&&(c=!0),c&&console.error(`startDate > endDate for ${l.constructor.$name} record with id: ${l.id}`)}return u}applyValue(r,s,t,n,e){s==="cls"&&this.updateInternalCls(t),super.applyValue(r,s,t,n,e)}forEachDate(r,s){return this.dates.forEach(r.bind(s))}get isScheduled(){const{startDateMS:r,endDateMS:s}=this;return s-r>=0}get isValid(){const{startDate:r,endDate:s}=this;return!r||!s||s-r>=0}shift(r,s=this.durationUnit){if(typeof r=="string"){const t=r;r=s,s=t}return this.setStartDate(T.add(this.startDate,r,s,!0),!0)}get wbsCode(){return this._wbsCode||this.indexPath.join(".")}set wbsCode(r){this._wbsCode=r}fullCopy(){return this.copy.apply(this,arguments)}intersects(r){return this.intersectsRange(r.startDate,r.endDate)}intersectsRange(r,s){const t=this.startDate,n=this.endDate;return t&&n&&T.intersectSpans(t,n,r,s)}split(r=.5){const s=this,t=s.copy(),{fullDuration:n,eventStore:e,assignmentStore:i}=s,a=new se(n),o=new se(n);let l,u;return typeof r=="string"?(l=new se(r),l.unit===a.unit?o.magnitude-=l.magnitude:(o.magnitude=T.as(l.unit,a)-l.magnitude,o.unit=l.unit,u=!0)):(l=new se(r>1?r:s.duration*r,s.durationUnit),o.magnitude-=l.magnitude),t.startDate=T.add(s.startDate,l.magnitude,l.unit),u?(t.fullDuration=o,s.fullDuration=l):(t.duration=o.magnitude,s.duration=l.magnitude),e&&(e.add(t),i&&!e.usesSingleAssignment&&i.add(s.assignments.map(c=>{const d=Object.assign({},c.data,{eventId:t.id,event:null,resource:null});return delete d.id,d}))),t}toICSString(r={}){if(!this.isScheduled)return"";const{startDate:s,endDate:t}=this,n=r.DTSTAMP||T.format(new Date,"uu");delete r.DTSTAMP;let e={};this.allDay?e={"DTSTART;VALUE=DATE":T.format(s,"u"),"DTEND;VALUE=DATE":T.format(t,"u")}:e={DTSTART:T.format(s,"uu"),DTEND:T.format(t,"uu")};const i=ie.scheduler&&ie.getVersion("scheduler")||ie.calendar&&ie.getVersion("calendar")||"",a={BEGIN:"VCALENDAR",VERSION:"2.0",CALSCALE:"GREGORIAN",PRODID:`-//Bryntum AB//Bryntum Scheduler ${i} //EN`,END:"VCALENDAR"},o={BEGIN:"VEVENT",UID:this.id+"@bryntum.com",CLASS:"PUBLIC",SUMMARY:this.name,DTSTAMP:n,...e,...this.recurrenceRule?{RRULE:this.recurrenceRule}:{},...r,END:"VEVENT"},l=Object.keys(a).map(c=>`${c}:${a[c]}`),u=Object.keys(o).map(c=>`${c}:${o[c]}`);return l.splice(l.length-1,0,...u),l.join(`
`)}exportToICS(r){if(this.isScheduled){const s=new Blob([this.toICSString(r)],{type:"text/calendar"});Br.downloadBlob(s,(this.name||"Event")+".ics")}}isEditable(r){return this.getFieldDefinition(r)?!0:void 0}isFieldModified(r){return r==="fullDuration"?super.isFieldModified("duration")||super.isFieldModified("durationUnit"):super.isFieldModified(r)}};_(K,"$name","TimeSpan"),_(K,"fields",[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number",allowNull:!0,internal:!0},{type:"durationunit",name:"durationUnit",defaultValue:"d",internal:!0},{name:"fullDuration",persist:!1,column:{type:"duration"},useProp:!0},{name:"cls",defaultValue:"",internal:!0},{name:"iconCls",internal:!0},{name:"style",type:"object",internal:!0},{name:"name",type:"string",defaultValue:""}]),K._$name="TimeSpan";var wt=r=>class extends(r||B){static get $name(){return"ResourceStoreMixin"}get isResourceStore(){return!0}static get defaultConfig(){return{loadPriority:200,syncPriority:100,storeId:"resources",autoTree:!0}}construct(t){if(super.construct(t),!this.modelClass.isResourceModel)throw new Error("Model for ResourceStore must subclass ResourceModel")}removeAll(){const t=super.removeAll(...arguments);return t&&this.assignmentStore.removeAll(),t}onRecordIdChange({record:t,oldValue:n,value:e}){super.onRecordIdChange({record:t,oldValue:n,value:e}),t.isFieldModified("id")&&(this.isChangingId=!0,t.updateAssignmentResourceIds(),this.isChangingId=!1)}get allResourceRecords(){return this._allResourceRecords||(this._allResourceRecords=this.getAllDataRecords())}getAvailableResources({startDate:t,endDate:n}){return this.query(e=>this.eventStore.isDateRangeAvailable(t,n,null,e))}},W=r=>class extends(r||B){static get $name(){return"PartOfProject"}},Pt=r=>class extends r{static get $name(){return"ResourceModelMixin"}static get isResourceModel(){return!0}static get fields(){return[{name:"name",type:"string",persist:!0},"eventColor","eventStyle","imageUrl","image","resourceMargin",{name:"barMargin",type:"number"},"eventLayout"]}updateAssignmentResourceIds(){this.assigned.forEach(t=>{t.resourceId=this.id})}syncId(t){super.syncId(t),this.updateAssignmentResourceIds()}get events(){return this.assignments.reduce((t,n)=>(n.event&&t.push(n.event),t),[])}get assignments(){return this.assigned?[...this.assigned]:[]}set assignments(t){this.assignmentStore.remove(this.assignments),t.forEach(n=>{n.resource=this})}getEvents(){return ie.deprecate("scheduler","6.0.0","getEvents() is deprecated, use the events property instead"),this.events}get isPersistable(){return super.isPersistable&&(!this.parent||this.parent.isPersistable)}unassignAll(){this.assignments&&this.assignmentStore.remove(this.assignments)}get initials(){const{name:t=""}=this;if(!t)return"";const n=t.split(" "),e=n[0][0],i=n.length>1?n[n.length-1][0]:"";return e+i}isWorkingTime(t){var n,e;const i=this.effectiveCalendar||((n=this.project)==null?void 0:n.calendar);return!i||((e=i.isWorkingTime)==null?void 0:e.call(i,t))}};function _t(r){const s=[],t=[];let n;const e=function*(){for(n||(n=r[Symbol.iterator]());s.length&&(yield*s,s.length=0),!!n;){const{value:a,done:o}=n.next();if(o){n=null,r=null;break}t.push(a),yield a}},i=function*(){for(n||(n=r[Symbol.iterator]());t.length&&(yield*t,t.length=0),!!n;){const{value:a,done:o}=n.next();if(o){n=null,r=null;break}s.push(a),yield a}};return[e(),i()]}function*zr(r,s){if(s<0)throw new Error("Batch size needs to a natural number");s=s|0;const t=[];for(const n of r)t.length===s&&(yield t,t.length=0),t.push(n);t.length>0&&(yield t)}function*Wr(r,s){let t=0;for(const n of r)s(n,t++)&&(yield n)}function*Zr(r,s){let t=0;for(const n of r)++t>s&&(yield n)}function Hr(r,s){let t=0;for(const n of r)if(!s(n,t++))return!1;return!0}function Kr(r,s){let t=0;for(const n of r)if(s(n,t++))return!0;return!1}function*jt(r,s){let t=0;for(const n of r)yield s(n,t++)}function Jr(r,s,t){let n=0,e=t;for(const i of r)e=s(e,i,n++);return e}function*Ot(r){const s=new Set;for(const t of r)s.has(t)||(s.add(t),yield t)}function*Gr(r,s){const t=new Set;for(const n of r){const e=s(n);t.has(e)||(t.add(e),yield n)}}function*Xr(r,s){let t=0;for(const n of r)if(s(n,t++))yield n;else return}function*Qr(...r){for(let s=0;s<r.length;s++)yield*r[s]}function*Ft(r){for(const s of r)yield*s}var Qe=class Ze{constructor(s){if(this.iterable=void 0,!s)throw new Error("Require an iterable instance for chaining");this.iterable=s}derive(s){return this.iterable=void 0,new Ze(s)}copy(){const[s,t]=_t(this.iterable);return this.iterable=t,new Ze(s)}split(){const[s,t]=_t(this.iterable);return[new Ze(s),this.derive(t)]}inBatchesBySize(s){return this.derive(zr(this.iterable,s))}filter(s){return this.derive(Wr(this.iterable,s))}drop(s){return this.derive(Zr(this.iterable,s))}map(s){return this.derive(jt(this.iterable,s))}reduce(s,t){return Jr(this,s,t)}concat(){return this.derive(Ft(this.iterable))}uniqueOnly(){return this.derive(Ot(this.iterable))}uniqueOnlyBy(s){return this.derive(Gr(this.iterable,s))}every(s){return Hr(this,s)}some(s){return Kr(this,s)}takeWhile(s){return this.derive(Xr(this.iterable,s))}*[Symbol.iterator](){let s=this.iterable;if(!s)throw new Error("Chained iterator already exhausted or used to derive the new one");this.iterable=void 0,yield*s,s=void 0}toArray(){return Array.from(this)}sort(s){return Array.from(this).sort(s)}toSet(){return new Set(this)}toMap(){return new Map(this)}flush(){for(const s of this);}memoize(){return new kt(this)}},en=r=>new Qe(r),J=en,kt=class extends Qe{constructor(){super(...arguments),this.elements=[],this.$iterator=void 0}set iterable(r){this.$iterable=r}get iterable(){return this}derive(r){return new Qe(r)}*[Symbol.iterator](){const r=this.elements;if(this.$iterable){this.$iterator||(this.$iterator=this.$iterable[Symbol.iterator]());let s=this.$iterator,t=r.length;for(t>0&&(yield*r);;){if(r.length>t){for(let i=t;i<r.length;i++)yield r[i];t=r.length}if(!s)break;const{value:n,done:e}=s.next();e?(s=this.$iterator=null,this.$iterable=null):(r.push(n),t++,yield n)}}else yield*r}},tn=r=>new kt(r),rn=tn,Ae=Symbol("MixinIdentity"),he=Symbol("MixinStateProperty"),nn=class{constructor(){this.baseEl=void 0,this.sourceEl=void 0,this.$elementsByTopoLevel=void 0,this.$topoLevels=void 0,this.linearizedByTopoLevelsSource=rn(this.linearizedByTopoLevels())}static new(r){const s=new this;return r&&Object.assign(s,r),s}get topoLevels(){return this.$topoLevels!==void 0?this.$topoLevels:this.$topoLevels=this.buildTopoLevels()}buildTopoLevels(){return Array.from(this.elementsByTopoLevel.keys()).sort((r,s)=>r-s)}get elementsByTopoLevel(){return this.$elementsByTopoLevel!==void 0?this.$elementsByTopoLevel:this.$elementsByTopoLevel=this.buildElementsByTopoLevel()}getOrCreateLevel(r,s){let t=r.get(s);return t||(t=[],r.set(s,t)),t}buildElementsByTopoLevel(){let r=0;const s=this.baseEl?J(this.baseEl.walkDepthState.elementsByTopoLevel.values()).concat().toSet():new Set,t=J(this.sourceEl.requirements).map(n=>n.walkDepthState.elementsByTopoLevel).concat().reduce((n,[e,i])=>(e>r&&(r=e),this.getOrCreateLevel(n,e).push(i),n),new Map);return this.getOrCreateLevel(t,r+1).push([this.sourceEl]),J(t).map(([n,e])=>[n,J(e).concat().uniqueOnly().filter(i=>!s.has(i)).sort((i,a)=>i.id-a.id)]).toMap()}*linearizedByTopoLevels(){yield*J(this.topoLevels).map(r=>this.elementsByTopoLevel.get(r)).concat()}},$t=1,sn=r=>class extends r{},we=class{},et=class{constructor(){this.id=$t++,this.requirements=[],this.baseClass=we,this.identitySymbol=void 0,this.mixinLambda=sn,this.walkDepthState=void 0,this.$minimalClass=void 0,this.name=""}static new(r){const s=new this;r&&Object.assign(s,r),s.walkDepthState=nn.new({sourceEl:s,baseEl:on(s.baseClass)});const t=s.mixinLambda,n=s.identitySymbol=Symbol(t.name),e=Object.assign(function(i){const a=t(i);return a.prototype[n]=!0,a},{[Ae]:n,[he]:s});return Object.defineProperty(e,Symbol.hasInstance,{value:Nt}),s.mixinLambda=e,s}get minimalClass(){return this.$minimalClass!==void 0?this.$minimalClass:this.$minimalClass=this.buildMinimalClass()}getBaseClassMixinId(r){const s=this.constructor,t=s.baseClassesIds.get(r);if(t!==void 0)return t;const n=$t++;return s.baseClassesIds.set(r,n),n}buildMinimalClass(){const r=this.constructor;let s=this.baseClass;const t=this.walkDepthState.linearizedByTopoLevelsSource.reduce((e,i)=>{const{cls:a,hash:o}=e,l=o+String.fromCharCode(i.id);let u=r.minimalClassesByLinearHash.get(l);return u||(u=i.mixinLambda(a),i.name=u.name,r.minimalClassesByLinearHash.set(l,u)),e.cls=u,e.hash=l,e},{cls:s,hash:String.fromCharCode(this.getBaseClassMixinId(s))}).cls,n=Object.assign(t,{[Ae]:this.identitySymbol,[he]:this,mix:this.mixinLambda,derive:e=>P([n,e],i=>class extends i{}),$:this,toString:this.toString.bind(this)});return Object.defineProperty(n,Symbol.hasInstance,{value:Nt}),n}toString(){return this.walkDepthState.linearizedByTopoLevelsSource.reduce((r,s)=>`${s.name}(${r})`,this.baseClass.name)}};et.minimalClassesByLinearHash=new Map,et.baseClassesIds=new Map;var an=r=>Object.getPrototypeOf(r.prototype).constructor.hasOwnProperty(he),on=r=>Object.getPrototypeOf(r.prototype).constructor[he],Lt=(r,s)=>{let t;if(r.length>0){const i=r[r.length-1];!an(i)&&i!==we&&(t=i)}const n=[];return r.forEach((i,a)=>{const o=i[he];if(o!==void 0){const l=o.baseClass;if(l!==we)if(t){if(t!==l){const u=l.prototype.isPrototypeOf(t.prototype),c=t.prototype.isPrototypeOf(l.prototype);if(!u&&!c)throw new Error("Base class mismatch");t=c?l:t}}else t=l;n.push(o)}else if(a!==r.length-1)throw new Error("Base class should be provided as the last element of the requirements array")}),et.new({requirements:n,mixinLambda:s,baseClass:t||we}).minimalClass},Nt=function(r){return!!(r&&r[this[Ae]])},Y=(r,s)=>!!(r&&r[s[Ae]]),P=Lt,ln=Lt,un=class{initialize(r){r&&Object.assign(this,r)}static new(r){const s=new this;return s.initialize(r),s}},Pe=class extends P([],r=>{const s=r.prototype;class t extends r{async commitAsync(){return this.project.commitAsync()}set project(e){this.$project=e}get project(){return this.$project}calculateProject(){throw new Error("Implement me")}setProject(e){return this.project=e}getProject(){return this.project?this.project:this.setProject(this.calculateProject())}getAssignmentStore(){const e=this.getProject();return e==null?void 0:e.assignmentStore}getDependencyStore(){const e=this.getProject();return e==null?void 0:e.dependencyStore}getEventStore(){const e=this.getProject();return e==null?void 0:e.eventStore}getResourceStore(){const e=this.getProject();return e==null?void 0:e.resourceStore}getCalendarManagerStore(){const e=this.getProject();return e==null?void 0:e.calendarManagerStore}}return t}){},tt=class extends P([Pe],r=>{const s=r.prototype;class t extends r{get eventStore(){var e;return(e=this.project)==null?void 0:e.eventStore}get resourceStore(){var e;return(e=this.project)==null?void 0:e.resourceStore}get assignmentStore(){var e;return(e=this.project)==null?void 0:e.assignmentStore}get dependencyStore(){var e;return(e=this.project)==null?void 0:e.dependencyStore}get calendarManagerStore(){var e;return(e=this.project)==null?void 0:e.calendarManagerStore}getEventById(e){var i;return(i=this.eventStore)==null?void 0:i.getById(e)}getDependencyById(e){var i;return(i=this.dependencyStore)==null?void 0:i.getById(e)}getResourceById(e){var i;return(i=this.resourceStore)==null?void 0:i.getById(e)}getAssignmentById(e){var i;return(i=this.assignmentStore)==null?void 0:i.getById(e)}getCalendarById(e){var i;return(i=this.calendarManagerStore)==null?void 0:i.getById(e)}}return t}){},U=class extends P([Pe,$],r=>{const s=r.prototype;class t extends r{constructor(){super(...arguments),this.isLoadingData=!1,this.disableHasLoadedDataToCommitFlag=!1}static get $name(){return"AbstractPartOfProjectStoreMixin"}construct(e={}){return e.asyncEvents={add:!0,remove:!0,removeAll:!0,change:!0,refresh:!0,replace:!0,move:!0,update:!0},s.construct.call(this,e)}trigger(e,i){const a=this,{asyncEvents:o,project:l}=a,u=o==null?void 0:o[e];return u&&(u===!0||u[i.action])?(s.trigger.call(a,`${e}PreCommit`,{...i}),!l||l.isEngineReady()&&!l.isWritingData?s.trigger.call(a,e,i):!a.eventsSuspended&&l&&(l.dataReadyDetacher||(l.queuedDataReadyEvents=[],l.dataReadyDetacher=l.ion({dataReady(){this.queuedDataReadyEvents.forEach(([d,p,m,f])=>{d.trigger.call(p,m,f)}),l.queuedDataReadyEvents=null,l.dataReadyDetacher(),l.dataReadyDetacher=null},once:!0})),l.queuedDataReadyEvents.push([s,a,e,i])),!0):s.trigger.call(a,e,i)}calculateProject(){return this.project}setStoreData(e){var i;this.project&&!(this.syncDataOnLoad||this.disableHasLoadedDataToCommitFlag)&&(this.project.hasLoadedDataToCommit=!0),this.isLoadingData=!0,s.setStoreData.call(this,e),this.isLoadingData=!1,(i=this.project)==null||i.trigger("storeRefresh",{store:this})}async doAutoCommit(){this.suspendCount<=0&&this.project&&!this.project.isEngineReady()&&await this.project.commitAsync(),s.doAutoCommit.call(this)}async addAsync(e,i){const a=this.add(e,i);return await this.project.commitAsync(),a}async insertAsync(e,i,a){const o=this.insert(e,i,a);return await this.project.commitAsync(),o}async loadDataAsync(e){this.data=e,await this.project.commitAsync()}performFilter(){var e;return this.project&&(this.isLoadingData||(e=this.rootNode)!=null&&e.isLoading)&&this.project.commitAsync().then(()=>this.filter()),super.performFilter(...arguments)}}return t}){},ge=class extends P([Pe,k],r=>{const s=r.prototype;class t extends r{joinStore(e){let i=null;if(Y(e,U)){const a=e.getProject();a&&!this.getProject()&&(this.setProject(a),i=a)}s.joinStore.call(this,e),i&&!i.isRepopulatingStores&&this.joinProject()}unjoinStore(e,i=!1){s.unjoinStore.call(this,e,i);const{project:a}=this,o=Y(e,U)&&!e.isFillingFromMaster&&a===(e.isChained&&e.project?e.masterStore.project:e.project);a&&!a.isDestroying&&!a.isRepopulatingStores&&o&&(this.leaveProject(i),this.setProject(null)),o&&(this.graph=null)}joinProject(){}leaveProject(e=!1){}calculateProject(){const e=this.stores.find(i=>Y(i,U)&&!!i.getProject());return e==null?void 0:e.getProject()}async setAsync(e,i,a){var o;const l=this.set(e,i,a);return await((o=this.project)==null?void 0:o.commitAsync()),l}async getAsync(e){var i;return await((i=this.project)==null?void 0:i.commitAsync()),this.get(e)}get isStmRestoring(){const e=this.getProject();return(e==null?void 0:e.isRestoringData)||(e==null?void 0:e.stm.isRestoring)||!1}}return t}){},fe=class extends P([ge,tt,k],r=>{const s=r.prototype;class t extends r{constructor(){super(...arguments),this.$isCalculating=!1,this.$changed={},this.$beforeChange={}}get isInActiveTransaction(){return!0}joinProject(){this.invalidate()}leaveProject(e=!1){var i;s.leaveProject.call(this,e),(i=this.project)==null||i.bufferedCommitAsync()}invalidate(){var e;(e=this.project)==null||e.invalidate(this)}getCurrentOrProposed(e){var i;return e in this.$changed&&this.$changed[e]!==!0?this.$changed[e]:(i=this.get(e))!=null?i:null}hasCurrentOrProposed(e){return e in this.$changed&&this.$changed[e]!=!0||this.get(e)!=null}propose(e){var i;if(this.project||(i=this.recurringTimeSpan)!=null&&i.project){const a=Object.keys(e);for(let o=0;o<a.length;o++){const l=a[o];this.$changed[l]=e[l]}this.invalidate()}else this.set(e)}setChanged(e,i,a=!0,o=!1){const l=this;l.$changed[e]=i,o&&(e in l.$beforeChange||(l.$beforeChange[e]=l.get(e)),l.setData(e,i)),a&&l.invalidate()}calculateInvalidated(){}finalizeInvalidated(e=!1){const i=this;i.$isCalculating=!0,e?i.setData(i.$changed):(i.setData(i.$beforeChange),i.set(i.$changed)),i.$changed={},i.$beforeChange={},i.$isCalculating=!1}}return t}){},me=class extends P([fe],r=>{const s=r.prototype;class t extends r{get assigned(){var e;return(e=this.project)==null?void 0:e.assignmentStore.getResourcesAssignments(this)}joinProject(){var e;this.resourceStore&&!this.resourceStore.isLoadingData&&((e=this.assignmentStore)==null||e.query(i=>i.get("resource")===this.id).forEach(i=>i.setChanged("resource",this))),s.joinProject.call(this)}leaveProject(e=!1){var i;if(this.assigned&&!e&&!((i=this.resourceStore)!=null&&i.isLoadingData)){const a=this.resourceStore;this.assigned.forEach(o=>a.assignmentsForRemoval.add(o))}s.leaveProject.call(this)}applyValue(e,i,a,o,l){(l==null?void 0:l.name)==="id"&&this.assigned.forEach(u=>{u.set("resourceId",a)}),s.applyValue.call(this,e,i,a,o,l)}}return t}){},cn=me,ae=class extends Pt(W(cn.derive(Lr))){};_(ae,"$name","ResourceModel"),ae.exposeProperties(),ae._$name="ResourceModel";var dn=r=>class extends r{static get $name(){return"PartOfBaseProject"}get assignmentStore(){return this.project.assignmentStore}get calendarManagerStore(){return this.project.calendarManagerStore}get dependencyStore(){return this.project.dependencyStore}get eventStore(){return this.project.eventStore}get resourceStore(){return this.project.resourceStore}},pe=class extends P([U,tt,$],r=>{const s=r.prototype;class t extends r{setProject(e){const i=s.setProject.call(this,e);return e&&this.joinProject(e),i}joinProject(e){}onCommitAsync(){}}return t}){},hn={splice:1,clear:1},Bt=class extends P([U],r=>{const s=r.prototype;class t extends r{constructor(){super(...arguments),this.assignmentsForRemoval=new Set}onDataChange(e){var i;const a=hn[e.action];super.onDataChange(e),a&&((i=e.removed)!=null&&i.length)&&this.afterResourceRemoval()}remove(e,i){const a=s.remove.call(this,e,i);return this.afterResourceRemoval(),a}removeAll(e){const i=s.removeAll.call(this,e);return this.afterResourceRemoval(),i}afterResourceRemoval(){const e=this.getAssignmentStore();if(e&&!e.allAssignmentsForRemoval){const i=[...this.assignmentsForRemoval].filter(a=>!e.assignmentsForRemoval.has(a));i.length>0&&e.remove(i)}this.assignmentsForRemoval.clear()}processRecord(e,i=!1){const a=this.getById(e.id);if(a&&a!==e)for(const l of a.assigned||[])l.resource=e;return e}}return t}){},Vt=class extends P([Bt,pe],r=>{const s=r.prototype;class t extends r{static get defaultConfig(){return{modelClass:me}}joinProject(){var e;(e=this.assignmentStore)==null||e.linkAssignments(this,"resource")}afterLoadData(){var e;(e=this.assignmentStore)==null||e.linkAssignments(this,"resource")}clear(e){var i;s.clear.call(this,e),(i=this.assignmentStore)==null||i.unlinkAssignments("resource")}}return t}){},gn=W(Vt.derive(ee)),_e=class extends wt(gn){static get defaultConfig(){return{modelClass:ae}}};_e._$name="ResourceStore";var Yt=r=>{var s;return s=class extends(r||B){static get defaultConfig(){return{loadPriority:100,syncPriority:200,storeId:"events",removeUnassignedEvent:!0,singleAssignment:null}}construct(t){if(super.construct(t),this.autoTree=!0,this.singleAssignment&&(this.usesSingleAssignment=!0),!this.modelClass.isEventModel)throw new Error("The model for the EventStore must subclass EventModel")}set filtersFunction(t){super.filtersFunction=t}get filtersFunction(){const t=super.filtersFunction;return t&&t!==Vr.returnTrue?n=>n.isCreating||t(n):t}getEventCounts(t){const n=this,{filtersFunction:e,added:i}=n,a=n.getEvents({...t,storeFilterFn:n.isFiltered?n.reapplyFilterOnAdd?e:o=>i.includes(o)?n.indexOf(o)>-1:e(o):null,dateMap:t.dateMap||!0});return a.forEach((o,l)=>a.set(l,o.length)),a}forEachScheduledEvent(t,n=this){this.forEach(e=>{const{startDate:i,endDate:a}=e;if(i&&a)return t.call(n,e,i,a)})}getTotalTimeSpan(){let t=new Date(9999,0,1),n=new Date(0);return this.forEach(e=>{e.startDate&&(t=T.min(e.startDate,t)),e.endDate&&(n=T.max(e.endDate,n))}),t=t<new Date(9999,0,1)?t:null,n=n>new Date(0)?n:null,this.lastTotalTimeSpan={startDate:t||null,endDate:n||t||null}}isEventPersistable(t){return t.isPersistable}isDateRangeAvailable(t,n,e,i){if(i.data.generatedParent)return!1;const a=new Set(this.getEventsForResource(i));if(e!=null&&e.isAssignment&&e.event.resources.forEach(c=>{c.id!==e.resourceId&&this.getEventsForResource(c).forEach(d=>a.add(d))}),e){const l=e.isAssignment?e.event:e;a.delete(l)}const o=Array.from(a);return t.getTime()===n.getTime()?!o.some(l=>l.isScheduled&&(l.duration===0?l.startDate.getTime()===t.getTime():T.intersectSpans(t,n,l.startDate,l.endDate))):!o.some(l=>l.isScheduled&&T.intersectSpans(t,n,l.startDate,l.endDate))}filterEventsForResource(t,n,e=this){return t.getEvents(this).filter(n.bind(e))}getResourcesForEvent(t){return t.isOccurrence&&(t=t.recurringTimeSpan),this.assignmentStore.getResourcesForEvent(t)}getEventsForResource(t){return this.assignmentStore.getEventsForResource(t)}getAssignmentsForEvent(t){return this.assignmentStore.getAssignmentsForEvent(t)||[]}getAssignmentsForResource(t){return this.assignmentStore.getAssignmentsForResource(t)||[]}assignEventToResource(t,n,e=!1){return this.assignmentStore.assignEventToResource(t,n,void 0,e)}unassignEventFromResource(t,n){this.assignmentStore.unassignEventFromResource(t,n)}reassignEventFromResourceToResource(t,n,e){const i=this,a=k.asId(e),o=i.assignmentStore.getAssignmentForEventAndResource(t,n);o?o.resourceId=a:i.assignmentStore.assignEventToResource(t,e)}isEventAssignedToResource(t,n){return this.assignmentStore.isEventAssignedToResource(t,n)}removeAssignmentsForEvent(t){this.assignmentStore.removeAssignmentsForEvent(t)}removeAssignmentsForResource(t){this.assignmentStore.removeAssignmentsForResource(t)}append(t){return this.add(t)}get project(){return super.project}set project(t){var n;super.project=t,this.detachListeners("project"),t&&((n=t.assignmentStore)!=null&&n.isAssignmentStore&&this.attachToAssignmentStore(t.assignmentStore),t.ion({name:"project",assignmentStoreChange:"onProjectAssignmentStoreChange",thisObj:this,prio:200}))}get usesResourceIds(){var t,n;return(n=(t=this.modelClass.fieldMap)==null?void 0:t.resourceIds.persist)!=null?n:!1}get usesSingleAssignment(){return this.isChained?this.masterStore.usesSingleAssignment:this._usesSingleAssignment}set usesSingleAssignment(t){this._usesSingleAssignment=t;const{assignmentStore:n}=this;n!=null&&n.isStore&&!n.hasGenerateIdOverride&&(n.modelClass.generateId=function(){return this.singleAssignmentIdCounter==null&&(this.singleAssignmentIdCounter=0),`a-${++this.singleAssignmentIdCounter}`},n.hasGenerateIdOverride=!0)}processRecords(t){var n;const{assignmentStore:e}=this,i=[];return e&&(e.skipInvalidateIndices=!0),t=super.processRecords(t,e&&!((n=this.stm)!=null&&n.isRestoring)&&(a=>{const o=a.get("resourceId");!a.reassignedFromReplace&&o!=null&&(e.includesAssignment(a.id,o)||i.push({id:e.modelClass.generateId(""),resourceId:o,eventId:a.id})),a.reassignedFromReplace=!1})||void 0),e&&(e.storage.invalidateIndices(),e.skipInvalidateIndices=!1,e.add(i)),t}joinRecordsToStore(t){const{assignmentStore:n}=this;n?(n.skipInvalidateIndices=!0,super.joinRecordsToStore(t),n.storage.invalidateIndices(),n.skipInvalidateIndices=!1):super.joinRecordsToStore(t)}processRecord(t,n=!1){var e,i;t=super.processRecord(t,n);const a=this,o=(i=a.assignmentStore)!=null?i:(e=a.crudManager)==null?void 0:e.assignmentStore,l=t.get("resourceId"),{resourceIds:u}=t;if(u!=null&&u.length&&t.meta.skipEnforcingSingleAssignment!==!1&&a.usesResourceIds)o?o.add(u.filter(c=>!o.some(d=>d.eventId===t.id&&d.resourceId===c)).map(c=>({resource:c,event:t}))):a.$processResourceIds=!0;else if(l!=null&&!t.meta.skipEnforcingSingleAssignment){const c=a.getById(t.id);if(c&&c!==t&&!n){const p=o.storage.findItem("eventId",t.id);if(p!=null&&p.size){const m=p.values().next().value;m.resource=l,t.reassignedFromReplace=!0}}else a.$processResourceIds=!0;a.usesSingleAssignment=!0}return t}processResourceIds(){var t,n,e;const i=this,a=(n=i.assignmentStore)!=null?n:(t=i.crudManager)==null?void 0:t.assignmentStore;if(i.$processResourceIds&&(a!=null&&a.isAssignmentStore)&&!((e=i.project)!=null&&e.isSharingAssignmentStore&&i.isChained)){const o=[];i.forEach(l=>{const{resourceId:u,resourceIds:c,id:d}=l;u!=null?o.push({id:a.modelClass.generateId(""),resourceId:u,eventId:d}):c!=null&&c.length&&c.forEach(p=>{o.push({id:a.modelClass.generateId(""),resourceId:p,eventId:d})})},i,{includeFilteredOutRecords:!0}),a.useRawData={disableDefaultValue:!0,disableDuplicateIdCheck:!0,disableTypeConversion:!0},a.usesSingleAssignment=!1,a.verifyNoGeneratedIds=!1,a.data=o,a.usesSingleAssignment=!0,i.$processResourceIds=!1}}loadData(){super.loadData(...arguments),this.processResourceIds()}onBeforeRemoveAssignment({records:t}){var n;const e=this;if(e.removeUnassignedEvent&&!e.isRemoving&&!e.isSettingData&&!((n=e.stm)!=null&&n.isRestoring)&&!e.usesSingleAssignment&&!e.assignmentStore.isSyncingDataOnLoad&&!e.resourceStore.isSyncingDataOnLoad){const i=new Set;t.forEach(a=>{const{event:o}=a;o&&!o.isRemoved&&o.assignments.every(l=>t.includes(l))&&i.add(o)}),i.size&&e.remove([...i])}}onProjectAssignmentStoreChange({store:t}){this.attachToAssignmentStore(t)}attachToAssignmentStore(t){const n=this;n.detachListeners("assignmentStore"),t&&(n.processResourceIds(),t.ion({name:"assignmentStore",addPreCommit({records:e}){!n.isSettingData&&!n.isAssigning&&(n.usesSingleAssignment?e.forEach(i=>{const{event:a}=i;a!=null&&a.isEvent&&a.resourceId!==i.resourceId&&(a.meta.isAssigning=!0,a.set("resourceId",i.resourceId),a.meta.isAssigning=!1)}):n.usesResourceIds&&e.forEach(i=>{var a;const{event:o}=i;if(o!=null&&o.isEvent){o.meta.isAssigning=!0;const l=(a=o.resourceIds)!=null?a:[];l.includes(i.resourceId)||(o.resourceIds=[...l,i.resourceId]),o.meta.isAssigning=!1}}))},beforeRemove:"onBeforeRemoveAssignment",removePreCommit({records:e}){!n.isSettingData&&!n.isAssigning&&(n.usesSingleAssignment?e.forEach(i=>{var a;(a=n.getById(i.eventId))==null||a.set("resourceId",null)}):n.usesResourceIds&&e.forEach(({event:i,resourceId:a})=>{const o=i.resourceIds.slice(),l=o==null?void 0:o.indexOf(a);l>=0&&(o.splice(l,1),i.resourceIds=o)}))},removeAllPreCommit(){!n.isSettingData&&!n.isAssigning&&(n.usesSingleAssignment?n.allRecords.forEach(e=>e.set("resourceId",null)):n.usesResourceIds&&n.allRecords.forEach(e=>{e.resourceIds=[]}))},update({record:e,changes:i}){if("resourceId"in i){const{event:a}=e;if(n.usesSingleAssignment)a.meta.isAssigning=!0,a.set("resourceId",i.resourceId.value),a.meta.isAssigning=!1;else if(n.usesResourceIds){a.meta.isAssigning=!0;const o=a.resourceIds.slice(),l=o==null?void 0:o.indexOf(i.resourceId.oldValue);l>=0&&o.splice(l,1),o!=null&&o.includes(i.resourceId.value)||(o.push(i.resourceId.value),a.resourceIds=o),a.meta.isAssigning=!1}}},change({action:e,records:i}){e==="dataset"&&n.usesResourceIds&&i.forEach(({event:a,resourceId:o})=>{var l;const u=(l=a.resourceIds)!=null?l:[];u.includes(o)||(u.push(o),a.meta.isAssigning=!0,a.setData("resourceIds",u),a.meta.isAssigning=!1)})},thisObj:n}))}set data(t){this.isSettingData=!0,this.usesSingleAssignment&&!this.syncDataOnLoad&&!this.isChained&&this.assignmentStore.removeAll(!0),super.data=t,this.isSettingData=!1}trigger(t,n){var e;const{changes:i}=n||{};return i&&"resourceId"in i&&Object.keys(i).length===1&&!((e=this.stm)!=null&&e.isRestoring)&&(n.isAssign=!0),super.trigger(...arguments)}remove(t,...n){var e,i;const a=super.remove(t,...n);if(a.length&&this.usesSingleAssignment)for(const o of a)o.isOccurrence||(i=this.assignmentStore||((e=this.crudManager)==null?void 0:e.assignmentStore))==null||i.remove(o.assignments,!0);return a}},_(s,"$name","EventStoreMixin"),s},fn=()=>!0,mn=r=>!r.isRecurring,Ut=r=>{var s;return s=class extends r{getEvents({filter:t,date:n,startDate:e,endDate:i,startOnly:a,includeOccurrences:o,allowPartial:l,onlyAssigned:u=!1,dateMap:c=!1,dayTime:d=null,getDateIndex:p}){const m=this,f=arguments[0],{lastDateRange:I,added:M,filtersFunction:E}=m,D=t;if(u&&(f.filter=D?y=>D(y)&&y.resources.length:y=>y.resources.length),"startDate"in f||(e=f.startDate=n),"includeOccurrences"in f||(o=f.includeOccurrences=!0),"allowPartial"in f||(l=f.allowPartial=!a),f.storeFilterFn=m.isFiltered&&!f.ignoreFilters?m.reapplyFilterOnAdd?E:y=>M.includes(y)?m.indexOf(y)>-1:E(y):null,!i)if(e)i=f.endDate=T.clearTime(e),i.setDate(i.getDate()+1);else{if(o)throw new Error("getEvents MUST be passed startDate and endDate if recurring occurrences are requested");f.dateFilter=fn}f.dateFilter||(a?f.dateFilter=y=>{const h=y.hasBatchedChange("startDate")?y.get("startDate"):y.startDate;return h&&!(T.clearTime(h)-e)}:l?f.dateFilter=y=>{const h=y.hasBatchedChange("startDate")?y.get("startDate"):y.startDate,g=y.hasBatchedChange("endDate")?y.get("endDate"):y.endDate||h,v=!(h-g);return h&&(v?T.betweenLesserEqual(h,e,i):T.intersectSpans(h,g,e,i))}:f.dateFilter=y=>{const h=y.hasBatchedChange("startDate")?y.get("startDate"):y.startDate,g=y.hasBatchedChange("endDate")?y.get("endDate"):y.endDate||h;return h&&h>=e&&g<=i});const S={startDate:e,endDate:i};return m.processConfiguredListeners(),m.trigger("loadDateRange",{old:I||{},new:te.clone(S),changed:!!(!I||I.startDate-S.startDate||I.endDate-S.endDate)}),m.lastDateRange=te.clone(S),c?m.getEventsAsMap(f):m.getEventsAsArray(f)}getEventsAsArray({filter:t,date:n,resourceRecord:e,startDate:i=n,endDate:a,startOnly:o,includeOccurrences:l=!0,dayTime:u=null,dateFilter:c,storeFilterFn:d,getDateIndex:p}){const m=this,f=[];if(d?m.count:m.allCount){let M=e?m.getEventsForResource(e):null;if(!e){const E=m.useDayIndex(u),D=new Set,S=o?"startDate":"date";m.recurringEvents.forEach(y=>{E.dayTime.startOfDay(y.startDate)<=i&&D.add(y)});for(const y=new Date(i);y<a;y.setDate(y.getDate()+1)){const h=E.get(p?p(y):S,y);h==null||h.forEach(g=>D.add(g))}M=[...D]}d&&(M=M.filter(d));for(let E=0,{length:D}=M;E<D;E++){const S=M[E];l&&S.isRecurring?f.push.apply(f,S.getOccurrencesForDateRange(i,a).filter(c)):c(S)&&f.push(S)}}return t?f.filter(t):f}getEventsAsMap({filter:t,date:n,resourceRecord:e,startDate:i=n,endDate:a,startOnly:o,includeOccurrences:l=!0,dateMap:u,dayTime:c=null,storeFilterFn:d,getDateIndex:p}){var m;const f=this;if(u!=null&&u.clear?u.clear():u=new Map,f.count){const I=f.useDayIndex(c),M=o?"startDate":"date",E=[],D=y=>(!t||t(y))&&(!d||d(y)),S=y=>mn(y)&&D(y);if(c=I.dayTime,e)throw new Error("Querying for events for a resource and returning a date-keyed Map is not supported");(m=f.recurringEvents)==null||m.forEach(y=>{c.startOfDay(y.startDate)<a&&E.push(y)});for(const y=new Date(i);y<a;y.setDate(y.getDate()+1)){let[h,g]=I.get(p?p(y):M,y,!0);h!=null&&h.size&&(h=[...h].filter(S),h.length&&(u.get(g)||u.set(g,[]).get(g)).push(...h))}for(let y=0,{length:h}=E;y<h;y++){const g=E[y],v=(l?g.getOccurrencesForDateRange(i,a):[g]).filter(D),C=T.add(a,1,"day");for(let x,R=0,{length:A}=v;R<A;R++){const b=v[R],w=c.startOfDay(b.startDate),F=p?p(w):o?"startDate":"date",j=F==="startDate"||!b.durationMS?T.add(w,1,"day"):T.min(b.endDate||T.add(b.startDate,b.duration,b.durationUnit),C);for(;w<j;w.setDate(w.getDate()+1)){const L=c.dateKey(w);(x=u.get(L))||u.set(L,x=[]),x.push(b)}}}}return u}},_(s,"$name","GetEventsMixin"),s},je={date:"_dateIndex",startDate:"_startDateIndex"},rt=Object.values(je),qt=Object.freeze([]),{MILLIS_PER_DAY:zt}=Je,Oe=class{constructor(r,s){this.dayTime=s||Je.MIDNIGHT,this.store=r,this.users=[this.dayTime]}add(r,s,t){const n=this[je[r]],e=this.dayTime.dateKey(s);(n[e]||(n[e]=new Set)).add(t)}addEvent(r){var s,t,n;let e=(s=this.dayTime.startOfDay(r.startDate))==null?void 0:s.getTime(),i;if(e){i=(n=(t=r.endDate)==null?void 0:t.getTime())!=null?n:e,this.add("startDate",e,r);do this.add("date",e,r),e+=zt;while(e<i)}}clear(){rt.forEach(r=>this[r]=Object.create(null))}get(r,s,t){!this.initialized&&this.initialize();let n=this[je[r]],e;return s&&(e=this.dayTime.dateKey(s),n=t?[n[e],e]:n[e]),n}initialize(){this.initialized=!0,this.clear(),this.sync("splice",this.store.storage.allValues)}invalidate(){this.initialized=!1,rt.forEach(r=>this[r]=null)}matches(r){return this.dayTime.startShift===r.startShift}remove(r,s,t){const n=this[je[r]],e=this.dayTime.dateKey(s),i=n[e];i&&i.delete(t)}removeEvent(r,s,t){var n,e;let i=(n=this.dayTime.startOfDay(s))==null?void 0:n.getTime(),a;if(i){a=(e=t==null?void 0:t.getTime())!=null?e:i,this.remove("startDate",i,r);do this.remove("date",i,r),i+=zt;while(i<a)}}sync(r,s,t,n,e){var i,a;s=s||qt,t=t||qt;const o=this,l=s.length,u=t.length,c=n==null?void 0:n.length;let d,p,m;if(o.initialized)switch(r){case"clear":o.clear();break;case"splice":if(c)for(s=s.slice(),t=t.slice(),d=0;d<c;d++)t.push(n[d][0]),s.push(n[d][1]);if(u)for(d=0;d<u;d++)m=t[d],o.removeEvent(m,m.startDate,m.endDate);if(l)for(d=0;d<l;d++)p=s[d],p.isScheduled&&!p.isParent&&o.addEvent(p);break;case"reschedule":m=s[0],o.removeEvent(m,((i=e.startDate)==null?void 0:i.oldValue)||m.startDate,((a=e.endDate)==null?void 0:a.oldValue)||m.endDate),o.sync("splice",s);break}}register(r){this.users.push(r)}unregister(r){const{users:s}=this,t=s.indexOf(r);return t>-1&&s.splice(t,1),!s.length}},Wt=Oe.prototype;rt.forEach(r=>Wt[r]=null),Wt.initialized=!1,Oe._$name="EventDayIndex";var Zt=Object.freeze([]),Fe=r=>class extends(r||B){static get $name(){return"RecurringTimeSpansMixin"}construct(...t){const n=this;n.globalOccurrences=new Map,n.recurringEvents=new Set,super.construct(...t)}afterLoadData(){this.globalOccurrences.clear(),this.refreshRecurringEventsCache("clear"),this.refreshRecurringEventsCache("splice",this.storage.allValues),super.afterLoadData&&super.afterLoadData()}onDataChange({action:t,added:n,removed:e,replaced:i}){this.refreshRecurringEventsCache(t,n,e,i),super.onDataChange(...arguments)}refreshRecurringEventsCache(t,n=Zt,e=Zt,i){const a=this,{recurringEvents:o}=a,l=i==null?void 0:i.length;switch(t){case"clear":o.clear();break;case"splice":{if(l){n=n.slice(),e=e.slice();for(let d=0;d<l;d++)e.push(i[d][0]),n.push(i[d][1])}const u=n.length,c=e.length;if(c&&o.size)for(let d=0;d<c;d++)o.delete(e[d]);if(u)for(let d=0;d<u;d++){const p=n[d];p.isRecurring&&o.add(p)}break}}}getById(t){let n=super.getById(t);return n||(n=this.globalOccurrences.get(this.modelClass.asId(t))),n}onModelChange(t,n,e,i,a){const o=!i&&this.isRecurrenceRelatedFieldChange(t,e);if(o&&t.removeOccurrences(),super.onModelChange(...arguments),o){const l={action:"batch",records:this.storage.values};this.trigger("refresh",l),this.trigger("change",l)}}isRecurrenceRelatedFieldChange(t,n){return t.isRecurring||"recurrenceRule"in n}getOccurrencesForTimeSpan(t,n,e){const i=[];return t.isRecurring&&t.recurrence.forEachOccurrence(n,e,a=>i.push(a)),i}set data(t){this.globalOccurrences.clear(),super.data=t}getRecurringTimeSpans(){return[...this.recurringEvents]}},Ht=r=>class extends Fe(r||B){static get $name(){return"RecurringEventsMixin"}getRecurringEvents(){return this.getRecurringTimeSpans()}isEventPersistable(t){return super.isEventPersistable(t)&&(!t.supportsRecurring||!t.isOccurrence)}},pn=/^([+-]?[0-9])?(SU|MO|TU|WE|TH|FR|SA)$/,Kt=["SU","MO","TU","WE","TH","FR","SA"],oe=class extends B{static decodeDay(r){let s,t;return(s=pn.exec(r))&&(t=[Kt.indexOf(s[2])],s[1]&&(s[1]=parseInt(s[1],10),t.push(s[1]))),t}static encodeDay(r){let s;return Array.isArray(r)&&([r,s]=r),(s?s.toString():"")+Kt[r]}static decode(r){const s=[];let t;if(r)for(let n=0;n<r.length;n++)(t=this.decodeDay(r[n]))&&s.push(t);return s}static encode(r){const s=[];let t;if(r)for(let n=0;n<r.length;n++)(t=this.encodeDay(r[n]))&&s.push(t);return s}};oe._$name="RecurrenceDayRuleEncoder";var vn=/ly$/i,nt=r=>{const s=r.replace(vn,"");return s==="DAI"?"DAY":s},Sn=(r,s,t,n)=>n.buildOccurrence(r,t),yn=r=>st=r,st,Z=class extends B{static processIterationConfig(r){const{recurrence:s}=r,{frequency:t,interval:n,timeSpan:e,endDate:i,count:a}=s;if(!r.syncingStartDate&&!e.meta.isSyncedWithRule){const d=T.add(e.startDate,n,nt(t)),p=T.min(d,r.endDate||d);this.forEachDate({syncingStartDate:!0,startDate:e.startDate,endDate:p,recurrence:s,fn:Sn})}const o=e.startDate;let{startDate:l=o,endDate:u=i}=r;l<o&&(l=o),i?(!u||u>i)&&(u=i):a&&l>o&&(this.forEachDate({recurrence:s,fn:yn}),(!u||u>st)&&(u=new Date(st.getTime()+1)));const c=l;return r.startOnly||(l=new Date(T.max(T.add(l,-n,nt(t)),o))),Object.assign({extraArgs:[],startOnly:!e.durationMS},r,{startDate:l,endDate:u,timeSpan:e,timeSpanStart:o,earliestVisibleDate:c,endDateMS:u==null?void 0:u.getTime(),timeSpanStartMS:o.getTime(),earliestVisibleDateMS:c.getTime(),durationMS:e.durationMS,spansStart:l<=o&&u>o})}static getOccurrenceIndex(r){if(r.isOccurrence)return T.diff(r.recurringTimeSpan.startDate,r.startDate,nt(r.recurringTimeSpan.recurrence.frequency))}static getNthDayInPeriod(r,s,t,n){let e,i,a;if(n){n>0?(i=1,a=r):(i=-1,a=s);const o=t-a.getDay();i*o<0&&(n+=i),e=new Date(a),e.setDate(a.getDate()+(n-i)*7+o),(e<r||e>s)&&(e=null)}return e}static buildDate(r,s,t){const n=new Date(r,s,t);if(n.getFullYear()===r&&n.getMonth()===s&&n.getDate()===t)return n}static isValidPosition(r){return!!r}static forEachDateAtPositions(r,s,t,n){const e=r.length,i={};for(let a=0;a<s.length;a++){const o=s[a];if(this.isValidPosition(o)){const l=o>0?r[o-1]:r[e+o];if(l&&!i[l.getTime()]&&(i[l.getTime()]=!0,t.call(n,l)===!1))return!1}}}static isInView(r,s,t,n,e){return(r?s>=t:s.valueOf()+n>t)&&!e.hasException(s)}static isInViewMS(r,s,t,n,e,i){return(r?t>=n:t+e>n)&&!i.hasException(s)}};_(Z,"frequency","NONE"),_(Z,"MAX_OCCURRENCES_COUNT",1e6),Z._$name="AbstractRecurrenceIterator";var ke=class extends Z{static forEachDate(r){const{startOnly:s,startDate:t,endDate:n,endDateMS:e,timeSpan:i,timeSpanStart:a,earliestVisibleDateMS:o,durationMS:l,spansStart:u,recurrence:c,fn:d,extraArgs:p,scope:m=this}=this.processIterationConfig(r),{interval:f}=c,I=t-a,M=f*864e5,E=Math.floor(I/M);let{count:D}=c,S=0,y=T.add(a,E*f,"day"),h=y.getTime();for(!n&&!D&&(D=this.MAX_OCCURRENCES_COUNT);!e||h<e;){const g=this.isInViewMS(s,y,h,o,l,i);if(S++,g&&(e&&h>e||d.apply(m,[y,S,S===1&&u,i,...p])===!1||D&&S>=D))break;y=T.add(y,f,"day"),h=y.getTime()}}};_(ke,"frequency","DAILY"),ke._$name="DailyRecurrenceIterator";var $e=class extends Z{static forEachDate(r){const{startOnly:s,startDate:t,endDateMS:n,timeSpan:e,timeSpanStart:i,timeSpanStartMS:a,earliestVisibleDateMS:o,durationMS:l,spansStart:u,recurrence:c,fn:d,extraArgs:p,scope:m=this}=this.processIterationConfig(r),{interval:f,days:I}=c,{weekStartDay:M}=T,E=i.getHours(),D=i.getMinutes(),S=i.getSeconds(),y=i.getMilliseconds();let h=0,{count:g}=c,v=oe.decode(I),C,x;if(v!=null&&v.length||(v=[[i.getDay()]]),M>0)for(let R=0;R<v.length;R++)M>v[R][0]?v[R][0]=7-M-v[R][0]:v[R][0]-=M;for(v.sort((R,A)=>R[0]-A[0]),C=T.getNext(g||f>1?i:t,"week",0),!n&&!g&&(g=this.MAX_OCCURRENCES_COUNT);!n||C.getTime()<n;){for(let R=0;R<v.length;R++){x=new Date(C.getFullYear(),C.getMonth(),C.getDate()+v[R][0],E,D,S,y);const A=x.getTime();if(A>=a){const b=this.isInViewMS(s,x,A,o,l,e);if(h++,b&&(n&&A>=n||d.apply(m,[x,h,h===1&&u,e,...p])===!1||g&&h>=g))return}}C=T.getNext(C,"week",f)}}};_($e,"frequency","WEEKLY"),$e._$name="WeeklyRecurrenceIterator";var Le=class extends Z{static getNthDayOfMonth(r,s){const t=T.daysInMonth(r);let n=null;return s&&Math.abs(s)<=t&&(n=new Date(r.getFullYear(),r.getMonth(),s<0?t+s+1:s)),n}static isValidPosition(r){return r&&Math.abs(r)>0&&Math.abs(r)<=31}static forEachDate(r){const{startOnly:s,startDate:t,endDate:n,timeSpan:e,timeSpanStart:i,earliestVisibleDate:a,durationMS:o,spansStart:l,recurrence:u,fn:c,extraArgs:d,scope:p=this}=this.processIterationConfig(r),{interval:m,days:f,count:I,positions:M}=u,E=oe.decode(f),D=M&&M.length,S={};let{monthDays:y}=u,h=0,g,v,C,x,R,A;for(v=T.startOf(I||m>1?i:t,"month"),C=new Date(T.getNext(v,"month",1)-1),!(y&&y.length)&&!(E&&E.length)&&(y=[i.getDate()]),E&&E.length&&E.forEach(b=>{b[1]&&(g=g||{},g[b[0]]=b[1])});(!n||n>v)&&(!I||h<I);){if(x=[],E&&E.length){if(E.forEach(b=>{const w=b[0];let F=1,j=53;for(b[1]&&(F=j=b[1]),A=F;A<=j;A++)(R=this.getNthDayInPeriod(v,C,w,A))&&(R=T.copyTimeValues(R,i),S[R.getTime()]||(S[R.getTime()]=!0,x.push(R)))}),x.sort((b,w)=>b-w),!D){for(A=0;A<x.length;A++)if(R=x[A],R>=i){const b=this.isInView(s,R,a,o,e);if(h++,b&&(n&&R>=n||c.apply(p,[R,h,h===1&&l,e,...d])===!1||I&&h>=I))return!1}}}else{const b=[];for(A=0;A<y.length;A++)(R=this.getNthDayOfMonth(v,y[A]))&&!S[R.getTime()]&&(S[R.getTime()]=!0,b.push(R));for(b.sort((w,F)=>w-F),A=0;A<b.length;A++)if(R=T.copyTimeValues(b[A],i),D)x.push(R);else if(R>=i){const w=this.isInView(s,R,a,o,e);if(h++,w&&(n&&R>n||c.apply(p,[R,h,h===1&&l,e,...d])===!1||I&&h>=I))return}}D&&x.length&&this.forEachDateAtPositions(x,M,b=>{if(b>=i){const w=s?b>=a:b.valueOf()+o>a&&!e.hasException(b);if(h++,w&&(!n||b<=n)&&(c.apply(p,[b,h,h===1&&l,e,...d])===!1||I&&h>=I))return!1}}),v=T.getNext(v,"month",m),C=new Date(T.getNext(v,"month",1)-1)}}};_(Le,"frequency","MONTHLY"),Le._$name="MonthlyRecurrenceIterator";var Ne=class extends Z{static forEachDate(r){const{startOnly:s,startDate:t,endDate:n,timeSpan:e,timeSpanStart:i,earliestVisibleDate:a,durationMS:o,spansStart:l,recurrence:u,fn:c,extraArgs:d,scope:p=this}=this.processIterationConfig(r),{interval:m,days:f,count:I,positions:M}=u,E=oe.decode(f),D=M&&M.length,S={};let{months:y}=u,h=0,g,v,C,x,R,A;for(x=T.startOf(I||m>1?i:t,"year"),R=new Date(T.getNext(x,"year",1)-1),y&&y.sort((b,w)=>b-w),!(y&&y.length)&&!(E&&E.length)&&(y=[i.getMonth()+1]),E&&E.length&&E.forEach(b=>{b[1]&&(A=A||{},A[b[0]]=b[1])});(!n||n>x)&&(!I||h<I);){if(C=[],E&&E.length){if(E.forEach(b=>{const w=b[0];let F=1,j=53;for(b[1]&&(F=j=b[1]),g=F;g<=j;g++)(v=this.getNthDayInPeriod(x,R,w,g))&&(v=T.copyTimeValues(v,i),S[v.getTime()]||(S[v.getTime()]=!0,C.push(v)))}),C.sort((b,w)=>b-w),!D){for(g=0;g<C.length;g++)if(v=C[g],v>=i){const b=this.isInView(s,v,a,o,e);if(h++,b&&(n&&v>=n||c.apply(p,[v,h,h===1&&l,e,...d])===!1||I&&h>=I))return}}}else for(g=0;g<y.length;g++)if((v=this.buildDate(x.getFullYear(),y[g]-1,i.getDate()))&&(v=T.copyTimeValues(v,i),!S[v.getTime()])){if(S[v.getTime()]=!0,D)C.push(v);else if(v>=i){const b=s?v>=a:v.valueOf()+o>a&&!e.hasException(v);if(h++,b&&(n&&v>=n||c.apply(p,[v,h,h===1&&l,e,...d])===!1||I&&h>=I))return}}D&&C.length&&this.forEachDateAtPositions(C,M,b=>{if(b>=i){const w=s?b>=a:b.valueOf()+o>a&&!e.hasException(b);if(h++,w&&(!n||b<n)&&(c.apply(p,[b,h,h===1&&l,e,...d])===!1||I&&h>=I))return!1}}),x=T.getNext(x,"year",m),R=new Date(T.getNext(x,"year",1)-1)}}};_(Ne,"frequency","YEARLY"),Ne._$name="YearlyRecurrenceIterator";var Jt={};[ke,$e,Le,Ne].forEach(r=>{Jt[r.frequency]=r});function it(r){return r?typeof r=="string"&&(r=r.split(",").map(s=>parseInt(s,10))):r=null,r}function Dn(r){return r?typeof r=="string"&&(r=r.split(",")):r=null,r}function Be(r,s){return String(r)===String(s)}function Gt(r){return this.defaultValue&&r===void 0?this.defaultValue:this.allowNull&&r==null?null:(r=parseInt(r),isNaN(r)?void 0:r)}var at=class extends k{static get $name(){return"RecurrenceModel"}get isRecurrenceModel(){return!0}static get fields(){return[{name:"frequency",defaultValue:"DAILY"},{name:"interval",defaultValue:1,convert:Gt},{name:"endDate",type:"date"},{name:"count",allowNull:!0,convert:Gt},{name:"days",convert:Dn,isEqual:Be},{name:"monthDays",convert:it,isEqual:Be},{name:"months",convert:it,isEqual:Be},{name:"positions",convert:it,isEqual:Be}]}get dateFormat(){return this._dateFormat||"YYYYMMDDTHHmmss"}set dateFormat(r){this._dateFormat=r}get recurrenceIterator(){return Jt[this.frequency]}get timeSpan(){return this._timeSpan}set timeSpan(r){this._timeSpan=r}get rule(){const r=this,s=[];return r.frequency&&(s.push(`FREQ=${r.frequency}`),r.interval>1&&s.push(`INTERVAL=${r.interval}`),r.days&&r.days.length&&s.push("BYDAY="+r.days.join(",")),r.monthDays&&r.monthDays.length&&s.push("BYMONTHDAY="+r.monthDays.join(",")),r.months&&r.months.length&&s.push("BYMONTH="+r.months.join(",")),r.count&&s.push(`COUNT=${r.count}`),r.endDate&&s.push("UNTIL="+T.format(r.endDate,r.dateFormat)),r.positions&&r.positions.length&&s.push("BYSETPOS="+r.positions.join(","))),s.join(";")}set rule(r){const s=this,t={frequency:null,interval:null,count:null,endDate:null,days:null,monthDays:null,months:null,positions:null};if(s.beginBatch(),r){const n=r.split(";");for(let e=0,i=n.length;e<i;e++){const a=n[e].split("="),o=a[1];switch(a[0]){case"FREQ":t.frequency=o;break;case"INTERVAL":t.interval=o;break;case"COUNT":t.count=o,t.until=null;break;case"UNTIL":o?t.endDate=T.parse(o,s.dateFormat):t.endDate=null,t.count=null;break;case"BYDAY":t.days=o;break;case"BYMONTHDAY":t.monthDays=o;break;case"BYMONTH":t.months=o;break;case"BYSETPOS":t.positions=o;break}}}s.set(t),r&&s.sanitize(),s.endBatch()}construct(r={}){const s=this,{rule:t,timeSpan:n}=r;s._suspendedTimeSpanNotifying=0,delete r.timeSpan,delete r.rule,super.construct(...arguments),t&&(s.suspendTimeSpanNotifying(),s.rule=t,s.resumeTimeSpanNotifying()),s.timeSpan=n}forEachOccurrence(r,s,t){this.timeSpan.startDate&&this.recurrenceIterator.forEachDate({recurrence:this,startDate:r,endDate:s,fn(n,e,i,a){return t(a.buildOccurrence(n,i),i,e,n)}})}sanitize(){var r,s;const t=this,n=(r=t.timeSpan)==null?void 0:r.startDate,e={};switch(t.isSanitizing=!0,t.frequency){case"DAILY":e.positions=null,e.days=null,e.monthDays=null,e.months=null;break;case"WEEKLY":{e.positions=null,e.monthDays=null,e.months=null;const{days:i}=t;n&&(i==null?void 0:i.length)===1&&i[0]===oe.encodeDay(n.getDay())&&(e.days=null);break}case"MONTHLY":{(s=t.monthDays)!=null&&s.length&&(e.positions=null,e.days=null),e.months=null;const{monthDays:i}=t;n&&(i==null?void 0:i.length)===1&&i[0]===n.getDate()&&(e.monthDays=null);break}case"YEARLY":{e.monthDays=null;const{months:i}=t;n&&(i==null?void 0:i.length)===1&&i[0]===n.getMonth()+1&&(e.months=null);break}}t.set(e),t.isSanitizing=!1}copy(...r){const s=super.copy(...r);return s.dateFormat=this.dateFormat,s.timeSpan=this.timeSpan,s}afterChange(r,s,t){const n=super.afterChange(r,s,t),{timeSpan:e}=this;return this.isSanitizing||this.sanitize(),e&&(e.sanitizeRecurrenceData(this),this.isTimeSpanNotifyingSuspended||e.onRecurrenceChanged()),n}set(r,s,...t){const n=typeof r=="object"?r:{[r]:s};n.count?n.endDate=null:n.endDate&&(n.count=null),super.set(n,void 0,...t)}get isTimeSpanNotifyingSuspended(){return!!this._suspendedTimeSpanNotifying}suspendTimeSpanNotifying(){this._suspendedTimeSpanNotifying++}resumeTimeSpanNotifying(){this._suspendedTimeSpanNotifying&&this._suspendedTimeSpanNotifying--}};at._$name="RecurrenceModel";function Cn(r){const s={},{dateFormat:t}=this;return r&&(r=typeof r=="string"?r.split(","):N.asArray(r),r.forEach(n=>{typeof n=="string"&&(n=T.parse(n,t)),isNaN(n)||(s[T.makeKey(n)]=1)})),s}function Rn(r){const s=[],{dateFormat:t}=this;for(const n in r)r[n]&&s.push(T.format(T.parseKey(n),t));return s}var In=[],Ve=r=>class extends(r||K){static get $name(){return"RecurringTimeSpan"}get supportsRecurring(){return!0}static get fields(){return[{name:"recurrenceRule",internal:!0},{name:"exceptionDates",convert:Cn,serialize:Rn,internal:!0}]}remove(){if(this.isOccurrence){const t=this,{recurringTimeSpan:n}=t;t.cancelBatch(),n.beginBatch(),t.detachFromRecurringEvent(),n.endBatch()}else return super.remove(...arguments)}get eventStore(){var t,n;let e=this.isOccurrence&&((t=this.recurringEvent)==null?void 0:t.eventStore)||super.eventStore;return!e&&((n=this.firstStore)!=null&&n.isRecurringTimeSpansMixin)&&(e=this.firstStore),e}get recurrenceModel(){return this._recurrenceModel||at}set recurrenceModel(t){this._recurrenceModel=t}setRecurrence(t,n,e){const i=this;let a;t&&(t.isRecurrenceModel||(typeof t=="string"&&(t={frequency:t},n&&(t.interval=n),e&&(e instanceof Date?t.endDate=e:t.count=e)),t=new i.recurrenceModel(t)),t.timeSpan=i,a=t.rule),i.recurrence=t,i.recurrenceRule=a}get recurrence(){const t=this,n=t.recurrenceRule;return!t._recurrence&&n&&(t._recurrence=new t.recurrenceModel({rule:n,timeSpan:t,id:`${t.id}-recurrence`})),t._recurrence}set recurrence(t){const n=this;n._recurrence=t,t?(t.timeSpan=n,n.recurrenceRule=t.rule):n.isOccurrence?n.setData("recurrenceRule",null):n.recurrenceRule=null}get isRecurring(){return!!(!this.isOccurrence&&this.recurrence)}get isOccurrence(){return!!this.recurringTimeSpan}get recurringTimeSpan(){return this._recurringTimeSpan}get isPersistable(){return super.isPersistable&&(!this.supportsRecurring||!this.isOccurrence)}set recurringTimeSpan(t){this._recurringTimeSpan=t}getOccurrencesForDateRange(t,n=t){return this.eventStore.getOccurrencesForTimeSpan(this,t,n)}get occurrences(){if(this.isRecurring){const t=[];return this.occurrenceMap.forEach(n=>{n!==this&&t.push(n)}),t}return In}get occurrenceMap(){return this._occurrencesMap||(this._occurrencesMap=new Map)}removeOccurrence(t,n=this.eventStore){const e=t.isTimeSpan?t.occurrenceDate:t;n==null||n.globalOccurrences.delete(this.createRecurrenceKey(e)),this.occurrenceMap.delete(T.makeKey(e))}removeOccurrencesFrom(t){this.occurrenceMap.forEach((n,e)=>{T.parseKey(e)>=t&&this.removeOccurrence(n)})}removeOccurrences(t){[this,...this.occurrences].forEach(n=>this.removeOccurrence(n,t))}onRecurrenceChanged(){var t;this.recurrenceRule=((t=this.recurrence)==null?void 0:t.rule)||null}sanitizeRecurrenceData(t=this.recurrence){if(t.endDate){const n=T.clearTime(t.endDate),{exceptionDates:e}=this;if(this.removeOccurrencesFrom(n),e)for(const i in e)T.parseKey(i)>=n&&delete e[i]}}get occurrenceDate(){var t;return((t=this.meta.modified)==null?void 0:t.startDate)||this.startDate}get occurrenceIndex(){return Z.getOccurrenceIndex(this)}buildOccurrence(t,n){var e;const i=this,{occurrenceMap:a,recurrence:o,meta:l}=i,u=(e=i.eventStore)==null?void 0:e.globalOccurrences,c=T.makeKey(t),d=i.createRecurrenceKey(t,c),p=!(t-i.startDate),{fieldMap:m}=i.constructor;let f=u==null?void 0:u.get(d),{duration:I}=i;i.endDate&&(i.allDay||!I)&&(I=T.as(i.durationUnit,i.endDate.getTime()-i.startDate.getTime()));const M=I!==void 0?T.add(t,I,i.durationUnit):void 0;return f||(n||p?(f=i,p||(i.setStartEndDate(t,M,!0),o.suspendTimeSpanNotifying(),o.sanitize(),o.resumeTimeSpanNotifying()),l.isSyncedWithRule=!0):(f=i.copy({[m.id.dataSource]:d,[m.startDate.dataSource]:t,[m.endDate.dataSource]:M,[m.duration.dataSource]:I,constraintDate:null,constraintType:null},{creatingOccurrence:!0}),f.recurringTimeSpan=i),u==null||u.set(d,f),a.set(c,f)),f}createRecurrenceKey(t=this.startDate,n=null){return`_generated:${this.id}:${n||T.makeKey(t)}`}convertToRealEvent(t,n){var e;if(!this.isOccurrence)return;const i=this,{recurringTimeSpan:a,resource:o,occurrenceIndex:l,recurrence:u}=i,c=u&&a.recurrence.count,d=((e=t==null?void 0:t.resourceRecords)==null?void 0:e.value)||i.data.newResource;a.beginBatch(),i.detachFromRecurringEvent(),i.clearChanges(),i.setData("id",i.generateId(a.eventStore)),d&&delete i.data.resourceId,a.eventStore.add(i,n),c&&(i.recurrence.count=c-l),(d||o)&&i.assign(d||o),d&&delete i.data.resourceRecords,t&&delete t.resourceRecords,a.endBatch()}afterChange(t,n,e,...i){const a=this,{eventStore:o}=a;return"recurrenceRule"in n&&(a._recurrence=null,o==null||o.recurringEvents[n.recurrenceRule.value?"add":"delete"](a)),a.isOccurrence?a.convertToRealEvent(n,e):"newExceptionDate"in n&&(a.meta.modified.exceptionDates=!0,delete a.meta.modified.newExceptionDate,a.removeOccurrence(n.newExceptionDate.value)),super.afterChange(t,n,e,...i)}detachFromRecurringEvent(){const t=this,{recurringTimeSpan:n,occurrenceDate:e,startDate:i}=t;t.recurringTimeSpan=null,n.addExceptionDate(e),t.recurrenceRule&&(n.recurrence.endDate=T.add(i,-1,"minute"))}set newExceptionDate(t){if(t){const n=this.exceptionDates||(this.exceptionDates={});n[T.makeKey(t)]=1}}addExceptionDate(t){return this.set({newExceptionDate:t})}hasException(t){var n;return(n=this.exceptionDates)==null?void 0:n[T.makeKey(t)]}},En=1e3*60*60*24,Xt=r=>class extends r{static get $name(){return"EventModelMixin"}static get isEventModel(){return!0}static get fields(){return[{name:"resourceId",internal:!0},{name:"resourceIds",type:"array",persist:!1,internal:!0},{name:"resources",column:{type:"resourceassignment"},persist:!1,internal:!0,useProp:!0},{name:"draggable",type:"boolean",persist:!1,defaultValue:!0,internal:!0},{name:"resizable",persist:!1,defaultValue:!0,internal:!0},{name:"allDay",type:"boolean",defaultValue:!1},{name:"eventStyle",internal:!0},{name:"eventColor",internal:!0},{name:"milestoneWidth",internal:!0},{name:"stickyContents",internal:!0}]}updateAssignmentEventIds(){this.assigned.forEach(t=>{t.eventId=this.id})}syncId(t){super.syncId(t),this.updateAssignmentEventIds()}setValue(t,n){var e;if(t==="resource"&&!this.usesSingleAssignment)this.resources=(e=N.asArray(n))!=null?e:[];else return super.setValue(t,n)}get resources(){return this.assignments.reduce((t,{resource:n})=>(n&&t.push(n.$original),t),[])}set resources(t){var n;t=N.asArray(t);const e=this,i=t.map(e.constructor.asId);if(e.usesSingleAssignment)e.set("resourceId",i[0]);else if((n=e.fieldMap)!=null&&n.resourceIds.persist)e.resourceIds=i;else{const a=e.assignments.map(u=>u.resource.id),{onlyInA:o,onlyInB:l}=N.delta(i,a);e.assignmentStore.add(o.map(u=>({resource:u,event:e}))),e.assignmentStore.remove(l.map(u=>e.assignments.find(c=>c.resource.id===u)))}}forEachResource(t,n=this){for(const e of this.resources)if(t.call(n,e)===!1)return}getResource(t){return t==null?this.resource:this.resourceStore?this.resourceStore.getById(t):null}get startDate(){var t;let n;return this.isOccurrence?n=this.get("startDate"):n=(t=this._startDate)!=null?t:super.startDate,this.allDay&&(n=this.constructor.getAllDayStartDate(n)),n}set startDate(t){this.batching?(this._startDate=t,this.set({startDate:t})):super.startDate=t}get endDate(){var t;let n;return this.isOccurrence?n=this.get("endDate"):n=(t=this._endDate)!=null?t:super.endDate,this.allDay&&(n=this.constructor.getAllDayEndDate(n)),n}set endDate(t){this.batching?(this._endDate=t,this.set({endDate:t})):super.endDate=t}get wrapStartDate(){return this.startDate}set wrapStartDate(t){}get wrapEndDate(){return this.endDate}set wrapEndDate(t){}get isEvent(){return!0}get isDraggable(){return!this.readOnly&&this.draggable}get isResizable(){return!this.isMilestone&&(!this.isParent||this.manuallyScheduled)&&this.resizable}get isPersistable(){return super.isPersistable&&!this.isCreating}endBatch(t,n,e){const i=this,a=i.isPersistable;if(super.endBatch(t,n,e),i.isPersistable&&!a&&!i.ignoreBag&&i.assigned)for(const o of i.assigned)o.stores.forEach(l=>l.updateModifiedBagForRecord(o))}get isCreating(){return super.isCreating}set isCreating(t){var n,e;super.isCreating=t,(n=this.assignmentStore)==null||n.suspendAutoCommit(),this.assignments.forEach(i=>i.isCreating=t),(e=this.assignmentStore)==null||e.resumeAutoCommit()}get usesSingleAssignment(){return!this.eventStore||this.eventStore.usesSingleAssignment}copy(...t){const n=super.copy(...t);return this.usesSingleAssignment||(n.resourceId=null),n}get persistableData(){const t=super.persistableData;return this.usesSingleAssignment||delete t.resourceId,t}get resource(){const{resources:t}=this;return t.length?t[0]:null}set resource(t){this.resourceId=this.constructor.asId(t)}get resourceId(){var t;return this.usesSingleAssignment?this.get("resourceId"):(t=this.assignments[0])==null?void 0:t.resourceId}set resourceId(t){this.applyResourceId(t)}get resourceIds(){var t,n,e;return(t=this.fieldMap)!=null&&t.resourceIds.persist?this.get("resourceIds"):(e=(n=this.resources)==null?void 0:n.map(i=>i.id))!=null?e:[]}set resourceIds(t){this.set("resourceIds",t)}get $linkedResources(){var t,n;return(n=(t=this.resources)==null?void 0:t.flatMap(e=>[e,...e.$links]))!=null?n:[]}applyResourceId(t,n=!1){var e,i;const a=this,{eventStore:o,assignments:l}=a;if(o){const u=o.assignmentStore||((e=o.crudManager)==null?void 0:e.assignmentStore);if(t!=null)if(a.meta.skipEnforcingSingleAssignment||(o.usesSingleAssignment=!0),l!=null&&l.length&&t!==l[0].resourceId){const c=!!o.eventsSuspended;c&&u.suspendEvents(),l[0].resource=t,c&&u.resumeEvents()}else u.assignEventToResource(a,t);else(a.usesSingleAssignment||(i=a.resourceIds)!=null&&i.length)&&u.remove(l)}else n||a.set({resourceId:t})}applyResourceIds(t,n=!1){var e;const i=this,{eventStore:a,assignments:o}=i;if(i.fieldMap.resourceIds.persist===!1)return!1;if(t=[...new Set(t)],a){const l=a.assignmentStore||((e=a.crudManager)==null?void 0:e.assignmentStore);if(t!=null&&t.length)if(o!=null&&o.length){const u=!!a.eventsSuspended;u&&l.suspendEvents(),o.forEach(p=>{const m=t.find(f=>!o.some(I=>I.resourceId===f));m&&(p.resource=m)});const{onlyInA:c,onlyInB:d}=N.delta(t,o.map(p=>p.resourceId));l.add(c.map(p=>({resource:p,event:i}))),l.remove(d.map(p=>o.find(m=>m.resource.id===p))),u&&l.resumeEvents()}else l.add(t.map(u=>({resource:u,event:i})));else l.remove(o)}else n||i.set({resourceIds:t})}applyValue(t,n,e,i,a){if(a&&!this.meta.isAssigning){const{eventStore:o}=this;switch(a.name){case"resourceId":o&&(o.isAssigning=!0),this.applyResourceId(e,!0);break;case"resourceIds":o&&(o.isAssigning=!0),this.applyResourceIds(e,!0);break}o&&(o.isAssigning=!1)}super.applyValue(t,n,e,i,a)}get assignments(){return[...this.assigned||[]]}assign(t,n=!1){const{eventStore:e}=this;e&&!e.usesSingleAssignment?e.assignEventToResource(this,t,n):(this.resourceId=this.constructor.asId(t),e||(this.meta.skipEnforcingSingleAssignment=!0))}unassign(t,n=!1){var e;const i=this;t=i.constructor.asId(t),i.meta.removingResource=n,(e=i.eventStore)==null||e.unassignEventFromResource(i,t),i.meta.removingResource=null}reassign(t,n){this.eventStore&&this.eventStore.reassignEventFromResourceToResource(this,t,n)}isAssignedTo(t){const n=this.constructor.asId(t);return this.assignments.some(e=>e.resourceId===n)}get predecessors(){var t;return[...(t=this.incomingDeps)!=null?t:[]]}get successors(){var t;return[...(t=this.outgoingDeps)!=null?t:[]]}get dependencies(){var t,n;return[...(t=this.incomingDeps)!=null?t:[],...(n=this.outgoingDeps)!=null?n:[]]}normalize(){}inSetNormalize(){}get recurringEvent(){return this.recurringTimeSpan}get isInterDay(){const{durationMS:t}=this;if(t>=En||!t&&this.allDay)return!0;const{endDate:n,startDate:e}=this,i=T.clearTime(e);if(e&&n)return i.setDate(i.getDate()+1),(n||T.add(e,t))>i}static getAllDayStartDate(t){return t&&t.isEvent&&(t=t.get("startDate")),t&&(t=T.clearTime(t,!0)),t}static getAllDayEndDate(t){return t&&t.isEvent&&(t=t.get("endDate")),t&&(t.getHours()>0||t.getMinutes()>0||t.getSeconds()>0||t.getMilliseconds()>0)&&(t=T.getNext(t,"d",1)),t}static getAllDayDisplayStartDate(t){return t&&t.isEvent&&(t=t.get("startDate")),T.clearTime(t,!0)}static getAllDayDisplayEndDate(t,n){return t&&t.isEvent&&(n=t.get("endDate"),t=t.get("startDate")),n&&(t=this.constructor.getAllDayDisplayStartDate(t),T.clearTime(n,!0).valueOf()===n.valueOf()?n=T.add(n,T.DAY,-1):t.valueOf()!==n.valueOf()&&(n=T.clearTime(n,!0))),n}isEditable(t){switch(t){case"endDate":case"duration":case"fullDuration":return this.isLeaf}return super.isEditable(t)}},G=class extends P([fe],r=>{const s=r.prototype;class t extends r{constructor(){super(...arguments),this._startDate=null,this._endDate=null,this._duration=null}static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number"},{name:"durationUnit",type:"durationunit",defaultValue:"day"}]}get startDate(){var e,i;return(i=(e=this._startDate)!=null?e:this.get("startDate"))!=null?i:null}get endDate(){var e,i;return(i=(e=this._endDate)!=null?e:this.get("endDate"))!=null?i:null}get duration(){var e,i;return(i=(e=this._duration)!=null?e:this.get("duration"))!=null?i:null}set startDate(e){this.proposeStartDate(e)}set endDate(e){this.proposeEndDate(e)}set duration(e){this.proposeDuration(e)}inSet(e,i,a,o,l){const u=this;return u.project&&!u.project.isWritingData&&typeof e!="string"&&!l&&("startDate"in e&&!("startDate"in u.$changed)&&(u.$changed.startDate=!0,u.invalidate()),"endDate"in e&&!("endDate"in u.$changed)&&(u.$changed.endDate=!0,u.invalidate())),s.inSet.call(u,e,i,a,o,l)}getStartDate(){return this.startDate}proposeStartDate(e,i=!("endDate"in this.$changed)){var a;(this.inSetting||(e==null?void 0:e.getTime())!==((a=this.startDate)==null?void 0:a.getTime()))&&(this._startDate=e,this.propose({startDate:e,keepDuration:i}))}async setStartDate(e,i=!0){var a;return this.proposeStartDate(e,i),(a=this.project)==null?void 0:a.commitAsync()}getEndDate(){return this.endDate}proposeEndDate(e,i=!1){var a;(this.inSetting||(e==null?void 0:e.getTime())!==((a=this.endDate)==null?void 0:a.getTime()))&&(this._endDate=e,this.propose({endDate:e,keepDuration:i}))}async setEndDate(e,i=!1){var a;return this.proposeEndDate(e,i),(a=this.project)==null?void 0:a.commitAsync()}getDuration(){return this.duration}proposeDuration(e,i,a=!0){this._duration=e,this.propose({duration:e,keepStart:a}),i&&this.propose({durationUnit:i})}async setDuration(e,i,a=!0){var o;return this.proposeDuration(e,i,a),(o=this.project)==null?void 0:o.commitAsync()}getDurationUnit(){return this.durationUnit}joinProject(){var e,i;const a=this,o=a.$changed,l=a.getCurrentOrProposed("startDate"),u=a.getCurrentOrProposed("endDate"),c=a.getCurrentOrProposed("duration");if(l!=null&&(o.startDate=a._startDate=l),u!=null&&(o.endDate=a._endDate=u),c!=null&&(o.duration=a._duration=c),a.eventStore&&!a.eventStore.isLoadingData){const d=(e=a.assignmentStore)==null?void 0:e.storage.findItem("event",null);if(d){const p=(i=a.assignmentStore)==null?void 0:i.storage.findItem("eventId",a.id);if(p)for(const m of p)m.setChanged("event",a);else for(const m of d)m.getCurrentOrProposed("event")===a.id&&m.setChanged("event",a)}}s.joinProject.call(a)}applyValue(e,i,a,o,l){var u;if((this.project||(u=this.recurringTimeSpan)!=null&&u.project)&&l){const{name:c}=l;(c==="startDate"||c=="duration"||c==="endDate")&&(e=!0,this["_"+c]=a),o&&(e=!1)}s.applyValue.call(this,e,i,a,o,l)}afterChange(e,i,a,o,l){!this.$isCalculating&&!l&&this.setData({startDate:this.getCurrentOrProposed("startDate"),endDate:this.getCurrentOrProposed("endDate"),duration:this.getCurrentOrProposed("duration"),durationUnit:this.getCurrentOrProposed("durationUnit")}),s.afterChange.call(this,e,i,a,o,l)}calculateInvalidated(){var e,i;const a=this,o=a.$changed,l="startDate"in o,u="endDate"in o,c="duration"in o,{startDate:d,endDate:p,duration:m,keepDuration:f,keepStart:I}=o;let M=null;l&&!u&&!c?d===null?o.endDate=null:a.hasCurrentOrProposed("endDate")&&d>a.getCurrentOrProposed("endDate")&&!f?(o.endDate=d,o.duration=0):a.hasCurrentOrProposed("duration")&&(f||!a.hasCurrentOrProposed("endDate"))?M="endDate":a.hasCurrentOrProposed("endDate")&&(M="duration"):!l&&u&&!c?p===null?o.startDate=null:a.hasCurrentOrProposed("startDate")&&!f&&p!==!0&&p<a.getCurrentOrProposed("startDate")?(o.startDate=p,o.duration=0):a.hasCurrentOrProposed("duration")&&(f||!a.hasCurrentOrProposed("startDate"))?M="startDate":a.hasCurrentOrProposed("startDate")&&(M="duration"):!l&&!u&&c?m===null?o.endDate=null:a.hasCurrentOrProposed("startDate")&&(I||!a.hasCurrentOrProposed("endDate"))?(I&&o.duration<0&&(o.duration=0),M="endDate"):a.hasCurrentOrProposed("endDate")&&(M="startDate"):l&&u&&!c?d===null&&p===null?o.duration=null:M="duration":l&&!u&&c?M="endDate":!l&&u&&c?M="startDate":l&&u&&c&&(m==null?M="duration":d==null?M="startDate":M="endDate");const E=a.getCurrentOrProposed("startDate"),D=a.getCurrentOrProposed("endDate"),S=a.getCurrentOrProposed("duration"),y=a.getCurrentOrProposed("durationUnit"),h=(i=(e=a.getProject())==null?void 0:e.adjustDurationToDST)!=null?i:!1;switch(M){case"startDate":const g=T.add(D,-S,y);if(h){const x=D.getTimezoneOffset()-g.getTimezoneOffset();g.setTime(g.getTime()-x*60*1e3)}o.startDate=g;break;case"endDate":const v=T.add(E,S,y);if(h){const x=E.getTimezoneOffset()-v.getTimezoneOffset();v.setTime(v.getTime()-x*60*1e3)}o.endDate=v;break;case"duration":let C=T.diff(E,D,"millisecond");if(h){const x=E.getTimezoneOffset()-D.getTimezoneOffset();C+=x*60*1e3}o.duration=T.as(y,C,"millisecond");break}"startDate"in o&&o.startDate!==!0&&(this._startDate=o.startDate),"endDate"in o&&o.endDate!==!0&&(this._endDate=o.endDate),"duration"in o&&o.duration!==!0&&(this._duration=o.duration),o.startDate===!0&&delete o.startDate,o.endDate===!0&&delete o.endDate,delete o.keepDuration,delete o.keepStart}}return t}){},Qt=class extends P([ge],r=>{const s=r.prototype;class t extends r{getAssignmentFor(e){var i;for(const a of(i=this.assigned)!=null?i:[])if(a.resource===e)return a;return null}isAssignedTo(e){return!!this.getAssignmentFor(e)}async assign(e){const i=this.project.assignmentStore.modelClass;return this.addAssignment(new i({event:this,resource:e})),this.commitAsync()}async unassign(e){const i=this.getAssignmentFor(e);return this.removeAssignment(i),this.commitAsync()}leaveProject(){if(this.isInActiveTransaction&&this.assigned){const e=this.getEventStore();this.assigned.forEach(i=>e.assignmentsForRemoval.add(i))}s.leaveProject.call(this,...arguments)}remove(){if(this.parent){const e=this.getEventStore();s.remove.call(this),e&&e.afterEventRemoval()}else return s.remove.call(this)}addAssignment(e){return this.getProject().assignmentStore.add(e),e}removeAssignment(e){return this.getProject().assignmentStore.remove(e),e}}return t}){},xn=class extends P([G,Qt],r=>{const s=r.prototype;class t extends r{get assigned(){var e,i;return(i=(e=this.project)==null?void 0:e.assignmentStore.getEventsAssignments(this))!=null?i:this.$cachedAssignments}leaveProject(e=!1){this.$cachedAssignments=this.assigned,super.leaveProject(e)}applyValue(e,i,a,o,l){var u;i==="id"&&((u=this.assigned)==null||u.forEach(c=>c.set("eventId",a))),s.applyValue.call(this,e,i,a,o,l)}copy(e=null,i=null){const a=s.copy.call(this,e,i);return(O.isObject(i)&&!i.skipFieldIdentifiers||!O.isObject(i))&&(a.$cachedAssignments=this.assigned),a}}return t}){},Mn=class extends P([G],r=>{const s=r.prototype;class t extends r{get outgoingDeps(){return this.project.dependencyStore.getOutgoingDepsForEvent(this)}get incomingDeps(){return this.project.dependencyStore.getIncomingDepsForEvent(this)}leaveProject(){const e=this.eventStore;this.outgoingDeps&&this.outgoingDeps.forEach(i=>e.dependenciesForRemoval.add(i)),this.incomingDeps&&this.incomingDeps.forEach(i=>e.dependenciesForRemoval.add(i)),s.leaveProject.call(this)}}return t}){},ot=class extends P([G,xn,Mn],r=>{const s=r.prototype;class t extends r{}return t}){},Tn=ot,ve=class extends Tn.derive(K).mixin(Ve,W,Xt){static get $name(){return"EventModel"}};ve.exposeProperties(),ve._$name="EventModel";var{MIDNIGHT:er}=Je,tr=r=>{var s;return s=class extends r{construct(t){super.construct(t),this.dayIndices=null}afterLoadData(){var t;this.syncIndices("splice",this.storage.allValues),(t=super.afterLoadData)==null||t.call(this)}onDataChange({action:t,added:n,removed:e,replaced:i}){this.syncIndices(t,n,e,i),super.onDataChange(...arguments)}onDataReplaced(t,n){this.syncIndices("clear"),this.syncIndices("splice",this.storage.values),super.onDataReplaced(t,n)}onModelChange(t,n,e,i,a){("startDate"in e||"endDate"in e)&&this.syncIndices("reschedule",[t],null,null,e),super.onModelChange(...arguments)}invalidateDayIndices(){var t;(t=this.dayIndices)==null||t.forEach(n=>n.invalidate())}registerDayIndex(t){const n=this,e=n.dayIndices||(n.dayIndices=[]);let i,a;for(a=0;!i&&a<e.length;++a)e[a].matches(t)&&(i=e[a]).register(t);return!i&&e.push(i=new Oe(n,t)),i}syncIndices(...t){var n;(n=this.dayIndices)==null||n.forEach(e=>e.sync(...t))}unregisterDayIndex(t){const n=this,{dayIndices:e}=n;for(let i=e==null?void 0:e.length;i-- >0;)if(e[i].matches(t)){e[i].unregister(t)&&e.splice(i,1);break}}useDayIndex(t){const n=this,{dayIndices:e}=n;t=t||er;for(let i=0;e&&i<e.length;++i)if(e[i].matches(t))return e[i];if(t.startShift)throw new Error(`No day index registered for ${t} on ${n.id}`);return n.registerDayIndex(er)}},_(s,"$name","DayIndexMixin"),s},bn={splice:1,clear:1},rr=class extends P([U],r=>{const s=r.prototype;class t extends r{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.dependenciesForRemoval=new Set}onDataChange(e){var i;const a=bn[e.action];super.onDataChange(e),a&&((i=e.removed)!=null&&i.length)&&this.afterEventRemoval()}remove(e,i){const a=s.remove.call(this,e,i);return this.afterEventRemoval(),a}removeAll(e){const i=s.removeAll.call(this,e);return this.afterEventRemoval(),i}onNodeRemoveChild(e,i,a,o){const l=s.onNodeRemoveChild.call(this,...arguments);return this.afterEventRemoval(),l}afterEventRemoval(){const{assignmentsForRemoval:e,dependenciesForRemoval:i}=this;if(!e)return;const a=this.getAssignmentStore();if(a&&!a.allAssignmentsForRemoval&&e.size){const l=[...e].filter(u=>!a.assignmentsForRemoval.has(u));l.length>0&&a.remove(l)}e.clear();const o=this.getDependencyStore();if(o&&!o.allDependenciesForRemoval&&i.size){const l=[...i].filter(u=>!o.dependenciesForRemoval.has(u));l.length>0&&o.remove(l)}i.clear()}processRecord(e,i=!1){var a;if(!((a=this.project)!=null&&a.isRepopulatingStores)){const o=this.getById(e.id);if(o&&o!==e&&o.assigned)for(const u of o.assigned)u.event=e}return e}}return t}){},nr=class extends P([rr,pe],r=>{const s=r.prototype;class t extends r{static get defaultConfig(){return{modelClass:ot}}joinProject(){var e;(e=this.assignmentStore)==null||e.linkAssignments(this,"event")}afterLoadData(){var e;this.afterEventRemoval(),(e=this.assignmentStore)==null||e.linkAssignments(this,"event")}}return t}){},An=W(nr.derive(ee)),Se=class extends An.mixin(Ht,Yt,tr,Ut){static get defaultConfig(){return{modelClass:ve}}};_(Se,"$name","EventStore"),Se._$name="EventStore";var sr=r=>class extends r{static get $name(){return"AssignmentModelMixin"}static get fields(){return["resourceId","eventId",{name:"drawDependencies",type:"boolean"},"event","resource"]}construct(t,...n){t=t||{};const{fieldMap:e}=this,i=e.eventId.dataSource,a=e.resourceId.dataSource,o=e.event.dataSource,l=e.resource.dataSource,u=t[i],c=t[a],d=t[o],p=t[l];u!=null?t[o]=u:d!=null&&(t[i]=d.isModel?d.id:d),c!=null?t[l]=c:p!=null&&(t[a]=p.isModel?p.id:p),super.construct(t,...n)}get eventResourceKey(){return this.buildEventResourceKey(this.event,this.resource)}buildEventResourceKey(t,n){let e,i;return t?e=t.isModel?t.id:t:e=this.internalId,n?i=n.isModel?n.id:n:i=this.internalId,`${e}-${i}`}buildIndexKey({event:t,resource:n}){return this.buildEventResourceKey(t,n)}set(t,n,...e){var i,a;const o=this.fieldToKeys(t,n);return"resource"in o?((i=o.resource)==null?void 0:i.id)!==void 0&&(o.resourceId=o.resource.id):"resourceId"in o&&this.constructor.isProAssignmentModel&&(o.resource=o.resourceId),"event"in o?((a=o.event)==null?void 0:a.id)!==void 0&&(o.eventId=o.event.id):"eventId"in o&&this.constructor.isProAssignmentModel&&(o.event=o.eventId),super.set(o,null,...e)}afterChange(t,n,e,i,a){var o,l;const u=this;return!u.constructor.isProAssignmentModel&&(n!=null&&n.resourceId)&&((o=u.resource)==null?void 0:o.id)!==n.resourceId.value?u.resource=n.resourceId.value:u.constructor.isProAssignmentModel&&((l=u.project)!=null&&l.propagatingSyncChanges)&&(n!=null&&n.eventId)&&!(n!=null&&n.event)&&(t.event.value===n.eventId.value||t.event.value.id===n.eventId.value)&&(delete n.eventId,delete u.meta.modified.eventId),super.afterChange(...arguments)}set resourceId(t){const{resource:n}=this;n!=null&&n.isModel&&n.id===t?this.set("resourceId",t):this.resource=t}get resourceId(){var t,n;return(n=(t=this.resource)==null?void 0:t.id)!=null?n:this.get("resourceId")}set eventId(t){const{event:n}=this;n!=null&&n.isModel&&n.id===t?this.set("eventId",t):this.event=t}get eventId(){var t,n;return(n=(t=this.event)==null?void 0:t.id)!=null?n:this.get("eventId")}get eventName(){var t;return(t=this.event)==null?void 0:t.name}get resourceName(){var t;return(t=this.resource)==null?void 0:t.name}getResource(){return this.resource}get isAssignment(){return!0}get isPersistable(){var t;const{event:n,resource:e,unjoinedStores:i,assignmentStore:a}=this,o=a==null?void 0:a.crudManager;let l;return a?l=this.isValid&&n.isPersistable&&(o||!n.hasGeneratedId&&!e.hasGeneratedId):l=!this.isPhantom&&!!i[0],l&&super.isPersistable&&!((t=this.event)!=null&&t.isCreating)}get isValid(){return this.resource!=null&&this.event!=null}toString(){return this.resourceName?`${this.resourceName} ${Math.round(this.units)}%`:""}shouldRecordFieldChange(t,n,e){var i,a;if(!super.shouldRecordFieldChange(t,n,e))return!1;if(t==="event"||t==="eventId"){const o=(i=this.project)==null?void 0:i.eventStore;if(o&&o.oldIdMap[n]===o.getById(e))return!1}if(t==="resource"||t==="resourceId"){const o=(a=this.project)==null?void 0:a.resourceStore;if(o&&o.oldIdMap[n]===o.getById(e))return!1}return!0}};function Ye(r){return r!=null&&r.isModel?r.id:r}var lt=class extends P([fe],r=>{const s=r.prototype;class t extends r{static get fields(){return[{name:"resource",isEqual:(e,i)=>e===i,persist:!1},{name:"event",isEqual:(e,i)=>e===i,persist:!1}]}setChanged(e,i,a){const{assignmentStore:o,eventStore:l,resourceStore:u,project:c}=this;let d=!1;if(e==="event"){const p=Y(i,G)?i:l==null?void 0:l.$master.getById(i);p&&(d=!0),i=p||i}if(e==="resource"){const p=Y(i,me)?i:u==null?void 0:u.$master.getById(i);p&&(d=!0),i=p||i}s.setChanged.call(this,e,i,a,!0),o&&d&&!c.isPerformingCommit&&!o.isLoadingData&&!(u!=null&&u.isLoadingData)&&!o.skipInvalidateIndices&&o.invalidateIndices()}joinProject(){s.joinProject.call(this),this.setChanged("event",this.get("event")),this.setChanged("resource",this.get("resource"))}calculateInvalidated(){var e,i;let{event:a=this.event,resource:o=this.resource}=this.$changed;if(a!==null&&!Y(a,G)){const l=(e=this.eventStore)==null?void 0:e.getById(a);l&&this.setChanged("event",l,!1)}if(o!==null&&!Y(o,me)){const l=(i=this.resourceStore)==null?void 0:i.getById(o);l&&this.setChanged("resource",l,!1)}}finalizeInvalidated(e){const i=this.$changed;"resource"in i&&(i.resourceId=Ye(i.resource)),"event"in i&&(i.eventId=Ye(i.event)),s.finalizeInvalidated.call(this,e)}set event(e){this.setChanged("event",e),this.setChanged("eventId",Ye(e))}get event(){const e=this.get("event");return(e==null?void 0:e.id)!=null?e:null}set resource(e){this.setChanged("resource",e),this.setChanged("resourceId",Ye(e))}get resource(){const e=this.get("resource");return(e==null?void 0:e.id)!=null?e:null}}return t}){},wn=lt,ye=class extends sr(W(wn.derive(k))){static get $name(){return"AssignmentModel"}};ye.exposeProperties(),ye._$name="AssignmentModel";var ir=r=>class extends r{static get $name(){return"AssignmentStoreMixin"}static get defaultConfig(){return{loadPriority:300,syncPriority:300,storeId:"assignments"}}add(t,...n){var e;t=N.asArray(t);for(let i=0;i<t.length;i++){let a=t[i];if(a instanceof k||(t[i]=a=this.createRecord(a)),!this.isSyncingDataOnLoad&&this.storage.findIndex("eventResourceKey",a.eventResourceKey,!0)!==-1)throw new Error(`Duplicate assignment Event: ${a.eventId} to resource: ${a.resourceId}`);(e=a.event)!=null&&e.isCreating&&(a.isCreating=!0)}return super.add(t,...n)}includesAssignment(t,n){return this.storage.findIndex("eventResourceKey",`${t}-${n}`,!0)!==-1}setStoreData(t){if(this.usesSingleAssignment)throw new Error("Data loading into AssignmentStore (multi-assignment mode) cannot be combined EventStore data containing resourceId (single-assignment mode)");super.setStoreData(t)}set storage(t){super.storage=t,this.storage.addIndex({property:"eventResourceKey",dependentOn:{event:!0,resource:!0},onDuplicate(n){console.warn(`Duplicate assignment of event ${n.eventId} to resource ${n.resourceId}`)}})}get storage(){return this._storage||super.storage}get isAssignmentStore(){return!0}getOccurrence(t,n){if(!t||!(n!=null&&n.isOccurrence))return t;const e=this;return{id:`${n.id}:a${t.id}`,event:n,resource:t.resource,eventId:n.id,resourceId:t.resource.id,isAssignment:!0,isOccurrenceAssignment:!0,instanceMeta(i){return e.occurrenceInstanceMeta(this,i)}}}occurrenceInstanceMeta(t,n){const e=this,i=n.id||n,{id:a}=t;let{occurrenceMeta:o}=e;return o||(o=e.occurrenceMeta={}),o[a]||(o[a]={}),o[a][i]||(o[a][i]={})}mapAssignmentsForEvent(t,n,e){t=this.eventStore.getById(t);const i=!!n,a=!!e;return i||a?t.assignments.reduce((o,l)=>{const u=i?n(l):l;return(!a||e(u))&&o.push(u),o},[]):t.assignments}mapAssignmentsForResource(t,n,e){t=this.resourceStore.getById(t);const i=!!n,a=!!e;return i||a?t.assignments.reduce((o,l)=>{const u=i?n(l):l;return(!a||e(u))&&o.push(u),o},[]):t.assignments}getAssignmentsForEvent(t){return t.assignments}removeAssignmentsForEvent(t){return this.remove(t.assignments)}getAssignmentsForResource(t){return t=this.resourceStore.getById(t),t.assignments}removeAssignmentsForResource(t){this.remove(this.getAssignmentsForResource(t))}getResourcesForEvent(t){return t.resources}getEventsForResource(t){return t=this.resourceStore.getById(t),t==null?void 0:t.events}assignEventToResource(t,n,e=null,i=!1){var a,o,l;const u=this,c=i?new Set(t.assignments):null;if(n=N.asArray(n).map(p=>{var m;return(m=p.$original)!=null?m:p}),(a=u.eventStore)!=null&&a.usesSingleAssignment){if((o=t.assignments)!=null&&o.length)return u.isEventAssignedToResource(t,n[0])||(t.resource=n[0]),[];t.resourceId=(l=n[0])==null?void 0:l.id}let d=[];return u.suspendAutoCommit(),n.forEach(p=>{var m;const f=u.getAssignmentForEventAndResource(t,p);if(f)i&&c.delete(f);else{const I={event:t,resource:p};d.push((m=e==null?void 0:e(I))!=null?m:I)}}),d=u.add(d),i&&u.remove(Array.from(c)),u.resumeAutoCommit(),d}unassignEventFromResource(t,n){const e=this,i=[];if(!n)return e.removeAssignmentsForEvent(t);n=N.asArray(n);for(let a=0;a<n.length;a++)e.isEventAssignedToResource(t,n[a])&&i.push(e.getAssignmentForEventAndResource(t,n[a]));return e.remove(i)}isEventAssignedToResource(t,n){return!!this.getAssignmentForEventAndResource(t,n)}getAssignmentForEventAndResource(t,n){let e;return!(t=this.eventStore.getById(t))||!(e=t.assignments)||!(n=this.resourceStore.$master.getById(n))?null:this.getOccurrence(e.find(i=>{var a;return((a=i.resource)==null?void 0:a.$original)===n.$original}),t)}},Pn=r=>Number(r)!==r,ar=r=>r instanceof Set||r instanceof Array?J(r):J([r]),_n=r=>new Promise(s=>setTimeout(s,r)),jn=(r,...s)=>r.replace(/{(\d+)}/g,(t,n)=>typeof s[n]!="undefined"?s[n]:t),or=class extends P([U],r=>{const s=r.prototype;class t extends r{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.allAssignmentsForRemoval=!1}remove(e,i){this.assignmentsForRemoval=ar(e).toSet();const a=s.remove.call(this,e,i);return this.assignmentsForRemoval.clear(),a}removeAll(e){this.allAssignmentsForRemoval=!0;const i=s.removeAll.call(this,e);return this.allAssignmentsForRemoval=!1,i}}return t}){},lr=new Set,ur=class extends P([or,pe],r=>{const s=r.prototype;class t extends r{constructor(){super(...arguments),this.skipInvalidateIndices=!1}static get defaultConfig(){return{modelClass:lt,storage:{extraKeys:[{property:"event",unique:!1},{property:"resource",unique:!1},{property:"eventId",unique:!1}]}}}set data(e){this.allAssignmentsForRemoval=!0,super.data=e,this.allAssignmentsForRemoval=!1}getEventsAssignments(e){return this.storage.findItem("event",e,!0)||lr}getResourcesAssignments(e){return this.storage.findItem("resource",e.$original,!0)||lr}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}afterLoadData(){this.eventStore&&this.linkAssignments(this.eventStore,"event"),this.resourceStore&&this.linkAssignments(this.resourceStore,"resource")}linkAssignments(e,i){e=e.masterStore||e;const a=this.count&&this.storage.findItem(i,null,!0);if(a){for(const o of a){const l=e.getById(o.getCurrentOrProposed(i));l&&o.setChanged(i,l)}this.invalidateIndices()}}unlinkAssignments(e){this.forEach(i=>{var a,o,l;return i.setChanged(e,(l=(o=(a=i[e])==null?void 0:a.id)!=null?o:i==null?void 0:i.getData(e))!=null?l:i[e+"Id"])}),this.invalidateIndices()}onCommitAsync(){this.updateIndices()}}return t}){},On=W(ur.derive(ee)),De=class extends ir(On){static get defaultConfig(){return{modelClass:ye}}};_(De,"$name","AssignmentStore"),De._$name="AssignmentStore";var Fn=["SS","SF","FS","FF"],Ce=class xt extends k{static get $name(){return"DependencyBaseModel"}static get Type(){return{StartToStart:0,StartToEnd:1,EndToStart:2,EndToEnd:3}}static get fields(){return[{name:"from"},{name:"to"},{name:"type",type:"int",defaultValue:2},{name:"cls",defaultValue:""},{name:"bidirectional",type:"boolean"},{name:"fromSide",type:"string"},{name:"toSide",type:"string"},{name:"lag",type:"number",allowNull:!0,defaultValue:0},{name:"lagUnit",type:"string",defaultValue:"d"},{name:"highlighted",persist:!1,internal:!0}]}construct(s){const t=s[this.fieldMap.from.dataSource],n=s[this.fieldMap.to.dataSource];t!=null&&(s.fromEvent=t),n!=null&&(s.toEvent=n),super.construct(...arguments)}get eventStore(){var s;return this.eventStore||((s=this.unjoinedStores[0])==null?void 0:s.eventStore)}set from(s){const{fromEvent:t}=this;t!=null&&t.isModel&&t.id===s?this.set("from",s):this.fromEvent=s}get from(){return this.get("from")}set to(s){const{toEvent:t}=this;t!=null&&t.isModel&&t.id===s?this.set("to",s):this.toEvent=s}get to(){return this.get("to")}get hardType(){return this.getHardType()}set hardType(s){this.setHardType(s)}getHardType(){return this.get("type")}setHardType(s){let t;return s!==this.hardType&&(t=this.set({type:s,fromSide:null,toSide:null})),t}get lag(){return this.get("lag")}set lag(s){this.setLag(s)}setLag(s,t=this.lagUnit){if(arguments.length===1){typeof s=="number"?this.lag=s:(s=T.parseDuration(s),this.set({lag:s.magnitude,lagUnit:s.unit}));return}s=parseFloat(s),this.set({lag:s,lagUnit:t})}getLag(){return this.lag?`${this.lag<0?"-":"+"}${Math.abs(this.lag)}${T.getShortNameOfUnit(this.lagUnit)}`:""}get fullLag(){return new se({unit:this.lagUnit,magnitude:this.lag})}set fullLag(s){typeof s=="string"?this.setLag(s):this.setLag(s.magnitude,s.unit)}get isPersistable(){const s=this,{stores:t,unjoinedStores:n}=s,e=t[0];let i;if(e){const{fromEvent:a,toEvent:o}=s,l=e.crudManager;i=a&&(l||!a.hasGeneratedId)&&o&&(l||!o.hasGeneratedId)}else i=!!n[0];return i&&super.isPersistable}getDateRange(){const{fromEvent:s,toEvent:t}=this;if(s!=null&&s.isScheduled&&(t!=null&&t.isScheduled)){const n=xt.Type;let e,i;switch(this.type){case n.StartToStart:e=s.startDateMS,i=t.startDateMS;break;case n.StartToEnd:e=s.startDateMS,i=t.endDateMS;break;case n.EndToEnd:e=s.endDateMS,i=t.endDateMS;break;case n.EndToStart:e=s.endDateMS,i=t.startDateMS;break;default:throw new Error("Invalid dependency type: "+this.type)}return{start:Math.min(e,i),end:Math.max(e,i)}}return null}highlight(s){var t,n;const e=(n=(t=this.highlighted)==null?void 0:t.split(" "))!=null?n:[];e.includes(s)||(this.highlighted=e.concat(s).join(" "))}unhighlight(s){const{highlighted:t}=this;if(t){const n=t.split(" "),e=n.indexOf(s);e>=0&&(n.splice(e,1),this.highlighted=n.join(" "))}}isHighlightedWith(s){return this.highlighted&&this.highlighted.split(" ").includes(s)}getConnectorString(s){const t=Fn[this.type];return s?t:this.type===xt.Type.EndToStart?"":t}toString(){return`${this.from}${this.getConnectorString()}${this.getLag()}`}get isValid(){const{fromEvent:s,toEvent:t,type:n}=this;return typeof n=="number"&&s&&t&&s!==t}get fromEventName(){var s;return((s=this.fromEvent)==null?void 0:s.name)||""}get toEventName(){var s;return((s=this.toEvent)==null?void 0:s.name)||""}shouldRecordFieldChange(s,t,n){var e;if(!super.shouldRecordFieldChange(s,t,n))return!1;if(s==="from"||s==="to"||s==="fromEvent"||s==="toEvent"){const i=(e=this.project)==null?void 0:e.eventStore;if(i&&i.oldIdMap[t]===i.getById(n))return!1}return!0}};Ce.exposeProperties(),Ce._$name="DependencyBaseModel";var ut=class extends P([fe],r=>{const s=r.prototype;class t extends r{static get fields(){return[{name:"fromEvent",isEqual:(e,i)=>e===i,persist:!1},{name:"toEvent",isEqual:(e,i)=>e===i,persist:!1}]}setChanged(e,i,a){var o,l,u;let c=!1;if(e==="fromEvent"||e==="toEvent"){const d=Y(i,G)?i:(o=this.eventStore)==null?void 0:o.getById(i);d&&(c=!0),i=d||i}s.setChanged.call(this,e,i,a,!0),c&&!this.project.isPerformingCommit&&!((l=this.dependencyStore)!=null&&l.isLoadingData)&&((u=this.dependencyStore)==null||u.invalidateIndices())}joinProject(){s.joinProject.call(this),this.setChanged("fromEvent",this.get("fromEvent")),this.setChanged("toEvent",this.get("toEvent"))}calculateInvalidated(){var e,i;let{fromEvent:a,toEvent:o}=this.$changed;if(a!==null&&!Y(a,G)){const l=(e=this.eventStore)==null?void 0:e.getById(a);l&&(this.$changed.fromEvent=l)}if(o!==null&&!Y(o,G)){const l=(i=this.eventStore)==null?void 0:i.getById(o);l&&(this.$changed.toEvent=l)}}set fromEvent(e){this.setChanged("fromEvent",e)}get fromEvent(){const e=this.get("fromEvent");return(e==null?void 0:e.id)!=null?e:null}set toEvent(e){this.setChanged("toEvent",e)}get toEvent(){const e=this.get("toEvent");return(e==null?void 0:e.id)!=null?e:null}}return t}){},kn=ut,Re=class extends W(kn.derive(Ce)){static get $name(){return"DependencyModel"}getTypeFromSides(r,s,t){const n=Ce.Type,e=t?"right":"left",i=t?"left":"right";return r===e?s===e?n.StartToStart:n.StartToEnd:s===i?n.EndToEnd:n.EndToStart}};Re.exposeProperties(),Re._$name="DependencyModel";var cr=r=>class extends r{static get $name(){return"DependencyStoreMixin"}static get defaultConfig(){return{loadPriority:400,syncPriority:400,storeId:"dependencies"}}reduceEventDependencies(t,n,e,i=!0,a){return a=a||(o=>this.getEventDependencies(o)),t=N.asArray(t),t.reduce((o,l)=>{l.children&&!i?l.traverse(u=>{o=a(u).reduce(n,o)}):o=a(l).reduce(n,o)},e),e}mapEventDependencies(t,n,e,i,a){return this.reduceEventDependencies(t,(o,l)=>(e(l)&&o.push(l),o),[],i,a)}mapEventPredecessors(t,n,e,i){return this.reduceEventPredecessors(t,(a,o)=>(e(o)&&a.push(o),a),[],i)}mapEventSuccessors(t,n,e,i){return this.reduceEventSuccessors(t,(a,o)=>(e(o)&&a.push(o),a),[],i)}getEventDependencies(t){return[].concat(t.predecessors||[],t.successors||[])}removeEventDependencies(t){this.remove(this.getEventDependencies(t))}removeEventPredecessors(t){this.remove(t.predecessors)}removeEventSuccessors(t,n){this.remove(t.successors)}getBySourceTargetId(t){return this.records.find(n=>t==this.constructor.makeDependencySourceTargetCompositeKey(n.from,n.to))}getDependencyForSourceAndTargetEvents(t,n){return t=k.asId(t),n=k.asId(n),this.getBySourceTargetId(this.constructor.makeDependencySourceTargetCompositeKey(t,n))}getEventsLinkingDependency(t,n){return this.getDependencyForSourceAndTargetEvents(t,n)||this.getDependencyForSourceAndTargetEvents(n,t)}async isValidDependency(t,n,e){let i=t,a=n;return t==null?!1:(t.isDependencyModel&&({fromEvent:i,toEvent:a}=t),i=this.eventStore.getById(i),a=this.eventStore.getById(a),i&&a?!i.project||!a.project?!1:this.project.isValidDependency(i,a,e):t!==n)}isValidDependencyToCreate(t,n,e){return this.isValidDependency(t,n,e)}getHighlightedDependencies(t){return this.records.reduce((n,e)=>(e.isHighlightedWith(t)&&n.push(e),n),[])}static makeDependencySourceTargetCompositeKey(t,n){return`source(${t})-target(${n})`}getTimeSpanDependencies(t){return this.getEventDependencies(t)}},dr=class extends P([U],r=>{const s=r.prototype;class t extends r{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}remove(e,i){this.dependenciesForRemoval=ar(e).toSet();const a=s.remove.call(this,e,i);return this.dependenciesForRemoval.clear(),a}removeAll(e){this.allDependenciesForRemoval=!0;const i=s.removeAll.call(this,e);return this.allDependenciesForRemoval=!1,i}}return t}){},hr=new Set,gr=class extends P([dr,pe],r=>{const s=r.prototype;class t extends r{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}static get defaultConfig(){return{modelClass:ut,storage:{extraKeys:[{property:"fromEvent",unique:!1},{property:"toEvent",unique:!1}]}}}getIncomingDepsForEvent(e){return this.storage.findItem("toEvent",e)||hr}getOutgoingDepsForEvent(e){return this.storage.findItem("fromEvent",e)||hr}set data(e){this.allDependenciesForRemoval=!0,super.data=e,this.allDependenciesForRemoval=!1}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}onCommitAsync(){this.updateIndices()}}return t}){},$n=W(gr.derive(ee)),Ue=class extends cr($n.derive(ee)){static get defaultConfig(){return{modelClass:Re}}};Ue._$name="DependencyStore";var fr=r=>class extends r{static get $name(){return"AbstractCrudManagerValidation"}static get configurable(){return{validateResponse:!0,skipSuccessProperty:!0,crudLoadValidationWarningPrefix:"CrudManager load response error(s):",crudSyncValidationWarningPrefix:"CrudManager sync response error(s):",supportShortSyncResponseNote:'Note: Please consider enabling "supportShortSyncResponse" option to allow less detailed sync responses (https://bryntum.com/products/scheduler/docs/api/Scheduler/crud/AbstractCrudManagerMixin#config-supportShortSyncResponse)',disableValidationNote:'Note: To disable this validation please set the "validateResponse" config to false'}}get crudLoadValidationMandatoryStores(){return[]}getStoreLoadResponseWarnings(t,n,e){const i=[],{storeId:a}=t,o=this.crudLoadValidationMandatoryStores,l={[a]:{}};return n?n.rows||(i.push(`- "${a}" store section should have a "rows" property with an array of the store records.`),l[a].rows=["..."]):o!=null&&o.includes(a)&&(i.push(`- No "${a}" store section found. It should contain the store data.`),l[a].rows=["..."]),i.length&&Object.assign(e,l),i}getLoadResponseWarnings(t){const n=[],e={};return this.skipSuccessProperty||(e.success=!0),this.forEachCrudStore((i,a,o)=>{n.push(...this.getStoreLoadResponseWarnings(o,t==null?void 0:t[a],e))}),n.length&&(n.push(`Please adjust your response to look like this:
`+JSON.stringify(e,null,4).replace(/"\.\.\."/g,"...")),n.push(this.disableValidationNote)),n}validateLoadResponse(t){const n=this.getLoadResponseWarnings(t);n.length&&console.warn(this.crudLoadValidationWarningPrefix+`
`+n.join(`
`))}getStoreSyncResponseWarnings(t,n,e,i){const a=[],o=[],l=[],{storeId:u}=t,c={[u]:{}},d=t.phantomIdField||this.phantomIdField,{modelClass:p}=t.store,{idField:m}=p,f=(e==null?void 0:e.rows)||[],I=(e==null?void 0:e.removed)||[];let M=!1;if(n!=null&&n.added&&(o.push(...n.added.filter(E=>!f.find(D=>D[d]==E[d])&&!I.find(D=>D[d]==E[d]||D[m]==E[d])).map(E=>({[d]:E[d],[m]:"..."}))),o.length)){const E=o.map(D=>"#"+D[d]).join(", ");a.push(`- "${u}" store "rows" section should mention added record(s) ${E} sent in the request. It should contain the added records identifiers (both phantom and "real" ones assigned by the backend).`)}if(this.supportShortSyncResponse)!o.length&&e&&((typeof e!="object"||Array.isArray(e))&&(a.push(`- "${u}" store section should be an Object.`),c[u]["..."]="..."),e.rows&&!Array.isArray(e.rows)&&(a.push(`- "${u}" store "rows" section should be an array`),o.push("...")),e.removed&&!Array.isArray(e.removed)&&(a.push(`- "${u}" store "removed" section should be an array:`),l.push("...")));else{if(n!=null&&n.updated){const E=n.updated.filter(D=>!f.find(S=>S[m]==D[m])).map(D=>({[m]:D[m]}));if(o.push(...E),E.length){const D=E.map(S=>"#"+S[m]).join(", ");a.push(`- "${u}" store "rows" section should mention updated record(s) ${D} sent in the request. It should contain the updated record identifiers.`),M=!0}}if(o.length&&o.push("..."),n!=null&&n.removed&&(l.push(...n.removed.filter(E=>!f.find(D=>D[m]==E[m])).map(E=>({[m]:E[m]}))),l.length)){const E=l.map(D=>"#"+D[m]).join(", ");a.push(`- "${u}" store "removed" section should mention removed record(s) ${E} sent in the request. It should contain the removed record identifiers.`),c[u].removed=l,l.push("..."),M=!0}}return o.length&&(c[u].rows=o),a.length||delete c[u],Object.assign(i,c),{messages:a,showSupportShortSyncResponseNote:M}}getSyncResponseWarnings(t,n){const e=[],i={},a=n.pack;this.skipSuccessProperty||(i.success=!0);let o=!1;return this.forEachCrudStore((l,u,c)=>{const d=this.getStoreSyncResponseWarnings(c,a==null?void 0:a[u],t[u],i);o=o||d.showSupportShortSyncResponseNote,e.push(...d.messages)}),e.length&&(e.push(`Please adjust your response to look like this:
`+JSON.stringify(i,null,4).replace(/"\.\.\.":\s*"\.\.\."/g,",,,").replace(/"\.\.\."/g,"...")),o&&e.push(this.supportShortSyncResponseNote),e.push(this.disableValidationNote)),e}validateSyncResponse(t,n){const e=this.getSyncResponseWarnings(t,n);e.length&&console.warn(this.crudSyncValidationWarningPrefix+`
`+e.join(`
`))}},Ln=class extends Error{},mr=class extends Ln{constructor(r={}){var s,t;super(r.message||r.request&&q.capitalize((s=r.request)==null?void 0:s.type)+" failed"||"Crud Manager request failed"),Object.assign(this,r),this.action=(t=this.request)==null?void 0:t.type}},pr=function(r,s,t){return r.store&&(r=r.store),s.store&&(s=s.store),r=r[t]||0,s=s[t]||0,r<s?-1:r>s?1:0},Nn=function(r,s){return pr(r,s,"loadPriority")},Bn=function(r,s){return pr(r,s,"syncPriority")},ct=r=>{var s;r.$$meta=r.$meta;const t=[];return r.isEvents||t.push(bt),r.isDelayable||t.push(Ge),t.push(fr),s=class extends(r||B).mixin(...t){static get $name(){return"AbstractCrudManagerMixin"}static get defaultConfig(){return{crudRevision:null,crudStores:[],storeIdProperty:"storeId",crudFilterParam:"filter",transport:{},trackResponseType:!1,supportShortSyncResponse:!0,phantomIdField:"$PhantomId",phantomParentIdField:"$PhantomParentId",autoLoad:!1,autoSyncTimeout:100,autoSync:!1,resetIdsBeforeSync:!0,syncApplySequence:[],orderedCrudStores:[],writeAllFields:!1,crudIgnoreUpdates:0,autoSyncSuspendCounter:0,crudLoaded:!1,applyingLoadResponse:!1,applyingSyncResponse:!1,callOnFunctions:!0}}get isCrudManager(){return!0}construct(n={}){this._requestId=0,this.activeRequests={},this.crudStoresIndex={},super.construct(n)}afterConstruct(){super.afterConstruct(),this.autoLoad&&(this._autoLoadPromise=this.doAutoLoad())}get loadUrl(){var n,e;return(e=(n=this.transport)==null?void 0:n.load)==null?void 0:e.url}updateLoadUrl(n){O.setPath(this,"transport.load.url",n)}get syncUrl(){var n,e;return(e=(n=this.transport)==null?void 0:n.sync)==null?void 0:e.url}updateSyncUrl(n){O.setPath(this,"transport.sync.url",n)}getStoreDescriptor(n){return n?n instanceof $?this.crudStores.find(e=>e.store===n):typeof n=="object"?this.crudStoresIndex[n.storeId]:this.crudStoresIndex[n]||this.getStoreDescriptor($.getStore(n)):null}fillStoreDescriptor(n){const{store:e}=n,{storeIdProperty:i=this.storeIdProperty,modelClass:a}=e;return n.storeId||(n.storeId=e[i]||e.id),n.idField||(n.idField=a.idField),n.phantomIdField||(n.phantomIdField=a.phantomIdField),n.phantomParentIdField||(n.phantomParentIdField=a.phantomParentIdField),"writeAllFields"in n||(n.writeAllFields=e.writeAllFields),n}updateCrudStoreIndex(){const n=this.crudStoresIndex={};this.crudStores.forEach(e=>e.storeId&&(n[e.storeId]=e))}getCrudStore(n){const e=this.getStoreDescriptor(n);return e==null?void 0:e.store}forEachCrudStore(n,e=this){if(!n)throw new Error("Iterator function must be provided");this.crudStores.every(i=>n.call(e,i.store,i.storeId,i)!==!1)}set crudStores(n){this._crudStores=[],this.addCrudStore(n);for(const e of this._crudStores)e.loadPriority=e.syncPriority=0}get crudStores(){return this._crudStores}get orderedCrudStores(){return this._orderedCrudStores}set orderedCrudStores(n){return this._orderedCrudStores=n}set syncApplySequence(n){this._syncApplySequence=[],this.addStoreToApplySequence(n)}get syncApplySequence(){return this._syncApplySequence}internalAddCrudStore(n){const e=this;let i;return n instanceof $?i={store:n}:typeof n=="object"?(n.store||(n={storeId:n.id,store:new $(n)}),i=n):i={store:$.getStore(n)},e.fillStoreDescriptor(i),n=i.store,n.setCrudManager?n.setCrudManager(e):n.crudManager=e,n.pageSize=null,(e.loadUrl||e.syncUrl)&&(n.autoCommit=!1,n.autoLoad=!1,(n.createUrl||n.updateUrl||n.deleteUrl||n.readUrl)&&console.warn("You have configured an URL on a Store that is handled by a CrudManager that is also configured with an URL. The Store URL's should be removed.")),e.bindCrudStoreListeners(n),i}addCrudStore(n,e,i){if(n=N.asArray(n),!(n!=null&&n.length))return;const a=this,o=n.map(a.internalAddCrudStore,a);typeof e=="undefined"?a.crudStores.push(...o):(i&&((i instanceof $||typeof i!="object")&&(i=a.getStoreDescriptor(i)),e+=a.crudStores.indexOf(i)),a.crudStores.splice(e,0,...o)),a.orderedCrudStores.push(...o),a.updateCrudStoreIndex()}addPrioritizedStore(n){const e=this;e.hasCrudStore(n)||e.addCrudStore(n,N.findInsertionIndex(n,e.crudStores,Nn)),e.hasApplySequenceStore(n)||e.addStoreToApplySequence(n,N.findInsertionIndex(n,e.syncApplySequence,Bn))}hasCrudStore(n){var e;return(e=this.crudStores)==null?void 0:e.some(i=>i===n||i.store===n||i.storeId===n)}removeCrudStore(n){const e=this,i=e.crudStores,a=i.find(o=>o===n||o.store===n||o.storeId===n);if(a)e.unbindCrudStoreListeners(a.store),delete e.crudStoresIndex[a.storeId],N.remove(i,a),e.syncApplySequence&&e.removeStoreFromApplySequence(n);else throw new Error("Store not found in stores collection")}bindCrudStoreListeners(n){n.ion({name:n.id,addConfirmed:"onCrudStoreChange",change:"onCrudStoreChange",destroy:"onCrudStoreDestroy",thisObj:this})}unbindCrudStoreListeners(n){this.detachListeners(n.id)}addStoreToApplySequence(n,e,i){if(!n)return;n=N.asArray(n);const a=this,o=n.reduce((u,c)=>{const d=a.getStoreDescriptor(c);return d&&u.push(d),u},[]);if(typeof e=="undefined")a.syncApplySequence.push(...o);else{let u=e;i&&((i instanceof $||typeof i!="object")&&(i=a.getStoreDescriptor(i)),u+=a.syncApplySequence.indexOf(i)),a.syncApplySequence.splice(u,0,...o)}const l=a.syncApplySequence.map(({storeId:u})=>u);a.orderedCrudStores=[...a.syncApplySequence],a.crudStores.forEach(u=>{l.includes(u.storeId)||a.orderedCrudStores.push(u)})}removeStoreFromApplySequence(n){const e=this.syncApplySequence.findIndex(i=>i===n||i.store===n||i.storeId===n);e>-1&&(this.syncApplySequence.splice(e,1),this.orderedCrudStores.splice(e,1))}hasApplySequenceStore(n){return this.syncApplySequence.some(e=>e===n||e.store===n||e.storeId===n)}onCrudStoreDestroy({source:n}){this.removeCrudStore(n)}onCrudStoreChange(n){const e=this;e.crudIgnoreUpdates||(e.crudStoreHasChanges(n==null?void 0:n.source)?(e.trigger("hasChanges"),e.autoSync&&e.scheduleAutoSync()):e.trigger("noChanges"))}suspendAutoSync(){this.autoSyncSuspendCounter++}resumeAutoSync(n=!0){const e=this;e.autoSyncSuspendCounter--,e.autoSyncSuspendCounter<=0&&(e.autoSyncSuspendCounter=0,n&&e.autoSync&&e.crudStoreHasChanges()&&e.scheduleAutoSync())}get isAutoSyncSuspended(){return this.autoSyncSuspendCounter>0}scheduleAutoSync(){const n=this;!n.hasTimeout("autoSync")&&!n.isAutoSyncSuspended&&n.setTimeout({name:"autoSync",fn:()=>{n.sync().catch(e=>{})},delay:n.autoSyncTimeout})}async triggerFailedRequestEvents(n,e,i,a){const{options:o,type:l}=n;this.trigger("requestFail",{requestType:l,response:e,responseText:i,responseOptions:a}),this.trigger(l+"Fail",{response:e,responseOptions:a,responseText:i,options:o})}async internalOnResponse(n,e,i){const a=this,o=e?a.decode(e):null,{options:l,type:u}=n;if(e&&!o&&console.error("Failed to parse response: "+e),!o||(a.skipSuccessProperty?o.success===!1:!o.success))a.triggerFailedRequestEvents(n,o,e,i);else if(a.trigger("beforeResponseApply",{requestType:u,response:o})!==!1&&a.trigger(`before${q.capitalize(u)}Apply`,{response:o,options:l})!==!1){if(a.crudRevision=o.revision,await a.applyResponse(n,o,l),a.isDestroyed)return;a.trigger("requestDone",{requestType:u,response:o,responseOptions:i}),a.trigger(u,{response:o,responseOptions:i,options:l}),(u==="load"||!a.crudStoreHasChanges())&&(a.trigger("noChanges"),u==="load"&&a.emitCrudStoreEvents(n.pack.stores,"afterRequest"))}return o}suspendChangeTracking(){this.crudIgnoreUpdates++}resumeChangeTracking(n){this.crudIgnoreUpdates&&!--this.crudIgnoreUpdates&&!n&&this.onCrudStoreChange()}get isChangeTrackingSuspended(){return this.crudIgnoreUpdates>0}crudStoreHasChanges(n){return n?this.isCrudStoreDirty(this.getCrudStore(n)):this.crudStores.some(e=>this.isCrudStoreDirty(e.store))}isCrudStoreDirty(n){return!!n.changes}doAutoLoad(){return this.load().catch(n=>{})}emitCrudStoreEvents(n,e,i){const a={action:"read"+e,...i};for(const o of this.crudStores)n.includes(o.storeId)&&o.store.trigger(e,a)}getLoadPackage(n){const e={type:"load",requestId:this.requestId},i=this.crudStores,a=Object.assign({},n);return delete a.request,e.stores=i.map(o=>{var l;const u=a==null?void 0:a[o.storeId],c=o.pageSize||((l=o.store)==null?void 0:l.pageSize);if(u||c){const d=Object.assign({storeId:o.storeId,page:1},u);return c&&(d.pageSize=c),o.currentPage=d.page,u&&delete a[o.storeId],d}return o.storeId}),Object.assign(e,a),e}loadCrudStore(n,e,i){const a=e==null?void 0:e.rows;i!=null&&i.append||e!=null&&e.append?n.add(a,!1,{clean:!0}):n.data=a,n.trigger("load",{data:a})}loadDataToCrudStore(n,e,i){const a=n.store,o=e==null?void 0:e.rows;a.__loading=!0,o&&this.loadCrudStore(a,e,i,n),a.__loading=!1}loadCrudManagerData(n,e={}){const i=this;i.trigger("beforeLoadCrudManagerData"),i.suspendChangeTracking(),i.crudStores.forEach(a=>{const o=a.storeId,l=n[o];l&&i.loadDataToCrudStore(a,l,e[o])}),i.resumeChangeTracking(!0),i.trigger("loadCrudManagerData")}get isCrudManagerLoading(){return!!(this.activeRequests.load||this.applyingLoadResponse)}get isCrudManagerSyncing(){return!!(this.activeRequests.sync||this.applyingSyncResponse)}get isLoadingOrSyncing(){return!!(this.isCrudManagerLoading||this.isCrudManagerSyncing)}load(n){typeof n=="string"&&(n={request:{url:n}});const e=this,i=e.getLoadPackage(n);return e._autoLoadPromise=null,new Promise((a,o)=>{if(e.trigger("beforeLoad",{pack:i})!==!1){const{load:l}=e.activeRequests;l&&(e.cancelRequest(l.desc,l.reject),e.trigger("loadCanceled",{pack:i}));const u=te.assign({id:i.requestId,data:e.encode(i),type:"load",success:e.onCrudRequestSuccess,failure:e.onCrudRequestFailure,thisObj:e},n==null?void 0:n.request);e.activeRequests.load={type:"load",options:n,pack:i,resolve:a,reject(...c){u.success=u.failure=null,o(...c)},id:i.requestId,desc:e.sendRequest(u)},e.emitCrudStoreEvents(i.stores,"loadStart"),e.trigger("loadStart",{pack:i})}else e.trigger("loadCanceled",{pack:i}),o({cancelled:!0})})}getActiveCrudManagerRequest(n){let e=this.activeRequests[n];return!e&&this.trackResponseType&&(e=Object.values(this.activeRequests)[0]),e}prepareAddedRecordData(n,e){const i=this,{store:a}=e,{isTree:o}=a,l=e.phantomIdField||i.phantomIdField,u=e.phantomParentIdField||i.phantomParentIdField,c=a.modelClass.allFields.filter(m=>m.subStore),d=n.constructor,p=Object.assign(n.persistableData,{[l]:n.id});if(o){const{parent:m}=n;m&&!m.isRoot&&m.isPhantom&&(p[u]=m.id)}return i.resetIdsBeforeSync&&O.deletePath(p,d.idField),c.forEach(m=>{const f=n.get(m.name);f.allCount&&(p[m.dataSource]={added:f.getRange().map(I=>i.prepareAddedRecordData(I,{store:f}))})}),p}prepareAdded(n,e){return n.filter(i=>i.isValid).map(i=>this.prepareAddedRecordData(i,e))}prepareUpdated(n,e){const{store:i}=e,{isTree:a}=i,o=e.writeAllFields||e.writeAllFields!==!1&&this.writeAllFields,l=e.phantomParentIdField||this.phantomParentIdField,u=i.modelClass.allFields.filter(c=>c.subStore);if(e.store.tree){const c=e.store.rootNode;n=n.filter(d=>d!==c)}return n.filter(c=>c.isValid).reduce((c,d)=>{let p;if(o?p=d.persistableData:p=d.modificationDataToWrite,a){const{parent:m}=d;m&&!m.isRoot&&m.isPhantom&&(p[l]=m.id)}return u.forEach(m=>{const f=d.get(m.name);p[m.dataSource]=this.getCrudStoreChanges({store:f})}),O.isEmpty(p)||c.push(p),c},[])}prepareRemoved(n){return n.map(e=>{const i=e.constructor;return O.setPath({},i.idField,e.id)})}getCrudStoreChanges(n){const{store:e}=n;let{added:i=[],modified:a=[],removed:o=[]}=e.changes||{},l;return i.length&&(i=this.prepareAdded(i,n)),a.length&&(a=this.prepareUpdated(a,n)),o.length&&(o=this.prepareRemoved(o)),(i.length||a.length||o.length)&&(l={},i.length&&(l.added=i),a.length&&(l.updated=a),o.length&&(l.removed=o)),l}getChangesetPackage(){const{changes:n}=this;return n||this.forceSync?{type:"sync",requestId:this.requestId,revision:this.crudRevision,...n}:null}get changes(){const n={};return this.crudStores.forEach(e=>{const i=this.getCrudStoreChanges(e);i&&(n[e.storeId]=i)}),Object.keys(n).length>0?n:null}getRowsToApplyChangesTo({store:n,storeId:e},i,a){var o,l;const u=this,{modelClass:c}=n,d=c.idField,{updated:p,removed:m}=a||{};let f,I,M;if(i){M=!0;const E={};f=((o=i.rows)==null?void 0:o.slice())||[],I=((l=i.removed)==null?void 0:l.slice())||[],[...f,...I].forEach(D=>{const S=O.getPath(D,d);E[S]=!0}),u.supportShortSyncResponse&&(p==null||p.forEach(D=>{const S=O.getPath(D,d);E[S]||f.push({[d]:S})}),m==null||m.forEach(D=>{const S=O.getPath(D,d);E[S]||I.push({[d]:S})}))}else(p||m)&&(M=!1,f=p,I=m);return f=f!=null&&f.length?f:null,I=I!=null&&I.length?I:null,{rows:f,removed:I,remote:M}}applyChangesToStore(n,e,i){var a;const o=this,l=n.phantomIdField||o.phantomIdField,{store:u}=n,c=u.modelClass.getFieldDataSource("id"),d=u.modelClass.allFields.filter(S=>S.subStore),{rows:p,removed:m,remote:f}=o.getRowsToApplyChangesTo(n,e,i),I=[],M=[];if(p)for(const S of p)u.getById((a=S[l])!=null?a:S[c])?M.push(S):I.push(S);const E=[];M.length&&d.length&&M.forEach(S=>{var y,h,g;const v=u.getById((y=S[l])!=null?y:S[c]),C=((h=i.added)==null?void 0:h.find(R=>R[l]==S[l]))||((g=i.updated)==null?void 0:g.find(R=>R[c]==S[c])),x={};d.forEach(R=>{const A=v.get(R.name);o.applyChangesToStore({store:A},S[R.dataSource],C==null?void 0:C[R.dataSource]),x[R.dataSource]="foo",delete S[R.dataSource]}),E.push([v,x])});const D=u.applyChangeset({removed:m,added:I,updated:M},null,l,f,!0);return E.forEach(([S,y])=>Object.assign(D.get(S.id),y)),D}applySyncResponse(n,e){var i;const a=this,o=a.orderedCrudStores;a.applyingChangeset=a.applyingSyncResponse=!0,a.suspendChangeTracking();for(const l of o)a.applyChangesToStore(l,n[l.storeId],(i=e==null?void 0:e.pack)==null?void 0:i[l.storeId]);a.resumeChangeTracking(!0),a.applyingChangeset=a.applyingSyncResponse=!1}applyLoadResponse(n,e){this.applyingLoadResponse=!0,this.loadCrudManagerData(n,e),this.applyingLoadResponse=!1}async applyResponse(n,e,i){const a=this;switch(a.trackResponseType&&e.type||n.type){case"load":a.validateResponse&&a.validateLoadResponse(e),a.applyLoadResponse(e,i);break;case"sync":a.validateResponse&&a.validateSyncResponse(e,n),a.applySyncResponse(e,n);break}}applyChangeset(n,e=null,i,a=!1){const o=this,l=a?new Map:void 0;o.suspendAutoSync(),o.suspendChangeTracking();for(const{store:u,phantomIdField:c}of o.orderedCrudStores)if(n[u.id]){const d=u.applyChangeset(n[u.id],e,c||o.phantomIdField,!0,a);d&&l.set(u.id,d)}return o.resumeChangeTracking(!0),o.resumeAutoSync(!1),l}get requestId(){return Number.parseInt(`${Date.now()}${this._requestId++}`)}sync(){const n=this;return n.clearTimeout("autoSync"),n.activeRequests.sync?(n.trigger("syncDelayed"),n.activeSyncPromise=n.activeSyncPromise.finally(()=>n.sync())):n.activeSyncPromise=new Promise((e,i)=>{const a=n.getChangesetPackage();if(!a){e(null);return}n.trigger("beforeSync",{pack:a})!==!1?(n.trigger("syncStart",{pack:a}),n.activeRequests.sync={type:"sync",pack:a,resolve:e,reject:i,id:a.requestId,desc:n.sendRequest({id:a.requestId,data:n.encode(a),type:"sync",success:n.onCrudRequestSuccess,failure:n.onCrudRequestFailure,thisObj:n})}):(n.trigger("syncCanceled",{pack:a}),i({cancelled:!0}))}).catch(e=>{if(e&&!e.cancelled)throw e;return e})}async onCrudRequestSuccess(n,e,i){const a=this,{type:o,id:l}=i;if(a.isDestroyed)return;let u="";i=a.activeRequests[o];try{u=await n.text()}catch(d){}if(a.isDestroyed)return;if((i==null?void 0:i.id)!==l)throw new Error(`Interleaved ${o} operation detected`);a.activeRequests[o]=null;const c=await a.internalOnResponse(i,u,e);if(!a.isDestroyed){if(!c||(a.skipSuccessProperty?(c==null?void 0:c.success)===!1:!(c!=null&&c.success))){const d={rawResponse:n,response:c,request:i};c!=null&&c.message&&(d.message=c.message),i.reject(new mr(d))}a["crud"+q.capitalize(i.type)+"ed"]=!0,i.resolve({response:c,rawResponse:n,responseText:u,request:i})}}async onCrudRequestFailure(n,e,i){var a;const o=this;if(o.isDestroyed)return;i=o.activeRequests[i.type];const l=(a=e==null?void 0:e.abortController)==null?void 0:a.signal;if(!!!(l!=null&&l.aborted)){let c,d="";try{d=await n.text(),c=o.decode(d)}catch(p){}if(o.isDestroyed||(o.triggerFailedRequestEvents(i,c,d,e),o.isDestroyed))return;i.reject(new mr({rawResponse:n,request:i}))}o.activeRequests[i.type]=null}acceptChanges(){this.crudStores.forEach(n=>n.store.acceptChanges())}revertChanges(){this.revertCrudStoreChanges()}revertCrudStoreChanges(){const{usesSingleAssignment:n}=this.eventStore;this.orderedCrudStores.forEach(({store:e})=>(!e.isAssignmentStore||!n)&&e.revertChanges())}doDestroy(){const n=this,{load:e,sync:i}=n.activeRequests;for(e&&n.cancelRequest(e.desc,e.reject),i&&n.cancelRequest(i.desc,i.reject);n.crudStores.length>0;)n.removeCrudStore(n.crudStores[0]);super.doDestroy&&super.doDestroy()}},_(s,"configurable",{loadUrl:null,syncUrl:null,forceSync:null}),_(s,"delayable",{doAutoLoad:"raf"}),s},dt=r=>class jr extends(r||B){static get $name(){return"AjaxTransport"}static get defaultMethod(){return{load:"GET",sync:"POST"}}cancelRequest(t,n){var e;(e=t.abort)==null||e.call(t),this.isDestroying||n({cancelled:!0})}shouldUseBodyForRequestData(t,n,e){return!(n==="HEAD"||n==="GET")&&!e}sendRequest(t){const n=this,{data:e}=t,i=n.transport[t.type]||{},a=te.assign({},i,i.requestConfig);t.url&&(a.url=t.url),a.method=a.method||jr.defaultMethod[t.type],a.params=te.assign(a.params||{},t.params);let{paramName:o}=a;if(n.shouldUseBodyForRequestData(i,a.method,o)?(a.body=e,a.headers=a.headers||{},a.headers["Content-Type"]=a.headers["Content-Type"]||"application/json"):(o=o||"data",a.params[o]=e),!a.url)throw new Error("Trying to request without URL specified");delete a.requestConfig,delete a.paramName;let l,u;function c(){a.queryParams=a.params,delete a.params;let p=!1;const m=te.assign({},a,a.fetchOptions);return l=Nr.fetch(a.url,m),l.catch(f=>{var I,M;l.done=!0,(I=n.trigger)==null||I.call(n,"responseReceived",{success:!1});const E=(M=m.abortController)==null?void 0:M.signal;return E&&(p=E.aborted,p||console.warn(f)),{error:f,cancelled:p}}).then(f=>{var I;l.done=!0,(I=n.trigger)==null||I.call(n,"responseReceived",{success:!!(f!=null&&f.ok)});const M=f!=null&&f.ok?t.success:t.failure;return M==null?void 0:M.call(t.thisObj||n,f,m,t)})}const d=n.trigger("beforeSend",{params:a.params,requestType:t.type,requestConfig:a,config:t});return te.isPromise(d)?u=d.then(c):u=c(),u.abort=()=>{var p;l.done||(p=l.abort)==null||p.call(l)},u}},ht=r=>class extends(r||B){static get $name(){return"JsonEncoder"}static get defaultConfig(){return{encoder:{}}}encode(t){var n;return t=Object.assign({},(n=this.encoder)==null?void 0:n.requestData,t),q.safeJsonStringify(t)}decode(t){return q.safeJsonParse(t)}},vr=r=>class extends(r||B).mixin(ct,dt,ht){static get defaultConfig(){return{project:null}}startConfigure(t){this.getConfig("project"),super.startConfigure(t),this._changesToClear=new Map}async doAutoLoad(){const{project:t}=this;return t&&await t.commitAsync(),super.doAutoLoad()}applyProjectResponse(t){const n=this,{project:e}=n;n.applyingProjectResponse=!0;const i=e.fieldMap.startDate,a=e.fieldMap.endDate,o=O.getPath(t,i.dataSource),l=O.getPath(t,a.dataSource);typeof o=="string"&&O.setPath(t,i.dataSource,i.convert(o)),typeof l=="string"&&O.setPath(t,a.dataSource,a.convert(l)),e.setByDataSource(t),n._changesToClear.set(n,t),n.applyingProjectResponse=!1}loadCrudManagerData(t,n={}){const e=this,{project:i}=e;e.suspendChangeTracking(),super.loadCrudManagerData(...arguments),t!=null&&t.project&&(i.delayEnteringReplica&&i.hasDataInStores?i.ion({recordsUnlinked:()=>{e.suspendChangeTracking(),e.applyProjectResponse(t.project),e.resumeChangeTracking()},once:!0}):e.applyProjectResponse(t.project)),e.resumeChangeTracking()}async sync(){const{project:t}=this;if(this.suspendAutoSync(),t&&await t.commitAsync(),!this.isDestroying)return this.resumeAutoSync(!1),super.sync()}async applyResponse(t,n,e){var i,a,o,l,u,c;const d=this;if(!(d.isDestroyed||(i=d.project)!=null&&i.isDestroyed)){if(d.trigger("beforeApplyResponse"),await super.applyResponse(t,n,e),(n!=null&&n.project||d.supportShortSyncResponse&&((a=t==null?void 0:t.pack)!=null&&a.project))&&d.applyProjectResponse(n.project||((o=t==null?void 0:t.pack)==null?void 0:o.project)),d.project){let p=t.type;d.trackResponseType&&(p=n.type||p);const m=`propagating${q.capitalize(p)}Changes`;d.suspendAutoSync(),d[m]=!0;const f=d.project.isInitialCommit&&!d.project.silenceInitialCommit;await d.project.commitAsync(),d[m]=!1,(l=d.resumeAutoSync)==null||l.call(d,f),(u=d.commitRespondedChanges)==null||u.call(d)}(c=d.trigger)==null||c.call(d,"applyResponse")}}applySyncResponse(...t){var n;const e=this,i=(n=e.project)==null?void 0:n.stm.disabled;i===!1&&e.ignoreRemoteChangesInSTM&&e.project.stm.disable(),super.applySyncResponse(...t),i===!1&&e.project.stm.enable()}shouldClearRecordFieldChange(t,n,e){const i=t.getValue(n);return n=t.getFieldDefinition(n),n!=null&&n.isEqual?n.isEqual(i,e):O.isEqual(i,e)}commitRespondedChanges(){this._changesToClear.forEach((t,n)=>{Object.entries(t).forEach(([e,i])=>{this.shouldClearRecordFieldChange(n,e,i)&&delete n.meta.modified[e]})}),this._changesToClear.clear()}applyChangesToStore(t,n,e,...i){const a=super.applyChangesToStore(t,n,e,...i);if(a.size&&this.project)for(const[o,l]of a){const u=t.store.getById(o);u&&this._changesToClear.set(u,l)}return a}},gt=class extends B.mixin(ct){get revision(){return this.crudRevision}set revision(r){this.crudRevision=r}get json(){return q.safeJsonStringify(this)}set json(r){typeof r=="string"&&(r=q.safeJsonParse(r)),this.forEachCrudStore(s=>{const t=`${s.storeId}Data`;r[t]&&(s.data=r[t])})}static get defaultConfig(){return{stores:null}}construct(r={}){r.stores&&(r.crudStores=r.stores,delete r.stores),super.construct(r)}toJSON(){const r={};return this.forEachCrudStore((s,t)=>r[`${t}Data`]=s.toJSON()),r}get inlineData(){return this.toJSON()}set inlineData(r){this.json=r}set stores(r){r!==this.crudStores&&(this.crudStores=r)}get stores(){return this.crudStores}get isLoading(){return this.isCrudManagerLoading}addStore(...r){return this.addCrudStore(...r)}removeStore(...r){return this.removeCrudStore(...r)}getStore(...r){return this.getCrudStore(...r)}hasChanges(...r){return this.crudStoreHasChanges(...r)}loadData(...r){return this.loadCrudManagerData(...r)}};gt._$name="AbstractCrudManager";var Sr=r=>{var s;return s=class extends(r||k){static get configurable(){return{assignments:null,dependencies:null,resources:null,timeRanges:null}}static get autoExposeFields(){return!1}get assignments(){return this.assignmentStore.allRecords}updateAssignments(t){this.assignmentStore.data=t}get dependencies(){return this.dependencyStore.allRecords}updateDependencies(t){this.dependencyStore.data=t}get resources(){return this.resourceStore.allRecords}updateResources(t){this.resourceStore.data=t}get timeRanges(){return this.timeRangeStore.allRecords}getTimeRanges(t,n){const e=this.timeRangeStore,i=[];for(const a of e)a.isRecurring?i.push(...a.getOccurrencesForDateRange(t,n)):a.startDate<n&&t<a.endDate&&i.push(a);return i}updateTimeRanges(t){this.timeRangeStore.data=t}getResourceTimeRanges(t,n){const e=this.resourceTimeRangeStore,i=[];for(const a of e)a.isRecurring?i.push(...a.getOccurrencesForDateRange(t,n)):a.startDate<n&&(!a.endDate||t<a.endDate)&&i.push(a);return i}},_(s,"$name","ProjectModelCommon"),s},X=class extends K.mixin(Ve){get domId(){return`${this.constructor.domIdPrefix}-${this.id}`}get isResourceTimeRange(){return!0}get resources(){return this.resource?[this.resource]:[]}get $linkedResources(){return this.resources}};_(X,"$name","ResourceTimeRangeModel"),_(X,"fields",["resourceId","timeRangeColor"]),_(X,"relations",{resource:{foreignKey:"resourceId",foreignStore:"resourceStore",relatedCollectionName:"timeRanges",nullFieldOnRemove:!0}}),_(X,"domIdPrefix","resourcetimerange"),X._$name="ResourceTimeRangeModel";var qe=class extends ee.mixin(Fe){static get defaultConfig(){return{loadPriority:500,syncPriority:500,resourceStore:null,modelClass:X,storeId:"resourceTimeRanges"}}set resourceStore(r){this._resourceStore=r,this.isConfiguring||this.initRelations(!0)}get resourceStore(){return this._resourceStore}getResourcesForEvent(r){return[r.resource]}getRanges({resourceRecord:r,startDate:s,endDate:t}){return r.timeRanges.flatMap(e=>e.supportsRecurring?e.getOccurrencesForDateRange(s,t):e.intersectsRange(s,t)?e:[]).sort((e,i)=>e.startDate-i.startDate)}};_(qe,"$name","ResourceTimeRangeStore"),qe._$name="ResourceTimeRangeStore";var le=class extends Yr{get timeZone(){return this.client.project.timeZone}processRecord(r,s){(s||this.client.isLoadingData||r.timeZone!==void 0)&&this.convertRecordToTimeZone(r)}convertRecordToTimeZone(r,s=this.timeZone){var t,n;if(r.timeZone!==s){if(r.$ignoreChange=!0,(t=r.baselines)!=null&&t.count)for(const e of r.baselines)r.timeZone!==e.timeZone&&(e.timeZone=r.timeZone),e.convertToTimeZone(s);if((n=r.occurrences)!=null&&n.length)for(const e of r.occurrences)r.timeZone!==e.timeZone&&(e.timeZone=r.timeZone),e.convertToTimeZone(s);r.convertToTimeZone(s),r.$ignoreChange=!1}}beforeSyncRecord({record:r}){r.timeZone!=null&&(r.$restoreTimeZone=r.timeZone,r.convertToTimeZone())}afterSyncRecord({record:r}){r.$restoreTimeZone&&(r.convertToTimeZone(r.$restoreTimeZone),r.$restoreTimeZone=null)}};_(le,"$name","storeTimeZonePlugin"),_(le,"pluginConfig",{before:["processRecord"],assign:["beforeSyncRecord","afterSyncRecord"]}),le._$name="StoreTimeZonePlugin";var yr=r=>{var s;return s=class extends(r||k){get _storesWithDates(){return[this.taskStore,this.timeRangeStore,this.resourceTimeRangeStore].filter(t=>t)}plugStore(t){t.hasPlugin(le)||t.addPlugins(le)}unplugStore(t){var n;(n=t.plugins.storeTimeZonePlugin)==null||n.destroy()}attachStore(t){super.attachStore(t),t&&this.timeZone!=null&&this._storesWithDates.includes(t)&&(this.plugStore(t),this.convertStoresToTimeZone([t]))}detachStore(t){super.detachStore(t),t&&!t.isDestroyed&&this.timeZone!=null&&(this.convertStoresToTimeZone([t],null),this.unplugStore(t))}relayStoreChange({source:t,action:n,records:e,replaced:i}){const a=this;a.timeZone!=null&&a._storesWithDates.includes(t)&&["add","replace"].includes(n)&&(!(e!=null&&e.length)&&(i!=null&&i.length)&&(e=i),e.length&&e.forEach(o=>o.timeZone=a.timeZone))}convertStoresToTimeZone(t,n=this.timeZone){var e;const i=this,a=(e=i.stm)==null?void 0:e.autoRecord;a&&(i.stm.autoRecord=!1);for(const o of t)o==null||o.forEach(l=>o.plugins.storeTimeZonePlugin.convertRecordToTimeZone(l,n));a&&(i.stmAutoRecord=a)}updateTimeZone(t,n){const e=this,i=e._isConfiguringTimeZone||e.isConfiguring;if(e.trigger("beforeTimeZoneChange",{timeZone:t,oldTimeZone:n,isConfiguring:i}),e.calendarManagerStore.forEach(a=>a.bumpVersion()),e._storesWithDates.forEach(a=>e.plugStore(a)),e.convertStoresToTimeZone(e._storesWithDates),e.startDate){const a=n!=null?z.fromTimeZone(e.startDate,n):e.startDate;e.startDate=t!=null?z.toTimeZone(a,t):a}e.ignoreRecordChanges=!0,e.commitAsync().then(()=>{e.isDestroyed||e.trigger("timeZoneChange",{timeZone:t,oldTimeZone:n,isConfiguring:i}),delete e._isConfiguringTimeZone})}},_(s,"$name","ProjectModelTimeZoneMixin"),_(s,"configurable",{timeZone:{$config:"lazy",value:null}}),s},Ie=class extends K.mixin(Ve){afterConstruct(){this.endDate||(this.endDate=this.startDate),super.afterConstruct()}};_(Ie,"$name","TimeRangeModel"),Ie._$name="TimeRangeModel";var Ee=class extends ee.mixin(Fe){};_(Ee,"$name","TimeRangeStore"),_(Ee,"defaultConfig",{loadPriority:500,syncPriority:500,modelClass:Ie,storeId:"timeRanges"}),Ee._$name="TimeRangeStore";var Dr=r=>{var s;return s=class extends(r||k).mixin(Sr,yr){static get $name(){return"ProjectModelMixin"}static get defaultConfig(){return{stm:{},timeRangeModelClass:Ie,resourceTimeRangeModelClass:X,timeRangeStoreClass:Ee,resourceTimeRangeStoreClass:qe,eventStore:{},assignmentStore:{},dependencyStore:{},resourceStore:{},timeRangesData:null,resourceTimeRangesData:null}}get inlineData(){return q.safeJsonParse(super.json)}set inlineData(t){this.json=t}construct(t={}){super.construct(...arguments),t.timeRangesData&&(this.timeRangeStore.data=t.timeRangesData),t.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=t.resourceTimeRangesData)}afterConstruct(){super.afterConstruct();const t=this;!t.timeRangeStore.stm&&t.stm.addStore(t.timeRangeStore),!t.resourceTimeRangeStore.stm&&t.stm.addStore(t.resourceTimeRangeStore)}attachStore(t){t&&t.ion({name:t.$$name,change:"relayStoreChange",thisObj:this}),super.attachStore(t)}detachStore(t){t&&(this.detachListeners(t.$$name),super.detachStore(t))}relayStoreChange(t){return super.relayStoreChange(t),this.trigger("change",{store:t.source,...t,source:this})}updateTimeRangeStore(t,n){this.detachStore(n),this.attachStore(t),n&&(n.project=null),t&&(t.project=this)}setTimeRangeStore(t){this.timeRangeStore=t}changeTimeRangeStore(t){return t&&!t.isStore&&(t=this.timeRangeStoreClass.new({modelClass:this.timeRangeModelClass},t)),t}updateResourceTimeRangeStore(t,n){this.detachStore(n),this.attachStore(t),n&&(n.project=null),t&&(t.project=this)}changeResourceTimeRangeStore(t){return t&&!t.isStore&&(t=this.resourceTimeRangeStoreClass.new({modelClass:this.resourceTimeRangeModelClass},t)),t}setResourceTimeRangeStore(t){this.resourceTimeRangeStore=t}get events(){return this.eventStore.allRecords}updateEvents(t){this.eventStore.data=t}get resourceTimeRanges(){return this.resourceTimeRangeStore.allRecords}updateResourceTimeRanges(t){this.resourceTimeRangeStore.data=t}async loadInlineData(t){return this.isLoadingInlineData=!0,t.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=t.resourceTimeRangesData),t.timeRangesData&&(this.timeRangeStore.data=t.timeRangesData),super.loadInlineData(t)}toJSON(){const t=this,n={eventsData:t.eventStore.toJSON(),resourcesData:t.resourceStore.toJSON(),dependenciesData:t.dependencyStore.toJSON(),timeRangesData:t.timeRangeStore.toJSON(),resourceTimeRangesData:t.resourceTimeRangeStore.toJSON()};return t.eventStore.usesSingleAssignment||(n.assignmentsData=t.assignmentStore.toJSON()),n}get json(){return super.json}changeJson(t){return typeof t=="string"&&(t=q.safeJsonParse(t)),t}updateJson(t){t&&this.loadInlineData(t)}afterChange(t,n){super.afterChange(...arguments),n.calendar&&this.trigger("calendarChange")}doDestroy(){this.timeRangeStore.destroy(),this.resourceTimeRangeStore.destroy(),super.doDestroy()}},_(s,"configurable",{json:null,timeRangeStore:{value:{},$config:"nullify"},resourceTimeRangeStore:{value:{},$config:"nullify"},events:null,resourceTimeRanges:null}),s},Cr=r=>class extends r{getCurrentConfig(t){const n=this,e=super.getCurrentConfig(t);if(e){for(const i of["eventStore","resourceStore","assignmentStore","dependencyStore","timeRangeStore","resourceTimeRangeStore"]){const a=n[i];if(a){a.count&&(e[a.id+"Data"]=a.getInlineData(t));const o=a.getCurrentConfig(t);o&&Object.keys(o).length>0?e[i]=Object.assign(e[i]||{},o):e[i]&&Object.keys(e[i]).length===0&&delete e[i]}}return n.taskStore.isTaskStore&&(delete e.eventModelClass,delete e.eventStoreClass,delete e.children),e}}},Rr=class extends B{set eventStore(r){const s=this;s.eventStoreDetacher&&s.eventStoreDetacher(),s._eventStore=r,r&&r.autoCommit&&(s.eventStoreDetacher=r.ion({beforecommit:s.onEventStoreBeforeSync,thisObj:s,detachable:!0,prio:100}))}get eventStore(){return this._eventStore}set resourceStore(r){const s=this;s.resourceStoreDetacher&&s.resourceStoreDetacher(),s._resourceStore=r,r&&r.autoCommit&&(s.resourceStoreDetacher=r.ion({beforecommit:s.onResourceStoreBeforeSync,thisObj:s,detachable:!0,prio:100}))}get resourceStore(){return this._resourceStore}set assignmentStore(r){const s=this;s.assignmentStoreDetacher&&s.assignmentStoreDetacher(),s._assignmentStore=r,r&&r.autoSync&&(s.assignmentStoreDetacher=r.ion({beforecommit:s.onAssignmentStoreBeforeSync,thisObj:s,detachable:!0,prio:100}))}get assignmentStore(){return this._assignmentStore}set dependencyStore(r){const s=this;s.dependencyStoreDetacher&&s.dependencyStoreDetacher(),s._dependencyStore=r,r&&r.autoSync&&(s.dependencyStoreDetacher=r.ion({beforecommit:s.onDependencyStoreBeforeSync,thisObj:s,detachable:!0,prio:100}))}get dependencyStore(){return this._dependencyStore}onEventStoreBeforeSync({changes:r}){const s=this;return s.removeNonPersistableRecordsToCreate(r),s.shallContinueSync(r)}onResourceStoreBeforeSync({changes:r}){const s=this;return s.removeNonPersistableRecordsToCreate(r),s.shallContinueSync(r)}onAssignmentStoreBeforeSync({changes:r}){const s=this;return s.removeNonPersistableRecordsToCreate(r),s.shallContinueSync(r)}onDependencyStoreBeforeSync({changes:r}){const s=this;return s.removeNonPersistableRecordsToCreate(r),s.shallContinueSync(r)}removeNonPersistableRecordsToCreate(r){const s=r.added||[];let t,n;for(n=s.length-1;n>=0;--n)t=s[n],t.isPersistable||s.splice(s.indexOf(t),1);s.length===0&&(r.added.length=0)}shallContinueSync(r){return!!(r.added&&r.added.length>0||r.modified&&r.modified.length>0||r.removed&&r.removed.length>0)}};Rr._$name="ModelPersistencyManager";var Ir=(r,s)=>new Date(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds()+s,r.getMilliseconds()),Er=function(){"use strict";var r={version:"1.2.0"};return Array.prototype.indexOf||(Array.prototype.indexOf=function(s){"use strict";if(this==null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(n===0)return-1;var e=0;if(arguments.length>1&&(e=Number(arguments[1]),e!=e?e=0:e!=0&&e!=1/0&&e!=-1/0&&(e=(e>0||-1)*Math.floor(Math.abs(e)))),e>=n)return-1;for(var i=e>=0?e:Math.max(n-Math.abs(e),0);i<n;i++)if(i in t&&t[i]===s)return i;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),r.array={},r.array.sort=function(s,t){s.sort(function(n,e){return+n-+e}),t&&s[0]===0&&s.push(s.shift())},r.array.next=function(s,t,n){for(var e,i=n[0]!==0,a=0,o=t.length-1;o>-1;--o){if(e=t[o],e===s)return e;if(e>s||e===0&&i&&n[1]>s){a=o;continue}break}return t[a]},r.array.nextInvalid=function(s,t,n){for(var e=n[0],i=n[1],a=t.length,o=t[a-1]===0&&e!==0?i:0,l=s,u=t.indexOf(s),c=l;l===(t[u]||o);)if(l++,l>i&&(l=e),u++,u===a&&(u=0),l===c)return;return l},r.array.prev=function(s,t,n){for(var e,i=t.length,a=n[0]!==0,o=i-1,l=0;l<i;l++){if(e=t[l],e===s)return e;if(e<s||e===0&&a&&n[1]<s){o=l;continue}break}return t[o]},r.array.prevInvalid=function(s,t,n){for(var e=n[0],i=n[1],a=t.length,o=t[a-1]===0&&e!==0?i:0,l=s,u=t.indexOf(s),c=l;l===(t[u]||o);)if(l--,l<e&&(l=i),u--,u===-1&&(u=a-1),l===c)return;return l},r.day=r.D={name:"day",range:86400,val:function(s){return s.D||(s.D=r.date.getDate.call(s))},isValid:function(s,t){return r.D.val(s)===(t||r.D.extent(s)[1])},extent:function(s){if(s.DExtent)return s.DExtent;var t=r.M.val(s),n=r.DAYS_IN_MONTH[t-1];return t===2&&r.dy.extent(s)[1]===366&&(n=n+1),s.DExtent=[1,n]},start:function(s){return s.DStart||(s.DStart=r.date.next(r.Y.val(s),r.M.val(s),r.D.val(s)))},end:function(s){return s.DEnd||(s.DEnd=r.date.prev(r.Y.val(s),r.M.val(s),r.D.val(s)))},next:function(s,t){t=t>r.D.extent(s)[1]?1:t;var n=r.date.nextRollover(s,t,r.D,r.M),e=r.D.extent(n)[1];return t=t>e?1:t||e,r.date.next(r.Y.val(n),r.M.val(n),t)},prev:function(s,t){var n=r.date.prevRollover(s,t,r.D,r.M),e=r.D.extent(n)[1];return r.date.prev(r.Y.val(n),r.M.val(n),t>e?e:t||e)}},r.dayOfWeekCount=r.dc={name:"day of week count",range:604800,val:function(s){return s.dc||(s.dc=Math.floor((r.D.val(s)-1)/7)+1)},isValid:function(s,t){return r.dc.val(s)===t||t===0&&r.D.val(s)>r.D.extent(s)[1]-7},extent:function(s){return s.dcExtent||(s.dcExtent=[1,Math.ceil(r.D.extent(s)[1]/7)])},start:function(s){return s.dcStart||(s.dcStart=r.date.next(r.Y.val(s),r.M.val(s),Math.max(1,(r.dc.val(s)-1)*7+1||1)))},end:function(s){return s.dcEnd||(s.dcEnd=r.date.prev(r.Y.val(s),r.M.val(s),Math.min(r.dc.val(s)*7,r.D.extent(s)[1])))},next:function(s,t){t=t>r.dc.extent(s)[1]?1:t;var n=r.date.nextRollover(s,t,r.dc,r.M),e=r.dc.extent(n)[1];t=t>e?1:t;var i=r.date.next(r.Y.val(n),r.M.val(n),t===0?r.D.extent(n)[1]-6:1+7*(t-1));return i.getTime()<=s.getTime()?(n=r.M.next(s,r.M.val(s)+1),r.date.next(r.Y.val(n),r.M.val(n),t===0?r.D.extent(n)[1]-6:1+7*(t-1))):i},prev:function(s,t){var n=r.date.prevRollover(s,t,r.dc,r.M),e=r.dc.extent(n)[1];return t=t>e?e:t||e,r.dc.end(r.date.prev(r.Y.val(n),r.M.val(n),1+7*(t-1)))}},r.dayOfWeek=r.dw=r.d={name:"day of week",range:86400,val:function(s){return s.dw||(s.dw=r.date.getDay.call(s)+1)},isValid:function(s,t){return r.dw.val(s)===(t||7)},extent:function(){return[1,7]},start:function(s){return r.D.start(s)},end:function(s){return r.D.end(s)},next:function(s,t){return t=t>7?1:t||7,r.date.next(r.Y.val(s),r.M.val(s),r.D.val(s)+(t-r.dw.val(s))+(t<=r.dw.val(s)?7:0))},prev:function(s,t){return t=t>7?7:t||7,r.date.prev(r.Y.val(s),r.M.val(s),r.D.val(s)+(t-r.dw.val(s))+(t>=r.dw.val(s)?-7:0))}},r.dayOfYear=r.dy={name:"day of year",range:86400,val:function(s){return s.dy||(s.dy=Math.ceil(1+(r.D.start(s).getTime()-r.Y.start(s).getTime())/r.DAY))},isValid:function(s,t){return r.dy.val(s)===(t||r.dy.extent(s)[1])},extent:function(s){var t=r.Y.val(s);return s.dyExtent||(s.dyExtent=[1,t%4?365:366])},start:function(s){return r.D.start(s)},end:function(s){return r.D.end(s)},next:function(s,t){t=t>r.dy.extent(s)[1]?1:t;var n=r.date.nextRollover(s,t,r.dy,r.Y),e=r.dy.extent(n)[1];return t=t>e?1:t||e,r.date.next(r.Y.val(n),r.M.val(n),t)},prev:function(s,t){var n=r.date.prevRollover(s,t,r.dy,r.Y),e=r.dy.extent(n)[1];return t=t>e?e:t||e,r.date.prev(r.Y.val(n),r.M.val(n),t)}},r.hour=r.h={name:"hour",range:3600,val:function(s){return s.h||(s.h=r.date.getHour.call(s))},isValid:function(s,t){return r.h.val(s)===t},extent:function(){return[0,23]},start:function(s){return s.hStart||(s.hStart=r.date.next(r.Y.val(s),r.M.val(s),r.D.val(s),r.h.val(s)))},end:function(s){return s.hEnd||(s.hEnd=r.date.prev(r.Y.val(s),r.M.val(s),r.D.val(s),r.h.val(s)))},next:function(s,t){t=t>23?0:t;var n=r.date.next(r.Y.val(s),r.M.val(s),r.D.val(s)+(t<=r.h.val(s)?1:0),t);return!r.date.isUTC&&n.getTime()<=s.getTime()&&(n=r.date.next(r.Y.val(n),r.M.val(n),r.D.val(n),t+1)),n},prev:function(s,t){return t=t>23?23:t,r.date.prev(r.Y.val(s),r.M.val(s),r.D.val(s)+(t>=r.h.val(s)?-1:0),t)}},r.minute=r.m={name:"minute",range:60,val:function(s){return s.m||(s.m=r.date.getMin.call(s))},isValid:function(s,t){return r.m.val(s)===t},extent:function(s){return[0,59]},start:function(s){return s.mStart||(s.mStart=r.date.next(r.Y.val(s),r.M.val(s),r.D.val(s),r.h.val(s),r.m.val(s)))},end:function(s){return s.mEnd||(s.mEnd=r.date.prev(r.Y.val(s),r.M.val(s),r.D.val(s),r.h.val(s),r.m.val(s)))},next:function(s,t){var n=r.m.val(s),e=r.s.val(s),i=t>59?60-n:t<=n?60-n+t:t-n,a=new Date(s.getTime()+i*r.MIN-e*r.SEC);return!r.date.isUTC&&a.getTime()<=s.getTime()&&(a=new Date(s.getTime()+(i+120)*r.MIN-e*r.SEC)),a},prev:function(s,t){return t=t>59?59:t,r.date.prev(r.Y.val(s),r.M.val(s),r.D.val(s),r.h.val(s)+(t>=r.m.val(s)?-1:0),t)}},r.month=r.M={name:"month",range:2629740,val:function(s){return s.M||(s.M=r.date.getMonth.call(s)+1)},isValid:function(s,t){return r.M.val(s)===(t||12)},extent:function(){return[1,12]},start:function(s){return s.MStart||(s.MStart=r.date.next(r.Y.val(s),r.M.val(s)))},end:function(s){return s.MEnd||(s.MEnd=r.date.prev(r.Y.val(s),r.M.val(s)))},next:function(s,t){return t=t>12?1:t||12,r.date.next(r.Y.val(s)+(t>r.M.val(s)?0:1),t)},prev:function(s,t){return t=t>12?12:t||12,r.date.prev(r.Y.val(s)-(t>=r.M.val(s)?1:0),t)}},r.second=r.s={name:"second",range:1,val:function(s){return s.s||(s.s=r.date.getSec.call(s))},isValid:function(s,t){return r.s.val(s)===t},extent:function(){return[0,59]},start:function(s){return s},end:function(s){return s},next:function(s,t){var n=r.s.val(s),e=t>59?60-n:t<=n?60-n+t:t-n,i=new Date(s.getTime()+e*r.SEC);return!r.date.isUTC&&i.getTime()<=s.getTime()&&(i=new Date(s.getTime()+(e+7200)*r.SEC)),i},prev:function(s,t,n){return t=t>59?59:t,r.date.prev(r.Y.val(s),r.M.val(s),r.D.val(s),r.h.val(s),r.m.val(s)+(t>=r.s.val(s)?-1:0),t)}},r.time=r.t={name:"time",range:1,val:function(s){return s.t||(s.t=r.h.val(s)*3600+r.m.val(s)*60+r.s.val(s))},isValid:function(s,t){return r.t.val(s)===t},extent:function(){return[0,86399]},start:function(s){return s},end:function(s){return s},next:function(s,t){t=t>86399?0:t;var n=r.date.next(r.Y.val(s),r.M.val(s),r.D.val(s)+(t<=r.t.val(s)?1:0),0,0,t);return!r.date.isUTC&&n.getTime()<s.getTime()&&(n=r.date.next(r.Y.val(n),r.M.val(n),r.D.val(n),r.h.val(n),r.m.val(n),t+7200)),n},prev:function(s,t){return t=t>86399?86399:t,r.date.next(r.Y.val(s),r.M.val(s),r.D.val(s)+(t>=r.t.val(s)?-1:0),0,0,t)}},r.weekOfMonth=r.wm={name:"week of month",range:604800,val:function(s){return s.wm||(s.wm=(r.D.val(s)+(r.dw.val(r.M.start(s))-1)+(7-r.dw.val(s)))/7)},isValid:function(s,t){return r.wm.val(s)===(t||r.wm.extent(s)[1])},extent:function(s){return s.wmExtent||(s.wmExtent=[1,(r.D.extent(s)[1]+(r.dw.val(r.M.start(s))-1)+(7-r.dw.val(r.M.end(s))))/7])},start:function(s){return s.wmStart||(s.wmStart=r.date.next(r.Y.val(s),r.M.val(s),Math.max(r.D.val(s)-r.dw.val(s)+1,1)))},end:function(s){return s.wmEnd||(s.wmEnd=r.date.prev(r.Y.val(s),r.M.val(s),Math.min(r.D.val(s)+(7-r.dw.val(s)),r.D.extent(s)[1])))},next:function(s,t){t=t>r.wm.extent(s)[1]?1:t;var n=r.date.nextRollover(s,t,r.wm,r.M),e=r.wm.extent(n)[1];return t=t>e?1:t||e,r.date.next(r.Y.val(n),r.M.val(n),Math.max(1,(t-1)*7-(r.dw.val(n)-2)))},prev:function(s,t){var n=r.date.prevRollover(s,t,r.wm,r.M),e=r.wm.extent(n)[1];return t=t>e?e:t||e,r.wm.end(r.date.next(r.Y.val(n),r.M.val(n),Math.max(1,(t-1)*7-(r.dw.val(n)-2))))}},r.weekOfYear=r.wy={name:"week of year (ISO)",range:604800,val:function(s){if(s.wy)return s.wy;var t=r.dw.next(r.wy.start(s),5),n=r.dw.next(r.Y.prev(t,r.Y.val(t)-1),5);return s.wy=1+Math.ceil((t.getTime()-n.getTime())/r.WEEK)},isValid:function(s,t){return r.wy.val(s)===(t||r.wy.extent(s)[1])},extent:function(s){if(s.wyExtent)return s.wyExtent;var t=r.dw.next(r.wy.start(s),5),n=r.dw.val(r.Y.start(t)),e=r.dw.val(r.Y.end(t));return s.wyExtent=[1,n===5||e===5?53:52]},start:function(s){return s.wyStart||(s.wyStart=r.date.next(r.Y.val(s),r.M.val(s),r.D.val(s)-(r.dw.val(s)>1?r.dw.val(s)-2:6)))},end:function(s){return s.wyEnd||(s.wyEnd=r.date.prev(r.Y.val(s),r.M.val(s),r.D.val(s)+(r.dw.val(s)>1?8-r.dw.val(s):0)))},next:function(s,t){t=t>r.wy.extent(s)[1]?1:t;var n=r.dw.next(r.wy.start(s),5),e=r.date.nextRollover(n,t,r.wy,r.Y);r.wy.val(e)!==1&&(e=r.dw.next(e,2));var i=r.wy.extent(e)[1],a=r.wy.start(e);return t=t>i?1:t||i,r.date.next(r.Y.val(a),r.M.val(a),r.D.val(a)+7*(t-1))},prev:function(s,t){var n=r.dw.next(r.wy.start(s),5),e=r.date.prevRollover(n,t,r.wy,r.Y);r.wy.val(e)!==1&&(e=r.dw.next(e,2));var i=r.wy.extent(e)[1],a=r.wy.end(e);return t=t>i?i:t||i,r.wy.end(r.date.next(r.Y.val(a),r.M.val(a),r.D.val(a)+7*(t-1)))}},r.year=r.Y={name:"year",range:31556900,val:function(s){return s.Y||(s.Y=r.date.getYear.call(s))},isValid:function(s,t){return r.Y.val(s)===t},extent:function(){return[1970,2099]},start:function(s){return s.YStart||(s.YStart=r.date.next(r.Y.val(s)))},end:function(s){return s.YEnd||(s.YEnd=r.date.prev(r.Y.val(s)))},next:function(s,t){return t>r.Y.val(s)&&t<=r.Y.extent()[1]?r.date.next(t):r.NEVER},prev:function(s,t){return t<r.Y.val(s)&&t>=r.Y.extent()[0]?r.date.prev(t):r.NEVER}},r.fullDate=r.fd={name:"full date",range:1,val:function(s){return s.fd||(s.fd=s.getTime())},isValid:function(s,t){return r.fd.val(s)===t},extent:function(){return[0,3250368e7]},start:function(s){return s},end:function(s){return s},next:function(s,t){return r.fd.val(s)<t?new Date(t):r.NEVER},prev:function(s,t){return r.fd.val(s)>t?new Date(t):r.NEVER}},r.modifier={},r.modifier.after=r.modifier.a=function(s,t){var n=t[0];return{name:"after "+s.name,range:(s.extent(new Date)[1]-n)*s.range,val:s.val,isValid:function(e,i){return this.val(e)>=n},extent:s.extent,start:s.start,end:s.end,next:function(e,i){return i!=n&&(i=s.extent(e)[0]),s.next(e,i)},prev:function(e,i){return i=i===n?s.extent(e)[1]:n-1,s.prev(e,i)}}},r.modifier.before=r.modifier.b=function(s,t){var n=t[t.length-1];return{name:"before "+s.name,range:s.range*(n-1),val:s.val,isValid:function(e,i){return this.val(e)<n},extent:s.extent,start:s.start,end:s.end,next:function(e,i){return i=i===n?s.extent(e)[0]:n,s.next(e,i)},prev:function(e,i){return i=i===n?n-1:s.extent(e)[1],s.prev(e,i)}}},r.compile=function(s){var t=[],n=0,e;for(var i in s){var a=i.split("_"),o=a[0],l=a[1],u=s[i],c=l?r.modifier[l](r[o],u):r[o];t.push({constraint:c,vals:u}),n++}t.sort(function(p,m){var f=p.constraint.range,I=m.constraint.range;return I<f?-1:I>f?1:0}),e=t[n-1].constraint;function d(p){return p==="next"?function(m,f){return m.getTime()>f.getTime()}:function(m,f){return f.getTime()>m.getTime()}}return{start:function(p,m){for(var f=m,I=r.array[p],M=1e3,E;M--&&!E&&f;){E=!0;for(var D=0;D<n;D++){var S=t[D].constraint,y=S.val(f),h=S.extent(f),g=I(y,t[D].vals,h);if(!S.isValid(f,g)){f=S[p](f,g),E=!1;break}}}return f!==r.NEVER&&(f=p==="next"?e.start(f):e.end(f)),f},end:function(p,m){for(var f,I=r.array[p+"Invalid"],M=d(p),E=n-1;E>=0;E--){var D=t[E].constraint,S=D.val(m),y=D.extent(m),h=I(S,t[E].vals,y),g;h!==void 0&&(g=D[p](m,h),g&&(!f||M(f,g))&&(f=g))}return f},tick:function(p,m){return new Date(p==="next"?e.end(m).getTime()+r.SEC:e.start(m).getTime()-r.SEC)},tickSafe:function(p,m){return p==="next"?Ir(e.end(m),1):Ir(e.start(m),-1)},tickStart:function(p){return e.start(p)}}},r.schedule=function(s){if(!s)throw new Error("Missing schedule definition.");if(!s.schedules)throw new Error("Definition must include at least one schedule.");for(var t=[],n=s.schedules.length,e=[],i=s.exceptions?s.exceptions.length:0,a=0;a<n;a++)t.push(r.compile(s.schedules[a]));for(var o=0;o<i;o++)e.push(r.compile(s.exceptions[o]));function l(h,g,v,C,x){var R=S(h),A=g,b=1e6,w=[],F=[],j,L,H=[],Me=h==="next",de,Or=Me?0:1,He=Me?1:0;if(v=v?new Date(v):new Date,!v||!v.getTime())throw new Error("Invalid start date.");for(c(h,t,w,v),p(h,e,F,v);b--&&A&&(j=y(w,R))&&!(C&&R(j,C));){if(i&&(m(h,e,F,j),L=M(h,F,j))){d(h,t,w,L);continue}if(x){var Fr=E(F,R);L=D(h,t,w,j,Fr);var Ke=Me?[new Date(Math.max(v,j)),L?new Date(C?Math.min(L,C):L):void 0]:[L?new Date(C?Math.max(C,L.getTime()+r.SEC):L.getTime()+r.SEC):void 0,new Date(Math.min(v,j.getTime()+r.SEC))];if(de&&Ke[Or].getTime()===de[He].getTime()?(de[He]=Ke[He],A++):(de=Ke,H.push(de)),!L)break;d(h,t,w,L)}else H.push(Me?new Date(Math.max(v,j)):I(t,w,j,C)),f(h,t,w,j);A--}for(var Te=0,kr=H.length;Te<kr;Te++){var be=H[Te];H[Te]=Object.prototype.toString.call(be)==="[object Array]"?[u(be[0]),u(be[1])]:u(be)}return H.length===0?r.NEVER:g===1?H[0]:H}function u(h){if(h instanceof Date&&!isNaN(h.valueOf()))return new Date(h)}function c(h,g,v,C){for(var x=0,R=g.length;x<R;x++)v[x]=g[x].start(h,C)}function d(h,g,v,C){for(var x=S(h),R=0,A=g.length;R<A;R++)v[R]&&!x(v[R],C)&&(v[R]=g[R].start(h,C))}function p(h,g,v,C){for(var x=S(h),R=0,A=g.length;R<A;R++){var b=g[R].start(h,C);b?v[R]=[b,g[R].end(h,b)]:v[R]=r.NEVER}}function m(h,g,v,C){for(var x=S(h),R=0,A=g.length;R<A;R++)if(v[R]&&!x(v[R][0],C)){var b=g[R].start(h,C);b?v[R]=[b,g[R].end(h,b)]:v[R]=r.NEVER}}function f(h,g,v,C){for(var x=0,R=g.length;x<R;x++)if(v[x]&&v[x].getTime()===C.getTime()){const A=g[x].start(h,g[x].tick(h,C));A!==r.NEVER&&A.getTime()===v[x].getTime()?v[x]=g[x].start(h,g[x].tickSafe(h,C)):v[x]=A}}function I(h,g,v,C){for(var x,R=0,A=g.length;R<A;R++)if(g[R]&&g[R].getTime()===v.getTime()){var b=h[R].tickStart(v);if(C&&b<C)return C;(!x||b>x)&&(x=b)}return x}function M(h,g,v){for(var C=S(h),x,R=0,A=g.length;R<A;R++){var b=g[R];b&&!C(b[0],v)&&(!b[1]||C(b[1],v))&&(!x||C(b[1],x))&&(x=b[1])}return x}function E(h,g){for(var v,C=0,x=h.length;C<x;C++)h[C]&&(!v||g(v,h[C][0]))&&(v=h[C][0]);return v}function D(h,g,v,C,x){for(var R=S(h),A,b=0,w=g.length;b<w;b++){var F=v[b];if(F&&F.getTime()===C.getTime()){var j=g[b].end(h,F);if(x&&(!j||R(j,x)))return x;(!A||R(j,A))&&(A=j)}}return A}function S(h){return h==="next"?function(g,v){return!v||g.getTime()>v.getTime()}:function(g,v){return!g||v.getTime()>g.getTime()}}function y(h,g){for(var v=h[0],C=1,x=h.length;C<x;C++)h[C]&&g(v,h[C])&&(v=h[C]);return v}return{isValid:function(h){return l("next",1,h,h)!==r.NEVER},next:function(h,g,v){return l("next",h||1,g,v)},prev:function(h,g,v){return l("prev",h||1,g,v)},nextRange:function(h,g,v){return l("next",h||1,g,v,!0)},prevRange:function(h,g,v){return l("prev",h||1,g,v,!0)}}},r.setTimeout=function(s,t){var n=r.schedule(t),e;s&&i();function i(){var a=Date.now(),o=n.next(2,a);if(!o[0]){e=void 0;return}var l=o[0].getTime()-a;l<1e3&&(l=o[1]?o[1].getTime()-a:1e3),l<2147483647?e=setTimeout(s,l):e=setTimeout(i,2147483647)}return{isDone:function(){return!e},clear:function(){clearTimeout(e)}}},r.setInterval=function(s,t){if(!s)return;var n=r.setTimeout(i,t),e=n.isDone();function i(){e||(s(),n=r.setTimeout(i,t))}return{isDone:function(){return n.isDone()},clear:function(){e=!0,n.clear()}}},r.date={},r.date.timezone=function(s){r.date.build=s?function(e,i,a,o,l,u){return new Date(e,i,a,o,l,u)}:function(e,i,a,o,l,u){return new Date(Date.UTC(e,i,a,o,l,u))};var t=s?"get":"getUTC",n=Date.prototype;r.date.getYear=n[t+"FullYear"],r.date.getMonth=n[t+"Month"],r.date.getDate=n[t+"Date"],r.date.getDay=n[t+"Day"],r.date.getHour=n[t+"Hours"],r.date.getMin=n[t+"Minutes"],r.date.getSec=n[t+"Seconds"],r.date.isUTC=!s},r.date.UTC=function(){r.date.timezone(!1)},r.date.localTime=function(){r.date.timezone(!0)},r.date.UTC(),r.SEC=1e3,r.MIN=r.SEC*60,r.HOUR=r.MIN*60,r.DAY=r.HOUR*24,r.WEEK=r.DAY*7,r.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],r.NEVER=0,r.date.next=function(s,t,n,e,i,a){return r.date.build(s,t!==void 0?t-1:0,n!==void 0?n:1,e||0,i||0,a||0)},r.date.nextRollover=function(s,t,n,e){var i=n.val(s),a=n.extent(s)[1];return(t||a)<=i||t>a?new Date(e.end(s).getTime()+r.SEC):e.start(s)},r.date.prev=function(s,t,n,e,i,a){var o=arguments.length;return t=o<2?11:t-1,n=o<3?r.D.extent(r.date.next(s,t+1))[1]:n,e=o<4?23:e,i=o<5?59:i,a=o<6?59:a,r.date.build(s,t,n,e,i,a)},r.date.prevRollover=function(s,t,n,e){var i=n.val(s);return t>=i||!t?e.start(e.prev(s,e.val(s)-1)):e.start(s)},r.parse={},r.parse.cron=function(s,t){var n={JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12,SUN:1,MON:2,TUE:3,WED:4,THU:5,FRI:6,SAT:7},e={"* * * * * *":"0/1 * * * * *","@YEARLY":"0 0 1 1 *","@ANNUALLY":"0 0 1 1 *","@MONTHLY":"0 0 1 * *","@WEEKLY":"0 0 * * 0","@DAILY":"0 0 * * *","@HOURLY":"0 * * * *"},i={s:[0,0,59],m:[1,0,59],h:[2,0,23],D:[3,1,31],M:[4,1,12],Y:[6,1970,2099],d:[5,1,7,1]};function a(D,S,y){return isNaN(D)?n[D]||null:Math.min(+D+(S||0),y||9999)}function o(D){var S={},y;for(y in D)y!=="dc"&&y!=="d"&&(S[y]=D[y].slice(0));return S}function l(D,S,y,h,g){var v=y;for(D[S]||(D[S]=[]);v<=h;)D[S].indexOf(v)<0&&D[S].push(v),v+=g||1;D[S].sort(function(C,x){return C-x})}function u(D,S,y,h){(S.d&&!S.dc||S.dc&&S.dc.indexOf(h)<0)&&(D.push(o(S)),S=D[D.length-1]),l(S,"d",y,y),l(S,"dc",h,h)}function c(D,S,y){var h={},g={};y===1?(l(S,"D",1,3),l(S,"d",n.MON,n.FRI),l(h,"D",2,2),l(h,"d",n.TUE,n.FRI),l(g,"D",3,3),l(g,"d",n.TUE,n.FRI)):(l(S,"D",y-1,y+1),l(S,"d",n.MON,n.FRI),l(h,"D",y-1,y-1),l(h,"d",n.MON,n.THU),l(g,"D",y+1,y+1),l(g,"d",n.TUE,n.FRI)),D.exceptions.push(h),D.exceptions.push(g)}function d(D,S,y,h,g,v){var C=D.split("/"),x=+C[1],R=C[0];if(R!=="*"&&R!=="0"){var A=R.split("-");h=a(A[0],v,g),g=a(A[1],v,g)||g}l(S,y,h,g,x)}function p(D,S,y,h,g,v){var C,x,R=S.schedules,A=R[R.length-1];D==="L"&&(D=h-1),(C=a(D,v,g))!==null?l(A,y,C,C):(C=a(D.replace("W",""),v,g))!==null?c(S,A,C):(C=a(D.replace("L",""),v,g))!==null?u(R,A,C,h-1):(x=D.split("#")).length===2?(C=a(x[0],v,g),u(R,A,C,a(x[1]))):d(D,A,y,h,g,v)}function m(D){return D.indexOf("#")>-1||D.indexOf("L")>0}function f(D,S){return m(D)&&!m(S)?1:D-S}function I(D){var S={schedules:[{}],exceptions:[]},y=D.replace(/(\s)+/g," ").split(" "),h,g,v,C;for(h in i)if(g=i[h],v=y[g[0]],v&&v!=="*"&&v!=="?"){C=v.split(",").sort(f);var x,R=C.length;for(x=0;x<R;x++)p(C[x],S,h,g[1],g[2],g[3])}return S}function M(D){var S=D.toUpperCase();return e[S]||S}var E=M(s);return I(t?E:"0 "+E)},r.parse.recur=function(){var s=[],t=[],n,e=s,i,a,o,l,u,c,d,p;function m(f,I,M){if(f=l?f+"_"+l:f,n||(e.push({}),n=e[0]),n[f]||(n[f]=[]),i=n[f],o){for(a=[],d=I;d<=M;d+=o)a.push(d);p={n:f,x:o,c:i.length,m:M}}a=u?[I]:c?[M]:a;var E=a.length;for(d=0;d<E;d+=1){var D=a[d];i.indexOf(D)<0&&i.push(D)}a=o=l=u=c=0}return{schedules:s,exceptions:t,on:function(){return a=arguments[0]instanceof Array?arguments[0]:arguments,this},every:function(f){return o=f||1,this},after:function(f){return l="a",a=[f],this},before:function(f){return l="b",a=[f],this},first:function(){return u=1,this},last:function(){return c=1,this},time:function(){for(var f=0,I=a.length;f<I;f++){var M=a[f].split(":");M.length<3&&M.push(0),a[f]=+M[0]*3600+ +M[1]*60+ +M[2]}return m("t"),this},second:function(){return m("s",0,59),this},minute:function(){return m("m",0,59),this},hour:function(){return m("h",0,23),this},dayOfMonth:function(){return m("D",1,c?0:31),this},dayOfWeek:function(){return m("d",1,7),this},onWeekend:function(){return a=[1,7],this.dayOfWeek()},onWeekday:function(){return a=[2,3,4,5,6],this.dayOfWeek()},dayOfWeekCount:function(){return m("dc",1,c?0:5),this},dayOfYear:function(){return m("dy",1,c?0:366),this},weekOfMonth:function(){return m("wm",1,c?0:5),this},weekOfYear:function(){return m("wy",1,c?0:53),this},month:function(){return m("M",1,12),this},year:function(){return m("Y",1970,2450),this},fullDate:function(){for(var f=0,I=a.length;f<I;f++)a[f]=a[f].getTime();return m("fd"),this},customModifier:function(f,I){var M=r.modifier[f];if(!M)throw new Error("Custom modifier "+f+" not recognized!");return l=f,a=arguments[1]instanceof Array?arguments[1]:[arguments[1]],this},customPeriod:function(f){var I=r[f];if(!I)throw new Error("Custom time period "+f+" not recognized!");return m(f,I.extent(new Date)[0],I.extent(new Date)[1]),this},startingOn:function(f){return this.between(f,p.m)},between:function(f,I){return n[p.n]=n[p.n].splice(0,p.c),o=p.x,m(p.n,f,I),this},and:function(){return n=e[e.push({})-1],this},except:function(){return e=t,n=null,this}}},r.parse.text=function(s){var t=r.parse.recur,n=0,e="",i,a={eof:/^$/,fullDate:/^(\d\d\d\d-\d\d-\d\dt\d\d:\d\d:\d\d)\b/,rank:/^((\d\d\d\d)|([2-5]?1(st)?|[2-5]?2(nd)?|[2-5]?3(rd)?|(0|[1-5]?[4-9]|[1-5]0|1[1-3])(th)?))\b/,time:/^((([0]?[1-9]|1[0-2]):[0-5]\d(\s)?(am|pm))|(([0]?\d|1\d|2[0-3]):[0-5]\d))\b/,dayName:/^((sun|mon|tue(s)?|wed(nes)?|thu(r(s)?)?|fri|sat(ur)?)(day)?)\b/,monthName:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(ly|ne)|aug(ust)?|oct(ober)?|(sept|nov|dec)(ember)?)\b/,yearIndex:/^(\d\d\d\d)\b/,every:/^every\b/,after:/^after\b/,before:/^before\b/,second:/^(s|sec(ond)?(s)?)\b/,minute:/^(m|min(ute)?(s)?)\b/,hour:/^(h|hour(s)?)\b/,day:/^(day(s)?( of the month)?)\b/,dayInstance:/^day instance\b/,dayOfWeek:/^day(s)? of the week\b/,dayOfYear:/^day(s)? of the year\b/,weekOfYear:/^week(s)?( of the year)?\b/,weekOfMonth:/^week(s)? of the month\b/,weekday:/^weekday\b/,weekend:/^weekend\b/,month:/^month(s)?\b/,year:/^year(s)?\b/,between:/^between (the)?\b/,start:/^(start(ing)? (at|on( the)?)?)\b/,at:/^(at|@)\b/,and:/^(,|and\b)/,except:/^(except\b)/,also:/(also)\b/,first:/^(first)\b/,last:/^last\b/,in:/^in\b/,of:/^of\b/,onthe:/^on the\b/,on:/^on\b/,through:/(-|^(to|through)\b)/},o={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12,sun:1,mon:2,tue:3,wed:4,thu:5,fri:6,sat:7,"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,for:4};function l(h,g,v,C){return{startPos:h,endPos:g,text:v,type:C}}function u(h){var g=h instanceof Array?h:[h],v=/\s+/,C,x,R,A,b,w;for(g.push(v),b=n;!C||C.type===v;){w=-1,x=e.substring(b),C=l(b,b,e.split(v)[0]);var F,j=g.length;for(F=0;F<j;F++)A=g[F],R=A.exec(x),R&&R.index===0&&R[0].length>w&&(w=R[0].length,C=l(b,b+w,x.substring(0,w),A));C.type===v&&(b=C.endPos)}return C}function c(h){var g=u(h);return n=g.endPos,g}function d(h){for(var g=+S(h),v=E(a.through)?+S(h):g,C=[],x=g;x<=v;x++)C.push(x);return C}function p(h){for(var g=d(h);E(a.and);)g.push.apply(g,d(h));return h===a.dayName&&g.sort((v,C)=>v-C),g}function m(h){var g,v,C,x;E(a.weekend)?h.on(o.sun,o.sat).dayOfWeek():E(a.weekday)?h.on(o.mon,o.tue,o.wed,o.thu,o.fri).dayOfWeek():(g=S(a.rank),h.every(g),v=M(h),E(a.start)?(g=S(a.rank),h.startingOn(g),D(v.type)):E(a.between)&&(C=S(a.rank),E(a.and)&&(x=S(a.rank),h.between(C,x))))}function f(h){E(a.first)?h.first():E(a.last)?h.last():h.on(p(a.rank)),M(h)}function I(h){n=0,e=h,i=-1;for(var g=t();n<e.length&&i<0;){var v=D([a.every,a.after,a.before,a.onthe,a.on,a.of,a.in,a.at,a.and,a.except,a.also]);switch(v.type){case a.every:m(g);break;case a.after:u(a.time).type!==void 0?(g.after(S(a.time)),g.time()):u(a.fullDate).type!==void 0?(g.after(S(a.fullDate)),g.fullDate()):(g.after(S(a.rank)),M(g));break;case a.before:u(a.time).type!==void 0?(g.before(S(a.time)),g.time()):u(a.fullDate).type!==void 0?(g.before(S(a.fullDate)),g.fullDate()):(g.before(S(a.rank)),M(g));break;case a.onthe:f(g);break;case a.on:g.on(p(a.dayName)).dayOfWeek();break;case a.of:g.on(p(a.monthName)).month();break;case a.in:g.on(p(a.yearIndex)).year();break;case a.at:for(g.on(S(a.time)).time();E(a.and);)g.on(S(a.time)).time();break;case a.and:break;case a.also:g.and();break;case a.except:g.except();break;default:i=n}}return{schedules:g.schedules,exceptions:g.exceptions,error:i}}function M(h){var g=D([a.second,a.minute,a.hour,a.dayOfYear,a.dayOfWeek,a.dayInstance,a.day,a.month,a.year,a.weekOfMonth,a.weekOfYear]);switch(g.type){case a.second:h.second();break;case a.minute:h.minute();break;case a.hour:h.hour();break;case a.dayOfYear:h.dayOfYear();break;case a.dayOfWeek:h.dayOfWeek();break;case a.dayInstance:h.dayOfWeekCount();break;case a.day:h.dayOfMonth();break;case a.weekOfMonth:h.weekOfMonth();break;case a.weekOfYear:h.weekOfYear();break;case a.month:h.month();break;case a.year:h.year();break;default:i=n}return g}function E(h){var g=u(h).type===h;return g&&c(h),g}function D(h){var g=c(h);return g.type?g.text=y(g.text,h):i=n,g}function S(h){return D(h).text}function y(h,g){var v=h;switch(g){case a.time:var C=h.split(/(:|am|pm)/),x=C[3]==="pm"&&C[0]<12?parseInt(C[0],10)+12:C[0],R=C[2].trim();v=(x.length===1?"0":"")+x+":"+R;break;case a.rank:v=parseInt(/^\d+/.exec(h)[0],10);break;case a.monthName:case a.dayName:v=o[h.substring(0,3)];break;case a.fullDate:v=new Date(h.toUpperCase());break}return v}return I(s.toLowerCase())},r}();Er.date.localTime();var ze=Er,ft=class extends P([ge],r=>{const s=r.prototype;class t extends r{static get fields(){return["name",{name:"startDate",type:"date"},{name:"endDate",type:"date"},"recurrentStartDate","recurrentEndDate","cls","iconCls",{name:"isWorking",type:"boolean",defaultValue:!1},{name:"priority",type:"number"}]}getCalendar(){return this.stores[0].calendar}resetPriority(){this.priorityField=null,this.getCalendar().getDepth()}getPriorityField(){if(this.priorityField!=null)return this.priorityField;let e=1e4+this.getCalendar().getDepth()*100,i=this.priority;return i==null&&(i=this.isRecurrent()?20:30),this.priorityField=e+i}isRecurrent(){return!!(this.recurrentStartDate&&this.recurrentEndDate&&this.getStartDateSchedule()&&this.getEndDateSchedule())}isStatic(){return!!(this.startDate&&this.endDate)}parseDateSchedule(e){let i=e;if(e&&e!==Object(e)&&(i=ze.parse.text(e),i!==Object(i)||i.error>=0))try{i=JSON.parse(e)}catch(a){return null}return i}getStartDateSchedule(){if(this.startDateSchedule)return this.startDateSchedule;const e=this.parseDateSchedule(this.recurrentStartDate);return this.startDateSchedule=ze.schedule(e)}getEndDateSchedule(){if(this.endDateSchedule)return this.endDateSchedule;if(this.recurrentEndDate==="EOD")return"EOD";const e=this.parseDateSchedule(this.recurrentEndDate);return this.endDateSchedule=ze.schedule(e)}}return t}){},xr=class extends P([U],r=>{const s=r.prototype;class t extends r{constructor(){super(...arguments),this.disableHasLoadedDataToCommitFlag=!0}static get defaultConfig(){return{modelClass:ft}}}return t}){},ue;(function(r){r.Millisecond="millisecond",r.Second="second",r.Minute="minute",r.Hour="hour",r.Day="day",r.Week="week",r.Month="month",r.Quarter="quarter",r.Year="year"})(ue||(ue={}));var mt;(function(r){r.Honor="honor",r.Ignore="ignore",r.Conflict="conflict"})(mt||(mt={}));var pt;(function(r){r.MustStartOn="muststarton",r.MustFinishOn="mustfinishon",r.StartNoEarlierThan="startnoearlierthan",r.StartNoLaterThan="startnolaterthan",r.FinishNoEarlierThan="finishnoearlierthan",r.FinishNoLaterThan="finishnolaterthan",r.AsSoonAsPossible="assoonaspossible",r.AsLateAsPossible="aslateaspossible"})(pt||(pt={}));var vt;(function(r){r.Normal="Normal",r.FixedDuration="FixedDuration",r.FixedEffort="FixedEffort",r.FixedUnits="FixedUnits"})(vt||(vt={}));var St;(function(r){r[r.NoError=0]="NoError",r[r.CyclicDependency=1]="CyclicDependency",r[r.DuplicatingDependency=2]="DuplicatingDependency"})(St||(St={}));var yt;(function(r){r[r.StartToStart=0]="StartToStart",r[r.StartToEnd=1]="StartToEnd",r[r.EndToStart=2]="EndToStart",r[r.EndToEnd=3]="EndToEnd"})(yt||(yt={}));var Dt;(function(r){r.Project="Project",r.FromEvent="FromEvent",r.ToEvent="ToEvent"})(Dt||(Dt={}));var Ct;(function(r){r[r.SchedulerBasic=1]="SchedulerBasic",r[r.SchedulerPro=2]="SchedulerPro",r[r.Gantt=3]="Gantt"})(Ct||(Ct={}));var Rt;(function(r){r.Forward="Forward",r.Backward="Backward",r.None="None"})(Rt||(Rt={}));var Vn=(r,s)=>r&&!s||!r&&s?!1:!r&&!s?!0:r.direction===s.direction&&(r.kind==="own"&&s.kind==="own"||r.kind==="enforced"&&s.kind==="enforced"&&r.enforcedBy===s.enforcedBy||r.kind==="inherited"&&s.kind==="inherited"&&r.inheritedFrom===s.inheritedFrom),It;(function(r){r.Start="Start",r.End="End"})(It||(It={}));var re=new Date(-864e13),Q=new Date(864e13),Yn=r=>{if(!r)return!1;const s=r.getTime();return s!==re.getTime()&&s!==Q.getTime()},ne;(function(r){r[r.Left=0]="Left",r[r.Right=1]="Right"})(ne||(ne={}));var V;(function(r){r[r.FullRangeIterated=0]="FullRangeIterated",r[r.StoppedByIterator=1]="StoppedByIterator",r[r.MaxCacheExtendCyclesReached=2]="MaxCacheExtendCyclesReached",r[r.MaxRangeReached=3]="MaxRangeReached"})(V||(V={}));var Mr=class{constructor(r){this.cacheFilledStartDate=Q,this.cacheFilledEndDate=re,this.intervalsCachingChunkDuration=30,this.intervalsCachingChunkUnit=ue.Day,this.maxCacheExtendCycles=1e3,this.maxRange=5*365*24*60*60*1e3,r&&Object.assign(this,r)}includeWrappingRangeFrom(r,s,t){r.ensureCacheFilledForInterval(s,t),this.intervalCache.includeWrappingRange(r.intervalCache,s,t)}ensureCacheFilledForInterval(r,s){const t=this.cacheFilledStartDate.getTime(),n=this.cacheFilledEndDate.getTime();if(t!==Q.getTime()){const e=r.getTime(),i=s.getTime();if(t<=e&&i<=n)return;if(i<=t)s=new Date(t-1);else if(e>=n)r=new Date(n);else if(t<=e&&e<=n)r=new Date(n+1);else if(t<=i&&i<=n)s=new Date(t-1);else{this.ensureCacheFilledForInterval(r,new Date(t-1)),this.ensureCacheFilledForInterval(new Date(n+1),s);return}}(t===Q.getTime()||r.getTime()<n)&&(this.cacheFilledStartDate=r),(n===re.getTime()||n<s.getTime())&&(this.cacheFilledEndDate=s),this.fillCache(r,s)}fillCache(r,s){throw new Error("Abstract method")}clear(){this.cacheFilledStartDate=Q,this.cacheFilledEndDate=re,this.intervalCache.clear()}forEachAvailabilityInterval(r,s,t){var n;t=t||this;const e=r.startDate,i=r.endDate,a=e&&e.getTime(),o=i&&i.getTime(),l=(n=r.maxRange)!=null?n:this.maxRange,u=r.isForward!==!1;if(u?!e:!i)throw new Error("At least `startDate` or `endDate` is required, depending from the `isForward` option");const c=this.intervalCache;let d=u?e:i,p=u?e:i;const m=p.getTime();for(let f=1;f<this.maxCacheExtendCycles;f++){u?this.ensureCacheFilledForInterval(d,i||T.add(d,this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit)):this.ensureCacheFilledForInterval(e||T.add(d,-this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit),d);let I=c.getIntervalOf(p,u?ne.Left:ne.Right);for(;I;){const M=I.startDate,E=I.endDate;if(u&&o&&M.getTime()>=o||!u&&a&&E.getTime()<=a)return V.FullRangeIterated;if(u&&M.getTime()-m>=l||!u&&m-E.getTime()>=l)return V.MaxRangeReached;if(u&&M.getTime()>=this.cacheFilledEndDate.getTime()||!u&&E.getTime()<=this.cacheFilledStartDate.getTime())break;p=u?E:M;const D=a&&M.getTime()<a?e:M,S=o&&E.getTime()>o?i:E;if(s.call(t,D,S,I.cacheInterval)===!1)return V.StoppedByIterator;I=u?c.getNextInterval(I):c.getPrevInterval(I)}if(u&&p.getTime()===Q.getTime()||!u&&p.getTime()===re.getTime())return V.FullRangeIterated;d=u?this.cacheFilledEndDate:this.cacheFilledStartDate}return V.MaxCacheExtendCyclesReached}},Tr=r=>Array.from(new Set(r)),Un=class Mt{constructor(s){if(this.intervals=[],s&&Object.assign(this,s),!this.calendar)throw new Error("Required attribute `calendar` is missing")}includeInterval(s){if(this.intervals.indexOf(s)==-1){const t=this.intervals.slice();return t.push(s),new Mt({intervals:t,calendar:this.calendar})}else return this}combineWith(s){return new Mt({intervals:this.intervals.concat(s.intervals),calendar:this.calendar})}getIsWorking(){if(this.isWorking!=null)return this.isWorking;const s=this.intervals=this.normalizeIntervals(this.intervals);return this.isWorking=s[0].isWorking}normalizeIntervals(s){const t=Tr(s);return t.sort((n,e)=>e.getPriorityField()-n.getPriorityField()),t}},We=(r,s,t=(n,e)=>n-e)=>{let n=0,e=s.length;for(;n<e;){const i=(n+e)/2|0,a=t(r,s[i]);if(a===0)return{found:!0,index:i};a<0?e=i:n=i+1}return{found:!1,index:e}},ce;(function(r){r[r.Exact=0]="Exact",r[r.Next=1]="Next"})(ce||(ce={}));var qn=class{constructor(r){this.keys=[],this.values=[],this.comparator=r||((s,t)=>s-t)}set(r,s){const t=We(r,this.keys,this.comparator);return t.found?this.values[t.index]=s:(this.keys.splice(t.index,0,r),this.values.splice(t.index,0,s)),t.index}insertAt(r,s,t){this.keys.splice(r,0,s),this.values.splice(r,0,t)}setValueAt(r,s){this.values[r]=s}get(r){const s=We(r,this.keys,this.comparator);return s.found?this.values[s.index]:void 0}getEntryAt(r){return r<this.keys.length?{key:this.keys[r],value:this.values[r]}:void 0}getKeyAt(r){return this.keys[r]}getValueAt(r){return this.values[r]}delete(r){const s=We(r,this.keys,this.comparator);s.found&&this.deleteAt(s.index)}size(){return this.keys.length}deleteAt(r){this.keys.splice(r,1),this.values.splice(r,1)}indexOfKey(r){const s=We(r,this.keys,this.comparator);return{found:s.found?ce.Exact:ce.Next,index:s.index}}map(r){const s=this.keys,t=this.values,n=[];for(let e=0;e<s.length;e++)n.push(r(t[e],s[e],e));return n}getAllEntries(){return this.map((r,s)=>({value:r,key:s}))}clear(){this.keys.length=0,this.values.length=0}},br=class{constructor(r){if(this.points=new qn((s,t)=>s.getTime()-t.getTime()),this.leftInfinityKey=re,this.rightInfinityKey=Q,Object.assign(this,r),this.emptyInterval===void 0||!this.combineIntervalsFn)throw new Error("All of `emptyPoint`, `combineIntervalsFn` are required");this.points.set(this.leftInfinityKey,this.emptyInterval)}size(){return this.points.size()}indexOf(r){return this.points.indexOfKey(r)}getDateAt(r){return this.points.getKeyAt(r)}getPointAt(r){return this.points.getValueAt(r)}getIntervalOf(r,s=ne.Left){let{found:t,index:n}=this.indexOf(r),e;return s===ne.Left?e=t===ce.Exact?n:n-1:e=n-1,this.getIntervalWithStartDateIndex(e)}getPrevInterval(r){return r.startDateIndex===0?null:this.getIntervalWithStartDateIndex(r.startDateIndex-1)}getNextInterval(r){return r.startDateIndex>=this.size()-1?null:this.getIntervalWithStartDateIndex(r.startDateIndex+1)}getIntervalWithStartDateIndex(r){return{startDateIndex:r,startDate:this.getDateAt(r),endDate:r+1<this.size()?this.getDateAt(r+1):this.rightInfinityKey,cacheInterval:this.getPointAt(r)}}addInterval(r,s,t){const n=this.points,{found:e,index:i}=n.indexOfKey(r);let a,o;if(e==ce.Exact){const l=t(o=n.getValueAt(i));n.setValueAt(i,l),a=i+1}else{const l=t(o=n.getValueAt(i-1));n.insertAt(i,r,l),a=i+1}for(;a<n.size()&&!(n.getKeyAt(a).getTime()>=s.getTime());){const u=t(o=n.getValueAt(a));n.setValueAt(a,u),a++}a===n.size()?n.insertAt(n.size(),s,this.emptyInterval):n.getKeyAt(a).getTime()===s.getTime()||n.insertAt(a,s,o)}includeWrappingRange(r,s,t){let n=r.getIntervalOf(s);for(;n&&(this.addInterval(n.startDate,n.endDate,e=>this.combineIntervalsFn(e,n.cacheInterval)),!(n.endDate.getTime()>t.getTime()));)n=r.getNextInterval(n)}getSummary(){return this.points.map((r,s)=>({label:r,date:s}))}clear(){this.points.clear(),this.points.set(this.leftInfinityKey,this.emptyInterval)}},zn=class extends Mr{constructor(r){if(super(r),this.staticIntervalsCached=!1,!this.unspecifiedTimeInterval)throw new Error("Required attribute `unspecifiedTimeInterval` is missing");this.intervalCache=new br({emptyInterval:new Un({intervals:[this.unspecifiedTimeInterval],calendar:this.calendar}),combineIntervalsFn:(s,t)=>s.combineWith(t)})}fillCache(r,s){var t;this.staticIntervalsCached||(this.cacheStaticIntervals(),this.staticIntervalsCached=!0),this.parentCache&&this.includeWrappingRangeFrom(this.parentCache,r,s);const n=r.getTime(),e=s.getTime(),i=this.calendar.ignoreTimeZone?null:(t=this.calendar.project)==null?void 0:t.timeZone;if(n>e)throw new Error("Invalid cache fill interval");const a=ze.NEVER;this.forEachRecurrentInterval(o=>{const l=o.getStartDateSchedule(),u=o.getEndDateSchedule();let c=l.prev(1,r),d;if(u==="EOD"){const f=l.next(1,s);f!==a?d=T.getStartOfNextDay(f,!0):d=a}else d=u.next(1,s);if(c!==a&&c.getTime()===n){const f=l.prev(2,r);f!==a&&f.length===2&&(c=f[1])}if(d!==a&&d.getTime()===e){const f=u.next(2,s);f!==a&&f.length===2&&(d=f[1])}const p=l.next(1/0,c!==a?c:r,d!==a?new Date(d.getTime()-1):s);if(p===a)return;const m=u==="EOD"?p.map(f=>T.getStartOfNextDay(f,!0)):u.next(1/0,new Date(p[0].getTime()+1),d!==a?d:s);m!==a&&(m.length>p.length?m.length=p.length:m.length<p.length&&(p.length=m.length),p.forEach((f,I)=>{let M=f,E=m[I];i!=null&&(M=z.toTimeZone(M,i),E=z.toTimeZone(E,i)),this.intervalCache.addInterval(M,E,D=>D.includeInterval(o))}))})}clear(){this.staticIntervalsCached=!1,super.clear()}cacheStaticIntervals(){this.forEachStaticInterval(r=>{var s;const t=(s=this.calendar.project)==null?void 0:s.timeZone;let{startDate:n,endDate:e}=r;t!=null&&(n=z.toTimeZone(n,t),e=z.toTimeZone(e,t)),this.intervalCache.addInterval(n,e,i=>i.includeInterval(r))})}forEachStaticInterval(r){this.intervalStore.forEach(s=>{s.isStatic()&&r(s)})}forEachRecurrentInterval(r){this.intervalStore.forEach(s=>{s.isRecurrent()&&r(s)})}},Wn=class extends P([ft],r=>{const s=r.prototype;class t extends r{getCalendar(){return this.calendar}getPriorityField(){return this.priorityField!=null?this.priorityField:this.priorityField=this.getCalendar().getDepth()}}return t}){},Ar=class extends P([ge],r=>{const s=r.prototype;class t extends r{constructor(){super(...arguments),this.version=1}static get fields(){return[{name:"version",type:"number"},"name",{name:"unspecifiedTimeIsWorking",type:"boolean",defaultValue:!0},{name:"intervals",type:"store",subStore:!0},"cls","iconCls"]}get intervalStoreClass(){return xr}get intervalStore(){return this.meta.intervalsStore}initIntervalsStore(e){e.storeClass=this.intervalStoreClass,e.modelClass=this.getDefaultConfiguration().calendarIntervalModelClass||this.intervalStoreClass.defaultConfig.modelClass,e.calendar=this}processIntervalsStoreData(e){this.bumpVersion()}isDefault(){const e=this.getProject();return e?this===e.defaultCalendar:!1}getDepth(){return this.childLevel+1}forEachAvailabilityInterval(e,i,a){var o,l;const u=(l=e.maxRange)!=null?l:(o=this.getProject())==null?void 0:o.maxCalendarRange;return u&&(e={...e,maxRange:u}),this.calendarCache.forEachAvailabilityInterval(e,i,a)}accumulateWorkingTime(e,i,a){var o,l,u;if(i===0)return{finalDate:new Date(e),remainingDurationInMs:0};if(isNaN(i))throw new Error("Invalid duration");let c=e;const d=(u=(l=(o=this.getProject())==null?void 0:o.adjustDurationToDST)!=null?l:this.adjustDurationToDST)!=null?u:!1;return this.forEachAvailabilityInterval(a?{startDate:e,isForward:!0}:{endDate:e,isForward:!1},(p,m,f)=>{let I=!0;if(f.getIsWorking()){let M=m.getTime()-p.getTime();if(i<=M){if(d){const E=a?p.getTimezoneOffset()-new Date(p.getTime()+i).getTimezoneOffset():new Date(m.getTime()-i).getTimezoneOffset()-m.getTimezoneOffset();i-=E*60*1e3}c=a?new Date(p.getTime()+i):new Date(m.getTime()-i),i=0,I=!1}else{if(d){const E=p.getTimezoneOffset()-m.getTimezoneOffset();M+=E*60*1e3}c=a?m:p,i-=M}}return I}),{finalDate:new Date(c),remainingDurationInMs:i}}calculateDurationMs(e,i,a=!1){var o,l,u;let c=0;const d=e.getTime()<=i.getTime()||!a?1:-1;d<0&&([e,i]=[i,e]);const p=(u=(l=(o=this.getProject())==null?void 0:o.adjustDurationToDST)!=null?l:this.adjustDurationToDST)!=null?u:!1;return this.forEachAvailabilityInterval({startDate:e,endDate:i},(m,f,I)=>{if(I.getIsWorking()&&(c+=f.getTime()-m.getTime(),p)){const M=m.getTimezoneOffset()-f.getTimezoneOffset();c+=M*60*1e3}}),c*d}calculateEndDate(e,i){const a=i>=0,o=this.accumulateWorkingTime(e,Math.abs(i),a);return o.remainingDurationInMs===0?o.finalDate:null}calculateStartDate(e,i){const a=i<=0,o=this.accumulateWorkingTime(e,Math.abs(i),a);return o.remainingDurationInMs===0?o.finalDate:null}skipNonWorkingTime(e,i=!0){let a;const o=this.forEachAvailabilityInterval(i?{startDate:e,isForward:!0}:{endDate:e,isForward:!1},(l,u,c)=>{if(c.getIsWorking())return a=i?l:u,!1});return o===V.MaxRangeReached||o===V.FullRangeIterated?"empty_calendar":a?new Date(a):new Date(e)}addInterval(e){return this.addIntervals([e])}addIntervals(e){return this.bumpVersion(),this.intervalStore.add(e)}removeInterval(e){return this.removeIntervals([e])}removeIntervals(e){return this.bumpVersion(),this.intervalStore.remove(e)}clearIntervals(e){return e||this.bumpVersion(),this.intervalStore.removeAll(e)}bumpVersion(){this.clearCache(),this.version++}get calendarCache(){if(this.$calendarCache!==void 0)return this.$calendarCache;const e=new Wn({isWorking:this.unspecifiedTimeIsWorking});return e.calendar=this,this.$calendarCache=new zn({calendar:this,unspecifiedTimeInterval:e,intervalStore:this.intervalStore,parentCache:this.parent&&!this.parent.isRoot?this.parent.calendarCache:null})}clearCache(){this.$calendarCache&&this.$calendarCache.clear(),this.$calendarCache=void 0}resetPriorityOfAllIntervals(){this.traverse(e=>{e.intervalStore.forEach(i=>i.resetPriority())})}insertChild(e,i,a){let o=s.insertChild.call(this,...arguments);return Array.isArray(o)||(o=[o]),o.forEach(l=>{l.bumpVersion(),l.resetPriorityOfAllIntervals()}),o}joinProject(){s.joinProject.call(this),this.intervalStore.setProject(this.getProject())}leaveProject(){s.leaveProject.call(this),this.intervalStore.setProject(null),this.clearCache()}doDestroy(){this.leaveProject(),this.intervalStore.destroy(),super.doDestroy()}isDayHoliday(e){const i=T.clearTime(e),a=T.getNext(e,ue.Day);let o=!1;return this.forEachAvailabilityInterval({startDate:i,endDate:a,isForward:!0},(l,u,c)=>(o=c.getIsWorking(),!o)),!o}getDailyHolidaysRanges(e,i){const a=[];for(e=T.clearTime(e);e<i;)this.isDayHoliday(e)&&a.push({startDate:e,endDate:T.getStartOfNextDay(e,!0,!0)}),e=T.getNext(e,ue.Day);return a}getWorkingTimeRanges(e,i,a){const o=[];return this.forEachAvailabilityInterval({startDate:e,endDate:i,isForward:!0,maxRange:a},(l,u,c)=>{if(c.getIsWorking()){const d=c.intervals[0];o.push({name:d.name,startDate:l,endDate:u})}}),o}getNonWorkingTimeRanges(e,i,a){const o=[];return this.forEachAvailabilityInterval({startDate:e,endDate:i,isForward:!0,maxRange:a},(l,u,c)=>{if(!c.getIsWorking()){const d=c.intervals[0];o.push({name:d.name,iconCls:d.iconCls,cls:d.cls,startDate:l,endDate:u})}}),o}isWorkingTime(e,i,a){if(a){let o;const l=this.forEachAvailabilityInterval({startDate:e,endDate:i,isForward:!0},(u,c,d)=>{if(d.getIsWorking()&&u<=e&&c>=i)return o=!0,!1});return l===V.MaxRangeReached||l===V.FullRangeIterated?!1:o}else{const o=this.skipNonWorkingTime(e);return o&&o!=="empty_calendar"?i?o<i:o.getTime()===e.getTime():!1}}}return t}){},wr=class extends P([Ar,fe],r=>{const s=r.prototype;class t extends r{}return t}){},Pr=class extends P([U],r=>{const s=r.prototype;class t extends r{doDestroy(){var e;const i=[];(e=this.rootNode)!=null&&e.isDestroyed||this.traverse(a=>i.push(a)),super.doDestroy(),i.forEach(a=>a.destroy())}}return t}){},Zn=class extends P([Pr,pe],r=>{const s=r.prototype;class t extends r{static get defaultConfig(){return{tree:!0,modelClass:wr}}}return t}){},Hn=class extends P([],bt){},Kn=class extends P([],Ge){},_r=class extends P([Hn,Kn,k],r=>{const s=r.prototype;class t extends r{constructor(){super(...arguments),this.isRestoringData=!1}get isRepopulatingStores(){return!1}get isInitialCommit(){return!this.isInitialCommitPerformed||this.hasLoadedDataToCommit}construct(e={}){this.isInitialCommitPerformed=!1,this.isLoadingInlineData=!1,this.isWritingData=!1,this.hasLoadedDataToCommit=!1;const i="silenceInitialCommit"in e?e.silenceInitialCommit:!0,a="adjustDurationToDST"in e?e.adjustDurationToDST:!1;this.maxCalendarRange="maxCalendarRange"in e?e.maxCalendarRange:15768e7,delete e.maxCalendarRange,delete e.silenceInitialCommit,delete e.adjustDurationToDST,s.construct.call(this,e),this.silenceInitialCommit=i,this.adjustDurationToDST=a}repopulateStore(e){}repopulateReplica(){}deferUntilRepopulationIfNeeded(e,i,a){i(...a)}attachStore(e){}detachStore(e){}async commitAsync(){throw new Error("Abstract method called")}isEngineReady(){throw new Error("Abstract method called")}getStm(){throw new Error("Abstract method called")}}return t}){},Jn=class extends P([],Ge){},Gn=class extends P([_r,tt,Jn,k],r=>{const s=r.prototype;class t extends r{static get configurable(){return{stm:{},eventStore:{},assignmentStore:{},resourceStore:{},dependencyStore:{},calendarManagerStore:{},eventModelClass:ot,assignmentModelClass:lt,resourceModelClass:me,dependencyModelClass:ut,calendarModelClass:wr,eventStoreClass:nr,assignmentStoreClass:ur,resourceStoreClass:Vt,dependencyStoreClass:gr,calendarManagerStoreClass:Zn,assignmentsData:null,calendarsData:null,dependenciesData:null,eventsData:null,resourcesData:null}}construct(e={}){var i;const a=this;if(a.$invalidated=new Set,a.isPerformingCommit=!1,a.silenceInitialCommit=!0,a.ongoing=Promise.resolve(),e.eventStore&&!e.assignmentStore){const m=e.eventStore.masterStore||e.eventStore,f=m.assignmentStore||((i=m.crudManager)==null?void 0:i.assignmentStore);f!=null&&f.isAssignmentStore&&(e.assignmentStore=f,a.isSharingAssignmentStore=!0)}s.construct.call(a,e),a.defaultCalendar=new a.calendarManagerStore.modelClass({unspecifiedTimeIsWorking:a.unspecifiedTimeIsWorking}),a.defaultCalendar.project=a;const{calendarsData:o,eventsData:l,dependenciesData:u,resourcesData:c,assignmentsData:d}=a;!!(o||l||u||c||d)?(a.loadInlineData({calendarsData:o,eventsData:l,dependenciesData:u,resourcesData:c,assignmentsData:d}),delete a.calendarsData,delete a.eventsData,delete a.dependenciesData,delete a.resourcesData,delete a.assignmentsData):a.bufferedCommitAsync()}doDestroy(){var e,i,a,o,l,u;const c=this;(e=c.eventStore)==null||e.destroy(),(i=c.dependencyStore)==null||i.destroy(),(a=c.assignmentStore)==null||a.destroy(),(o=c.resourceStore)==null||o.destroy(),(l=c.calendarManagerStore)==null||l.destroy(),c.defaultCalendar.destroy(),(u=c.stm)==null||u.destroy(),s.doDestroy.call(this)}async loadInlineData(e){const i=this;i.isLoadingInlineData=!0,e.calendarsData&&(i.calendarManagerStore.data=e.calendarsData),e.resourcesData&&(i.resourceStore.data=e.resourcesData),e.assignmentsData&&(i.assignmentStore.data=e.assignmentsData),e.eventsData&&(i.eventStore.data=e.eventsData),e.tasksData&&(i.eventStore.data=e.tasksData),e.dependenciesData&&(i.dependencyStore.data=e.dependenciesData),await i.commitLoad(),i.isLoadingInlineData=!1}async commitLoad(){await this.commitAsync(),this.isDestroyed||this.trigger("load")}joinStoreRecords(e){const i=a=>{a.setProject(this),a.joinProject()};e.rootNode?e.rootNode.traverse(i):e.forEach(i)}unJoinStoreRecords(e){const i=a=>{a.leaveProject(),a.setProject(this)};e.rootNode?e.rootNode.traverse(a=>{a!==e.rootNode&&i(a)}):e.forEach(i)}resolveStoreAndModelClass(e,i){const a=(i==null?void 0:i.storeClass)||this[`${e}StoreClass`];let o=i==null?void 0:i.modelClass;return o||(this.getDefaultConfiguration()[`${e}ModelClass`]!==a.getDefaultConfiguration().modelClass?o=a.getDefaultConfiguration().modelClass:o=this[`${e}ModelClass`]),{storeClass:a,modelClass:o}}setEventStore(e){this.eventStore=e}changeEventStore(e,i){const a=this,{stm:o}=a;if(a.detachStore(i),e instanceof $)e.project=a,o.addStore(e),a.joinStoreRecords(e);else{const{storeClass:l,modelClass:u}=a.resolveStoreAndModelClass("event",e);e=new l(O.assign({modelClass:u,project:a,stm:o},e))}if(i&&o.hasStore(i)){o.removeStore(i),a.unJoinStoreRecords(i);const{assignmentsForRemoval:l}=i;l.forEach(u=>{const c=u.event;if(c){const d=e.getById(c.id);d&&(u.event=d,l.delete(u))}}),i.afterEventRemoval()}return e.setProject(a),e}updateEventStore(e,i){this.attachStore(e),this.trigger("eventStoreChange",{store:e})}setAssignmentStore(e){this.assignmentStore=e}changeAssignmentStore(e,i){const a=this,{stm:o}=a;if(a.detachStore(i),i&&o.hasStore(i)&&(o.removeStore(i),a.unJoinStoreRecords(i)),e instanceof $)e.project=a,o.addStore(e),a.joinStoreRecords(e);else{const{storeClass:l,modelClass:u}=a.resolveStoreAndModelClass("assignment",e);e=new l(O.assign({modelClass:u,project:a,stm:o},e))}return e.setProject(a),e}updateAssignmentStore(e,i){this.attachStore(e),this.trigger("assignmentStoreChange",{store:e})}setResourceStore(e){this.resourceStore=e}changeResourceStore(e,i){const a=this,{stm:o}=a;if(a.detachStore(i),e instanceof $)e.project=a,o.addStore(e),a.joinStoreRecords(e);else{const{storeClass:l,modelClass:u}=a.resolveStoreAndModelClass("resource",e);e=new l(O.assign({modelClass:u,project:a,stm:o},e))}if(i&&o.hasStore(i)){o.removeStore(i),a.unJoinStoreRecords(i);const{assignmentsForRemoval:l}=i;l.forEach(u=>{const c=u.resource;if(c){const d=e.getById(c.id);d&&(u.resource=d,l.delete(u))}}),i.afterResourceRemoval()}return e.setProject(a),e}updateResourceStore(e,i){this.attachStore(e),this.trigger("resourceStoreChange",{store:e})}setDependencyStore(e){this.dependencyStore=e}changeDependencyStore(e,i){const a=this;if(a.detachStore(i),e instanceof $)e.project=a,a.stm.addStore(e),a.joinStoreRecords(e);else{const{storeClass:o,modelClass:l}=a.resolveStoreAndModelClass("dependency",e);e=new o(O.assign({modelClass:l,project:a,stm:a.stm},e))}return e}updateDependencyStore(e,i){this.attachStore(e),this.trigger("dependencyStoreChange",{store:e})}setCalendarManagerStore(e){this.calendarManagerStore=e}changeCalendarManagerStore(e,i){const a=this;if(a.detachStore(i),e instanceof $)a.stm.addStore(e);else{const o=(e==null?void 0:e.storeClass)||a.calendarManagerStoreClass,l=(e==null?void 0:e.modelClass)||o.getDefaultConfiguration().modelClass||a.calendarModelClass;e=new o(O.assign({modelClass:l,project:a,stm:a.stm},e))}return e.setProject(a),e}updateCalendarManagerStore(e,i){this.attachStore(e),this.trigger("calendarManagerStoreChange",{store:e})}get calendar(){return this.$calendar||this.defaultCalendar}set calendar(e){this.$calendar=e}get effectiveCalendar(){return this.calendar}async addEvent(e){return this.eventStore.add(e),this.commitAsync()}async addAssignment(e){return this.assignmentStore.add(e),this.commitAsync()}async addResource(e){return this.resourceStore.add(e),this.commitAsync()}async addDependency(e){return this.dependencyStore.add(e),this.commitAsync()}bufferedCommitAsync(){this.hasPendingAutoCommit||this.setTimeout({fn:"commitAsync",delay:10})}get hasPendingAutoCommit(){return this.hasTimeout("commitAsync")}unScheduleAutoCommit(){this.clearTimeout("commitAsync")}async commitAsync(){return this.isPerformingCommit?this.ongoing:this.ongoing=this.doCommitAsync()}async doCommitAsync(){const e=this;if(e.isPerformingCommit=!0,e.unScheduleAutoCommit(),await _n(0),!e.isDestroyed){for(const u of e.$invalidated)u.calculateInvalidated();const{isInitialCommit:i,silenceInitialCommit:a}=e,o=i&&a;e.assignmentStore.onCommitAsync(),e.dependencyStore.onCommitAsync(),e.isInitialCommitPerformed=!0,e.hasLoadedDataToCommit=!1,e.isPerformingCommit=!1;const l=[e.assignmentStore,e.dependencyStore,e.eventStore,e.resourceStore,e.calendarManagerStore];if(l.forEach(u=>{var c;return(c=u.suspendAutoCommit)==null?void 0:c.call(u)}),e.isWritingData=!0,e.trigger("refresh",{isInitialCommit:i,isCalculated:!0}),o)for(const u of e.$invalidated)u.finalizeInvalidated(!0);else{for(const u of e.$invalidated)u.beginBatch(!0),u.finalizeInvalidated();for(const u of e.$invalidated)u.endBatch(!1,!0)}return e.isWritingData=!1,e.$invalidated.clear(),e.trigger("dataReady"),l.forEach(u=>{var c;return(c=u.resumeAutoCommit)==null?void 0:c.call(u)}),e.trigger("commitFinalized"),!0}}async propagateAsync(){return this.commitAsync()}invalidate(e){this.$invalidated.add(e),this.bufferedCommitAsync()}async isValidDependency(){return!0}getStm(){return this.stm}set stm(e){e=this.$stm=new $r(O.assign({disabled:!0},e)),e.ion({restoringStop:async()=>{e.disable(),await this.commitAsync(),this.isDestroyed||(e.enable(),this.trigger("stateRestoringDone"))}})}get stm(){return this.$stm}isEngineReady(){return!this.hasPendingAutoCommit&&!this.isPerformingCommit&&this.isInitialCommitPerformed}}return t.applyConfigs=!0,t}){},Xn=Gn,xe=class extends Cr(Dr(Xn)){static get $name(){return"ProjectModel"}static get defaultConfig(){return{eventModelClass:ve,dependencyModelClass:Re,resourceModelClass:ae,assignmentModelClass:ye,eventStoreClass:Se,dependencyStoreClass:Ue,resourceStoreClass:_e,assignmentStoreClass:De}}construct(...r){super.construct(...r),ie.isTestEnv&&(globalThis.bryntum.testProject=this),this.modelPersistencyManager=this.createModelPersistencyManager()}createModelPersistencyManager(){return new Rr({eventStore:this,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore})}doDestroy(){this.modelPersistencyManager.destroy(),super.doDestroy()}get taskStore(){return this.eventStore}};xe.applyConfigs=!0,xe.initClass(),xe._$name="ProjectModel";var Et=class extends gt.mixin(vr,dt,ht){static get defaultConfig(){return{projectClass:xe,resourceStoreClass:_e,eventStoreClass:Se,assignmentStoreClass:De,dependencyStoreClass:Ue,resourceStore:{},eventStore:{},assignmentStore:{},dependencyStore:{},project:null}}buildProject(){return new this.projectClass(this.buildProjectConfig())}buildProjectConfig(){return O.cleanupProperties({eventStore:this.eventStore,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore,resourceTimeRangeStore:this.resourceTimeRangeStore})}set project(r){const s=this;r!==s._project&&(s.detachListeners("beforeDataReady"),s.detachListeners("afterDataReady"),s._project=r,r&&(s.eventStore=r.eventStore,s.resourceStore=r.resourceStore,s.assignmentStore=r.assignmentStore,s.dependencyStore=r.dependencyStore,s.timeRangeStore=r.timeRangeStore,s.resourceTimeRangeStore=r.resourceTimeRangeStore,r.ion({name:"beforeDataReady",dataReady:()=>s.suspendChangeTracking(),prio:100,thisObj:s}),r.ion({name:"afterDataReady",dataReady:()=>s.resumeChangeTracking(),prio:-100,thisObj:s})),s.eventStore||(s.eventStore={}),s.resourceStore||(s.resourceStore={}),s.assignmentStore||(s.assignmentStore={}),s.dependencyStore||(s.dependencyStore={}))}get project(){return this._project}get timeRangeStore(){var r;return(r=this._timeRangeStore)==null?void 0:r.store}set timeRangeStore(r){var s;this.setFeaturedStore("_timeRangeStore",r,(s=this.project)==null?void 0:s.timeRangeStoreClass)}get resourceTimeRangeStore(){var r;return(r=this._resourceTimeRangeStore)==null?void 0:r.store}set resourceTimeRangeStore(r){var s;this.setFeaturedStore("_resourceTimeRangeStore",r,(s=this.project)==null?void 0:s.resourceTimeRangeStoreClass)}get resourceStore(){var r;return(r=this._resourceStore)==null?void 0:r.store}set resourceStore(r){const s=this;s.setFeaturedStore("_resourceStore",r,s.resourceStoreClass)}get eventStore(){var r;return(r=this._eventStore)==null?void 0:r.store}set eventStore(r){const s=this;s.setFeaturedStore("_eventStore",r,s.eventStoreClass)}get assignmentStore(){var r;return(r=this._assignmentStore)==null?void 0:r.store}set assignmentStore(r){this.setFeaturedStore("_assignmentStore",r,this.assignmentStoreClass)}get dependencyStore(){var r;return(r=this._dependencyStore)==null?void 0:r.store}set dependencyStore(r){this.setFeaturedStore("_dependencyStore",r,this.dependencyStoreClass)}setFeaturedStore(r,s,t){var n;const e=this,i=(n=e[r])==null?void 0:n.store;return i!==s&&(s=$.getStore(s,(s==null?void 0:s.storeClass)||t),i&&e.removeStore(i),e[r]=s&&{store:s}||null,e.addPrioritizedStore(e[r])),e[r]}getChangesetPackage(){var r,s;const t=super.getChangesetPackage();return t&&(this.eventStore.usesSingleAssignment||(s=(r=this.eventStore.modelClass.fieldMap)==null?void 0:r.resourceIds)!=null&&s.persist)&&(delete t[this.assignmentStore.storeId],!this.crudStores.some(n=>t[n.storeId]))?null:t}get crudLoadValidationMandatoryStores(){return[this._eventStore.storeId,this._resourceStore.storeId]}};_(Et,"$name","CrudManager"),Et._$name="CrudManager";var Qn=r=>{var s;return s=class extends r.mixin(Ur){static get $name(){return"CrudManagerView"}afterConstruct(){super.afterConstruct();const{crudManager:t,project:n}=this;this.loadMask&&(t||n).isCrudManagerLoading&&this.onCrudManagerLoadStart()}applySyncMask(){const{syncMask:t}=this;t&&(this.masked=qr.mergeConfigs(this.loadMaskDefaults,t))}bindCrudManager(t){this.detachListeners("crudManager");let n={};this.isTaskBoardBase||(n={beforeApplyResponse:"onCrudManagerBeforeApplyResponse",applyResponse:"onCrudManagerApplyResponse",beforeLoadCrudManagerData:"onCrudManagerBeforeLoadCrudManagerData",loadCrudManagerData:"onCrudManagerLoadCrudManagerData"}),t==null||t.ion({name:"crudManager",loadStart:"onCrudManagerLoadStart",beforeSend:"onCrudManagerBeforeSend",load:"onCrudManagerLoad",loadCanceled:"onCrudManagerLoadCanceled",syncStart:"onCrudManagerSyncStart",sync:"onCrudManagerSync",syncCanceled:"onCrudManagerSyncCanceled",requestFail:"onCrudManagerRequestFail",responseReceived:"onAjaxTransportResponseReceived",...n,thisObj:this})}onCrudManagerBeforeSend({params:t}){var n;(n=this.applyStartEndParameters)==null||n.call(this,t)}onCrudManagerLoadStart(){var t;this.applyLoadMask(),(t=this.toggleEmptyText)==null||t.call(this)}onCrudManagerSyncStart(){this.applySyncMask()}onCrudManagerBeforeApplyResponse(){this.suspendRefresh()}onCrudManagerApplyResponse(){this.resumeRefresh(!0)}onCrudManagerBeforeLoadCrudManagerData(){this.crudManager.applyingLoadResponse||this.suspendRefresh()}async onCrudManagerLoadCrudManagerData(){this.crudManager.applyingLoadResponse||(await this.project.commitAsync(),!this.isDestroyed&&this.resumeRefresh(!0))}onCrudManagerRequestFinalize(t=!0,n,e){var i;const a=this;t?(i=a.toggleEmptyText)==null||i.call(a):(a.masked||a.applyLoadMask(),a.applyMaskError(`<div class="b-grid-load-failure">
                    <div class="b-grid-load-fail">${a.L(`L{GridBase.${n}FailedMessage}`)}</div>
                    ${e&&e.message?`<div class="b-grid-load-fail">${a.L("L{CrudManagerView.serverResponseLabel}")} ${e.message}</div>`:""}
                </div>`))}onCrudManagerLoadCanceled(){this.onCrudManagerRequestFinalize(!0,"load")}onCrudManagerSyncCanceled(){this.onCrudManagerRequestFinalize(!0,"sync")}onCrudManagerLoad(){this.onCrudManagerRequestFinalize(!0,"load")}onCrudManagerSync(){this.onCrudManagerRequestFinalize(!0,"sync")}onCrudManagerRequestFail({requestType:t,response:n}){this.onCrudManagerRequestFinalize(!1,t,n)}onAjaxTransportResponseReceived(){const t=this;t.clearMaskDelay!=null?t.setTimeout(()=>t.masked=null,t.clearMaskDelay):t.masked=null}get widgetClass(){}},_(s,"config",{clearMaskDelay:null,testConfig:{clearMaskDelay:0}}),s};export{or as AbstractAssignmentStoreMixin,Pr as AbstractCalendarManagerStoreMixin,Ar as AbstractCalendarMixin,gt as AbstractCrudManager,ct as AbstractCrudManagerMixin_default,fr as AbstractCrudManagerValidation_default,dr as AbstractDependencyStoreMixin,rr as AbstractEventStoreMixin,Qt as AbstractHasAssignmentsMixin,Pe as AbstractPartOfProjectGenericMixin,ge as AbstractPartOfProjectModelMixin,U as AbstractPartOfProjectStoreMixin,_r as AbstractProjectMixin,Z as AbstractRecurrenceIterator,Bt as AbstractResourceStoreMixin,dt as AjaxTransport_default,ye as AssignmentModel,sr as AssignmentModelMixin_default,De as AssignmentStore,ir as AssignmentStoreMixin_default,un as Base,J as CI,Mr as CalendarCache,ft as CalendarIntervalMixin,xr as CalendarIntervalStore,V as CalendarIteratorResult,It as ConstraintIntervalSide,pt as ConstraintType,Et as CrudManager,Qn as CrudManagerView_default,ke as DailyRecurrenceIterator,tr as DayIndexMixin_default,Dt as DependenciesCalendar,Ce as DependencyBaseModel,Re as DependencyModel,Ue as DependencyStore,cr as DependencyStoreMixin_default,yt as DependencyType,St as DependencyValidationResult,Rt as Direction,ne as EdgeInclusion,Oe as EventDayIndex,ve as EventModel,Xt as EventModelMixin_default,Se as EventStore,Yt as EventStoreMixin_default,Ut as GetEventsMixin_default,br as IntervalCache,ht as JsonEncoder_default,Q as MAX_DATE,re as MIN_DATE,P as Mixin,ln as MixinAny,Le as MonthlyRecurrenceIterator,dn as PartOfBaseProject_default,W as PartOfProject_default,mt as ProjectConstraintResolution,vr as ProjectCrudManager_default,Cr as ProjectCurrentConfig_default,xe as ProjectModel,Sr as ProjectModelCommon_default,Dr as ProjectModelMixin_default,yr as ProjectModelTimeZoneMixin_default,Ct as ProjectType,oe as RecurrenceDayRuleEncoder,at as RecurrenceModel,Ht as RecurringEventsMixin_default,Ve as RecurringTimeSpan_default,Fe as RecurringTimeSpansMixin_default,ae as ResourceModel,Pt as ResourceModelMixin_default,_e as ResourceStore,wt as ResourceStoreMixin_default,X as ResourceTimeRangeModel,qe as ResourceTimeRangeStore,vt as SchedulingMode,le as StoreTimeZonePlugin,Ie as TimeRangeModel,Ee as TimeRangeStore,K as TimeSpan,ue as TimeUnit,At as TimeZonedDatesMixin_default,$e as WeeklyRecurrenceIterator,Ne as YearlyRecurrenceIterator,Qr as concat,Ft as concatIterable,jn as format,Yn as isDateFinite,Vn as isEqualEffectiveDirection,Y as isInstanceOf,Pn as isNotNumber,jt as map,Tr as stripDuplicates,Ot as uniqueOnly};
//# sourceMappingURL=chunk-KVD75ID2.js.map
