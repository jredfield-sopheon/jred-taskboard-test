/*!
 *
 * Bryntum TaskBoard 5.6.2
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
import{Clipboardable_default as Ct,DragHelper as wt,FieldFilterPicker as Y,FieldFilterPickerGroup as vt,MessageDialog_default as pe,ResizeHelper as St,WidgetHelper as be,filterableFieldDataTypes as yt,isFilterableField as xt,isSupportedDurationField as Rt}from"./chunk-6ZLMCHE5.js";import{GridRowModel as qe}from"./chunk-4NB7OJYA.js";import{AjaxStore as Et,ArrayHelper as H,Base as z,BrowserHelper as k,Checkbox as Ft,Collection as _t,CollectionFilter as Ue,Config as It,ContextMenuBase as Xe,DateHelper as Te,Delayable_default as Le,DomClassList as Ce,DomDataStore as B,DomHelper as m,DomSync as we,Duration as Ye,Editor as Ht,EventHelper as j,Events_default as Mt,GlobalEvents_default as D,InstancePlugin as P,LoadMaskable_default as Tt,LocaleHelper as Lt,LocaleManager_default as Je,Localizable_default as Qe,Mask as Dt,Model as At,ObjectHelper as x,Objects as kt,Panel as Ot,Pluggable_default as Bt,Rectangle as M,ScrollManager as Ze,Scroller as De,State_default as Pt,Store as Ae,StringHelper as T,TemplateHelper as se,Tooltip as et,VersionHelper as $,Widget as J,__publicField as F}from"./chunk-MZVS5JQA.js";var R=class W{constructor(t){if(t){if(t.isLocation)return t;if(t.nodeType===Node.ELEMENT_NODE){const e=J.fromElement(t,"gridbase"),r=e&&t.closest(e.focusableSelector);if(r){const{dataset:l}=r.parentNode;this.init({grid:e,rowIndex:e.store.includes(l.id)?e.store.indexOf(l.id):l.index||-1,columnId:r.dataset.columnId}),this.initialTarget=t}}else this.init(t)}}init(t){var e,r;const l=this,o=l.grid=t.grid,{store:s,columns:n}=o,{visibleColumns:a}=n;if(t.target&&(l.actionTargets=[l._target=t.target]),t.record)l._id=t.record.id;else if("id"in t)l._id=t.id,t.id==null&&(l._rowIndex=-1);else{const d=isNaN(t.row)?isNaN(t.rowIndex)?NaN:t.rowIndex:t.row;l._rowIndex=Math.max(Math.min(Number(d),s.count-1),o.hideHeaders?0:-1),l._id=(e=s.getAt(l._rowIndex))==null?void 0:e.id}if("_rowIndex"in l||(l._rowIndex=s.indexOf(l.id)),l.isSpecialRow=(r=l.record)==null?void 0:r.isSpecialRow,"columnId"in t)l._column=n.getById(t.columnId);else if("field"in t)l._column=n.get(t.field);else{const d=isNaN(t.column)?isNaN(t.columnIndex)?NaN:t.columnIndex:t.column;isNaN(d)?l._column="column"in t?isNaN(t.column)?t.column:a[t.column]:a[0]:(l._columnIndex=Math.min(Number(d),a.length-1),l._column=a[l._columnIndex])}"_columnIndex"in l||(l._columnIndex=a.indexOf(l._column))}get isLocation(){return!0}equals(t,e=!1){const r=this;return(t==null?void 0:t.isLocation)&&t.grid===r.grid&&(e?r.id===t.id&&r._column===t._column:t.record===r.record&&t.column===r.column&&t.target===r.target)}get rowIndex(){const{_id:t}=this,{store:e}=this.grid;return e.includes(t)?e.indexOf(t):Math.min(this._rowIndex,e.count-1)}get visibleRowIndex(){const{rowManager:t}=this.grid,{rowIndex:e}=this;return e===-1?e:Math.max(Math.min(e,t.lastFullyVisibleTow.dataIndex),t.firstFullyVisibleTow.dataIndex)}get isSelectable(){return this.grid.store.includes(this._id)&&!this.isSpecialRow}get record(){if(this._rowIndex>-1){const{store:t}=this.grid;return t.includes(this._id)?t.getById(this._id):t.getAt(this._rowIndex)}}get id(){return this._id}get column(){const{visibleColumns:t}=this.grid.columns;return t!=null&&t.includes(this._column)?this._column:t==null?void 0:t[this.columnIndex]}get columnId(){var t;return(t=this.column)==null?void 0:t.id}get columnIndex(){var t;return Math.min(this._columnIndex,((t=this.grid.columns.visibleColumns)==null?void 0:t.length)-1)}move(t){const e=this,{record:r,column:l,grid:o}=e,{store:s}=o,n=o.columns.visibleColumns,a=new W;let d=s.includes(r)?s.indexOf(r):e.rowIndex,c=n.includes(l)?n.indexOf(l):e.columnIndex;const u=o.hideHeaders?0:-1,h=s.count-1,g=n.length-1,f=d===u,p=d===h,v=c===0,C=c===g;switch(t){case W.PREV_CELL:v?f||(c=g,d--):c--;break;case W.NEXT_CELL:C?p||(c=0,d++):c++;break;case W.UP:f||d--;break;case W.DOWN:p||(d===-1?d=o.rowManager.firstFullyVisibleRow.dataIndex:d++);break;case W.FIRST_COLUMN:c=0;break;case W.LAST_COLUMN:c=g;break;case W.FIRST_CELL:d=u,c=0;break;case W.LAST_CELL:d=h,c=g;break;case W.PREV_PAGE:d=Math.max(u,d-Math.floor(o.scrollable.clientHeight/o.rowHeight));break;case W.NEXT_PAGE:d=Math.min(h,d+Math.floor(o.scrollable.clientHeight/o.rowHeight));break}return a.init({grid:o,rowIndex:d,columnIndex:c}),a}get cell(){var t,e;const r=this,{grid:l,id:o,_cell:s}=r;if(s)return s;if(o==null)return(t=l.columns.getById(r.columnId))==null?void 0:t.element;{const{row:n}=r;if(n)return n.getCell(r.columnId)||n.getCell((e=l.columns.getAt(r.columnIndex))==null?void 0:e.id)}}get row(){return this.grid.getRowById(this.id)||this.grid.getRow(this.rowIndex)}get target(){const{cell:t,_target:e}=this,{focusableFinder:r}=this.grid;if(t)return e||(r.currentNode=this.grid.focusableFinderCell=t,r.nextNode()||t)}get isActionable(){const{cell:t,_target:e}=this,r=t&&m.getActiveElement(t);return!!(r&&t.compareDocumentPosition(r)&Node.DOCUMENT_POSITION_CONTAINED_BY||e&&e!==this.cell)}get isColumnHeader(){return this.cell&&this.rowIndex===-1}get isCell(){return this.cell&&this.record}};R.UP=1,R.NEXT_CELL=2,R.DOWN=3,R.PREV_CELL=4,R.FIRST_COLUMN=5,R.LAST_COLUMN=6,R.FIRST_CELL=7,R.LAST_CELL=8,R.PREV_PAGE=9,R.NEXT_PAGE=10,R._$name="Location";var tt=i=>typeof i=="number"||(i==null?void 0:i.endsWith("px")),ke=class V extends At.mixin(Mt,Qe){static get fields(){return["type","text","field","renderer","width","flex","autoWidth","autoHeight",{name:"fitMode",defaultValue:"exact"},"readOnly",{name:"editor",defaultValue:{}},"cellEditor","finalizeCellEdit",{name:"revertOnEscape",defaultValue:!0},{name:"invalidAction",defaultValue:"block"},{name:"sortable",defaultValue:!0,convert(t,e,r){if(!t)return!1;if(t===!0)return!0;const l={};return typeof t=="function"?(l.originalSortFn=t,l.sortFn=t.bind(r)):typeof t=="object"&&(Object.assign(l,t),l.fn&&(l.sortFn=l.fn,delete l.fn)),l}},{name:"searchable",defaultValue:!0},{name:"collapsible",defaultValue:!1},{name:"collapsed",defaultValue:!1},{name:"collapseMode"},{name:"filterable",defaultValue:!0,convert(t){if(!t)return!1;if(t===!0)return!0;const e={columnOwned:!0};return typeof t=="function"?e.filterFn=t:typeof t=="object"&&Object.assign(e,t),e}},{name:"sealed"},{name:"hideable",defaultValue:!0},{name:"draggable",defaultValue:!0},{name:"groupable",defaultValue:!0},{name:"resizable",defaultValue:!0},"groupRenderer","headerRenderer","tooltip","tooltipRenderer","cellCls","cls","icon","align",{name:"minWidth",defaultValue:60},"maxWidth",{name:"hidden",defaultValue:!1},{name:"locked"},{name:"region"},{name:"mergeCells",type:"boolean"},{name:"mergeable",type:"boolean",defaultValue:!0},"mergedRenderer",{name:"showColumnPicker",defaultValue:!0},{name:"enableHeaderContextMenu",defaultValue:!0},{name:"enableCellContextMenu",defaultValue:!0},"headerMenuItems","cellMenuItems","sum","summaries","summaryRenderer","responsiveLevels","tags","touchConfig","tree","filterType",{name:"htmlEncode",defaultValue:!0},{name:"htmlEncodeHeaderText",defaultValue:!0},{name:"autoSyncHtml",defaultValue:!1},{name:"alwaysClearCell",defaultValue:!1},{name:"headerWidgets"},{name:"instantUpdate",defaultValue:!1},{name:"repaintOnResize",defaultValue:!1},"editTargetSelector",{name:"exportable",defaultValue:!0},{name:"exportedType"},{name:"ariaLabel",defaultValue:"L{Column.columnLabel}"},{name:"cellAriaLabel",defaultValue:"L{cellLabel}"}]}static get autoExposeFields(){return!1}construct(t,e){var r;const l=this;l.masterStore=e,e&&(l._grid=Array.isArray(e)?e[0].grid:e.grid),l.localizableProperties=It.mergeMethods.distinct(t.localizableProperties,["text","ariaLabel","cellAriaLabel"]),t.localeClass&&(l.localeClass=t.localeClass),super.construct(...arguments),l.isLeaf&&!("field"in l.data)&&(l.field="_"+(l.type||"")+ ++V.emptyCount,l.noFieldSpecified=!0),!l.width&&!l.flex&&!l.children&&l.set({width:V.defaultWidth,flex:null},null,!0),l.headerWidgets&&l.initHeaderWidgets(l.headerWidgets),l.isParent&&(l.meta.visibleChildren=new Set,l.collapsible&&(l.collapsible=!0)),l.rendererReturningContent=(r=l.renderer)==null?void 0:r.toString().includes("return ")}shouldSync(t){return t.isColumn&&t.text===this.text&&(t.field===this.field||String(t.renderer)===String(this.renderer))&&(!t.previousSibling&&!this.previousSibling||t.previousSibling.shouldSync(this.previousSibling))}get isCollapsible(){var t;return((t=this.children)==null?void 0:t.length)>1&&this.collapsible}get collapsed(){return this.get("collapsed")}set collapsed(t){this.set("collapsed",t,!0),this.onCollapseChange(!t),this.trigger("toggleCollapse",{collapsed:t})}onCellFocus(t){this.location=t,this.updateHeaderAriaLabel(this.localizeProperty("ariaLabel")),t.rowIndex!==-1&&this.updateCellAriaLabel(this.localizeProperty("cellAriaLabel"))}updateHeaderAriaLabel(t){m.setAttributes(this.element,{"aria-label":t})}updateCellAriaLabel(t){var e,r;!((e=this.location)!=null&&e.isSpecialRow)&&((r=this.location)!=null&&r.cell)&&(t!=null&&t.length||(t=this.location.column.text),m.setAttributes(this.location.cell,{"aria-label":t}))}doDestroy(){var t,e,r;(r=(e=(t=this.data)==null?void 0:t.editor)==null?void 0:e.destroy)==null||r.call(e),this.destroyHeaderWidgets(),super.doDestroy()}set headerWidgets(t){this.initHeaderWidgets(t),this.set("headerWidgets",t)}get headerWidgets(){return this.get("headerWidgets")}initHeaderWidgets(t){this.destroyHeaderWidgets();const e=this.headerWidgetMap={};for(const r of t){const l=J.create({owner:this,...r});e[l.ref||l.id]=l}}destroyHeaderWidgets(){var t;for(const e of Object.values(this.headerWidgetMap||{}))(t=e.destroy)==null||t.call(e)}static generateAutoCls(){const t=[];for(let r=this;r!==V;r=r.superclass)r.type&&r.type!==r.superclass.type&&t.push(`b-${r.type.toLowerCase()}-cell`);const e=t.join(" ");return(V.autoClsMap||(V.autoClsMap=new Map)).set(this,e),e}getCellClass(t){var e,r;const{record:l,column:o}=t,{cellCls:s,internalCellCls:n,grid:a,constructor:d,align:c}=o,u=((e=V.autoClsMap)==null?void 0:e.get(d))||d.generateAutoCls(),h=t.cell.classList.contains("b-editing"),g={[a.cellCls]:a.cellCls,[u]:u,[s]:s,[n]:n,"b-cell-dirty":l.isFieldModified(o.field)&&(o.compositeField||((r=l.fieldMap[o.field])==null?void 0:r.persist)!==!1),[`b-grid-cell-align-${c}`]:c,"b-selected":a.selectionMode.cell&&a.isCellSelected(t),"b-focused":a.isFocused(t),"b-auto-height":o.autoHeight,"b-editing":h};return l.isSpecialRow&&g["b-checkbox-selection"]&&(g["b-checkbox-selection"]=!1),g}get locked(){return this.data.region==="locked"}set locked(t){this.region=t?"locked":"normal"}get region(){return this.parent.isRoot?this.get("region"):this.parent.region}set region(t){this.set("region",t)}get sortable(){return this.isLeaf&&this.data.sortable}set sortable(t){this.set("sortable",t)}get groupable(){return!!(this.isLeaf&&this.field&&this.data.groupable)}set groupable(t){this.set("groupable",t)}get editor(){const t=this;let{editor:e}=t.data;if(e&&!e.isWidget){const r=t.grid.processCellEditor({editor:e,field:t.field});r?e=t.data.editor=r.editor:(typeof e=="string"&&(e={type:e}),e=t.data.editor=J.create(x.merge(t.defaultEditor,{owner:t.grid,label:T.encodeHtml(t.text)},e)))}return e}set editor(t){this.data.editor=t}get defaultEditor(){return{type:"textfield",name:this.field}}getFilterableValue(t){return this.getRawValue(t)}get owner(){return this._owner||this.subGrid}set owner(t){this._owner=t}get grid(){var t;return this._grid||((t=this.parent)==null?void 0:t.grid)}set subGrid(t){this._subGrid=t}get subGrid(){var t;return this._subGrid||((t=this.grid)==null?void 0:t.getSubGridFromColumn(this))}get subGridElement(){return this.subGrid.element}get element(){return this.grid.getHeaderElement(this)}get previousVisibleSibling(){const t=this.region;let e=this.previousSibling;for(;e&&(e.hidden||e.region!==t);)e=e.previousSibling;return e}get nextVisibleSibling(){const t=this.region;let e=this.nextSibling;for(;e&&(e.hidden||e.region!==t);)e=e.nextSibling;return e}get isLastInSubGrid(){return!this.nextVisibleSibling&&(this.parent.isRoot||this.parent.isLastInSubGrid)}get allowDrag(){return!this.parent.isRoot||!!(this.nextVisibleSibling||this.previousVisibleSibling)}get textWrapper(){return m.getChild(this.element,".b-grid-header-text")}get textElement(){return m.down(this.element,".b-grid-header-text-content")}get contentElement(){return m.down(this.element,".b-grid-header-children")}get isSorted(){return this.grid.store.sorters.some(t=>t.field===this.field)}get isFocusable(){return this.isLeaf}static get text(){return this.$meta.fields.defaults.text}get headerText(){return this.htmlEncodeHeaderText?T.encodeHtml(this.text):this.text}get isVisible(){return!this.hidden&&(!this.parent||this.parent.isVisible)}hide(t=!1,e=!1){const r=this,{parent:l}=r;r.hidden||(r.hidden=!0,l&&!l.isRoot&&!l.isTogglingAll&&!l.children.some(s=>s.hidden!==!0)&&!l.hidden&&(t=!0,l.hide()),r.isParent?r.children.forEach(o=>o.hide(!0,!0)):l.isRoot||l.meta.visibleChildren[e?"add":"delete"](r),t||r.stores.forEach(o=>o.trigger("columnHide",{column:r})))}show(t=!1){var e;const r=this,{parent:l}=r;r.hidden&&(r.hidden=!1,l!=null&&l.hidden&&l.show(),r.isParent&&((e=r.meta.visibleChildren)==null||e.forEach(o=>o.show(!0))),t||r.stores.forEach(o=>o.trigger("columnShow",{column:r})))}toggle(t){if(this.hidden&&t===void 0||t===!0)return this.show();if(!this.hidden&&t===void 0||t===!1)return this.hide()}toggleChildren(t=this.children,e=void 0){var r,l;const o=this;(r=o.grid.columns)==null||r.beginBatch(),o.isTogglingAll=!0,t.forEach(s=>s.toggle(e)),o.isTogglingAll=!1,(l=o.grid.columns)==null||l.endBatch()}onCollapseChange(t=void 0){var e,r;const l=this;if(l.collapseMode==="toggleAll")l.toggleChildren();else{const{firstChild:o}=l;o.flex!=null&&l.collapsed?(o.oldFlex=o.flex,o.width=o.element.offsetWidth):!l.collapsed&&o.oldFlex&&(o.flex=o.oldFlex,o.oldFlex=null),(e=l.grid.columns)==null||e.beginBatch(),l.isTogglingAll=!0,l.children.slice(1).forEach(s=>s.toggle(t)),l.isTogglingAll=!1,(r=l.grid.columns)==null||r.endBatch()}}set collapsible(t){const e=this;if(e.set("collapsible",t),e.isParent){const{headerWidgets:r=[]}=e;if(t)r.push({type:"button",ref:"collapseExpand",toggleable:!0,pressed:e.collapsed,icon:`b-icon-collapse-${e.grid.rtl?"right":"left"}`,pressedIcon:`b-icon-collapse-${e.grid.rtl?"left":"right"}`,cls:"b-grid-header-collapse-button b-transparent",onToggle:({pressed:l})=>e.collapsed=l});else{const l=r.findIndex(o=>o.ref==="collapseExpand");l>-1&&r.splice(l,1)}e.headerWidgets=r,e.collapsed&&e.onCollapseChange(!1)}}get collapsible(){return this.get("collapsible")}generateId(){return V.generatedIdIndex||(V.generatedIdIndex=0),(this.field?this.field.replace(/\./g,"-"):"col")+ ++V.generatedIdIndex}get allIndex(){return this.masterStore.indexOf(this)}measureSize(t){var e;return m.measureSize(t,(e=this.subGrid)==null?void 0:e.element)}get calcMinWidth(){const{width:t,minWidth:e}=this.data;return tt(t)&&tt(e)?Math.max(parseInt(t)||0,parseInt(e)||0):t}get width(){return this.data.width}set width(t){const e={width:t};t&&"flex"in this.data&&(e.flex=null),this.set(e)}set flex(t){const e={flex:t};t&&"width"in this.data&&(e.width=null),this.set(e)}get flex(){return this.data.flex}calculateMinWidth(){const t=this,e=t.measureSize(t.width),r=t.measureSize(t.minWidth);let l=0;return t.children&&(l=t.children.reduce((o,s)=>o+s.calculateMinWidth(),0)),Math.max(e,r,l)}resizeToFitContent(t,e,r=!1){const l=this,{grid:o,element:s,fitMode:n}=l,{rowManager:a,store:d}=o,{count:c}=d;if(c<=0||l.fitMode==="none"||!l.fitMode)return;const[u]=a.rows,{rowElement:h,cellElement:g}=o.beginGridMeasuring(),f=new R({grid:o,column:l,id:null});let p=0,v,C,b,w,S,y,E={length:0,record:null};if(g._domData={columnId:l.id,row:u,rowElement:h},f._cell=g,f.updatingSingleRow=!0,f.isMeasuring=!0,g.innerHTML="",o.resizeToFitIncludesHeader&&!o.hideHeaders){if(!o.$headerPadding){const A=globalThis.getComputedStyle(s);o.$headerPadding=parseInt(A.paddingLeft)}const I=s.querySelector(".b-grid-header-text-content");I.style.cssText="flex: none; width: auto",p=I.offsetWidth+o.$headerPadding*2+2,I.style.cssText=""}for(c>1e3?(v=Math.max(Math.min(a.topIndex+Math.round(a.rowCount/2)-500,c-1e3),0),C=v+1e3):(v=0,C=c),b=v;b<C;b++){if(w=d.getAt(b),S=l.getRawValue(w),n==="value")y=String(S).length;else if(f._record=E.record,f._id=w.id,f._rowIndex=b,u.renderCell(f),n==="textContent")y=g.textContent.length;else{const I=g.offsetWidth;I>p&&(p=I)}y>E.length&&(E={record:w,length:y,rowIndex:b})}return E.length>0&&(n==="value"||n==="textContent")&&(f._record=E.record,f._id=E.record.id,f._rowIndex=E.rowIndex,u.renderCell(f),p=Math.max(p,g.offsetWidth)),Array.isArray(t)&&([t,e]=t),p=Math.max(p,t||0),p=Math.min(p,e||1e6),r||o.endGridMeasuring(),l.width=l.maxWidth?p=Math.min(p,l.maxWidth):p,p}getState(){const t=this,e={id:t.id,hidden:t.hidden,region:t.region,locked:t.locked};return t.children||(e[t.flex?"flex":"width"]=t.flex||t.width),t.isCollapsible&&(e.collapsed=t.collapsed),e}applyState(t){const e=this;e.beginBatch(),"locked"in t&&(e.locked=t.locked),"width"in t&&(e.width=t.width),"flex"in t&&(e.flex=t.flex),"width"in t&&e.flex?e.flex=void 0:"flex"in t&&e.width&&(e.width=void 0),"region"in t&&(e.region=t.region),e.endBatch(),"hidden"in t&&e.toggle(t.hidden!==!0),"collapsed"in t&&(e.collapsed=t.collapsed)}remove(){const{subGrid:t,grid:e}=this,r=t&&(e==null?void 0:e.focusedCell);(r==null?void 0:r.columnId)===this.id&&(e.owns(m.getActiveElement(e))?e.navigateRight():e._focusedCell=new R({grid:e,rowIndex:r.rowIndex,column:t.columns.getAdjacentVisibleLeafColumn(this.id,!0,!0)})),super.remove()}getRawValue(t){return t.getValue(this.field)}refreshCell(t){this.grid.rowManager.refreshCell(t,this.id)}refreshHeader(){this.grid.refreshHeader(this)}clearCell(t){t.innerHTML="",delete t._content}canEdit(t){if(t.isEditable){const e=t.isEditable(this.field);if(e!==void 0)return e}return!0}insertChild(t,e=null,r=!1){return t=Array.isArray(t)?t:[t],t.forEach(l=>{const{parent:o}=l;o!=null&&o.collapsed&&l===o.firstChild&&o.children.length>1&&o.children.filter(s=>!s.hidden).length===1&&(l.nextSibling.hidden=!1)}),this.sealed&&!this.inProcessChildren?null:super.insertChild(...arguments)}canFillValue(){return!0}getCurrentConfig(t){var e;const r=super.getCurrentConfig(t);return(e=this.sortable)!=null&&e.originalSortFn&&(r.sortable=this.sortable.originalSortFn),r.renderer===this.internalRenderer&&delete r.renderer,r.headerRenderer===this.internalHeaderRenderer&&delete r.headerRenderer,delete r.ariaLabel,delete r.cellAriaLabel,r}};F(ke,"$name","Column"),F(ke,"type","column");var O=ke;O.emptyCount=0,O.defaultWidth=100,O.exposeProperties(),O._$name="Column";var Gt={boolean:{type:"check"},date:{type:"date"},integer:{type:"number",format:{maximumFractionDigits:0}},number:{type:"number"}},Wt=[{field:"region"}],K=class le extends Qe(Ae){static get defaultConfig(){return{modelClass:O,tree:!0,autoAddField:!1,syncDataOnLoad:{threshold:1},sorters:Wt,reapplySortersOnAdd:!0}}construct(t){const e=this;t.grid&&(t.grid._columnStore=e,e.id=`${t.grid.id}-columns`,t.grid.ion({subGridCollapse:"clearSubGridCaches",subGridExpand:"clearSubGridCaches",thisObj:e})),super.construct(t),e.ion({change:e.onStoreChange,sort:()=>e.updateChainedStores(),thisObj:e,prio:1})}doDestroy(){const t=[];this.isChained||this.traverse(e=>t.push(e)),super.doDestroy(),this.isChained||t.forEach(e=>e.destroy())}getById(t){return super.getById(t)||this.idRegister[t]}forEach(t,e=this){this.traverseWhile((r,l)=>t.call(e,r,l),!0)}get totalFixedWidth(){let t=0;for(const e of this)e.hidden||(e.children?e.children.forEach(r=>t+=this.calculateFixedWidth(r)):t+=this.calculateFixedWidth(e));return t}get hasFlex(){return this.visibleColumns.some(t=>t.flex)}calculateFixedWidth(t){return t.flex?t.measureSize(O.defaultWidth):Math.max(t.measureSize(t.width),t.measureSize(t.minWidth))}get topColumns(){return this.isChained?this.masterStore.rootNode.children.filter(this.chainedFilterFn):this.rootNode.children}get visibleColumns(){const t=this;return t._visibleColumns||(t._visibleColumns=t.leaves.filter(e=>e.isVisible&&(!e.subGrid||!e.subGrid.collapsed))),t._visibleColumns}onStoreChange({action:t,changes:e}){t==="update"&&!("hidden"in e)||this.clearCaches()}clearSubGridCaches({subGrid:t}){t.columns.clearCaches(),this.clearCaches()}clearCaches(){var t;this._visibleColumns=null,(t=this.masterStore)==null||t.clearCaches()}onMasterDataChanged(t){super.onMasterDataChanged(t),(t.action!=="update"||"hidden"in t.changes)&&this.clearCaches()}getAdjacentVisibleLeafColumn(t,e=!0,r=!1){const l=this.visibleColumns,o=t instanceof O?t:this.getById(t);let s=l.indexOf(o)+(e?1:-1);if(!l[s])if(r)s=e?0:l.length-1;else return null;return l[s]}get bottomColumns(){return this.leaves}get(t){return this.findRecord("field",t,!0)}createRecord(t){var e,r;const{grid:l={}}=this,{store:o}=l,s=(r=(e=o==null?void 0:o.modelClass)==null?void 0:e.fieldMap)==null?void 0:r[t.field];let n=this.modelClass;if(s!=null&&s.column&&(t=kt.merge({},s.column,t)),t.type&&(n=le.getColumnClass(t.type),!n))throw new Error(`Column type '${t.type}' not registered`);t.locked&&(t.region="locked",delete t.locked);const a=new n(t,this);if(a.data.region||(a.data.region=l.defaultRegion||"normal"),this.autoAddField&&!a.noFieldSpecified&&o&&!s){let d=a.field;a.constructor.fieldType&&(d={name:a.field,type:a.constructor.fieldType}),o.modelClass.addField(d)}return a}indexOf(t){if(t==null)return-1;const e=super.indexOf(t);return e>-1?e:this.records.findIndex(r=>r.field===t)}removeAll(t=!1){const e=this;return e.some(l=>l.isTimeAxisColumn)?e.remove(e.query(l=>!l.isTimeAxisColumn),t):super.removeAll(t)}get usesAutoHeight(){return this.find(t=>t.autoHeight)}get usesFlexAutoHeight(){return this.find(t=>t.autoHeight&&t.flex!=null)}resolveSyncNode(t){return t.id?super.resolveSyncNode(t):t.field?{id:t.field,node:this.allRecords.find(e=>e.field===t.field)}:t.type?{id:t.type,node:this.allRecords.find(e=>e.type===t.type)}:{id:null,node:null}}static registerColumnType(t,e=!1){t.simpleRenderer=e,(le.columnTypes||(le.columnTypes={}))[t.type]=t}static getColumnClass(t){return le.columnTypes&&le.columnTypes[t]}generateColumnForField(t,e){var r;typeof t=="string"&&this.grid&&(t=(r=this.grid.store)==null?void 0:r.modelClass.fieldMap[t]);let l=t.column||Gt[t.type]||{};return typeof l=="string"&&(l={type:l}),l=Object.assign({text:t.text||T.separate(t.name),field:t.name},e,l),t.precision!=null&&(l.format.maximumFractionDigits=t.precision),t.columnType&&(l.type=t.columnType),this.createRecord(l)}},Nt=(i,t)=>({update:({store:e,record:r,changes:l})=>{let o=!0;return("width"in l||"minWidth"in l||"maxWidth"in l||"flex"in l)&&(o=i.call(t,{store:e,record:r,changes:l})),o}});K.registerColumnType(O,!0),K._$name="ColumnStore";var q=class extends O{static get defaults(){return{filterable:!1,sortable:!1,editor:!1,searchable:!1,fitMode:!1,alwaysClearCell:!1}}construct(i,t){const e=this;e.widgetMap={},super.construct(...arguments),e.renderer!==e.internalRenderer&&(e.externalRenderer=e.renderer,e.renderer=e.internalRenderer)}doDestroy(){for(const i of Object.values(this.widgetMap))i.destroy&&i.destroy();super.doDestroy()}updateReadOnly(i){for(const t of Object.values(this.widgetMap))t.cellInfo.record.readOnly||(t.readOnly=i)}internalRenderer(i){var t;const e=this,{cellElement:r,column:l,record:o,isExport:s}=i,{widgets:n}=l;!s&&n&&(r.widgets||e.clearCell(r),r.widgets=i.widgets=n.map((d,c)=>{var u,h;let g,f;if(r.widgets&&(g=r.widgets[c],f=g.element.nextElementSibling,d.recreate&&g&&(delete e.widgetMap[g.id],g.destroy(),r.widgets[c]=null)),g||(e.onBeforeWidgetCreate(d,i),d.recomposeAsync=!1,d.owner=e.grid,g=be.append(d,f?{insertBefore:f}:r)[0],e.widgetMap[g.id]=g,e.onAfterWidgetCreate(g,i),g.name&&g.ion({change:({value:p,userAction:v})=>{v&&g.cellInfo.record.setValue(g.name,p)}})),g.cellInfo={record:o,column:l},e.grid&&!e.meta.isSelectionColumn&&(g.readOnly=e.grid.readOnly||o.readOnly),((u=e.onBeforeWidgetSetValue)==null?void 0:u.call(e,g,i))!==!1){const p=d.valueProperty||"value"in g&&"value"||g.defaultBindProperty;if(p){const v=g.name?o.getValue(g.name):i.value;g[p]=v}}return(h=e.onAfterWidgetSetValue)==null||h.call(e,g,i),g}));const a=(t=e.externalRenderer)==null?void 0:t.call(e,i);return s?a:!a&&!n?"":a}onBeforeWidgetCreate(i,t){}onAfterWidgetCreate(i,t){}clearCell(i){i.widgets&&(i.widgets.forEach(t=>{delete this.widgetMap[t.id],t.destroy()}),i.widgets=null),super.clearCell(i)}resizeToFitContent(){}};F(q,"$name","WidgetColumn"),F(q,"type","widget"),F(q,"fields",["widgets"]),K.registerColumnType(q),q.exposeProperties(),q._$name="WidgetColumn";var X=class extends q{construct(i,t){var e;super.construct(...arguments);const r=this;if(Object.assign(r,{externalHeaderRenderer:r.headerRenderer,externalOnBeforeWidgetSetValue:r.onBeforeWidgetSetValue,externalOnAfterWidgetSetValue:r.onAfterWidgetSetValue,onBeforeWidgetSetValue:r.internalOnBeforeWidgetSetValue,onAfterWidgetSetValue:r.internalOnAfterWidgetSetValue,headerRenderer:r.internalHeaderRenderer}),!r.meta.isSelectionColumn){const l=(e=r.grid)==null?void 0:e.store.modelClass;r.field?l&&!l.fieldMap[r.field]&&!r.constructor.suppressNoModelFieldWarning&&(console.warn(r.$$name+" is configured with a field, but this is not part of your Model `fields` collection."),l.addField({name:r.field,type:"boolean"})):console.warn("CheckColumn MUST be configured with a field, otherwise the checked state will not be persistent. Widgets are recycled and reused")}}doDestroy(){var i;(i=this.headerCheckbox)==null||i.destroy(),super.doDestroy()}internalHeaderRenderer({headerElement:i,column:t}){let e;return i.classList.add("b-check-header"),t.showCheckAll?(i.classList.add("b-check-header-with-checkbox"),t.headerCheckbox?i.appendChild(t.headerCheckbox.element):t.headerCheckbox=new Ft({appendTo:i,owner:this.grid,ariaLabel:"L{Checkbox.toggleSelection}",internalListeners:{change:"onCheckAllChange",thisObj:t}})):e=t.headerText,e=t.externalHeaderRenderer?t.externalHeaderRenderer.call(this,...arguments):e,t.showCheckAll?void 0:e}updateCheckAllState(i){this.headerCheckbox&&(this.headerCheckbox.suspendEvents(),this.headerCheckbox.checked=i,this.headerCheckbox.resumeEvents())}onCheckAllChange({checked:i}){const t=this;if(t.field){const{store:e}=t.grid;e.beginBatch(),e.forEach(r=>t.updateRecord(r,t.field,i)),e.endBatch()}t.trigger("toggleAll",{checked:i})}internalRenderer({value:i,isExport:t,record:e,cellElement:r}){const l=super.internalRenderer(...arguments);return t?l!=null?l:i==null?"":i:(e.readOnly&&!this.meta.isSelectionColumn&&(r.widgets[0].readOnly=!0),i?r.widgets[0].input.setAttribute("checked",!0):r.widgets[0].input.removeAttribute("checked"),l)}onBeforeWidgetCreate(i,t){i.cls=this.checkCls}onAfterWidgetCreate(i,t){t.cellElement.widget=i,i.ion({beforeChange:"onBeforeCheckboxChange",change:"onCheckboxChange",thisObj:this})}internalOnBeforeWidgetSetValue(i){var t;i.record=i.cellInfo.record,this.isInitialSet=!0,(t=this.externalOnBeforeWidgetSetValue)==null||t.call(this,...arguments)}internalOnAfterWidgetSetValue(i){var t;this.isInitialSet=!1,(t=this.externalOnAfterWidgetSetValue)==null||t.call(this,...arguments)}onBeforeCheckboxChange({source:i,checked:t,userAction:e}){const r=this,{grid:l}=r,{record:o}=i.cellInfo;if(e&&r.field&&(!l.features.cellEdit||l.features.cellEdit.disabled)||r.meta.isSelectionColumn&&!l.isSelectable(o)&&t)return!1;if(!r.isInitialSet)return r.trigger("beforeToggle",{record:o,checked:t})}onCheckboxChange({source:i,checked:t}){if(!this.isInitialSet){const e=this,{record:r}=i.cellInfo,{field:l}=e;l&&(e.updateRecord(r,l,t),t?e.updateCheckAllState(e.grid.store.every(o=>o[l],null,!0)):e.updateCheckAllState(!1)),e.trigger("toggle",{record:r,checked:t,checkbox:i})}}updateRecord(i,t,e){i.setValue(t,e)}onCellKeyDown({event:i,cellElement:t}){if(i.key===" "){const e=t.widget;e==null||e.toggle(),i.preventDefault(),i.handled=!0}}getCurrentConfig(i){const t=super.getCurrentConfig(i);return delete t.onBeforeWidgetSetValue,delete t.onAfterWidgetSetValue,this.externalOnBeforeWidgetSetValue&&(t.onBeforeWidgetSetValue=this.externalOnBeforeWidgetSetValue),this.externalOnAfterWidgetSetValue&&(t.onAfterWidgetSetValue=this.externalOnAfterWidgetSetValue),t}};F(X,"$name","CheckColumn"),F(X,"type","check"),F(X,"fields",["checkCls","showCheckAll","onAfterWidgetSetValue","onBeforeWidgetSetValue","callOnFunctions","onBeforeToggle","onToggle","onToggleAll"]),F(X,"defaults",{align:"center",checkCls:null,showCheckAll:!1,sortable:!0,filterable:!0,widgets:[{type:"checkbox",valueProperty:"checked"}]}),K.registerColumnType(X,!0),X._$name="CheckColumn";var ne=class extends O{static get defaults(){return{groupable:!1,sortable:!1,filterable:!1,searchable:!1,resizable:!1,draggable:!1,minWidth:50,width:50,align:"right",text:"#",editor:!1,readOnly:!0}}construct(i){super.construct(...arguments);const t=this,{grid:e}=t;t.internalCellCls="b-row-number-cell",t.externalHeaderRenderer=t.headerRenderer,t.headerRenderer=t.internalHeaderRenderer,e&&(e.ion({bindStore:"bindStore",thisObj:t}),t.bindStore({store:e.store,initial:!0}),e.store.count&&!e.rendered&&e.ion({paint:"resizeToFitContent",thisObj:t,once:!0}))}get groupHeaderReserved(){return!0}bindStore({store:i,initial:t}){const e=this;e.detachListeners("grid"),i.ion({name:"grid",[`change${e.grid.asyncEventSuffix}`]:"onStoreChange",thisObj:e}),!t&&!e.resizeToFitContent()&&e.measureOnRender()}onStoreChange({action:i,isMove:t}){if(i==="dataset"||i==="add"||i==="remove"||i==="removeall"){if(i==="remove"&&t)return;const e=this.resizeToFitContent();i==="dataset"&&!e&&this.grid.store.count&&this.measureOnRender()}}measureOnRender(){this.grid.rowManager.ion({renderDone(){this.resizeToFitContent()},once:!0,thisObj:this})}renderer({record:i,grid:t}){return i.isSpecialRow?"":t.store.indexOf(i,!0)+1}resizeToFitContent(){const i=this,{store:t,element:e}=i.grid,{count:r}=t;if(r&&!i.hidden){const l=e.querySelector(`.b-grid-cell[data-column-id="${i.id}"]`);if(l){const o=l.isConnected?parseInt(m.getStyleValue(l,"padding-left")):i._cachedCellPadding||0,s=m.measureText(r,l);return i.width=Math.max(i.minWidth,s+2*o),i._cachedCellPadding=o,!0}}return!1}set flex(i){}internalHeaderRenderer({headerElement:i,column:t}){var e;return i.classList.add("b-rownumber-header"),((e=t.externalHeaderRenderer)==null?void 0:e.call(this,...arguments))||t.headerText}};F(ne,"$name","RowNumberColumn"),F(ne,"type","rownumber"),K.registerColumnType(ne,!0),ne._$name="RowNumberColumn";var Oe=class extends P.mixin(Ct){get clipboardRecords(){return this.clipboardData||[]}cellsToString(i){var t;const e=this;let r=0,l=0,o="";i.sort((s,n)=>s.rowIndex===n.rowIndex?s.columnIndex-n.columnIndex:s.rowIndex-n.rowIndex);for(const s of i){const{record:n,_column:a,rowIndex:d,columnIndex:c}=s;d>r?(o.length>0&&(o+=`
`.repeat(d-r)),r=d,l=c):c>l&&(o.length>0&&(o+="	".repeat(c-l)),l=c);let u=(t=a==null?void 0:a.toClipboardString)==null?void 0:t.call(a,s);u===void 0&&(u=n.getValue(a.field),u instanceof Date?u=Te.format(u,e.dateFormat):u=u==null?void 0:u.toString()),e.toCopyString&&(u=e.toCopyString({currentValue:u,column:a,record:n})),u=u==null?void 0:u.replace(/[\n\t]/," "),o+=u||e.emptyValueChar}return o}setFromStringData(i,t=!1,e=this.client.store,r){var l;const o=this,{client:s}=o,{columns:n,_shiftSelectRange:a}=s,d=new Set,c=o.stringAs2dArray(i),u=s.selectedCells[0],h=[],g=[];if(!t&&(a!=null&&a.some(f=>f.equals(u)))){const f=o.cellSelectorsAs2dArray(a);if((f==null?void 0:f.length)%c.length===0&&f.columnCount%c.columnCount===0)for(let p=0;p<f.length;p+=c.length)for(let v=0;v<f.columnCount;v+=c.columnCount)h.push(f[p][v])}h.length||h.push(u);for(const f of h)for(let p=0;p<c.length;p++){const v=c[p],C=t?new e.modelClass:e.getAt(f.rowIndex+p);if(C&&!C.readOnly){for(let b=0;b<v.length;b++){const w=r?null:n.visibleColumns[t?b:f.columnIndex+b],S=(w==null?void 0:w.field)||(r==null?void 0:r[b]);let y=v[b];if(S&&y&&!(w!=null&&w.readOnly)){if(y===o.emptyValueChar&&(y=null),w!=null&&w.fromClipboardString&&(y=w.fromClipboardString({string:y,record:C})),o.toPasteValue&&(y=o.toPasteValue({currentValue:y,record:C,column:w,field:S})),typeof y=="string"&&((l=C.getFieldDefinition(S))!=null&&l.isDateDataField)){const E=Te.parse(y,o.dateFormat);isNaN(E.getTime())||(y=E)}C.set(S,y,!1,!1,!1,!0),g.push(s.normalizeCellContext({column:w,record:C}))}}d.add(C)}}return{modifiedRecords:[...d],targetCells:g}}cellSelectorsAs2dArray(i){const t=[];let e=null,r;for(const l of i)l.id!==e&&(e=l.id,r=[],t.push(r)),r.push(l);return t.columnCount=t[0].length,t.some(l=>l.length!==t.columnCount)?!1:t}stringAs2dArray(i){const t=[],e=i.split(/\r\n|(?!\r\n)[\n-\r\x85\u2028\u2029]/).filter(r=>r.length);for(const r of e){const l=r.split("	");if(t.columnCount&&l.length!==t.columnCount)return!1;t.columnCount=l.length,t.push(l)}return t}};F(Oe,"configurable",{copyOnly:null,keyMap:{"Ctrl+C":"copy","Ctrl+X":"cut","Ctrl+V":"paste"},useNativeClipboard:!1,toCopyString:null,toPasteValue:null,emptyValueChar:" ",dateFormat:"lll"}),Oe._$name="CopyPasteBase";var ae=new Map,Q=new Map,ve="Grid",Se={Grid:"GridBase",Scheduler:"SchedulerBase",SchedulerPro:"SchedulerProBase",Gantt:"GanttBase"},$t=/\$\d+$/,L=class{static registerFeature(i,t=!1,e=null,r=null){r=T.uncapitalize(r||Object.prototype.hasOwnProperty.call(i,"$name")&&i.$$name||i.name),r=r.replace($t,""),Array.isArray(e)||(e=[e||ve]),e.forEach(l=>{const o=Se[l]||l,s=ae.get(o)||new Map,n=Q.get(o)||new Map;s.set(r,i),n.set(i,t),ae.set(o,s),Q.set(o,n)})}static getTypeNameFeatures(i=ve){const t=Se[i]||i,e=ae.get(t),r={};return e&&e.forEach((l,o)=>r[o]=l),r}static getTypeNameDefaultFeatures(i=ve){const t=Se[i]||i,e=ae.get(t),r=Q.get(t),l={};return e&&r&&e.forEach((o,s)=>{r.get(o)&&(l[s]=o)}),l}static getInstanceFeatures(i){return i.$meta.names.reduce((t,e)=>Object.assign(t,this.getTypeNameFeatures(e)),{})}static getInstanceDefaultFeatures(i){return i.$meta.names.reduce((t,e)=>Object.entries(this.getTypeNameFeatures(e)).reduce((r,[l,o])=>(this.isDefaultFeatureForTypeName(o,e)?r[l]=o:delete r[l],r),t),{})}static isDefaultFeatureForTypeName(i,t=ve){const e=Se[t]||t,r=Q.get(e);return r&&r.get(i)||!1}static isDefaultFeatureForInstance(i,t){const e=t.$meta.names.slice().reverse();let r=null;for(let l=0,o=e.length;l<o&&r===null;++l){const s=Q.get(e[l]);s&&s.has(i)&&(r=s.get(i))}return r||!1}static reset(){ae.clear(),Q.clear()}},it={finishAndEditNextRow:1,finishAndEditPrevRow:1,finishEditing:1,cancelEditing:1,finishAndEditNextCell:1,finishAndEditPrevCell:1},Vt={...it,startEditingFromKeyMap:1,finishAllSelected:1},ye=class extends Le(P){static get defaultConfig(){return{autoSelect:!0,blurAction:"complete",continueEditingOnCellClick:!0,addNewAtEnd:null,addToCurrentParent:!1,autoEdit:null,editNextOnEnterPress:!0,editorClass:Ht,triggerEvent:"celldblclick",touchEditDelay:300,focusCellAnimationDuration:!1,multiEdit:!0,keyMap:{Enter:["startEditingFromKeyMap","finishAndEditNextRow"],"Ctrl+Enter":["finishAllSelected","finishEditing"],"Shift+Enter":"finishAndEditPrevRow","Alt+Enter":"finishEditing",F2:["startEditingFromKeyMap","finishEditing"],Escape:"cancelEditing",Tab:{handler:"finishAndEditNextCell",weight:100},"Shift+Tab":{handler:"finishAndEditPrevCell",weight:100}},ignoreCSSSelector:"button,.b-icon,.b-fa,svg",validateTapOut:null}}static get pluginConfig(){return{assign:["startEditing","finishEditing","cancelEditing"],before:["onElementKeyDown","onElementPointerUp"],chain:["onElementClick","bindStore"]}}construct(i,t){super.construct(i,t);const e=this,r={renderRows:"onGridRefreshed",cellClick:"onCellClick",thisObj:e};e.grid=i,e.triggerEvent!=="cellclick"&&(r[e.triggerEvent]="onTriggerEditEvent"),e.autoEdit&&!("editNextOnEnterPress"in t)&&(e.editNextOnEnterPress=!1),i.ion(r),i.rowManager.ion({changeTotalHeight:"onGridRefreshed",thisObj:e}),e.bindStore(i.store)}bindStore(i){this.detachListeners("store"),i.ion({name:"store",update:"onStoreUpdate",beforeSort:"onStoreBeforeSort",thisObj:this})}async confirm(i){let t=!0;return this.editorContext&&(pe.owner=this.editorContext.editor.inputField,i.rootElement=this.grid.rootElement,t=await pe.confirm(i),pe.owner=null),t===pe.yesButton}doDestroy(){this.grid.columns.allRecords.forEach(i=>{var t;(t=i._cellEditor)==null||t.destroy()}),super.doDestroy()}doDisable(i){i&&!this.isConfiguring&&this.cancelEditing(!0),super.doDisable(i)}set disabled(i){super.disabled=i}get disabled(){const{grid:i}=this;return!!(super.disabled||i.disabled||i.readOnly)}get isEditing(){return!!this.editorContext}get activeRecord(){var i;return((i=this.editorContext)==null?void 0:i.record)||null}getEditorForCell({id:i,cell:t,column:e,columnId:r,editor:l}){const o=this,{grid:s,editorClass:n}=o;let a=e.cellEditor,d=0;return e.editTargetSelector&&(d=t.querySelector(e.editTargetSelector).offsetLeft),l.autoSelect=o.autoSelect,a!=null&&a.isEditor||(a=e.data.cellEditor=n.create(n.mergeConfigs({type:n.type,constrainTo:null,cls:"b-cell-editor",inputField:l,blurAction:"none",invalidAction:e.invalidAction,completeKey:!1,cancelKey:!1,owner:s,align:{align:"t0-t0",offset:[d,0]},internalListeners:o.getEditorListeners(),onInternalKeyDown:o.onEditorKeydown.bind(o),allowMouseEvents:l.allowMouseEvents},a))),a.minHeight=s.rowHeight,a.inputField!==l&&(a.remove(a.items[0]),a.add(l)),a.align.offset[0]=d,e.instantUpdate&&!l.cellEditValueSetter&&(x.wrapProperty(l,"value",null,c=>{const{editorContext:u}=o,h=u==null?void 0:u.editor.inputField;u!=null&&u.editor.isValid&&!x.isEqual(u.record.getValue(u.column.field),c)&&(!(h!=null&&h.isDateField)||h._isPickerInput)&&u.record.setValue(u.column.field,c)}),l.cellEditValueSetter=!0),Object.assign(a.element.dataset,{rowId:i,columnId:r,field:e.field}),a.inputField.revertOnEscape=e.revertOnEscape,o.editor=a}getEditorListeners(){return{focusOut:"onEditorFocusOut",focusIn:"onEditorFocusIn",start:"onEditorStart",beforeComplete:"onEditorBeforeComplete",complete:"onEditorComplete",beforeCancel:"onEditorBeforeCancel",cancel:"onEditorCancel",beforeHide:"onBeforeEditorHide",finishEdit:"onEditorFinishEdit",thisObj:this}}onEditorStart({source:i}){var t;const e=this,r=e.editorContext=i.cellEditorContext;if(r){const{grid:l}=e;e.triggerEvent!=="cellclick"&&(e.detachListeners("cellClickWhileEditing"),l.ion({name:"cellClickWhileEditing",cellclick:"onCellClickWhileEditing",thisObj:e})),(t=e.removeEditingListeners)==null||t.call(e),e.removeEditingListeners=D.addListener({globaltap:"onTapOut",thisObj:e}),l.trigger("startCellEdit",{grid:l,editorContext:r})}}onEditorBeforeComplete(i){const{grid:t}=this,e=i.source,r=e.cellEditorContext;return i.grid=t,i.editorContext=r,t.trigger("beforeFinishCellEdit",i)}onEditorComplete({source:i}){var t;const{grid:e}=this,r=i.cellEditorContext;if(r.value=i.inputField.value,i.dataField.includes(".")){const l=i.dataField.split(".")[0];(t=i.record.constructor.relations)!=null&&t[l]&&e.rowManager.refresh()}e.trigger("finishCellEdit",{grid:e,editorContext:r})}onEditorBeforeCancel(){const{editorContext:i}=this;return this.grid.trigger("beforeCancelCellEdit",{editorContext:i})}onEditorCancel({event:i}){const{editorContext:t,muteEvents:e,grid:r}=this;e||r.trigger("cancelCellEdit",{grid:r,editorContext:t,event:i})}onBeforeEditorHide({source:i}){const t=this,{row:e,cell:r}=i.cellEditorContext;r==null||r.classList.remove("b-editing"),e==null||e.removeCls("b-editing"),t.detachListeners("cellClickWhileEditing"),t.removeEditingListeners()}onEditorFinishEdit({source:i}){i.cellEditorContext=this.editorContext=null}getAdjacentEditableCell(i,t){const{grid:e}=this,{store:r,columns:l}=e,{visibleColumns:o}=l;let s=i.id,n=l.getAdjacentVisibleLeafColumn(i.columnId,t);for(;s;)if(n){if(n.editor&&n.canEdit(i.record))return{id:s,columnId:n.id};n=l.getAdjacentVisibleLeafColumn(n,t)}else{const a=r.getAdjacent(i.id,t,!1,!0);s=a==null?void 0:a.id,a&&(n=t?o[0]:o[o.length-1])}return null}doAddNewAtEnd(){const i=typeof this.addNewAtEnd=="object"?x.clone(this.addNewAtEnd):{},{grid:{store:t,rowManager:e},addToCurrentParent:r}=this;let l;return t.tree&&r?l=t.last.parent.appendChild(i):l=t.add(i)[0],e.getRowFor(l)||e.displayRecordAtBottom(),l}getEditingContext(i){i=this.grid.normalizeCellContext(i);const{column:t,record:e}=i;if(t!=null&&t.isVisible&&t.editor&&!t.readOnly&&e&&!e.isSpecialRow&&!e.readOnly&&t.canEdit(e)){const r=e&&t.getRawValue(e);return Object.assign(i,{value:r===void 0?null:r,editor:t.editor}),i}else return!1}startEditingFromKeyMap(){return this.startEditing(this.grid.focusedCell)}async startEditing(i={}){var t,e,r;const l=this;if(!l.disabled){const{grid:o}=l;if(i!=null&&i.fromKeyMap&&(i=l.grid.focusedCell),x.isEmpty(i)&&(i.id=o.firstVisibleRow.id),o.store.isTree&&o.features.tree){const u=i.id?o.store.getById(i.id):(t=i.record)!=null?t:o.store.getAt(i.row);if(u)await o.expandTo(u);else return!1}const s=l.getEditingContext(i);if(!s||l.editorContext&&l.cancelEditing()===!1||((e=o.focusedCell)!=null&&e.equals(s)||o.focusCell(s),o.trigger("beforeCellEditStart",{grid:o,editorContext:s})===!1))return!1;const n=s.editor=l.getEditorForCell(s),{row:a,cell:d,record:c}=s;return n.inputField.highlightExternalChange=!1,n.cellEditorContext=s,n.render(d),d.classList.add("b-editing"),a.addCls("b-editing"),await n.startEdit({target:d,field:n.inputField.name||s.column.field,value:s.value,record:c})||(d.classList.remove("b-editing"),a.removeCls("b-editing")),(r=l.onCellEditStart)==null||r.call(l),!0}return!1}cancelEditing(i=!1,t){var e;const r=this,{editor:l}=r;if(!r.isEditing)return;i.fromKeyMap&&(t=i,i=!1),r.muteEvents=i;const o=l.cancelEdit(t);return r.muteEvents=!1,o===!1?l.inputField.focus():(r.finishEditingPromise=!1,(e=r.afterCellEdit)==null||e.call(r)),o}async finishEditing(){var i;const t=this,{editorContext:e,grid:r}=t;let l=!1;if(t.finishEditingPromise)return t.finishEditingPromise;if(e){const{column:o}=e;t.finishEditingPromise=e.editor.completeEdit(o.bindCallback(o.finalizeCellEdit)),l=await t.finishEditingPromise,await r.waitForAnimations(),t.finishEditingPromise=null,l&&((i=t.afterCellEdit)==null||i.call(t))}return l}async onCellClickWhileEditing({event:i,cellSelector:t}){const e=this;if(!i.target.closest(".b-editor")){if(m.isTouchEvent||i.target.matches(e.ignoreCSSSelector)){await e.finishEditing();return}e.finishEditingPromise||e.editorContext&&!e.editorContext.editor.owns(i.target)&&(e.getEditingContext(t)?await e.finishEditing()?e.continueEditingOnCellClick&&await e.startEditing(t):(e.grid.focusCell(e.editorContext),e.editor.inputField.focus()):await e.finishEditing())}}async onCellClick({cellSelector:i,target:t,event:e,column:r}){if(r.onCellClick)return;const l=this,{focusedCell:o}=l.client;if(t.closest(".b-tree-expander"))return!1;m.isTouchEvent&&l._lastCellClicked===(o==null?void 0:o.cell)&&e.timeStamp-l.touchEditDelay>l._lastCellClickedTime?await l.startEditing(i):this.triggerEvent==="cellclick"&&await l.onTriggerEditEvent({cellSelector:i,target:t}),l._lastCellClicked=o==null?void 0:o.cell,l._lastCellClickedTime=e.timeStamp}onElementPointerUp(i){i.target.closest(".b-tree-expander")&&this.cancelEditing(void 0,i)}async onTriggerEditEvent({cellSelector:i,target:t,event:e}){var r;const{editorContext:l,client:o}=this;t.closest(".b-tree-expander")||m.isTouchEvent&&e.type==="dblclick"||e&&((r=o.features.cellMenu)==null?void 0:r.triggerEvent)===e.type||l&&(l.equals(this.grid.normalizeCellContext(i))||!await this.finishEditing())||await this.startEditing(i)}onStoreUpdate({changes:i,record:t}){const{editorContext:e}=this;e!=null&&e.editor.isVisible&&t===e.record&&e.editor.dataField in i&&e.editor.refreshEdit()}onStoreBeforeSort(){var i;const t=(i=this.editorContext)==null?void 0:i.editor;if(this.isEditing&&!(t!=null&&t.isFinishing)&&!t.isValid)return this.cancelEditing()}onGridRefreshed(){const i=this,{grid:t,editorContext:e}=i;if(e&&t.isVisible&&t.focusedCell){const r=t.getCell(t.focusedCell),{editor:l}=e;r&&m.isInView(r)&&!l.isFinishing?(e._cell=r,D.suspendFocusEvents(),l.render(r),l.showBy(r),l.focus(),D.resumeFocusEvents()):i.cancelEditing()}}get gridSelection(){return[...this.grid.selectedRows,...this.grid.selectedCells]}isActionAvailable({actionName:i,event:t}){const e=this;if(Vt[i]){if(!e.disabled&&!t.target.closest(".b-grid-header")){if(e.isEditing){if(i==="finishAllSelected")return e.multiEdit&&e.gridSelection.length>1;if(it[i])return!0}else if(i==="startEditingFromKeyMap")return e.grid.focusedCell.cell===t.target}return!1}}async finishAllSelected(){const i=this,{dataField:t,record:e}=i.editor;if(await i.finishEditing()&&!i.isDestroyed){const r=e.getValue(t);for(const l of i.gridSelection)l.isModel?l!==e&&l.setValue(t,r):l.record.set(l.column.field,r)}}async finishAndEditNextRow(i,t=!1){const e=this,{grid:r}=e,{record:l}=e.editorContext;let o;if(await e.finishEditing()){if(e.isDestroyed)return;e.isEditing||(t?o=r.internalNextPrevRow(!1,!0,!1):(e.addNewAtEnd&&l===r.store.last&&await e.doAddNewAtEnd(),e.isDestroyed||(o=r.internalNextPrevRow(!0,!0))),o&&e.editNextOnEnterPress&&!r.touch&&await e.startEditing(o))}}finishAndEditPrevRow(i){return this.finishAndEditNextRow(i,!0)}async finishAndEditNextCell(i,t=!1){var e,r;const l=this,{grid:o}=l,{focusedCell:s}=o;if(s&&!l.finishEditingPromise){const{rowIndex:n,columnIndex:a}=s;let d=l.getAdjacentEditableCell(s,!t);!d&&!t&&l.addNewAtEnd&&await l.finishEditing()===!0&&await l.doAddNewAtEnd();let c=!0;if(l.isEditing&&(c=await l.finishEditing()),l.isDestroyed)return;d=l.getAdjacentEditableCell(new R({grid:o,rowIndex:n,columnIndex:a}),!t),d?c&&(o.focusCell(d,{animate:l.focusCellAnimationDuration}),await l.startEditing(d)||await l.finishAndEditNextCell(i,t)):o.isNested&&o.owner&&!((r=(e=o.owner).catchFocus)!=null&&r.call(e,{source:o,navigationDirection:t?"up":"down",editing:!0}))&&o.onTab(i)}}finishAndEditPrevCell(i){return this.finishAndEditNextCell(i,!0)}async onElementKeyDown(i){const t=this,{grid:e}=t,{focusedCell:r}=e;if(i.handled||!t.autoEdit||t.isEditing||!r||r.isActionable||i.ctrlKey)return;const{key:l}=i,o=i.key==="Delete"||i.key==="Backspace",{gridSelection:s}=o?t:{},n=t.multiEdit&&(s==null?void 0:s.length)>1;if((l.length<=1||o&&!n)&&await t.startEditing(r)){const{inputField:a}=t.editor,{input:d}=a;d&&(a.internalOnKeyEvent(i),i.defaultPrevented||(d.value=o?"":l,a.internalOnInput(i))),i.preventDefault()}else if(n&&e.trigger("beforeCellRangeDelete",{grid:e,gridSelection:s})!==!1)for(const a of s)a.isModel?e.columns.visibleColumns.forEach(d=>{!d.readOnly&&a.set(d.field,null)}):a.column.readOnly||a.record.set(a.column.field,null)}onEditorKeydown(i){if(i.key.length!==1&&this.grid.matchKeyMapEntry(i)&&!this.grid.matchKeyMapEntry(i,this.keyMap))return!i.key.startsWith("Arrow")&&!i.key==="Backspace"&&i.preventDefault(),i.handled=!0,i.stopPropagation(),!1}async onEditorFocusOut(i){const t=this,{grid:e,editor:r,editorContext:l}=t,o=new R(i.relatedTarget),s=o.grid===e&&t.getEditingContext(o);l&&!r.isFinishing&&r.owns(i._target)&&(t.blurAction==="cancel"||!e.store.includes(l.record)?t.cancelEditing(void 0,i):!t.finishEditingPromise&&(t.triggerEvent==="cellclick"||t.triggerEvent!=="cellclick"&&!s)&&await t.finishEditing())}onEditorFocusIn(i){const t=i.toWidget;t===this.editor.inputField&&this.autoSelect&&t.selectAll&&!t.readOnly&&!t.disabled&&t.selectAll()}async onTapOut({event:i}){const t=this,{target:e}=i;if(!e._shadowRoot&&!t.editor.owns(e)&&(!t.grid.bodyContainer.contains(e)||i.button)){const r=t.resolveCallback(t.validateTapOut,t,!1),l=(r==null?void 0:r.handler.call(r.thisObj,i,t.editorContext))||t.blurAction;t.editingStoppedByTapOutside=!0,l==="cancel"?t.cancelEditing(void 0,i):await t.finishEditing(),delete t.editingStoppedByTapOutside}}async onElementClick(i){i.target.classList.contains("b-grid-body-container")&&this.editorContext&&await this.finishEditing()}};F(ye,"$name","CellEdit"),ye._$name="CellEdit",L.registerFeature(ye,!0);var de=class extends Xe{static get $name(){return"CellMenu"}static get defaultConfig(){return{processItems:null,items:null,type:"cell"}}static get pluginConfig(){const i=super.pluginConfig;return i.chain.push("populateCellMenu"),i}showContextMenu(i){const t=this,{cellSelector:e,event:r}=i;t.client.focusCell(e,{doSelect:!t.client.isSelected(e),event:r}),super.showContextMenu(i)}shouldShowMenu({column:i}){return i&&i.enableCellContextMenu!==!1}getDataFromEvent(i){const t=this.client.getCellDataFromEvent(i);if(t)return x.assign(super.getDataFromEvent(i),t)}beforeContextMenuShow({record:i,items:t,column:e}){if(e.cellMenuItems===!1)return!1;(!i||i.isSpecialRow)&&(t.removeRow=!1)}populateCellMenu({items:i,column:t,record:e}){const{client:r}=this;t!=null&&t.cellMenuItems&&x.merge(i,t.cellMenuItems),r.readOnly||(i.removeRow={text:"L{removeRow}",localeClass:this,icon:"b-fw-icon b-icon-trash",cls:"b-separator",weight:100,disabled:e.readOnly,onItem:()=>{var l,o;((o=(l=r.features.treeGroup)==null?void 0:l.originalStore)!=null?o:r.store).remove(r.selectedRecords.filter(n=>!n.readOnly).map(n=>n.$original))}})}get showMenu(){return!0}};de.featureClass="",de._$name="CellMenu",L.registerFeature(de,!0,["Grid","Scheduler"]),L.registerFeature(de,!1,["Gantt"]);var xe=class extends Le(P){static get $name(){return"ColumnDragToolbar"}static get pluginConfig(){return{after:["render"]}}construct(i,t){i.features.columnReorder&&i.features.columnReorder.ion({beforeDestroy:"onColumnReorderBeforeDestroy",thisObj:this}),this.grid=i,super.construct(i,t)}doDestroy(){const i=this;i.grid.features.columnReorder&&!i.grid.features.columnReorder.isDestroyed&&i.detachFromColumnReorder(),i.element&&i.element.remove(),i.element=null,super.doDestroy()}doDisable(i){this.initialized&&(i?this.detachFromColumnReorder():this.init()),super.doDisable(i)}init(){const i=this,t=i.grid;t.features.columnReorder&&(i.reorderDetacher=t.features.columnReorder.ion({gridheaderdragstart({context:e}){const r=t.columns.getById(e.element.dataset.columnId);i.showToolbar(r)},gridheaderdrag:({context:e})=>i.onDrag(e),gridheaderabort:()=>{i.hideToolbar()},gridHeaderDrop:i.onDrop,thisObj:i}),i.initialized=!0)}onColumnReorderBeforeDestroy(){this.detachFromColumnReorder()}detachFromColumnReorder(){const i=this;i.grid.features.columnReorder.un("beforedestroy",i.onColumnReorderBeforeDestroy,i),i.reorderDetacher&&i.reorderDetacher(),i.reorderDetacher=null}render(){this.initialized||this.init()}showToolbar(i){const t=this,e=t.grid.getColumnDragToolbarItems(i,[]),r=[];t.clearTimeout(t.buttonHideTimer),e.forEach(l=>{l.text=l.localeClass.L(l.text);let o=r.find(s=>s.text===l.group);o||(o={text:l.localeClass.L(l.group),buttons:[]},r.push(o)),o.buttons.push(l)}),t.element=m.append(t.grid.element,t.template(r)),t.groups=r,t.buttons=e,t.column=i}async hideToolbar(){const i=this,t=i.element;t&&(t.classList.add("b-remove"),await j.waitForTransitionEnd({element:t,mode:"animation",thisObj:i.client}),t.remove(),i.element=null)}onDrag(i){var t;const e=this;if(i.dragProxy.getBoundingClientRect().top-e.grid.element.getBoundingClientRect().top>100?e.element.classList.add("b-closer"):e.element.classList.remove("b-closer"),e.hoveringButton&&(e.hoveringButton.classList.remove("b-hover"),e.hoveringButton=null),(t=i.targetElement)!=null&&t.closest(".b-columndragtoolbar")){e.element.classList.add("b-hover");const r=i.targetElement.closest(".b-columndragtoolbar  .b-target-button:not([data-disabled=true])");r&&(r.classList.add("b-hover"),e.hoveringButton=r)}else e.element.classList.remove("b-hover")}onDrop({context:i}){const t=this,{targetElement:e}=i;if(e&&e.matches(".b-columndragtoolbar .b-target-button:not([data-disabled=true])")){const r=t.buttons.find(l=>l.ref===e.dataset.ref);r&&(e.classList.add("b-activate"),t.buttonHideTimer=t.setTimeout(()=>{t.hideToolbar(),r.onDrop({column:t.column})},100))}else t.hideToolbar()}template(i){return se.tpl`
            <div class="b-columndragtoolbar">     
            <div class="b-title"></div>          
            ${i.map(t=>se.tpl`
                <div class="b-group">
                    <div class="b-buttons">
                    ${t.buttons.map(e=>se.tpl`
                        <div class="b-target-button" data-ref="${e.ref}" data-disabled="${e.disabled}">
                            <i class="${e.icon}"></i>
                            ${e.text}
                        </div>
                    `)}
                    </div>
                    <div class="b-title">${t.text}</div>
                </div>
            `)}
            </div>`}};xe.featureClass="b-hascolumndragtoolbar",xe._$name="ColumnDragToolbar",L.registerFeature(xe,k.isTouchDevice);var ce=class extends P{static get pluginConfig(){return{chain:["populateHeaderMenu","getColumnDragToolbarItems"]}}get grid(){return this.client}getColumnPickerItems(i){const t=this,{createColumnsFromModel:e}=t;let r;if(t.groupByRegion)r=t.grid.regions.map(l=>{const o=t.grid.getSubGrid(l).columns.topColumns;return{text:T.capitalize(l),menu:t.buildColumnMenu(o),disabled:o.length===0,region:l}}),e&&r.push({text:t.L("L{newColumns}"),menu:t.createAutoColumnItems()});else if(t.groupByTag){const l={};i.topColumns.forEach(o=>{o.tags&&Array.isArray(o.tags)&&o.hideable!==!1&&o.tags.forEach(s=>{l[s]||(l[s]=1)})}),r=Object.keys(l).sort().map(o=>({text:T.capitalize(o),menu:t.buildColumnMenu(t.getColumnsForTag(o)),tag:o,onBeforeSubMenu:({item:s,itemEl:n})=>{t.refreshTagMenu(s,n)}})),e&&r.push({text:t.L("L{newColumns}"),menu:t.createAutoColumnItems()})}else r=t.buildColumnMenu(i.topColumns),e&&r.items.push(...x.transformNamedObjectToArray(t.createAutoColumnItems()));return r}createAutoColumnItems(){const i=this,{grid:t}=i,{columns:e,store:r}=t,{modelClass:l}=r,{allFields:o}=l,s={};for(let n=0,{length:a}=o;n<a;n++){const d=o[n],c=d.name;e.get(c)||d.internal||(s[c]={text:d.text||T.separate(d.name),checked:!1,onToggle:u=>{const h=e.get(c);h?h[u.checked?"show":"hide"]():e.add(e.generateColumnForField(d,{region:i.forColumn.region})),u.bubbles=!1}})}return s}getColumnsForTag(i){return this.grid.columns.records.filter(t=>t.tags&&Array.isArray(t.tags)&&t.tags.includes(i)&&t.hideable!==!1)}refreshTagMenu(i,t){this.getColumnsForTag(i.tag).forEach(r=>{const l=i.items.find(o=>o.column===r);l&&(l.checked=r.hidden!==!0)})}buildColumnMenu(i){let t=i.length>0&&i[0].region;const{grid:e}=this,r=i.reduce((l,o)=>{const s=e.columns.visibleColumns.filter(n=>n.region===o.region);if(o.hideable!==!1){const n={grid:e,column:o,text:o.headerText,checked:o.hidden!==!0,disabled:o.hidden!==!0&&s.length===1,cls:o.region!==t?"b-separator":""};t=o.region,o.children&&!o.isCollapsible&&(n.menu=this.buildColumnMenu(o.children)),l.push(n)}return l},[]);return{cls:this.menuCls,items:r}}populateHeaderMenu({column:i,items:t}){const e=this,{columns:r}=e.grid;e.forColumn=i,i.showColumnPicker!==!1&&r.some(l=>l.hideable)&&(t.columnPicker={text:"L{columnsMenu}",localeClass:e,icon:"b-fw-icon b-icon-columns",cls:"b-separator",weight:200,menu:e.getColumnPickerItems(r),onToggle:e.onColumnToggle,disabled:e.disabled}),i.hideable!==!1&&!i.parent.isCollapsible&&(t.hideColumn={text:"L{hideColumn}",localeClass:e,icon:"b-fw-icon b-icon-hide-column",weight:210,disabled:!i.allowDrag||e.disabled,onItem:()=>i.hide()})}onColumnToggle({menu:i,item:t,checked:e}){var r,l;if(!!t.column.hidden!=!e){t.column[e?"show":"hide"]();const{grid:o,column:s}=t,{columns:n,features:a}=o,d=i.items,c=n.visibleColumns.filter(g=>g.region===t.column.region),u=((r=a.headerMenu)==null?void 0:r.enabled)&&a.headerMenu.menu.widgetMap.hideColumn;if(c.length===1){const g=d.find(f=>f.column===c[0]);g&&(g.disabled=!0),u&&s.region===t.column.region&&(u.disabled=!0)}else c.forEach(g=>{const f=d.find(p=>p.column===g);f&&(f.disabled=!1)}),u&&s.region===t.column.region&&(u.disabled=!1);(l=t.menu)==null||l.eachWidget(g=>{g.checked=e});const h=i.owner;h&&h.column===s.parent&&(h.checked=d.some(g=>g.checked===!0))}}getColumnDragToolbarItems(i,t){const e=this.grid.columns.visibleColumns.filter(r=>r.region===i.region);return i.hideable!==!1&&e.length>1&&t.push({text:"L{hideColumnShort}",ref:"hideColumn",group:"L{column}",localeClass:this,icon:"b-fw-icon b-icon-hide-column",weight:101,onDrop:({column:r})=>r.hide()}),t}};F(ce,"$name","ColumnPicker"),F(ce,"configurable",{groupByRegion:!1,groupByTag:!1,createColumnsFromModel:!1,menuCls:"b-column-picker-menu b-sub-menu"}),ce._$name="ColumnPicker",L.registerFeature(ce,!0);var Z=class extends Le(P){constructor(){super(...arguments),F(this,"ignoreSelectors",[".b-grid-header-resize-handle",".b-field"])}init(){const i=this,{grid:t}=i,e=t.element,r=m.children(e,".b-grid-headers");r.push(...m.children(e,".b-grid-header-children")),i.dragHelper?i.dragHelper.containers=r:t.whenVisible(()=>i.createDragHelper())}createDragHelper(){const i=this,{grid:t}=i,e=t.element,r=m.children(e,".b-grid-headers");return r.push(...m.children(e,".b-grid-header-children")),i.dragHelper=new wt({name:"columnReorder",mode:"container",dragThreshold:10,targetSelector:".b-grid-header",floatRootOwner:t,rtlSource:t,outerElement:t.headerContainer,dropTargetSelector:".b-grid-headers, .b-groupbar, .b-columndragtoolbar",externalDropTargetSelector:".b-groupbar, .b-columndragtoolbar",monitoringConfig:{scrollables:[{element:".b-grid-headers"}]},scrollManager:Ze.new({direction:"horizontal",element:t.headerContainer}),containers:r,isElementDraggable(l){if(!!l.closest(i.ignoreSelectors.join(","))||i.disabled)return!1;const s=l.closest(this.targetSelector),n=s&&t.columns.getById(s.dataset.columnId),a=(n==null?void 0:n.childLevel)===0&&t.subGrids[n.region].columns.count===1;return!!n&&n.draggable!==!1&&!a},ignoreSelector:".b-filter-icon,.b-grid-header-resize-handle",internalListeners:{beforeDragStart:i.onBeforeDragStart,dragstart:i.onDragStart,drag:i.onDrag,drop:i.onDrop,abort:i.onAbort,thisObj:i}}),i.relayEvents(i.dragHelper,["dragStart","drag","drop","abort"],"gridHeader"),i.dragHelper}doDestroy(){var i,t;(i=this.dragHelper)==null||i.scrollManager.destroy(),(t=this.dragHelper)==null||t.destroy(),super.doDestroy()}get grid(){return this.client}onBeforeDragStart({context:i,event:t}){const e=this,{element:r}=i,l=i.column=e.client.columns.getById(r.dataset.columnId);return e.dragHelper.autoSizeClonedTarget=!e.usingGroupBarWidget,l.allowDrag&&e.client.trigger("beforeColumnDragStart",{column:l,event:t})}onDragStart({context:i,event:t}){const e=this,{grid:r,usingGroupBarWidget:l}=e,{column:o,dragProxy:s}=i;if(!r.features.columnDragToolbar&&!l){const n=r.element.querySelector(".b-grid-header-container").getBoundingClientRect();e.dragHelper.minY=n.top,e.dragHelper.maxY=n.bottom}r.element.classList.add("b-dragging-header"),l&&s.classList.add("b-grid-reordering-columns-with-groupbar"),r.features.filterBar&&r.features.filterBar.compactMode&&s.classList.add("b-filter-bar-compact"),s.style.fontSize=m.getStyleValue(i.element,"fontSize"),r.trigger("columnDragStart",{column:o,event:t})}onDrag({context:i,event:t}){const e=this,r=e.client,{column:l,insertBefore:o}=i,s=r.columns.getById(o==null?void 0:o.dataset.columnId),n=J.fromElement(t.target,"gridheader");n!=null&&n.subGrid.sealedColumns&&(i.valid=!1),r.trigger("columnDrag",{column:l,insertBefore:s,event:t,context:i})}onDrop({context:i,event:t}){var e;if(!i.valid)return this.onInvalidDrop({context:i,event:t});const r=this,{grid:l}=r,{column:o}=i,s=i.dragging,n=i.target.closest(".b-grid-header"),a=(e=i.draggedTo)==null?void 0:e.dataset.region,d=a||n;let c,u,h,g,f;if(l.element.classList.remove("b-dragging-header"),d){const p=n?l.columns.get(n.dataset.column):l.subGrids[a].columns.last,v=i.insertBefore;if(g=a||p.region,f=o.parent,h=v?l.columns.getById(v.dataset.columnId):l.subGrids[g].columns.last.nextSibling,h)u=h.parent;else{const C=n==null?void 0:n.parentElement.closest(".b-grid-header");C?u=l.columns.getById(C.dataset.columnId):u=l.columns.rootNode}c=g===o.region&&f===u&&(p===o.previousSibling||h===o.nextSibling),s.remove()}c=c||l.trigger("beforeColumnDropFinalize",{column:o,newParent:u,insertBefore:h,event:t,region:g})===!1,!c&&d&&(c=!u.insertChild(o,h)),i.valid=!c,!c&&d&&(o.region=g,f.children.length===0&&f.parent.removeChild(f)),l.trigger("columnDrop",{column:o,newParent:u,insertBefore:h,valid:i.valid,event:t,region:g})}onAbort({context:i,event:t}){this.onInvalidDrop({context:i,event:t})}onInvalidDrop({context:i,event:t}){const{grid:e}=this,{column:r}=i;e.trigger("columnDrop",{column:r,valid:!1,event:t}),e.element.classList.remove("b-dragging-header")}renderContents(){this.init()}onInternalPaint(){this.init()}get isReordering(){var i;return!!((i=this.dragHelper)!=null&&i.isDragging)}};F(Z,"$name","ColumnReorder"),F(Z,"pluginConfig",{after:["onInternalPaint","renderContents"]}),Z.featureClass="b-column-reorder",Z._$name="ColumnReorder",L.registerFeature(Z,!0);var Be=class extends P{static get $name(){return"ColumnResize"}static get configurable(){return{liveResize:"auto"}}construct(i,t){const e=this;e.grid=i,super.construct(i,t),e.resizer=new St({name:"columnResize",targetSelector:".b-grid-header",handleSelector:".b-grid-header-resize-handle",outerElement:i.element,rtlSource:i,internalListeners:{beforeresizestart:e.onBeforeResizeStart,resizestart:e.onResizeStart,resizing:e.onResizing,resize:e.onResize,cancel:e.onCancel,thisObj:e}})}doDestroy(){var i;(i=this.resizer)==null||i.destroy(),super.doDestroy()}changeLiveResize(i){return i==="auto"?!k.isMobileSafari:i}onBeforeResizeStart(){return!this.disabled}onResizeStart({context:i}){const{grid:t,resizer:e}=this,r=i.column=t.columns.getById(i.element.dataset.columnId);e.minWidth=r.minWidth,t.element.classList.add("b-column-resizing")}onResizing({context:i}){i.valid&&this.liveResize&&(this.grid.resizingColumns=!0,i.column.width=i.newWidth)}onResize({context:i}){const{grid:t}=this,{column:e}=i;t.element.classList.remove("b-column-resizing"),i.valid&&(this.liveResize?(t.resizingColumns=!1,t.afterColumnsResized(e)):e.width=i.newWidth)}onCancel({context:i}){const{grid:t}=this;t.element.classList.remove("b-column-resizing"),i.column.width=i.elementWidth,t.resizingColumns=!1}};Be._$name="ColumnResize",L.registerFeature(Be,!0);var rt=class mt extends Y{static get $name(){return"GridFieldFilterPicker"}static get type(){return"gridfieldfilterpicker"}afterConstruct(){var t;const e=this;if(!e.grid)throw new Error(`${e.constructor.$name} requires 'grid' to be configured.`);e.fields=(t=e.fields)!=null?t:{},super.afterConstruct()}updateGrid(t){var e;if(!((e=t.store)!=null&&e.modelClass))throw new Error("Grid does not have a store with a modelClass defined.");if(!t.columns)throw new Error("Grid does not have a column store.")}static getColumnFields(t,e,r){var l;return Object.fromEntries((l=t==null?void 0:t.reduce((o,{field:s,text:n,filterType:a,filterable:d})=>{var c;if(!r||r.includes(s)){const u=s&&e.getFieldDefinition(s),h=xt(u)?u.type:void 0;(h||a||d)&&o.push([s,{title:n||s,type:(c=a!=null?a:Rt(u)?"duration":h)!=null?c:"auto"}])}return o},[]))!=null?l:[])}changeFields(t){var e;let r=t;Array.isArray(t)&&($.deprecate("Core","6.0.0","FieldOption[] deprecated, use Object<String, FieldOption[]> keyed by field name instead"),r=H.keyBy(r,"name"));const l=x.merge({},mt.getColumnFields(this.grid.columns,(e=this.grid.store)==null?void 0:e.modelClass),r);return this.allowedFieldNames?Object.fromEntries(this.allowedFieldNames.map(o=>[o,l[o]])):l}};F(rt,"configurable",{grid:null,allowedFieldNames:null});var Pe=rt;Pe.initClass(),Pe._$name="GridFieldFilterPicker";var ue=class extends vt{static get $name(){return"GridFieldFilterPickerGroup"}static get type(){return"gridfieldfilterpickergroup"}validateConfig(){if(!this.grid)throw new Error(`${this.constructor.$name} requires the 'grid' config property.`)}getFilterPickerConfig(i){const{grid:t,allowedFieldNames:e,fields:r}=this;return{...super.getFilterPickerConfig(i),fields:r,grid:t,allowedFieldNames:e}}updateGrid(i){this.store=this.grid.store}canManage(i){const t=this;return super.canManage(i)&&(!t.allowedFieldNames||t.allowedFieldNames.includes(i.property))}};F(ue,"configurable",{grid:null,allowedFieldNames:null}),F(ue,"childPickerType","gridfieldfilterpicker"),ue.initClass(),ue._$name="GridFieldFilterPickerGroup";var Ge={date:"date",int:"number",integer:"number",number:"number",string:"string",duration:"duration",time:"time",auto:"auto"},zt={date:"=",number:"=",string:"includes",duration:"=",relation:null,auto:"*"},jt={...yt,relation:!0},Kt={filterDateIsToday:!0,filterDateIsThisWeek:!0,filterDateIsThisMonth:!0,filterDateIsThisYear:!0},We=class extends P{static get $name(){return"Filter"}static get configurable(){return{prioritizeColumns:!1,keyMap:{f:"showFilterEditorByKey"},legacyMode:!1,pickerConfig:null,closeEmptyPopup:!1}}construct(i,t){if(i.features.filterBar)throw new Error("Grid.feature.Filter feature may not be used together with Grid.feature.FilterBar. These features are mutually exclusive.");const e=this;if(e.grid=i,e.closeFilterEditor=e.closeFilterEditor.bind(e),t!=null&&t.isMulti&&($.deprecate("Grid","6.0.0","Filter plugin config isMulti deprecated, use pickerConfig instead"),typeof t.isMulti=="object"&&(t.pickerConfig=t.isMulti),delete t.isMulti),super.construct(i,t),e.bindStore(i.store),t&&typeof t=="object"){const r=x.clone(t);delete r.prioritizeColumns,delete r.legacyMode,delete r.pickerConfig,delete r.dateFormat,delete r.closeEmptyPopup,x.isEmpty(r)||i.store.filter(r,null,i.isConfiguring)}}doDestroy(){var i,t;(i=this.filterTip)==null||i.destroy(),(t=this.filterEditorPopup)==null||t.destroy(),super.doDestroy()}get store(){return this.grid.store}bindStore(i){this.detachListeners("store"),i.ion({name:"store",beforeFilter:"onStoreBeforeFilter",filter:"onStoreFilter",thisObj:this}),this.client.isPainted&&this.refreshHeaders(!1)}static get pluginConfig(){return{chain:["renderHeader","populateCellMenu","populateHeaderMenu","onElementClick","bindStore"]}}refreshHeaders(i){const t=this,e=t.grid,r=e.headerContainer;r&&(m.children(r,".b-filter-icon.b-latest").forEach(l=>l.classList.remove("b-latest")),t.filterTip||(t.filterTip=new et({forElement:r,forSelector:".b-filter-icon",getHtml({activeTarget:l}){return l.dataset.filterText}})),e.store.isFiltered||t.filterTip.hide(),e.columns.visibleColumns.forEach(l=>{if(l.filterable!==!1){const o=t.store.filters.allValues.filter(({property:a,disabled:d,internal:c})=>a===l.field&&!d&&!c),s=o.length>0,n=l.element;if(n){const a=l.textWrapper;let d=a==null?void 0:a.querySelector(".b-filter-icon"),c;if(s){const u="&#x2022 ";c=`${t.L("L{filter}")}: `+(o.length>1?"<br/><br/>":"")+o.map(h=>{var g,f,p,v,C;let b=(g=h.value)!=null?g:"";const w=Array.isArray(b),S=(p=(f=t.store)==null?void 0:f.modelRelations)==null?void 0:p.find(({foreignKey:y})=>y===h.property);if(h.displayValue)b=h.displayValue;else{if(!t.legacyMode&&S){const{relatedDisplayField:y}=(C=(v=t.pickerConfig)==null?void 0:v.fields)==null?void 0:C[h.property];if(y){const E=I=>{var A;return(A=S.foreignStore.getById(I))==null?void 0:A[y]};w?b=b.map(E).sort((I,A)=>(I!=null?I:"").localeCompare(A!=null?A:"")):b=E(b)}}else l.formatValue&&b&&(b=w?b.map(y=>l.formatValue(y)):l.formatValue(b));w&&(b=`[ ${b.join(", ")} ]`)}return(o.length>1?u:"")+(typeof h=="string"?h:`${h.operator} ${b}`)}).join("<br/><br/>")}else c=t.L("L{applyFilter}");d?d.dataset.filterText=c:d=m.createElement({parent:a,tag:"div",className:"b-filter-icon",dataset:{filterText:c}}),l.field===t.store.latestFilterField&&d.classList.add("b-latest"),n.classList.add("b-filterable"),n.classList.toggle("b-filter",s)}l.meta.isFiltered=s}}),i&&e.refreshRows())}applyFilter(i,t){const{store:e}=this;i.$filter=e.addFilter(this.injectColumnFilterConfig(i,t),!0),e.filter()}injectColumnFilterConfig(i,t){const{filterFn:e}=i.filterable;return x.assign(t,{...i.filterable,...t,property:i.field,[e?"filterBy":"_"]:function(r){return e({value:this.value,record:r,operator:this.operator,property:this.property,column:i})}})}removeFilter(i,t){var e;if(!this.legacyMode&&!((e=i.filterable)!=null&&e.filterField))for(const r of this.getCurrentMultiFilters(i))(!t||r.operator===t)&&this.store.removeFilter(r);else this.store.removeFilter(i.field)}disableFilter(i){for(const t of this.getCurrentMultiFilters(i))t.disabled=!0,this.store.filter(t);this.store.filter()}getCurrentMultiFilters(i){return this.store.filters.values.filter(t=>t.property===i.field)}getPopupDateItems(i,t,e,r,l,o,s,n){const a=this,d=o;function c(){a.removeFilter(i)}function u({event:g}){g.key==="Enter"&&o()}function h({source:g,value:f}){f==null?c():(a.clearSiblingsFields(g),a.applyFilter(i,{operator:g.operator,value:f,displayValue:g._value,type:"date"}))}return[x.assign({type:"date",ref:"on",placeholder:"L{on}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:(e==null?void 0:e.operator)==="sameDay"?e.value:r,operator:"sameDay",onKeydown:u,onChange:h,onClose:d,onClear:c},n),x.assign({type:"date",ref:"before",placeholder:"L{before}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-before"></i>',value:(e==null?void 0:e.operator)==="<"?e.value:null,operator:"<",onKeydown:u,onChange:h,onClose:d,onClear:c},n),x.assign({type:"date",ref:"after",cls:"b-last-row",placeholder:"L{after}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-after"></i>',value:(e==null?void 0:e.operator)===">"?e.value:null,operator:">",onKeydown:u,onChange:h,onClose:d,onClear:c},n)]}getPopupNumberItems(i,t,e,r,l,o,s,n){const a=this,d=o;function c(){a.removeFilter(i)}function u({event:g}){g.key==="Enter"&&o()}function h({source:g,value:f}){f==null?c():(a.clearSiblingsFields(g),a.applyFilter(i,{operator:g.operator,value:f}))}return[x.assign({type:"number",placeholder:"L{Filter.equals}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:(e==null?void 0:e.operator)==="="?e.value:r,operator:"=",onKeydown:u,onChange:h,onEsc:d,onClear:c},n),x.assign({type:"number",placeholder:"L{lessThan}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:(e==null?void 0:e.operator)==="<"?e.value:null,operator:"<",onKeydown:u,onChange:h,onEsc:d,onClear:c},n),x.assign({type:"number",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:(e==null?void 0:e.operator)===">"?e.value:null,operator:">",onKeydown:u,onChange:h,onEsc:d,onClear:c},n)]}clearSiblingsFields(i){var t;(t=this.filterEditorPopup)==null||t.items.forEach(e=>{e!==i&&(e==null||e.clear())})}getPopupDurationItems(i,t,e,r,l,o,s,n){const a=this,d=o,c=()=>a.removeFilter(i);function u({source:h,value:g}){g==null?c():(a.clearSiblingsFields(h),a.applyFilter(i,{operator:h.operator,value:g}))}return[x.assign({type:"duration",placeholder:"L{Filter.equals}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:(e==null?void 0:e.operator)==="="?e.value:r,operator:"=",onChange:u,onEsc:d,onClear:c},n),x.assign({type:"duration",placeholder:"L{lessThan}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:(e==null?void 0:e.operator)==="<"?e.value:null,operator:"<",onChange:u,onEsc:d,onClear:c},n),x.assign({type:"duration",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:(e==null?void 0:e.operator)===">"?e.value:null,operator:">",onChange:u,onEsc:d,onClear:c},n)]}getPopupStringItems(i,t,e,r,l,o,s,n){const a=this;return[x.assign({type:"text",cls:"b-last-row",placeholder:"L{filter}",localeClass:a,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:e?e.value||e:r,operator:"*",onChange({source:d,value:c}){c===""?s():(a.applyFilter(i,{operator:d.operator,value:c,displayValue:d.displayField&&d.records?d.records.map(u=>u[d.displayField]).join(", "):void 0}),d.multiSelect||o())},onClose:o,onClear:s},n)]}getPopupItems(i,t,e,r,l,o,s,n){const a=this;if(a.useLegacyModeForColumn(i)||n)switch(t){case"date":return a.getPopupDateItems(...arguments);case"number":return a.getPopupNumberItems(...arguments);case"duration":return a.getPopupDurationItems(...arguments);default:return a.getPopupStringItems(...arguments)}return[a.getFieldFilterPickerGroup(i)]}getFieldFilterPickerGroup(i){const t=this;return{...t.pickerConfig,type:"gridfieldfilterpickergroup",ref:"pickerGroup",limitToProperty:i.field,grid:t.grid,propertyFieldCls:"b-transparent property-field",operatorFieldCls:"b-transparent operator-field",valueFieldCls:"b-transparent value-field",internalListeners:{beforeAddFilter:({filter:e})=>{t.injectColumnFilterConfig(i,e)},remove:t.onPopupFilterRemove,keydown:t.onPopupKeydown,thisObj:t},triggerChangeOnInput:!1}}onPopupFilterRemove(){this.closeEmptyPopup&&this.filterEditorPopup.widgetMap.pickerGroup.filters.length===0&&this.delay(this.closeFilterEditor,0)}onPopupKeydown({event:i}){i.key==="Enter"&&this.delay(this.closeFilterEditor,0)}showFilterEditor(i,t,e,r=!1){var l;i=this.grid.columns.getById(i);const o=this,{store:s}=o,n=i.element,a=s.filters.getBy("property",i.field),d=o.getFilterType(i),c=o.useLegacyModeForColumn(i);if(i.filterable===!1)return;o.closeFilterEditor();const u=o.getPopupItems(i,d,a!=null&&a.internal?null:a,t,s,o.closeFilterEditor,()=>{o.removeFilter(i),o.closeFilterEditor()},i.filterable.filterField);u.forEach(h=>h.placeholder=h.placeholder?this.L(h.placeholder):h.placeholder),o.filterEditorPopup=be.openPopup(n,{owner:o.grid,cls:new Ce("b-filter-popup",{"b-filter-popup-legacymode":c}),scrollAction:"realign",layout:{type:"vbox",align:"stretch"},items:u}),c||((r||!((l=o.grid.store)!=null&&l.filters.find(h=>h.property===i.field)))&&o.filterEditorPopup.widgetMap.pickerGroup.addFilter({type:d,property:i.field,operator:e!=null?e:zt[d],value:t}),o.filterEditorPopup.items[0].focus())}closeFilterEditor(){var i;(i=this.filterEditorPopup)==null||i.setTimeout(this.filterEditorPopup.destroy),this.filterEditorPopup=null}getFilterType(i){var t,e,r,l;const o=i.field,s=this.client.store.modelClass.getFieldDefinition(o),n=(e=(t=i.filterType)!=null?t:Ge[i.type])!=null?e:Ge[s==null?void 0:s.type];return((l=(r=this.store)==null?void 0:r.modelRelations)==null?void 0:l.find(({foreignKey:d})=>d===o))?"relation":n==="auto"&&this.store&&!this.useLegacyModeForColumn(i)?Y.inferFieldType(this.store,o):n?Ge[n]:"auto"}populateCellMenuWithDateItems({column:i,record:t,items:e}){const r=i.field;if(this.getFilterType(i)==="date"){const o=this,s=t.getValue(r),n=a=>{o.applyFilter(i,{operator:a,value:s,displayValue:i.formatValue?i.formatValue(s):s,type:"date"})};e.filterDateEquals={text:"L{on}",localeClass:o,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:o.disabled,onItem:()=>n("=")},e.filterDateBefore={text:"L{before}",localeClass:o,icon:"b-fw-icon b-icon-filter-before",weight:310,disabled:o.disabled,onItem:()=>n("<")},e.filterDateAfter={text:"L{after}",localeClass:o,icon:"b-fw-icon b-icon-filter-after",weight:320,disabled:o.disabled,onItem:()=>n(">")}}}populateCellMenuWithNumberItems({column:i,record:t,items:e}){const r=i.field;if(this.getFilterType(i)==="number"){const o=this,s=t.getValue(r),n=a=>{o.applyFilter(i,{operator:a,value:s})};e.filterNumberEquals={text:"L{equals}",localeClass:o,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:o.disabled,onItem:()=>n("=")},e.filterNumberLess={text:"L{lessThan}",localeClass:o,icon:"b-fw-icon b-icon-filter-less",weight:310,disabled:o.disabled,onItem:()=>n("<")},e.filterNumberMore={text:"L{moreThan}",localeClass:o,icon:"b-fw-icon b-icon-filter-more",weight:320,disabled:o.disabled,onItem:()=>n(">")}}}addMenuItemsForDataType(i,t,e,r){const l=Y.defaultOperators[t].filter(({argCount:s,isArrayValued:n})=>!(s>1||n));let o=300;for(const{value:s,text:n,argCount:a}of l)i[`filter${T.capitalize(t)}${T.capitalize(s)}`]={text:T.capitalize(Y.L(n)),weight:o+=10,icon:r.includes(s)?"b-icon b-icon-check":null,disabled:this.disabled,onItem:()=>e(s,a)}}populateCellMenuWithDurationItems({column:i,record:t,items:e}){if(this.getFilterType(i)==="duration"){const l=this,o=i.getFilterableValue(t),s=n=>{l.applyFilter(i,{operator:n,value:o})};e.filterDurationEquals={text:"L{equals}",localeClass:l,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:l.disabled,onItem:()=>s("=")},e.filterDurationLess={text:"L{lessThan}",localeClass:l,icon:"b-fw-icon b-icon-filter-less",weight:310,disabled:l.disabled,onItem:()=>s("<")},e.filterDurationMore={text:"L{moreThan}",localeClass:l,icon:"b-fw-icon b-icon-filter-more",weight:320,disabled:l.disabled,onItem:()=>s(">")}}}populateCellMenuWithStringItems({column:i,record:t,items:e}){var r,l;const o=this.getFilterType(i);if(!/(date|number|duration)/.test(o)){const s=this,n=i.getFilterableValue(t),a=(l=(r=i.filterable.filterField)==null?void 0:r.operator)!=null?l:"*";e.filterStringEquals={text:"L{equals}",localeClass:s,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",weight:300,disabled:s.disabled,onItem:()=>s.applyFilter(i,{value:n,operator:a})}}}getMenuItems(i,t){const e=this,r={},l=e.getFilterType(i);if(i.filterable===!1)return{};if(jt[l]){const o=t?i.getFilterableValue(t):void 0,s=e.getCurrentMultiFilters(i).filter(c=>!c.disabled).map(({operator:c})=>c),n=t?1:void 0,a=Y.defaultOperators[l].filter(({argCount:c,isArrayValued:u})=>!(c>n||u));let d=300;for(const{value:c,text:u,argCount:h}of a){const g=`filter${T.capitalize(l)}${T.capitalize(c)}`;r[g]={text:T.capitalize(Y.L(u)),weight:d+=10,icon:s.includes(c)?"b-icon b-icon-check":null,disabled:e.disabled,cls:Kt[g]?"b-separator":null,onItem:()=>e.onOperatorMenuItem(i,o,c,h)}}}return i.meta.isFiltered&&Object.assign(r,e.getMenuItemsForFilteredColumn(i,t!==void 0)),{filterMenu:{text:"L{filter}",localeClass:e,menu:r,icon:"b-fw-icon b-icon-filter",weight:t?400:100}}}onOperatorMenuItem(i,t,e,r=1){const l=this,o=l.getFilterType(i);l.getCurrentMultiFilters(i).find(n=>!n.disabled&&n.operator===e)?l.removeFilter(i,e):r==0||t!==void 0?l.applyFilter(i,{property:i.field,operator:e,type:o,value:r===1?t:null,caseSensitive:!1,disabled:t==null&&r>0}):l.showFilterEditor(i,null,e,!0)}getMenuItemsForFilteredColumn(i,t){const e=this,r=!e.disabled&&(e.legacyMode||e.columnHasRemovableFilters(i));return{editFilter:e.legacyMode?void 0:{text:"L{editFilter}",localeClass:e,icon:"b-fw-icon b-icon-edit",cls:"b-separator",weight:500,disabled:!r,onItem:()=>e.showFilterEditor(i)},[t?"filterRemove":"removeFilter"]:{text:"L{removeFilter}",localeClass:e,icon:"b-fw-icon b-icon-remove",cls:"b-separator",weight:510,disabled:!r,onItem:()=>e.removeFilter(i)},disableFilter:{text:"L{disableFilter}",localeClass:e,icon:"b-fw-icon b-icon-filter-disable",weight:520,disabled:e.disabled||!e.columnHasEnabledFilters(i),onItem:()=>e.disableFilter(i)}}}populateCellMenu({column:i,record:t,items:e,...r}){const l=this;i.filterable!==!1&&!t.isSpecialRow&&(l.useLegacyModeForColumn(i)?(l.populateCellMenuWithDateItems({column:i,record:t,items:e,...r}),l.populateCellMenuWithNumberItems({column:i,record:t,items:e,...r}),l.populateCellMenuWithDurationItems({column:i,record:t,items:e,...r}),l.populateCellMenuWithStringItems({column:i,record:t,items:e,...r}),i.meta.isFiltered&&Object.assign(e,l.getMenuItemsForFilteredColumn(i,!0))):Object.assign(e,l.getMenuItems(i,t)))}columnHasRemovableFilters(i){const t=this;return!!t.getCurrentMultiFilters(i).find(e=>!t.canDeleteFilter||t.callback(t.canDeleteFilter,t,[e])!==!1)}columnHasEnabledFilters(i){return!!this.getCurrentMultiFilters(i).find(t=>!t.disabled)}populateHeaderMenu({column:i,items:t}){const e=this;e.useLegacyModeForColumn(i)?i.meta.isFiltered?(t.editFilter={text:"L{editFilter}",localeClass:e,weight:100,icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:e.disabled,onItem:()=>e.showFilterEditor(i)},t.removeFilter={text:"L{removeFilter}",localeClass:e,weight:110,icon:"b-fw-icon b-icon-remove",disabled:e.disabled||!e.legacyMode&&!e.columnHasRemovableFilters(i),onItem:()=>e.removeFilter(i)},t.disableFilter={text:"L{disableFilter}",localeClass:e,icon:"b-fw-icon b-icon-filter-disable",weight:115,disabled:e.disabled||!e.columnHasEnabledFilters(i),onItem:()=>e.disableFilter(i)}):i.filterable!==!1&&(t.filter={text:"L{filter}",localeClass:e,weight:100,icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:e.disabled,onItem:()=>e.showFilterEditor(i)}):Object.assign(t,e.getMenuItems(i))}useLegacyModeForColumn(i){var t,e,r;return this.legacyMode||((r=(t=i.filterable)==null?void 0:t.filterFn)!=null?r:(e=i.filterable)==null?void 0:e.filterField)!=null}onStoreBeforeFilter({filters:i}){var t;const{columns:e}=this.client;for(let r=0;r<i.count;r++){const l=i.getAt(r);if(!l.internal){const o=(l.columnOwned||this.prioritizeColumns)&&e.find(s=>s.filterable!==!1&&s.field===l.property);(t=o==null?void 0:o.filterable)!=null&&t.filterFn&&(o.$filter||(o.$filter=new Ue({columnOwned:!0,property:l.property,operator:l.operator,value:l.value,filterBy(s){return o.filterable.filterFn({value:this.value,record:s,operator:this.operator,property:this.property,column:o})}})),o.$filter.value=l.value,o.$filter.displayValue=l.displayValue,o.$filter.operator=l.operator,i.splice(r,1,o.$filter))}}}onStoreFilter(){this.refreshHeaders(!1)}renderHeader(){this.refreshHeaders(!1)}onElementClick({target:i}){if(this.filterEditorPopup&&this.closeFilterEditor(),i.classList.contains("b-filter-icon")){const t=i.closest(".b-grid-header");return this.showFilterEditor(t.dataset.columnId),!1}}showFilterEditorByKey({target:i}){const t=i.matches(".b-grid-header")&&i;return t&&this.showFilterEditor(t.dataset.columnId),!!t}isActionAvailable({event:i,actionName:t}){if(t==="showFilterEditorByKey"){const e=i.target.closest(".b-grid-header"),r=e&&this.client.columns.find(l=>l.id===e.dataset.columnId);return!!(r!=null&&r.filterable)}}};We._$name="Filter",L.registerFeature(We);var qt={"*":null,isIncludedIn:null,startsWith:null,endsWidth:null},Re=class extends P{static get $name(){return"FilterBar"}static get configurable(){return{prioritizeColumns:!1,keyStrokeFilterDelay:300,compactMode:!1,clearStoreFiltersOnHide:!0,hidden:!1,filter:null,keyMap:{ArrowUp:{handler:"disableGridNavigation",preventDefault:!1},ArrowRight:{handler:"disableGridNavigation",preventDefault:!1},ArrowDown:{handler:"disableGridNavigation",preventDefault:!1},ArrowLeft:{handler:"disableGridNavigation",preventDefault:!1},Enter:{handler:"disableGridNavigation",preventDefault:!1}}}}static get pluginConfig(){return{before:["renderContents"],chain:["afterColumnsChange","renderHeader","populateHeaderMenu","bindStore"]}}static get properties(){return{filterFieldCls:"b-filter-bar-field",filterFieldInputCls:"b-filter-bar-field-input",filterableColumnCls:"b-filter-bar-enabled",filterFieldInputSelector:".b-filter-bar-field-input",filterableColumnSelector:".b-filter-bar-enabled",filterParseRegExp:/^\s*([<>=*])?(.*)$/,storeTrackingSuspended:0}}construct(i,t){if(i.features.filter)throw new Error("Grid.feature.FilterBar feature may not be used together with Grid.feature.Filter, These features are mutually exclusive.");const e=this;e.grid=i,e.onColumnFilterFieldChange=e.onColumnFilterFieldChange.bind(e),super.construct(i,Array.isArray(t)?{filter:t}:t),e.bindStore(i.store),e.filter&&i.store.filter(e.filter),e.gridDetacher=i.ion({beforeElementClick:"onBeforeElementClick",thisObj:e})}bindStore(i){this.detachListeners("store"),i.ion({name:"store",beforeFilter:"onStoreBeforeFilter",filter:"onStoreFilter",thisObj:this})}doDestroy(){var i;this.destroyFilterBar(),(i=this.gridDetacher)==null||i.call(this),super.doDestroy()}doDisable(i){const{columns:t}=this.grid;t==null||t.forEach(e=>{const r=this.getColumnFilterField(e);r&&(r.disabled=i)}),super.doDisable(i)}updateHidden(i){this.isConfiguring||(i?this.hideFilterBar():this.showFilterBar())}updateCompactMode(i){this.client.headerContainer.classList[i?"add":"remove"]("b-filter-bar-compact");for(const t in this._columnFilters){const e=this._columnFilters[t];e.placeholder=i?e.column.headerText:null}}destroyFilterBar(){var i;(i=this.grid.columns)==null||i.forEach(this.destroyColumnFilterField,this)}hideFilterBar(){var i;const t=this;t.clearStoreFiltersOnHide&&t.suspendStoreTracking(),(i=t.grid.columns)==null||i.forEach(e=>t.hideColumnFilterField(e,!0)),t.grid.store.filter(),t.clearStoreFiltersOnHide&&t.resumeStoreTracking(),t._hidden=!0}showFilterBar(){this.suspendStoreTracking(),this.renderFilterBar(this.clearStoreFiltersOnHide),this.resumeStoreTracking(),this._hidden=!1}toggleFilterBar(){this.hidden?this.showFilterBar():this.hideFilterBar()}renderFilterBar(i){this.grid.hideHeaders||(this.grid.columns.visibleColumns.forEach(t=>this.renderColumnFilterField(t,i)),this.rendered=!0)}renderColumnFilterField(i,t){const e=this,{grid:r}=e,l=e.getColumnFilterable(i);if(l&&i.isVisible){const o=i.element,s=r.store.filters.get(i.id)||r.store.filters.getBy("property",i.field);let n=e.getColumnFilterField(i);if(n)t&&e.onColumnFilterFieldChange({source:n,value:n.value}),n.render(o),n.show();else{const a=`${i.filterType||"text"}field`,{filterField:d}=l,c=d==null?void 0:d.cls;c&&delete l.filterField.cls,n=be.append(x.assign({type:a,cls:{[e.filterFieldCls]:1,[c]:c},dataset:{column:i.field},column:i,owner:r,clearable:!0,name:i.field,value:s&&!s._filterBy&&!s.internal?e.buildFilterValue(s):"",inputCls:e.filterFieldInputCls,keyStrokeChangeDelay:e.keyStrokeFilterDelay,onChange:e.onColumnFilterFieldChange,onClear:e.onColumnFilterFieldChange,disabled:e.disabled,placeholder:e.compactMode?i.headerText:null,format:i.format},d),o)[0],d!=null&&d.hasOwnProperty("min")||Object.defineProperty(n,"min",{get:()=>{var h;return(h=i.editor)==null?void 0:h.min},set:()=>null}),d!=null&&d.hasOwnProperty("max")||Object.defineProperty(n,"max",{get:()=>{var h;return(h=i.editor)==null?void 0:h.max},set:()=>null}),d!=null&&d.hasOwnProperty("strictParsing")||Object.defineProperty(n,"strictParsing",{get:()=>{var h;return(h=i.editor)==null?void 0:h.strictParsing},set:()=>null}),n.element.retainElement=!0,e.setColumnFilterField(i,n);const u=(d==null?void 0:d.store)&&(d.store.readUrl||d.store.data||d.store.isChained);if(n.isCombo&&!u&&n.store.count===0){const h=n.value,g=()=>{n.store.readUrl||n.store.isChained||(n.store.data=r.store.getDistinctValues(i.field,!0).map(f=>r.store.modelClass.new({id:f,[i.field]:f})))};n.value=null,n.store.isSorted||n.store.sort({field:i.field,ascending:!0}),n.picker.ion({beforeShow:g}),g(),n.value=h}!e.filter&&n.value&&r.store.autoLoad!==!1&&e.onColumnFilterFieldChange({source:n,value:n.value})}o.classList.add(e.filterableColumnCls)}}updateColumnFilterFields(){const i=this,{columns:t,store:e}=i.grid;let r,l;i._updatingFields=!0;for(const o of t.visibleColumns)r=i.getColumnFilterField(o),r&&!o.$isApplyingFilter&&(l=e.filters.get(o.id)||e.filters.getBy("property",o.field),l&&!l.internal?l._filterBy?r.value=l.value:r.value=i.buildFilterValue(l):r.value="");i._updatingFields=!1}getColumnFilterable(i){if(!i.isRoot&&i.filterable!==!1&&i.field&&i.isLeaf)return typeof i.filterable=="function"&&(i.filterable={filterFn:i.filterable}),i.filterable}destroyColumnFilterField(i){const t=this.getColumnFilterField(i);t&&(this.hideColumnFilterField(i,!0),t.destroy(),this.setColumnFilterField(i,void 0))}hideColumnFilterField(i,t){const e=this,{store:r}=e.grid,l=i.element,o=e.getColumnFilterField(i);if(o){e.isDestroying||o.hide();const{$filter:s}=i;!r.isDestroyed&&e.clearStoreFiltersOnHide&&s&&r.removeFilter(s,t),l==null||l.classList.remove(e.filterableColumnCls)}}getColumnFilterField(i){var t;return(t=this._columnFilters)==null?void 0:t[i.id]}setColumnFilterField(i,t){this._columnFilters=this._columnFilters||{},this._columnFilters[i.data.id]=t}parseFilterValue(i,t,e){var r;if(Array.isArray(t)||t instanceof Ye)return{value:t};if(x.isDate(t))return{operator:e.isDateField?"sameDay":e.isTimeField?"sameTime":"=",value:t};const l=String(t).match(this.filterParseRegExp);return{operator:l[1]||((r=i.filterable)==null?void 0:r.operator)||"*",value:l[2]}}buildFilterValue({operator:i,value:t}){return t instanceof Date||Array.isArray(t)||t instanceof Ye?t:(i in qt?"":i)+t}onStoreBeforeFilter({filters:i}){var t;const{columns:e}=this.client;for(let r=0;r<i.count;r++){const l=i.getAt(r),o=(l.columnOwned||this.prioritizeColumns)&&e.find(s=>s.filterable!==!1&&s.field===l.property);(t=o==null?void 0:o.filterable)!=null&&t.filterFn&&(o.$filter||(o.$filter=new Ue({columnOwned:!0,property:l.property,id:o.id,filterBy(s){return o.filterable.filterFn({value:this.value,record:s,property:this.property,column:o})}})),o.$filter.value=l.value,i.splice(r,1,o.$filter))}}onStoreFilter(){!this.storeTrackingSuspended&&this.rendered&&this.updateColumnFilterFields()}afterColumnsChange({action:i,changes:t,column:e,columns:r}){!this.hidden&&(t!=null&&t.hidden)&&(t.hidden.value?this.destroyColumnFilterField(e):this.renderColumnFilterField(e)),i==="remove"&&r.forEach(l=>this.destroyColumnFilterField(l))}suspendStoreTracking(){this.storeTrackingSuspended++}resumeStoreTracking(){this.storeTrackingSuspended--}renderHeader(){this.hidden||this.renderFilterBar()}renderContents(){if(this._columnFilters)for(const i of Object.values(this._columnFilters))i==null||i.element.remove()}disableGridNavigation(i){return i.target.matches(this.filterFieldInputSelector)}onBeforeElementClick({event:i}){if(i.target.closest(`.${this.filterFieldCls}`))return!1}onColumnFilterFieldChange({source:i,value:t}){var e,r;const l=this,{column:o}=i,{filterFn:s}=o.filterable,{store:n}=l.grid,a=o.$filter||n.filters.find(c=>(c.id===o.id||c.property===o.field)&&!c.internal);if(l._updatingFields)return;const d=t==null||t===""||Array.isArray(t)&&t.length===0;if(n.removeFilter(a,!0),o.$filter=null,o.$isApplyingFilter=!0,d){if(!a){o.$isApplyingFilter=!1;return}}else o.$filter=n.addFilter({property:i.name,...l.parseFilterValue(o,t,i),[typeof((e=o.filterable)==null?void 0:e.caseSensitive)=="boolean"?"caseSensitive":void 0]:(r=o.filterable)==null?void 0:r.caseSensitive,[s?"filterBy":"_"]:function(c){return s({value:this.value,record:c,operator:this.operator,property:this.property,column:o})}},!0);n.filter(),o.$isApplyingFilter=!1}populateHeaderMenu({items:i}){i.toggleFilterBar={text:this.hidden?"L{enableFilterBar}":"L{disableFilterBar}",localeClass:this,weight:120,icon:"b-fw-icon b-icon-filter",cls:"b-separator",onItem:()=>this.toggleFilterBar()}}};Re.featureClass="b-filter-bar",Re._$name="FilterBar",L.registerFeature(Re);var Ee=class extends P{static get $name(){return"Group"}static get configurable(){return{field:null,groupSortFn:null,renderer:null,keyMap:{" ":"toggleGroup"},toggleOnRowClick:!0}}construct(i,t){const e=this;i.features.tree||(e._thisIsAUsedExpression(i.features.groupSummary),t=e.processConfig(t),e.grid=i,super.construct(i,t),e.bindStore(i.store),i.rowManager.ion({beforeRenderRow:"onBeforeRenderRow",renderCell:"renderCell",prio:1100,thisObj:e}))}processConfig(i){return typeof i=="string"?{field:i,ascending:null}:i}setConfig(i){i===null?this.store.clearGroupers():super.setConfig(this.processConfig(i))}bindStore(i){this.detachListeners("store"),i.ion({name:"store",group:"onStoreGroup",change:"onStoreChange",toggleGroup:"onStoreToggleGroup",thisObj:this}),this.onStoreGroup({groupers:i.groupers})}updateRenderer(i){this.groupRenderer=i}updateField(i){var t;(!this.isConfiguring||!((t=this.store.groupers)!=null&&t.some(e=>e.field===i)))&&this.store.group({field:i,ascending:this.ascending,fn:this.groupSortFn})}updateGroupSortFn(i){this.isConfiguring||this.store.group({field:this.field,ascending:this.ascending,fn:i})}doDestroy(){super.doDestroy()}doDisable(i){const{store:t}=this;if(i&&t.isGrouped){const{sorters:e}=t;e.unshift(...t.groupers),this.currentGroupers=t.groupers,t.clearGroupers(),t.sort(e)}else!i&&this.currentGroupers&&(t.group(this.currentGroupers[0]),this.currentGroupers=null);super.doDisable(i)}get store(){return this.grid.store}static get pluginConfig(){return{assign:["collapseAll","expandAll"],chain:["renderHeader","populateHeaderMenu","getColumnDragToolbarItems","onElementTouchStart","onElementClick","bindStore"]}}refreshGrid(i){const{store:t,rowManager:e}=this.grid;e.rowCount>t.count||!e.getRowFor(i)?e.renderFromRow():e.renderFromRecord(i)}toggleCollapse(i,t){this.internalToggleCollapse(i,t)}internalToggleCollapse(i,t,e=!1,r){const l=this,{store:o,grid:s}=l,n=o.getById(i);n.isGroupHeader&&(t=t===void 0?!n.meta.collapsed:t,s.trigger("beforeToggleGroup",{groupRecord:n,collapse:t,domEvent:r})!==!1&&(l.isToggling=!0,t?o.collapse(n):o.expand(n),l.isToggling=!1,e||l.refreshGrid(n),s.trigger("toggleGroup",{groupRecord:n,collapse:t}),s.afterToggleGroup()))}collapseAll(){const i=this;i.store.isGrouped&&!i.disabled&&(i.store.groupRecords.forEach(t=>i.internalToggleCollapse(t,!0,!0)),i.grid.refreshRows(!0))}expandAll(){const i=this;i.store.isGrouped&&!i.disabled&&(i.store.groupRecords.forEach(t=>i.internalToggleCollapse(t,!1,!0)),i.grid.refreshRows())}onBeforeRenderRow({row:i}){const t=i.grid.store.getById(i.id);i.forceInnerHTML=i.forceInnerHTML||(t==null?void 0:t.isGroupHeader)}renderCell(i){var t;const e=this,{cellElement:r,row:l,column:o,grid:s}=i,{meta:n}=i.record,a={"b-group-row":0,"b-grid-group-collapsed":0};if(!e.disabled&&e.store.isGrouped&&"groupRowFor"in n){if(o.type==="action")return;o.clearCell(r),a["b-grid-group-collapsed"]=n.collapsed,a["b-group-row"]=1,s.buildGroupHeader?s.buildGroupHeader(i):e.buildGroupHeader(i),o===e.groupHeaderColumn&&(m.createElement({parent:r,tag:"i",className:"b-group-state-icon",nextSibling:r.firstChild}),r.classList.add("b-group-title"),r.$groupHeader=r._hasHtml=!0)}else r.$groupHeader&&((t=r.querySelector(".b-group-state-icon"))==null||t.remove(),r.classList.remove("b-group-title"),r.$groupHeader=!1);l.assignCls(a)}buildGroupHeader(i){const t=this,{record:e,cellElement:r,column:l,persist:o}=i,{grid:s}=t,n=e.meta,a=n.emptyArray?s.L("L{Object.None}"):n.groupRowFor,{groupSummary:d}=s.features,c=n.childCount-(d&&d.target!=="header"?1:0);let u=null,h=!0;if(o||l){const g=s.columns.get(n.groupField),f=i.isFirstColumn=l===t.groupHeaderColumn;g!=null&&g.groupRenderer?f&&(u=g.groupRenderer({...i,groupRowFor:a,groupRecords:e.groupChildren,groupColumn:g,count:c}),h=!1):t.groupRenderer&&(u=t.groupRenderer({...i,groupRowFor:a,groupRecords:e.groupChildren,groupColumn:g,count:c,isFirstColumn:f})),f&&u==null&&h&&m.getChildElementCount(r)===0&&(u=T.encodeHtml(`${a==="__novalue__"?"":a} (${c})`))}else t.groupRenderer&&(u=t.groupRenderer(i));return typeof u=="string"?r.innerHTML=u:typeof u=="object"&&we.sync({targetElement:r,domConfig:{onlyChildren:!0,children:H.asArray(u)}}),m.getChildElementCount(r)>0&&(r._hasHtml=!0),r.innerHTML}get groupHeaderColumn(){return this.grid.columns.visibleColumns.find(i=>!i.groupHeaderReserved)}renderHeader(i=this.grid.headerContainer){var t;const{store:e,grid:r}=this;if(i&&e.isGrouped)for(const l of e.groupers){const o=r.columns.get(l.field),s=o&&r.getHeaderElement(o.id);if(s==null||s.classList.add("b-group",l.ascending?"b-asc":"b-desc"),s&&(!((t=r.features.sort)!=null&&t.enabled)||o.sortable===!1)){const n=o.textWrapper;n!=null&&n.querySelector(".b-sort-icon")||m.createElement({parent:n,className:"b-sort-icon"})}}}populateHeaderMenu({column:i,items:t}){const e=this;i.groupable!==!1&&(t.groupAsc={text:"L{groupAscending}",localeClass:e,icon:"b-fw-icon b-icon-group-asc",cls:"b-separator",weight:400,disabled:e.disabled,onItem:()=>e.store.group(i.field,!0)},t.groupDesc={text:"L{groupDescending}",localeClass:e,icon:"b-fw-icon b-icon-group-desc",weight:410,disabled:e.disabled,onItem:()=>e.store.group(i.field,!1)}),e.store.isGrouped&&(t.groupRemove={text:"L{stopGrouping}",localeClass:e,icon:"b-fw-icon b-icon-clear",cls:i.groupable?"":"b-separator",weight:420,disabled:e.disabled,onItem:()=>e.store.clearGroupers()})}getColumnDragToolbarItems(i,t){var e;const r=this,{store:l,disabled:o}=r;t.push({text:"L{groupAscendingShort}",group:"L{group}",localeClass:r,icon:"b-icon b-icon-group-asc",ref:"groupAsc",cls:"b-separator",weight:110,disabled:o,onDrop:({column:n})=>l.group(n.field,!0)}),t.push({text:"L{groupDescendingShort}",group:"L{group}",localeClass:r,icon:"b-icon b-icon-group-desc",ref:"groupDesc",weight:110,disabled:o,onDrop:({column:n})=>l.group(n.field,!1)});const s=((e=l.groupers)==null?void 0:e.some(n=>n.field===i.field))&&!o;return t.push({text:"L{stopGroupingShort}",group:"L{group}",localeClass:r,icon:"b-icon b-icon-clear",ref:"groupRemove",disabled:!s,weight:110,onDrop:({column:n})=>l.removeGrouper(n.field)}),t}onStoreGroup({groupers:i}){const{grid:t}=this,{element:e}=t,r=e&&m.children(e,".b-grid-header.b-group");if(e){for(const l of r)l.classList.remove("b-group","b-asc","b-desc");i&&this.renderHeader()}}onStoreChange({action:i,records:t}){const{client:e}=this,{rowManager:r,store:l}=e;if(l.isGrouped&&i==="move"){const{field:o}=l.groupers[0],s=Math.min(...t.reduce((n,a)=>{if(n.push(l.indexOf(a.groupParent.get(l.id))),o in a.meta.modified){const d=l.groupRecords.find(c=>c.meta.groupRowFor===a.meta.modified[o]);d&&n.push(l.indexOf(d))}return n},[]));r.renderFromRow(r.getRow(s))}}onStoreToggleGroup({groupRecord:i}){this.isToggling||this.refreshGrid(i)}onElementTouchStart(i){const t=this,{target:e}=i,r=e.closest(".b-grid-header"),l=r&&t.grid.getColumnFromElement(r);i.touches.length>1&&l&&l.groupable!==!1&&!t.disabled&&t.store.group(l.field)}onElementClick(i){var t;const e=this,{store:r}=e,{target:l}=i,o=l.closest(".b-group-row"),s=l.closest(".b-grid-header"),n=s==null?void 0:s.dataset.column;if(!(l.classList.contains("b-resizer")||e.disabled||l.classList.contains("b-action-item")||i.handled)){if(s&&n){const a=(t=r.groupers)==null?void 0:t.find(d=>d.field===n);if(a&&!i.shiftKey)return a.ascending=!a.ascending,r.group(),!1;i.shiftKey&&e.grid.columns.get(n).groupable!==!1&&(i.altKey?r.removeGrouper(n):r.group(n))}if(o&&(e.toggleOnRowClick||i.target.classList.contains("b-group-state-icon")))return e.internalToggleCollapse(B.get(o).id,void 0,void 0,i),!1}}toggleGroup(i){var t;const{grid:e}=this,{focusedCell:r}=e;return!this.disabled&&!r.isActionable&&((t=r.record)!=null&&t.isGroupHeader)?(this.internalToggleCollapse(r.id),!0):!1}};Ee._$name="Group",L.registerFeature(Ee,!0,["Grid","Scheduler"]),L.registerFeature(Ee,!1,["TreeGrid"]);var Fe=class extends Xe{static get $name(){return"HeaderMenu"}static get configurable(){return{type:"header",items:null,moveColumns:null}}static get defaultConfig(){return{processItems:null}}static get pluginConfig(){const i=super.pluginConfig;return i.chain.push("populateHeaderMenu"),i}shouldShowMenu(i){const{column:t}=i;return t&&t.enableHeaderContextMenu!==!1&&t!==this.client.timeAxisColumn}getDataFromEvent(i){return x.assign(super.getDataFromEvent(i),this.client.getHeaderDataFromEvent(i))}populateHeaderMenu({items:i,column:t}){const e=this;if(t){if(t.headerMenuItems&&x.merge(i,t.headerMenuItems),t.isCollapsible){const{collapsed:r}=t,l=r?e.client.rtl?"left":"right":e.client.rtl?"right":"left";i.toggleCollapse={weight:215,icon:`b-fw-icon b-icon-collapse-${l}`,text:e.L(r?"L{expandColumn}":"L{collapseColumn}"),onItem:()=>t.collapsed=!r}}if(e.moveColumns){const r=e.getColumnToMoveBefore(t),l=e.getColumnToMoveAfter(t);r&&(i.movePrev={weight:220,icon:"b-fw-icon b-icon-column-move-left",text:e.L("L{moveBefore}",T.encodeHtml(r.text)),onItem:()=>{var o;const{parent:s}=t;r.parent.insertChild(t,r)&&(t.region=r.region,(o=s.children)!=null&&o.length||s.remove())}}),l&&(i.moveNext={weight:230,icon:"b-fw-icon b-icon-column-move-right",text:e.L("L{moveAfter}",T.encodeHtml(l.text)),onItem:()=>{var o;const{parent:s}=t;l.parent.insertChild(t,l.nextSibling)&&(t.region=l.region,(o=s.children)!=null&&o.length||s.remove())}})}}return i}getColumnToMoveBefore(i){const{previousSibling:t,parent:e}=i;if(t)return t.children&&!i.children?t.children[t.children.length-1]:t;if(!e.isRoot)return e}getColumnToMoveAfter(i){const{nextSibling:t,parent:e}=i;if(t)return t;if(!e.isRoot)return e}};Fe.featureClass="",Fe._$name="HeaderMenu",L.registerFeature(Fe,!0);var ee=class extends P{static get pluginConfig(){return{chain:["onElementPointerDown","onElementDblClick","onElementTouchMove","onSubGridCollapse","onSubGridExpand","render"]}}updateShowSplitterButtons(i){this.client.element.classList.toggle("b-hide-splitter-buttons",!i)}onElementDblClick(i){const t=this,{client:e}=t,r=i.target.closest(".b-grid-splitter-collapsed");if(r&&!t.expanding){t.expanding=!0;let l=r.dataset.region,o=e.getSubGrid(l);o.collapsed||(l=e.getLastRegions()[1],o=e.getSubGrid(l)),o.expand().then(()=>t.expanding=!1)}}startMove(i,t){const e=this,{clientX:r}=t,{client:l}=e,o=i.dataset.region,s=l.element,n=l.regions[l.regions.indexOf(o)+1],a=l.getSubGrid(n),d=l.getSubGrid(o);let c=d,u=1;if(c.flex!=null&&a.flex==null&&(c=a,u=-1),l.rtl&&(u*=-1),i.classList.contains("b-grid-splitter-collapsed"))return;const h=Object.values(l.subGrids).reduce((g,f)=>f.width+g,0);l.trigger("splitterDragStart",{subGrid:c,domEvent:t}),e.dragContext={element:i,headerEl:c.header.element,subGridEl:c.element,subGrid:c,splitterSubGrid:d,originalWidth:c.element.offsetWidth,originalX:r,minWidth:c.minWidth||0,maxWidth:Math.min(h,c.maxWidth||h),flip:u},s.classList.add("b-moving-splitter"),d.toggleSplitterCls("b-moving"),e.pointerDetacher=j.on({element:document,pointermove:"onPointerMove",pointerup:"onPointerUp",thisObj:e})}endMove(i){const t=this,{dragContext:e,client:r}=t;if(e){const{subGrid:l}=e;i.preventDefault(),t.pointerDetacher(),r.element.classList.remove("b-moving-splitter"),e.splitterSubGrid.toggleSplitterCls("b-moving",!1),t.dragContext=null,r.trigger("splitterDragEnd",{subGrid:l,domEvent:i})}}onCollapseClick(i,t,e){const r=this,{client:l}=r,o=t.dataset.region,s=l.getLastRegions();if(l.trigger("splitterCollapseClick",{subGrid:i,domEvent:e})!==!1){if(s[0]===o){const n=l.getSubGrid(s[1]);if(n.collapsed){n.expand();return}}i.collapse()}}onExpandClick(i,t,e){const r=this,{client:l}=r,o=t.dataset.region,s=l.getLastRegions();if(l.trigger("splitterExpandClick",{subGrid:i,domEvent:e})!==!1){if(s[0]===o&&!i.collapsed){l.getSubGrid(s[1]).collapse();return}i.expand()}}updateMove(i){const{dragContext:t}=this;if(t){const e=i-t.originalX,r=Math.max(Math.min(t.maxWidth,t.originalWidth+e*t.flip),0);t.subGrid.width=Math.max(r,t.minWidth)}}onElementPointerDown(i){const t=this,{target:e}=i,r=i.button===0&&e.closest(":not(.b-row-reordering):not(.b-dragging-event):not(.b-dragging-task):not(.b-dragging-header):not(.b-dragselecting) .b-grid-splitter"),l=r&&t.client.getSubGrid(r.dataset.region);let o;r&&(e.closest(".b-grid-splitter-button-collapse")?t.onCollapseClick(l,r,i):e.closest(".b-grid-splitter-button-expand")?t.onExpandClick(l,r,i):t.enableDragging&&(t.startMove(r,i),o=r)),i.pointerType==="touch"&&t.toggleTouchSplitter(o)}onPointerMove(i){this.dragContext&&(this.updateMove(i.clientX),i.preventDefault())}onElementTouchMove(i){this.dragContext&&i.preventDefault()}onPointerUp(i){this.enableDragging&&this.endMove(i)}onSubGridCollapse({subGrid:i}){const t=this.client.resolveSplitter(i);this.client.getLastRegions()[1]===i.region&&t.classList.add("b-grid-splitter-allow-collapse")}onSubGridExpand({subGrid:i}){this.client.resolveSplitter(i).classList.remove("b-grid-splitter-allow-collapse")}toggleTouchSplitter(i){const t=this,{touchedSplitter:e}=t;i&&e&&i.dataset.region!==e.dataset.region&&t.toggleTouchSplitter();const r=t.client.getSubGrid(i?i.dataset.region:e==null?void 0:e.dataset.region);r&&(r.toggleSplitterCls("b-touching",!!i),i?r.startSplitterButtonSyncing():r.stopSplitterButtonSyncing()),t.touchedSplitter=i}render(){const{regions:i,subGrids:t}=this.client;i.length>2&&(t[i[0]].splitterElement.classList.add("b-left-only"),t[i[1]].splitterElement.classList.add("b-right-only"))}updateEnableDragging(i){this.client.element.classList.toggle("b-grid-splitter-no-drag",!i)}};F(ee,"$name","RegionResize"),F(ee,"configurable",{showSplitterButtons:!0,enableDragging:!0}),ee.featureClass="b-split",ee._$name="RegionResize",L.registerFeature(ee);var Ut=Object.freeze([]),te=class extends P{static get properties(){return{ignoreRe:new RegExp(["b-grid-header-resize-handle","b-filter-icon"].join("|")),sortableCls:"b-sortable",sortedCls:"b-sort",sortedAscCls:"b-asc",sortedDescCls:"b-desc"}}construct(i,t){t=this.processConfig(t),this.grid=i,this.bindStore(this.store),super.construct(i,t)}processConfig(i){return typeof i=="string"||Array.isArray(i)?{field:i,ascending:null}:i}setConfig(i){super.setConfig(this.processConfig(i))}bindStore(i){var t;this.detachListeners("store"),i.ion({name:"store",beforeSort:"onStoreBeforeSort",sort:"syncHeaderSortState",thisObj:this}),(t=this.client)!=null&&t.isPainted&&this.syncHeaderSortState()}set field(i){var t;const e=this.grid.columns.get(i);e&&typeof e.sortable=="object"&&(e.sortable.field=e.sortable.property||i,i=e.sortable),(t=this.store.sorters)!=null&&t.some(r=>r.field===i)||this.store.sort(i,this.ascending)}get store(){return this.grid[this.grid.sortFeatureStore]}static get pluginConfig(){return{chain:["onElementClick","populateHeaderMenu","getColumnDragToolbarItems","renderHeader","onInternalPaint","bindStore"]}}syncHeaderSortState(){var i;const t=this,{grid:e}=t;if(!e.hideHeaders&&e.isPainted){const r=t.store.sorters.concat(t.store.groupers||Ut),l=r.length,o=new Ce;let s;for(const n of e.columns.visibleColumns){if(!n.sortable)continue;const a=n.element,d=n.textWrapper,c=d==null?void 0:d.dataset;let u="none";c!=null&&c.sortIndex&&delete c.sortIndex,o.value=a.classList,n.sortable===!1?(o.remove(t.sortableCls),(i=d==null?void 0:d.querySelector(".b-sort-icon"))==null||i.remove()):(d!=null&&d.querySelector(".b-sort-icon")||m.createElement({parent:d,className:"b-sort-icon"}),o.add(t.sortableCls),s=r.find(h=>h.field===n.field||h.sortFn&&h.sortFn===n.sortable.sortFn),s?(l>1&&c&&(c.sortIndex=r.indexOf(s)+1),o.add(t.sortedCls),s.ascending?(o.add(t.sortedAscCls),o.remove(t.sortedDescCls),u="ascending"):(o.add(t.sortedDescCls),o.remove(t.sortedAscCls),u="descending")):(o.remove(t.sortedCls),o["b-group"]||(o.remove(t.sortedAscCls),o.remove(t.sortedDescCls)))),m.syncClassList(a,o),m.setAttributes(a,{"aria-sort":u})}}}populateHeaderMenu({column:i,items:t}){const e=this,{store:r}=e,l={...i.sortable,field:i.field,columnOwned:!0};if(i.sortable!==!1&&(t.sortAsc={text:"L{sortAscending}",localeClass:e,icon:"b-fw-icon b-icon-sort-asc",cls:"b-separator",weight:300,disabled:e.disabled,onItem:()=>r.sort(l,!0)},t.sortDesc={text:"L{sortDescending}",localeClass:e,icon:"b-fw-icon b-icon-sort-desc",weight:310,disabled:e.disabled,onItem:()=>r.sort(l,!1)},e.multiSort&&e.grid.columns.records.some(o=>o.sortable))){const o=r.sorters.find(s=>s.field===i.field||i.sortable.sortFn&&i.sortable.sortFn===s.sortFn);t.multiSort={text:"L{multiSort}",localeClass:e,icon:"b-fw-icon b-icon-sort",weight:320,disabled:e.disabled,menu:{addSortAsc:{text:o?"L{toggleSortAscending}":"L{addSortAscending}",localeClass:e,icon:"b-fw-icon b-icon-sort-asc",disabled:o&&(o==null?void 0:o.ascending),weight:330,onItem:()=>r.addSorter(l,!0)},addSortDesc:{text:o?"L{toggleSortDescending}":"L{addSortDescending}",localeClass:e,icon:"b-fw-icon b-icon-sort-desc",disabled:o&&!o.ascending,weight:340,onItem:()=>r.addSorter(l,!1)},removeSorter:{text:"L{removeSorter}",localeClass:e,icon:"b-fw-icon b-icon-remove",weight:350,disabled:!o,onItem:()=>{r.removeSorter(l.field)}}}}}}getColumnDragToolbarItems(i,t){const e=this,{store:r,disabled:l}=e;if(i.sortable!==!1){const o=r.sorters.find(s=>s.field===i.field);t.push({text:"L{sortAscendingShort}",group:"L{sort}",localeClass:e,icon:"b-icon b-icon-sort-asc",ref:"sortAsc",cls:"b-separator",weight:105,disabled:l,onDrop:({column:s})=>r.sort(s.field,!0)},{text:"L{sortDescendingShort}",group:"L{sort}",localeClass:e,icon:"b-icon b-icon-sort-desc",ref:"sortDesc",weight:105,disabled:l,onDrop:({column:s})=>r.sort(s.field,!1)},{text:"L{addSortAscendingShort}",group:"L{multiSort}",localeClass:e,icon:"b-icon b-icon-sort-asc",ref:"multisortAddAsc",disabled:l||o&&o.ascending,weight:105,onDrop:({column:s})=>r.addSorter(s.field,!0)},{text:"L{addSortDescendingShort}",group:"L{multiSort}",localeClass:e,icon:"b-icon b-icon-sort-desc",ref:"multisortAddDesc",disabled:l||o&&!o.ascending,weight:105,onDrop:({column:s})=>r.addSorter(s.field,!1)},{text:"L{removeSorterShort}",group:"L{multiSort}",localeClass:e,icon:"b-icon b-icon-remove",ref:"multisortRemove",weight:105,disabled:l||!o,onDrop:({column:s})=>r.removeSorter(s.field)})}return t}onStoreBeforeSort({sorters:i}){var t;const{columns:e}=this.client;for(let r=0;r<i.length;r++){const l=i[r],o=(l.columnOwned||this.prioritizeColumns)&&e.get(l.field);(t=o==null?void 0:o.sortable)!=null&&t.sortFn&&(i[r]={...l,...o.sortable,columnOwned:!0})}}onElementClick(i){const t=this,{store:e}=t,{target:r}=i,l=r.closest(".b-grid-header.b-sortable"),o=l==null?void 0:l.dataset.column;if(!(t.ignoreRe.test(r.className)||t.disabled||i.handled)&&l&&o&&(t.toggleOnHeaderClick||r.closest(".b-sort-icon"))){const s=t.grid.columns.getById(l.dataset.columnId);if(e.isGrouped&&e.groupers.find(a=>a.field===o)&&!i.shiftKey)return;if(s.sortable&&!i.shiftKey)if(i.ctrlKey&&i.altKey)e.removeSorter(s.field);else{const a={columnOwned:!0,field:s.field};typeof s.sortable=="object"&&x.assign(a,s.sortable),e.sort(a,null,i.ctrlKey&&t.multiSort)}}}renderHeader(){this.syncHeaderSortState()}onInternalPaint(){this.syncHeaderSortState()}};F(te,"$name","Sort"),F(te,"configurable",{multiSort:!0,prioritizeColumns:!1,toggleOnHeaderClick:!0}),te.featureClass="b-sort",te._$name="Sort",L.registerFeature(te,!0);var Ne=class extends P{static get $name(){return"Stripe"}construct(i,t){super.construct(i,t),i.ion({renderrow:"onRenderRow",thisObj:this})}doDisable(i){this.isConfiguring||this.client.refreshRows(),super.doDisable(i)}onRenderRow({row:i}){const{disabled:t}=this,e=i.dataIndex%2===0;i.assignCls({"b-even":!t&&e,"b-odd":!t&&!e})}};Ne._$name="Stripe",L.registerFeature(Ne);var $e=document.createRange(),he=class extends z{static get configurable(){return{cls:{$config:{equal:(i,t)=>(i==null?void 0:i.isDomClassList)&&(t==null?void 0:t.isDomClassList)&&i.isEqual(t)}}}}construct(i){Object.assign(this,{_elements:{},_elementsArray:[],_cells:{},_allCells:[],_regions:[],lastHeight:0,lastTop:-1,_dataIndex:0,_top:0,_height:0,_id:null,forceInnerHTML:!1,isGroupFooter:!1,cellContext:new R({grid:i.grid,id:null,columnIndex:0})}),super.construct(i),this.grid.positionMode==="position"&&(this.translateElements=this.positionElements)}doDestroy(){const i=this;i.rowManager.isDestroying||(i.removeElements(),i.rowManager.idMap[i.id]===i&&delete i.rowManager.idMap[i.id]),super.doDestroy()}get index(){return this._index}set index(i){this._index=i}get dataIndex(){return this._dataIndex}set dataIndex(i){this._dataIndex!==i&&(this._dataIndex=i,this.eachElement(t=>{t.dataset.index=i,t.ariaRowIndex=this.grid.hideHeaders?i+1:i+2}))}get id(){return this._id}set id(i){const t=this,e={id:i},r=t.rowManager.idMap;(t._id!==i||r[i]!==t)&&(r[t._id]===t&&delete r[t._id],r[i]=t,t._id=i,t.eachElement(l=>{B.assign(l,e),l.dataset.id=i}),t.eachCell(l=>B.assign(l,e)))}addElement(i,t){const e=this;let r=t.firstElementChild;for(e._elements[i]=t,e._elementsArray.push(t),e._regions.push(i),B.assign(t,{index:e.index}),e._cells[i]=[];r;)e._cells[i].push(r),e._allCells.push(r),B.set(r,{column:r.dataset.column,columnId:r.dataset.columnId,rowElement:r.parentNode,row:e}),r=r.nextElementSibling;t.dataset.index=e.index,t.ariaRowIndex=e.grid.hideHeaders?e.index+1:e.index+2,e.top!==null&&e.translateElements(!0)}getElement(i){return this._elements[i]}getRectangle(i){return M.from(this.getElement(i))}eachElement(i){this._elementsArray.forEach(i)}eachCell(i){this._allCells.forEach(i)}get elements(){return this._elements}get element(){const i=Object.keys(this._elements)[0];return this._elements[i]}get cells(){return this._allCells}getCells(i){return this._cells[i]}getCell(i,t=!1){return this._allCells.find(e=>{const r=B.get(e);return r.columnId==i||!t&&r.column==i})}removeElements(i=!1){const t=this;t.rowManager.trigger("removeRow",{row:t}),i||t.eachElement(e=>e.remove()),t._elements={},t._cells={},t._elementsArray.length=t._regions.length=t._allCells.length=t.lastHeight=t.height=0,t.lastTop=-1}get height(){return this._height}set height(i){this._height=i}get offsetHeight(){return this.height+this.grid._rowBorderHeight}updateElementsHeight(i){const t=this;i||t.rowManager.storeKnownHeight(t.id,t.height),t.lastHeight!==t.height&&(this.eachElement(e=>e.style.height=`${t.offsetHeight}px`),t.lastHeight=t.height)}addCls(i){this.updateCls(this.cls.add(i))}removeCls(i){this.updateCls(this.cls.remove(i))}toggleCls(i,t){this.updateCls(this.cls[t?"add":"remove"](i))}assignCls(i){this.updateCls(this.cls.assign(i))}changeCls(i){return i!=null&&i.isDomClassList?i:new Ce(i)}updateCls(i){this.eachElement(t=>m.syncClassList(t,i))}setAttribute(i,t){this.eachElement(e=>e.setAttribute(i,t))}removeAttribute(i){this.eachElement(t=>t.removeAttribute(i))}get isFirst(){return this.dataIndex===0}get top(){return this._top}get bottom(){return this._top+this._height+this.grid._rowBorderHeight}setTop(i,t){this._top!==i&&(this._top=i,this.translateElements(t))}setBottom(i,t){this.setTop(i-this.offsetHeight,t)}translate(i,t=!1){return this.setTop(i,t),i+this.offsetHeight}translateElements(i){const t=this,{top:e,_elementsArray:r}=t;if(t.lastTop!==e){for(let l=0,{length:o}=r;l<o;l++)r[l].style.transform=`translate(0,${e}px)`;!i&&t.rowManager.trigger("translateRow",{row:t}),t.lastTop=e}}positionElements(i){const t=this,{top:e,_elementsArray:r}=t;if(t.lastTop!==e){for(let l=0,{length:o}=r;l<o;l++)r[l].style.top=`${e}px`;!i&&t.rowManager.trigger("translateRow",{row:t}),t.lastTop=e}}offset(i){let t=this._top+i;return t<0&&(i-=t,t=0),this.setTop(t),i}render(i,t,e=!0,r=!1,l=!1){var o,s,n;const a=this,{cellContext:d,cls:c,elements:u,grid:h,rowManager:g,height:f,_id:p}=a,v=B.get(a._elementsArray[0]),C=g._rowHeight,{store:b}=h,{isTree:w}=b;let S=0,y;if(!t&&t!==!1&&(t=h.store.getById(v.id),i=h.store.indexOf(t)),!t)return;const E=t==null?void 0:t.cls,I=E?E.isDomClassList?E:new Ce(E):null;c.assign({"b-grid-row-updating":e&&h.transitionDuration&&!l,"b-selected":h.isSelected(t==null?void 0:t.id),"b-readonly":t.readOnly,"b-linked":t.isLinked,"b-original":t.hasLinks}),a.lastRecordCls&&c.remove(a.lastRecordCls),I?(c.add(I),a.lastRecordCls=Object.assign({},I)):a.lastRecordCls=null,g.trigger("beforeRenderRow",{row:a,record:t,recordIndex:i,oldId:p}),h.beforeRenderRow({row:a,record:t,recordIndex:i,oldId:p,cls:c}),a.updateCls(c),e&&h.transitionDuration&&!l&&h.setTimeout(()=>{a.isDestroyed||(c.remove("b-grid-row-updating"),a.updateCls(c))},h.transitionDuration+50),a.id=t.id,a.dataIndex=i;const A=!h.fixedRowHeight&&h.getRowHeight(t)||C;let G=a.maxRequestedHeight=null;if(w)for(const _ in u){const N=u[_];N.id=`${h.id}-${_}-${a.id}`,m.setAttributes(N,{"aria-level":t.childLevel+1,"aria-setsize":t.parent.children.length,"aria-posinset":t.parentIndex+1}),t.isExpanded(b)?m.setAttributes(N,{"aria-expanded":!0,"aria-owns":(o=t.children)!=null&&o.length?(s=t.children)==null?void 0:s.map(me=>`${h.id}-${_}-${me.id}`).join(" "):null}):(t.isLeaf?N.removeAttribute("aria-expanded"):N.setAttribute("aria-expanded",!1),N.removeAttribute("aria-owns"))}for(d._record=t,d._id=t.id,d._rowIndex=i,S=0;S<h.columns.visibleColumns.length;S++){const _=h.columns.visibleColumns[S];d._columnId=_.id,d._column=_,d._columnIndex=S,d._cell=a.getCell(_.id,!0),d.height=A,d.maxRequestedHeight=G,d.updatingSingleRow=e,y=a.renderCell(d),g.fixedRowHeight||y.height!=null&&(G=Math.max(G,y.height),y.transient||(a.maxRequestedHeight=G))}const U=G!=null?G:A;a.height=(n=h.processRowHeight(t,U))!=null?n:U,a.updateElementsHeight(l),e&&!l&&(f!==a.height&&g.translateFromRow(a,r),g.trigger("updateRow",{row:a,record:t,recordIndex:i,oldId:p}),g.trigger("renderDone")),h.afterRenderRow({row:a,record:t,recordIndex:i,oldId:p,oldHeight:f,isExport:l}),g.trigger("renderRow",{row:a,record:t,recordIndex:i,oldId:p,isExport:l}),f&&a.height!==f&&g.trigger("rowRowHeight",{row:a,record:t,height:a.height,oldHeight:f}),a.forceInnerHTML=!1}renderCell(i){var t,e,r,l;i.isLocation||(i=new R(i));let{cell:o,record:s}=i;const n=this,{grid:a,column:d,height:c,maxRequestedHeight:u,updatingSingleRow:h=!0,isMeasuring:g=!1}=i,f=(t=a.features)==null?void 0:t.cellEdit,p=B.get(o),v=p.rowElement,C=B.get(v);if(!s&&(s=i._record=a.store.getById(C.id),!s))return;let b=d.getRawValue(s);const w=s.fieldMap[d.field],S={configuredHeight:c,height:null,maxRequestedHeight:u},y=d.getCellClass(i),E={cellElement:o,dataField:w,rowElement:v,value:b,record:s,column:d,size:S,grid:a,row:p.row,updatingSingleRow:h,isMeasuring:g},I=d.renderer||d.defaultRenderer;a.beforeRenderCell(E),E.cellElement!==o&&(o=E.cellElement),m.syncClassList(o,y);let A=!0;I?(b=d.callback(I,d,[E]),b===void 0&&(s.generatedParent&&d.rendererReturningContent?b="":d.alwaysClearCell===!1&&(A=!1))):w&&(b=w.print(b));const G=(e=a.hasFrameworkRenderer)==null?void 0:e.call(a,{cellContent:b,column:d});G&&s.isSpecialRow&&(b="");const U=G&&!d.data.tree&&!s.isSpecialRow;if(A&&!U){let _=o;(r=f==null?void 0:f.editorContext)!=null&&r.equals(i)&&!f.editor.isFinishing&&(_=n.moveContentFromCell(o,f.editor.element));const N=b!=null&&typeof b=="object",me=typeof b=="string",oe=N||b==null?"":String(b);if(n.forceInnerHTML&&(_.innerHTML="",delete _._content,o.lastDomConfig=null),!N&&d.htmlEncode&&!d.disableHtmlEncode?o._hasHtml?(_.innerText=oe,o._hasHtml=!1):m.setInnerText(_,oe):d.autoSyncHtml&&(!me||m.getChildElementCount(_))?me?m.sync(oe,_.firstElementChild):N&&we.sync({domConfig:b,targetElement:_}):N?we.sync({targetElement:_,domConfig:{onlyChildren:!0,children:H.asArray(b)}}):_._content!==oe&&(_.innerHTML=_._content=oe),_!==o){const{firstChild:pt}=o;for(const bt of _.childNodes)o.insertBefore(bt,pt)}}return s.isSpecialRow||(l=a.processCellContent)==null||l.call(a,{cellElementData:p,rendererData:E,rendererHtml:E.rendererHtml||b}),d.autoHeight&&S.height==null&&(o.classList.add("b-measuring-auto-height"),S.height=Math.max(o.offsetHeight,a.rowHeight),o.classList.remove("b-measuring-auto-height")),g||n.rowManager.trigger("renderCell",E),S}moveContentFromCell(i,t){$e.setStart(i,0),$e.setEndBefore(t);const e=document.createElement("div");return e.appendChild($e.extractContents()),e}};F(he,"$name","Row"),he.initClass(),he._$name="Row";var ge=class extends J{static get $name(){return"Bar"}static get type(){return"gridbar"}static get defaultConfig(){return{htmlCls:"",scrollable:{overflowX:"hidden-scroll"}}}get columns(){return this._columns||this.subGrid.columns}set columns(i){this._columns=i}fixCellWidths(){const i=this,{hasFlex:t}=i.columns;let e;i.columns.traverse(r=>{const l=i.getBarCellElement(r.id),o=m.setLength(r.width),s=m.setLength(r.minWidth),n=m.setLength(r.maxWidth);if(l){if(e=o,l.style.maxWidth=n,r.isParent&&r.width==null&&r.flex==null){const a=r.children.reduce((d,c)=>d+=!c.hidden&&c.flex||0,0);l.style.flex=a>0?`${a} 0 auto`:"",l.style.minWidth=null,a>0&&r.traverse(d=>d.data.minWidth=null)}else if(parseInt(r.minWidth)>=0&&(l.style.minWidth=s),l.style.flex=l.style.flexBasis=l.style.width="",r.flex)!isNaN(parseInt(r.flex))&&r.children?l.style.flex=`${r.flex} 0 auto`:l.style.flex=r.flex;else if(parseInt(r.width)>=0){const a=r.parent;i.isHeader&&!a.isRoot&&!a.width?l.style.width=o:l.style.flexBasis=e}r.height>=0&&(l.style.height=m.setLength(r.height))}}),i.scrollable.element.classList.toggle("b-has-flex",t)}getLrPadding(i){if(!this.cellLrPadding){const t=i.ownerDocument.defaultView.getComputedStyle(i);this.cellLrPadding=parseInt(t.getPropertyValue("padding-left"))+parseInt(t.getPropertyValue("padding-right"))+parseInt(t.getPropertyValue("border-left-width"))+parseInt(t.getPropertyValue("border-right-width"))}return this.cellLrPadding}getBarCellElement(i){return this.element.querySelector(`[data-column-id="${i}"]`)}};ge.initClass(),ge._$name="Bar";var _e=class extends ge{static get $name(){return"Footer"}static get type(){return"gridfooter"}get subGrid(){return this._subGrid}set subGrid(i){this._subGrid=this.owner=i}refreshContent(){this.element.firstElementChild.innerHTML=this.contentTemplate(),this.fixFooterWidths()}onInternalPaint({firstPaint:i}){i&&this.refreshContent()}template(){const i=this.subGrid.region;return se.tpl`
            <div class="b-grid-footer-scroller b-grid-footer-scroller-${i}" role="presentation">
                <div data-reference="footersElement" class="b-grid-footers b-grid-footers-${i}" data-region="${i}" role="presentation"></div>
            </div>
        `}get overflowElement(){return this.footersElement}getFooter(i){return this.getBarCellElement(i)}contentTemplate(){return this.columns.visibleColumns.map(t=>se.tpl`
                <div
                    class="b-grid-footer ${t.align?`b-grid-footer-align-${t.align}`:""} ${t.cls||""}"
                    data-column="${t.field||""}" data-column-id="${t.id}" data-all-index="${t.allIndex}"
                    role="presentation">
                    ${t.footerText||""}
                </div>`).join("")}fixFooterWidths(){this.fixCellWidths()}};_e.initClass(),_e._$name="Footer";var Xt=i=>{const t=i.parentElement,e=i.cloneNode(!0);return e.classList.add("b-removing"),t.insertBefore(e,i),e},Ie=class extends P{static get pluginConfig(){return{chain:["destroy"],assign:["topRow","bottomRow","firstVisibleRow","lastVisibleRow","firstFullyVisibleRow","lastFullyVisibleRow","getRowById","getRecordCoords","getRow","getRowFor","getRowFromElement"]}}static get defaultConfig(){return{rowClass:he,prependRowBuffer:5,appendRowBuffer:5,rowHeight:null,fixedRowHeight:null,autoHeight:!1}}static get properties(){return{idMap:{},topIndex:0,lastScrollTop:0,_rows:[],heightMap:new Map,totalKnownHeight:0,_totalHeight:0,averageRowHeight:0,scrollTargetRecordId:null,refreshDetails:{topRowIndex:0,topRowTop:0}}}construct(i){i.grid._rowManager=this,super.construct(i.grid,i)}doDestroy(){this._rows.forEach(i=>i.destroy()),super.doDestroy()}initWithHeight(i,t=!1){const e=this;return e.autoHeight&&(i=e.store.allCount*e.preciseRowOffsetHeight),e.viewHeight=i,e.calculateRowCount(t),i}reinitialize(i=!1){const t=this;t.calculateRowCount(!1,!0,!0),t.topIndex+t.rowCount-1>t.store.count&&(i=!0),i&&(t.topIndex=t.lastScrollTop=0),t.scrollTargetRecordId=null;const{topRow:e}=t;e&&(e.dataIndex=t.topIndex,e.setTop(t.calculateTop(t.topIndex),!0)),t.estimateTotalHeight(),t.renderFromRow(e)}matchRowCount(i=!1){var t,e;const r=this,{rows:l,grid:o,rowClass:s}=r,n=l.length,a=n-r.rowCount;if(a)if(a<0){const d=[];for(let c=n,u=n?l[n-1].dataIndex+1:0;c<r.rowCount;c++,u++)d.push(s.new({cls:o.rowCls,rowManager:r,grid:o,index:c,dataIndex:u}));l.push.apply(l,d),r.trigger("addRows",{rows:d}),i||r.renderFromRow(l[Math.max(0,n-1)])}else{const{focusedCell:d}=o,c=(d==null?void 0:d.id)!=null&&((t=d==null?void 0:d.cell)==null?void 0:t.contains(m.getActiveElement(o))),u=l.splice(n-a,a);c&&(a===n?o.onFocusedRowDerender():((e=r.getRowFor(d._record))==null?void 0:e.index)>=l.length&&l[l.length-1].cells[d.columnIndex].focus()),r.trigger("removeRows",{rows:u}),u.forEach(h=>h.destroy())}}calculateRowCount(i=!1,t=!0,e=!1){var r,l;const o=this,{store:s}=o,n=Math.ceil(o.viewHeight/o.minRowOffsetHeight),a=n+o.prependRowBuffer+o.appendRowBuffer;if(!((r=o.grid.columns)!=null&&r.count)||isNaN(n))return o.rowCount=0,0;if(a<o.rowCount&&!t)return o.rowCount;if(o.visibleRowCount=n,o.rowCount=Math.min(s.count,a),!i){if(o.rows&&o.rowCount!==o.rows.length){if(o.matchRowCount(e),((l=o.bottomRow)==null?void 0:l.dataIndex)>=s.count&&o.topRow.dataIndex!==0){const d=o.bottomRow.dataIndex-s.count+1;for(const c of o.rows)c.dataIndex-=d;o.topIndex-=d}}else o.rowCount||o.trigger("changeTotalHeight",{totalHeight:o.totalHeight});o.grid.toggleEmptyText()}return o.rowCount}insert(i,t){var e,r,l;const o=this,{rows:s,rowCount:n,rowClass:a,grid:d,rowHeight:c}=o,{rowCls:u}=d,h=((e=s[i-1])==null?void 0:e.dataIndex)+1||0,g=i>=d.store.count,f=[],p=Te.as("ms",m.getStyleValue(d.element,"--row-splice-duration")),v=o.lastVisibleRow.index+1-i;if(t<0){t=Math.abs(t);const C=Math.min(t,v),b=s.slice(i,i+C),w=C?b[b.length-1].bottom-b[0].top:0,S=[];for(let y=0,{length:E}=b;y<E;y++)S.push(...b[y]._elementsArray.map(Xt));if(d.setTimeout(()=>{S.forEach(y=>y.remove())},p),g)return o.calculateRowCount(!1,!0,!0);for(let y=i;y<n;y++)s[y].setTop(s[y].top+w);(r=S[0])==null||r.getBoundingClientRect(),m.addTemporaryClass(d.element,"b-splicing-rows",p,d)}else if(t>0){t=o.grid.hasVerticalOverflow?Math.min(t,o.lastVisibleRow.index+1-i):t;let C=i,b=h;for(let w=0;w<t;w++,C++,b++)f.push(a.new({cls:`${u} b-adding`,rowManager:o,grid:d,index:C,dataIndex:b}));for(let w=i;w<o.rowCount;w++,C++,b++)s[w].index=C,s[w].dataIndex=b;d.setTimeout(()=>{f.forEach(w=>!w.isDestroyed&&w.removeCls("b-adding"))},p),s.splice(i,0,...f),o.rowCount+=t,t&&o.trigger("addRows",{rows:f});for(let w=0,S=(((l=s[i-1])==null?void 0:l.bottom)||0)-c;w<t;w++,S+=c)f[w].setTop(S);m.addTemporaryClass(d.element,"b-splicing-rows",p,d)}return o.renderFromRow(s[i]),f}removeAllRows(){const i=this,{topRow:t}=i,e=t?i.refreshDetails={topRowIndex:t.dataIndex,topRowTop:t.top}:i.refreshDetails,r=i.rows.slice();return i.trigger("removeRows",{rows:r}),i.rows.forEach(l=>l.destroy()),i.rows.length=0,i.idMap={},e}setPosition(i){const{topRow:t}=this,{topRowIndex:e,topRowTop:r}=i;t&&(t.setTop(r),t.dataIndex=e)}get store(){return this.client.store}get rows(){return this._rows}getRow(i){if(this.rowCount)return this.rows[i-this.topIndex]}getRowById(i){return i&&i.isModel&&(i=i.id),this.idMap[i]}getRowFromElement(i){return i=i.closest(".b-grid-row"),i&&this.getRow(i.dataset.index)}getRowAt(i,t=!1){return t||(i-=M.from(this.grid.bodyContainer,null,!0).roundPx(1).top,i+=this.grid.scrollable.y),i=m.roundPx(i),this.rows.find(e=>i>=e.top&&i<e.bottom)}getRowFor(i){return i instanceof HTMLElement?this.getRowFromElement(i):this.getRowById(i)}getNextRow(i){const t=typeof i=="number"?i:i.index;return this.getRow((t+1)%this.rowCount)}get topRow(){return this.rows[0]}get bottomRow(){const i=Math.min(this.rowCount,this.store.count);return this.rows[i-1]}get firstVisibleRow(){return this.rows.find(i=>i.bottom>Math.ceil(this.grid.scrollable.y))}get firstFullyVisibleRow(){return this.rows.find(i=>i.top>=Math.ceil(this.grid.scrollable.y))}get lastVisibleRow(){const{grid:i}=this;return H.findLast(this.rows,t=>t.top<i.scrollable.y+i.bodyHeight)}get lastFullyVisibleRow(){const{grid:i}=this;return H.findLast(this.rows,t=>t.bottom<i.scrollable.y+i.bodyHeight)}offsetRows(i){if(i!==0){const{rows:t}=this,{length:e}=t;for(let r=0;r<e;r++)t[r].offset(i)}this.trigger("offsetRows",{offset:i})}get prependBufferHeight(){return this.prependRowBuffer*this.rowOffsetHeight}get appendBufferHeight(){return this.appendRowBuffer*this.rowOffsetHeight}get rowHeight(){return this._rowHeight}set rowHeight(i){const t=this,{grid:e,fixedRowHeight:r}=t,l=t.rowHeight;if(l!==i){if(x.assertNumber(i,"rowHeight"),i<10&&(i=10),t.trigger("beforeRowHeight",{height:i}),t.minRowHeight=t._rowHeight=i,r&&(t.averageRowHeight=i),t.rows.length){const o=e.scrollable.y,s=t.getRowAt(o,!0),n=s?s.top-o:0;let a,d;r?(a=i,d=l):(d=a=t.averageRowHeight,t.clearKnownHeights(),a*=i/l),t.calculateRowCount(!1,!0,!0),t.topRow.setTop(t.topRow.dataIndex*(a+e._rowBorderHeight),!0),t.refresh(),o*(a/d)!==o&&e.scrollRowIntoView(s.id,{block:"start",edgeOffset:n})}t.trigger("rowHeight",{height:i,oldHeight:l})}}get rowOffsetHeight(){return Math.floor(this.preciseRowOffsetHeight)}get preciseRowOffsetHeight(){return(this.averageRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get minRowOffsetHeight(){return(this.minRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get allHeightsKnown(){return this.fixedRowHeight||this.heightMap.size>=this.store.count}storeKnownHeight(i,t){const e=this,{heightMap:r}=e;e.fixedRowHeight||(r.has(i)&&(e.totalKnownHeight-=r.get(i)),r.set(i,t),e.totalKnownHeight+=t,t<e.minRowHeight&&(e.minRowHeight=t),e.averageRowHeight=e.totalKnownHeight/r.size)}getOffsetHeight(i){const t=this;return(i&&t.heightMap.get(i.id)||i&&t.grid.getRowHeight(i)||t.averageRowHeight||t.rowHeight)+t.grid._rowBorderHeight}invalidateKnownHeight(i){const t=this;if(!t.fixedRowHeight){const{heightMap:e}=t;i=H.asArray(i),i.forEach(r=>{r&&e.has(r.id)&&(t.totalKnownHeight-=e.get(r.id),e.delete(r.id))}),t.averageRowHeight=t.totalKnownHeight/e.size}}clearKnownHeights(){this.heightMap.clear(),this.averageRowHeight=this.totalKnownHeight=0}calculateTop(i){if(this.fixedRowHeight)return i*this.rowOffsetHeight;const{store:t}=this;let e=0;for(let r=0;r<i;r++){const l=t.getAt(r);e+=this.getOffsetHeight(l)}return Math.floor(e)}getRecordCoords(i,t=!1,e=!1){const r=this,l=r.getRowById(i);let o=r.client._bodyRectangle;return t||(o=r.client.refreshBodyRectangle()),l?new M(o.x,Math.round(t?l.top:l.top+o.y-r.client.scrollable.y),o.width,l.offsetHeight):r.getRecordCoordsByIndex(r.store.indexOf(i),t,e)}getRecordCoordsByIndex(i,t=!1,e=!1){var r;const l=this,{topRow:o,bottomRow:s}=l,n=l.client._bodyRectangle,{id:a}=l.store.getAt(i),d=l.preciseRowOffsetHeight,c=o.dataIndex,u=s.dataIndex,h=i>u?{index:i-u-1,y:s.bottom,from:"bottomRow"}:i>c/2?{index:i-c,y:o.top,from:"topRow"}:{index:i,y:0,from:"top"},g=l.allHeightsKnown&&!e?l.calculateTop(i):Math.floor(h.y+h.index*d),f=Math.floor((r=l.heightMap.get(a))!=null?r:d),p=t?h.from==="topRow"?g+d-f:g:g+n.y-l.client.scrollable.y,v=new M(n.x,p,n.width,f);return v.virtual=!0,v.block=v.bottom<n.y?"start":v.y>n.bottom?"end":"nearest",v}get totalHeight(){return this._totalHeight}forEach(i){this.rows.forEach(i)}[Symbol.iterator](){return this.rows[Symbol.iterator]()}refreshCell(i,t){const e=new R({grid:this.grid,record:i,columnId:t});return!!(e.cell&&e.row.renderCell(e))}returnToTop(){const i=this;i.topIndex=0,i.lastScrollTop=0,i.topRow&&(i.topRow.dataIndex=0,i.topRow.setTop(0,!0)),i.refresh(),i.grid.scrollable.y=0}renderFromRecord(i){const t=this.getRowById(i.id);t&&this.renderFromRow(t)}renderFromRow(i=null){const t=this,{rows:e,store:r,topIndex:l,topRow:o}=t,s=r.count;let n=i?e.indexOf(i):0;if(t.calculateRowCount(!1,s<e.length,!0)===0){t.estimateTotalHeight(!0);return}t.topIndex<l?(t.topRow.setTop(t.calculateTop(t.topIndex),!0),n=0,i=t.topRow):i&&e.indexOf(i)<0&&(i=e[n]||o);let a=i?i.dataIndex:e[0].dataIndex;const d=s-a-1,c=Math.min(e.length-1,n+d);let u=e.length-c-1,h=n>0?e[n-1].bottom:e[n].top,g;for(let f=n;f<=c;f++)g=e[f],g.dataIndex=a,g.setTop(h,!0),g.render(a,r.getAt(a++),!1),h+=g.offsetHeight;for(;u-- >0;)t.displayRecordAtTop();t.bottomRow.bottom<t.viewHeight&&t.calculateRowCount(),t.estimateTotalHeight(!0),t.trigger("renderDone")}renderRows(i){let t,e=!1;i=Array.from(i),i.sort((r,l)=>r.dataIndex-l.dataIndex);for(const r of i)t=r.height,r.render(null,null,!1),e|=r.height!==t;e&&this.translateFromRow(i[0]),this.trigger("renderDone")}translateFromRow(i,t=!1){const e=this;let r=i.bottom,l,o;for(o=i.dataIndex+1,l=e.getRow(o);l;l=e.getRow(++o))r=l.translate(r);t||e.estimateTotalHeight(!0)}refresh(i=!1){const t=this,{topRow:e}=t;!e&&!i||t.grid.refreshSuspended||(t.idMap={},t.renderFromRow(e),t.trigger("refresh"))}jumpToPosition(i,t){const e=this,{store:r,heightMap:l}=e,o=r.count;if(e.allHeightsKnown&&!e.fixedRowHeight){const s=i-e.prependBufferHeight,n=e.grid._rowBorderHeight;let a=0,d=0;for(;a<s;){const u=r.getAt(d);a+=l.get(u.id)+n,d++}const c=Math.max(Math.min(d,o-e.rowCount),0);e.lastScrollTop=i,e.topRow.dataIndex=e.topIndex=c,e.topRow.setTop(e.calculateTop(c),!1),e.refresh()}else{const s=e.preciseRowOffsetHeight,n=t==null?Math.floor(i/s)-e.prependRowBuffer:t-Math.floor(e.rowCount/2),a=Math.max(Math.min(n,o-e.rowCount),0),d=e.client.scrollable.y,c=Math.min(e.client._bodyRectangle.height+d+e.appendBufferHeight,e.totalHeight);if(e.lastScrollTop=i,e.topRow.dataIndex=e.topIndex=a,e.topRow.setTop(Math.floor(a*s),!1),e.refresh(),e.bottomRow.bottom<c)for(e.calculateRowCount(!1,!1,!1);e.bottomRow.bottom<c&&e._rows[e.prependRowBuffer].top<d&&e.bottomRow.dataIndex<o-1;)e.displayRecordAtBottom();e.estimateTotalHeight()}if(t!=null){const{scrollable:s}=e.grid,n=e.getRow(t),a=n&&M.from(n._elementsArray[0]).center.y,d=s.viewport.center.y;n&&(s.y=i=Math.floor(s.y+(a-d)))}return i}warpIfNeeded(i){const t=this,e={newScrollTop:i,deltaTop:i-t.lastScrollTop};if(Math.abs(e.deltaTop)>t.rowCount*t.rowOffsetHeight*3){let r;t.scrollTargetRecordId&&(r=t.store.indexOf(t.scrollTargetRecordId)),t.grid.onFocusedRowDerender(),e.newScrollTop=t.jumpToPosition(i,r),e.deltaTop=0}return e}updateRenderedRows(i,t,e=!1){const r=this,l=r.client._bodyRectangle;if(r.rowCount===0)return 0;let o=r.totalHeight;if(t||Math.abs(i-r.lastScrollTop)>=r.rowOffsetHeight||r.topRow.top>i||r.bottomRow.bottom<i+l.height){const s=r.warpIfNeeded(i);r.scrollTargetRecordId=null,r.lastScrollTop=s.newScrollTop,s.deltaTop>0?r.fillBelow(s.newScrollTop):s.deltaTop<0&&r.fillAbove(s.newScrollTop),!r.fixedRowHeight&&!e&&r.correctError(s,l,i),o=r.estimateTotalHeight()}return o}correctError(i,t,e){const r=this;let l=0;(r.allHeightsKnown||i.deltaTop<0&&e<t.height*2||i.deltaTop>0&&e>r.totalHeight-t.height*2-3)&&(l=r.topRow.top-r.calculateTop(r.topRow.dataIndex)),l&&(r.offsetRows(-l),r.grid.scrollable.y=r.lastScrollTop=r.grid.scrollable.y-l)}fillAbove(i){const t=this,e=i-t.topRow.top-t.prependBufferHeight;let r=0;for(;r>e&&t.topIndex>0;)r-=t.displayRecordAtTop();t.trigger("renderDone")}fillBelow(i){const t=this,e=i-t.topRow.top-t.prependBufferHeight,r=t.store.count,l=t.rowCount;let o=0;for(;o<e&&t.topIndex+l<r&&t.topRow.top+t.topRow.offsetHeight<i;)o+=t.displayRecordAtBottom();t.trigger("renderDone")}estimateTotalHeight(i=!1){const t=this;if(t.grid.renderingRows)return;const e=t.store.count,r=e-t.heightMap.size,{bottomRow:l}=t;let o;if(t.fixedRowHeight)o=e*t.rowOffsetHeight;else{if(o=t.totalKnownHeight+t.heightMap.size*t.grid._rowBorderHeight+r*t.preciseRowOffsetHeight,l&&r){const s=l.bottom;(s>o||t.topIndex+t.rowCount>=e&&o>s&&s>0)&&(o=s,l.dataIndex<e-1&&(o+=(e-1-l.dataIndex)*t.preciseRowOffsetHeight))}o=Math.floor(o)}return o!==t.totalHeight&&t.trigger("changeTotalHeight",{totalHeight:o,immediate:i})!==!1&&(t._totalHeight=o),o}displayRecordAtTop(){var i;const t=this,{grid:e}=t,r=t.topIndex-1,l=t.store.getAt(r),o=t.bottomRow,s=o.top;return t.trigger("beforeTranslateRow",{row:o,newRecord:l}),o.dataIndex===((i=e.focusedCell)==null?void 0:i.rowIndex)&&e.onFocusedRowDerender(),o._top=t.topRow.top-t.getOffsetHeight(l),o.estimatedTop=!t.fixedRowHeight,o.render(r,l,!1),o._top=s,o.setBottom(t.topRow.top),o.estimatedTop=!1,t.topIndex--,t._rows.unshift(t._rows.pop()),t.fixIndices(),o.offsetHeight}displayRecordAtBottom(){var i;const t=this,{grid:e}=t,r=t.topIndex+t.rowCount,l=t.store.getAt(r),o=t.topRow;return t.trigger("beforeTranslateRow",{row:o,newRecord:l}),o.dataIndex===((i=e.focusedCell)==null?void 0:i.rowIndex)&&e.onFocusedRowDerender(),o.dataIndex=r,o.setTop(t.bottomRow.bottom),o.render(r,l,!1),t.topIndex++,t._rows.push(t._rows.shift()),t.fixIndices(),o.offsetHeight}fixIndices(){for(let i=0,{rows:t}=this,{length:e}=t;i<e;i++)t[i].index=i}};Ie.featureClass="",Ie._$name="RowManager";var ie=class extends ge{get subGrid(){return this._subGrid}set subGrid(i){this._subGrid=this.owner=i}get region(){var i;return(i=this.subGrid)==null?void 0:i.region}changeElement(i,t){const{region:e}=this;return this.getConfig("columns"),super.changeElement({className:{"b-grid-header-scroller":1,[`b-grid-header-scroller-${e}`]:e},children:[{reference:"headersElement",className:{"b-grid-headers":1,[`b-grid-headers-${e}`]:e},dataset:{region:e,reference:"headersElement",maxDepth:this.maxDepth}}]},t)}get overflowElement(){return this.headersElement}getColumnConfig(i){const{id:t,align:e,resizable:r,isLeaf:l,isParent:o,isLastInSubGrid:s,cls:n,childLevel:a,field:d,tooltip:c,children:u,isFocusable:h,grid:g}=i,f=g==null?void 0:g.focusedCell,p=(f==null?void 0:f.rowIndex)===-1&&(f==null?void 0:f.column)===i,v={};if(i.isVisible)return i.flex?v.flex=i.flex:i.width&&(v.width=m.setLength(i.width)),{style:v,className:{"b-grid-header":1,"b-grid-header-parent":o,[`b-level-${a}`]:1,[`b-depth-${i.meta.depth}`]:1,[`b-grid-header-align-${e}`]:e,"b-grid-header-resizable":r&&l,[n]:n,"b-collapsible":i.collapsible,"b-last-parent":o&&s,"b-last-leaf":l&&s},role:h?"columnheader":"presentation","aria-sort":"none","aria-label":i.ariaLabel,[h?"tabIndex":""]:p?0:-1,dataset:{...et.encodeConfig(c),columnId:t,[d?"column":""]:d},children:[{className:"b-grid-header-text",children:[{[g&&h?"id":""]:`${g==null?void 0:g.id}-column-${i.id}`,className:"b-grid-header-text-content"}]},u?{className:"b-grid-header-children",children:u.map(C=>this.getColumnConfig(C)),syncOptions:{syncIdField:"columnId"}}:null,{className:"b-grid-header-resize-handle"}]}}calculateMinWidthForSafari(){let i=0;return this.columns.visibleColumns.forEach(t=>{i+=t.calculateMinWidth()}),i}fixHeaderWidths(){this.fixCellWidths()}refreshHeaders(){const i=this;i.columns.traverse(t=>i.refreshColumn(t)),i.fixHeaderWidths()}refreshColumn(i){const t=this,e=t.getBarCellElement(i.id);if(e){let r=i.headerText;i.headerRenderer&&(r=i.headerRenderer.call(i.thisObj||t,{column:i,headerElement:e})),i.headerWidgetMap&&Object.values(i.headerWidgetMap).forEach(o=>{o.render(i.textWrapper)}),i.icon&&(r=`<i class="${T.encodeHtml(i.icon)}"></i>`+(r||""));const l=e.querySelector(".b-grid-header-text-content");l&&(l.innerHTML=r||"")}}get columns(){const i=this,t=super.columns;return i.columnsDetacher||(i.columnsDetacher=t.ion({change(){i.initDepths()},thisObj:i}),i.initDepths()),t}set columns(i){super.columns=i}initDepths(i=this.columns.topColumns,t=null){const e=this;let r=0;t!=null&&t.meta&&t.meta.depth++;for(const l of i){const{meta:o}=l;o.depth=0,l.children&&(e.initDepths(l.children.filter(e.columns.chainedFilterFn),l),o.depth&&t&&(t.meta.depth+=o.depth)),o.depth>r&&(r=o.depth)}return t||(e.maxDepth=r),r}getHeader(i){return this.getBarCellElement(i)}get contentElement(){return this.element.firstElementChild}refreshContent(){const i=this;we.sync({domConfig:{children:i.columns.topColumns.map(t=>i.getColumnConfig(t)),onlyChildren:!0},targetElement:i.contentElement,strict:!0,syncIdField:"columnId",releaseThreshold:0}),i.refreshHeaders()}onInternalPaint({firstPaint:i}){i&&this.refreshContent()}};F(ie,"$name","Header"),F(ie,"type","gridheader"),ie.initClass(),ie._$name="Header";var Ve={touchstart:"onElementTouchStart",touchmove:"onElementTouchMove",touchend:"onElementTouchEnd",pointerover:"onElementMouseOver",mouseout:"onElementMouseOut",mousedown:"onElementMouseDown",mousemove:"onElementMouseMove",mouseup:"onElementMouseUp",click:"onHandleElementClick",dblclick:"onElementDblClick",keyup:"onElementKeyUp",keypress:"onElementKeyPress",contextmenu:"onElementContextMenu",pointerdown:"onElementPointerDown",pointerup:"onElementPointerUp"},lt=["pageX","pageY","clientX","clientY","screenX","screenY"];function fe(i,t=!0){i==null||i.classList.toggle("b-hover",t)}function He(i,t,e=!0){t&&i&&fe(t.getCell(i),e)}var ot=i=>class extends(i||z){static get $name(){return"GridElementEvents"}static get configurable(){return{hoveredCell:null,longPressTime:400,enableUndoRedoKeys:!0,keyMap:{"Ctrl+z":"undoRedoKeyPress","Ctrl+Shift+z":"undoRedoKeyPress"," ":{handler:"clickCellByKey",weight:1e3}}}}initInternalEvents(){const e=Object.keys(Ve),r=e.length,l={element:this.bodyElement,thisObj:this};for(let o=0;o<r;o++){const s=e[o];l[s]={handler:"handleEvent"},s.startsWith("touch")&&(l[s].passive=!1)}j.on(l),j.on({focusin:"onGridBodyFocusIn",element:this.bodyElement,thisObj:this,capture:!0})}getCellDataFromEvent(e,r=!1){var l,o;const s=this,{columns:n}=s,{target:a}=e,d=a.classList.contains("b-grid-row");let c=a.closest(".b-grid-cell");if(!c&&r&&!d&&!a.classList.contains("b-grid-subgrid")){const{top:u,left:h,right:g,bottom:f}=s.bodyContainer.getBoundingClientRect();let p,{x:v,y:C}=e;v>=h&&v<=g?C=p=Math.ceil(s[`${C<u?"first":"last"}FullyVisibleRow`].element.getBoundingClientRect().y):C>=u&&C<=f&&(v=p=Math.ceil(n.visibleColumns[v<h?0:n.visibleColumns.length-1].element.getBoundingClientRect().x)),p!==void 0&&(c=(l=m.childFromPoint(e.target,e.offsetX,e.offsetY))==null?void 0:l.closest(".b-grid-cell"))}else d&&(c=(o=m.childFromPoint(e.target,e.offsetX,e.offsetY-a.offsetHeight/2))==null?void 0:o.closest(".b-grid-cell"));if(c){const u=B.get(c),{id:h,columnId:g}=u,f=s.store.getById(h),p=n.getById(g);return f?{cellElement:c,cellData:u,columnId:g,id:h,record:f,column:p,cellSelector:{id:h,columnId:g}}:null}}getHeaderDataFromEvent(e){const r=e.target.closest(".b-grid-header");if(r){const l=x.assign({},r.dataset),{columnId:o}=l,s=this.columns.getById(o);return s?{headerElement:r,headerData:l,columnId:o,column:s}:null}}handleEvent(e){!this.disabled&&Ve[e.type]&&this[Ve[e.type]](e)}onElementTouchStart(e){const r=this,l=r.getCellDataFromEvent(e);m.isTouchEvent=!0,e.touches.length===1&&(r.longPressTimeout=r.setTimeout(()=>{r.onElementLongPress(e),e.preventDefault(),r.longPressPerformed=!0},r.longPressTime)),l&&!e.defaultPrevented&&r.onFocusGesture(e)}onElementTouchMove(e){const r=this,{lastTouchTarget:l}=r,o=e.changedTouches[0],{pageX:s,pageY:n}=o,a=document.elementFromPoint(s,n);if(r.longPressTimeout&&(r.clearTimeout(r.longPressTimeout),r.longPressTimeout=null),a!==l){if(l){const d=new MouseEvent("mouseout",x.copyProperties({relatedTarget:a,pointerType:"touch",bubbles:!0},o,lt));d.preventDefault=()=>e.preventDefault(),l==null||l.dispatchEvent(d)}if(a){const d=new MouseEvent("mouseover",x.copyProperties({relatedTarget:l,pointerType:"touch",bubbles:!0},o,lt));d.preventDefault=()=>e.preventDefault(),a==null||a.dispatchEvent(d)}}r.lastTouchTarget=a}onElementTouchEnd(e){const r=this;r.longPressPerformed&&(e.cancelable&&e.preventDefault(),r.longPressPerformed=!1),r.longPressTimeout&&(r.clearTimeout(r.longPressTimeout),r.longPressTimeout=null)}onElementLongPress(e){}triggerCellMouseEvent(e,r,l=this.getCellDataFromEvent(r)){var o;const s=this;if(l){const n=s.columns.getById(l.columnId),a={grid:s,record:l.record,column:n,cellSelector:l.cellSelector,cellElement:l.cellElement,target:r.target,event:r};s.trigger("cell"+T.capitalize(e),a),e==="click"&&((o=n.onCellClick)==null||o.call(n,a))}}onElementMouseDown(e){const r=this,l=r.getCellDataFromEvent(e);r.skipFocusSelection=!0,r.isScrollbarOrRowBorderOrSplitterClick(e)?e.preventDefault():(r.triggerCellMouseEvent("mousedown",e,l),l&&!e.defaultPrevented&&r.onFocusGesture(e))}isScrollbarOrRowBorderOrSplitterClick({target:e,x:r,y:l}){if(e.closest(".b-grid-splitter")||e.matches(".b-grid-row, .b-virtual-width"))return!0;if(e.matches(".b-vertical-overflow")){const o=e.getBoundingClientRect();return r>o.right-m.scrollBarWidth}else if(e.matches(".b-horizontal-overflow")){const o=e.getBoundingClientRect();return l>o.bottom-m.scrollBarWidth-1}}onElementMouseMove(e){this.mouseMoveEvent=e}onElementMouseUp(e){}onElementPointerDown(e){}onElementPointerUp(e){}onHandleElementClick(e){this.trigger("beforeElementClick",{event:e})!==!1&&this.onElementClick(e)}onElementClick(e){const r=this,l=r.getCellDataFromEvent(e);l&&r.triggerCellMouseEvent("click",e,l)}onFocusGesture(e){var r;const l=this,{navigationEvent:o}=l,{target:s}=e,n=e.button===2,a=!n&&s.matches(".b-icon-tree-expand, .b-icon-tree-collapse"),d=!document.hasFocus()&&k.isMac&&n;if(a||d)e.preventDefault();else{l.navigationEvent=e;const c=new R(s);if(n||(r=l.focusedCell)!=null&&r.equals(c)){let u;globalThis.TouchEvent&&e instanceof MouseEvent&&o instanceof TouchEvent&&s===o.target&&(u={doSelect:!1}),l.focusCell(c,u)}}}onElementDblClick(e){const{target:r}=e;if(this.triggerCellMouseEvent("dblClick",e),r.classList.contains("b-grid-header-resize-handle")){const l=r.closest(".b-grid-header");this.columns.getById(l.dataset.columnId).resizeToFitContent()}}onElementMouseOver(e){var r;if(!this.scrolling){const l=this,{hoveredCell:o}=l,s=(typeof e.buttons!="number"||e.buttons===0)&&e.pointerType!=="touch";let n=e.target.closest(".b-grid-cell");!n&&e.target.classList.contains("b-grid-row")&&(n=(r=m.childFromPoint(e.target,e.offsetX,e.offsetY-2))==null?void 0:r.closest(".b-grid-cell")),n&&(s&&(l.hoveredCell=n),o!==l.hoveredCell&&l.triggerCellMouseEvent("mouseOver",e)),l.trigger("mouseOver",{event:e})}}onElementMouseOut(e){var r;const l=this,{target:o,relatedTarget:s}=e;s&&o.matches(".b-grid-cell")&&!o.contains(s)?s.matches(".b-grid-row")||(l.hoveredCell=s.closest(".b-grid-cell")):!(s!=null&&s.matches(".b-grid-row,.b-grid-cell"))&&!((r=l.hoveredCell)!=null&&r.contains(s))&&(l.hoveredCell=null),l.scrolling||((s==null?void 0:s.closest(".b-grid-cell"))!==(o==null?void 0:o.closest(".b-grid-cell"))&&o!=null&&o.closest(".b-grid-cell")&&l.triggerCellMouseEvent("mouseOut",e),l.trigger("mouseOut",{event:e}))}updateHoveredCell(e,r){var l,o,s;const n=this,{selectionMode:a}=n,d=a.rowNumber&&((l=n.columns.find(u=>u.type=="rownumber"))==null?void 0:l.id),c=a.checkbox&&((o=n.checkboxSelectionColumn)==null?void 0:o.id);if(r){fe(r,!1);const u=B.get(r),{row:h}=u;h&&!h.isDestroyed&&(He(d,h,!1),He(c,h,!1)),u!=null&&u.columnId&&fe((s=n.columns.getById(u.columnId))==null?void 0:s.element,!1)}if(n._hoveredRow&&!n._hoveredRow.isDestroyed&&n._hoveredRow.removeCls("b-hover"),n._hoveredRow=null,e&&!n.scrolling){const u=B.get(e),{row:h}=u;if(h)if(a.cell&&u.columnId!==d&&u.columnId!==c){const g=n.columns.getById(u.columnId);fe(e),He(c,h),He(d,h),g!=null&&g.element&&g.headerHoverable!==!1&&fe(g.element)}else n._hoveredRow=h,h.addCls("b-hover");else n.hoveredCell=null}}keyMapOnKeyDown(e){this.element.contains(e.target)&&(this.onElementKeyDown(e),super.keyMapOnKeyDown(e))}onElementKeyDown(e){var r,l;if(e.handled||!this.element.contains(e.target))return;const o=this,s=o.focusedCell;if(s!=null&&s.isCell&&!s.isActionable){const n=s.cell;(l=(r=o.columns.getById(n.dataset.columnId)).onCellKeyDown)==null||l.call(r,{event:e,cellElement:n})}}undoRedoKeyPress(e){var r;const{stm:l}=this.store;return l&&this.enableUndoRedoKeys&&!((r=this.features.cellEdit)!=null&&r.isEditing)?(l.onUndoKeyPress(e),!0):!1}clickCellByKey(e){const r=this,l=r.focusedCell,o=l==null?void 0:l.cell,s=r.columns.getById(o.dataset.columnId);return l!=null&&l.isCell&&!l.isActionable&&s.onCellClick?(s.onCellClick({grid:r,column:s,record:r.store.getById(l.id),cellElement:o,target:e.target,event:e}),!0):!1}onElementKeyPress(e){}onElementKeyUp(e){}onElementContextMenu(e){const r=this,l=r.getCellDataFromEvent(e);l&&(r.triggerCellMouseEvent("contextMenu",e,l),m.isTouchEvent&&r.onFocusGesture(e))}onInternalResize(e,r,l,o,s){const n=this;n._devicePixelRatio&&n._devicePixelRatio!==globalThis.devicePixelRatio&&m.resetScrollBarWidth(),n._devicePixelRatio=globalThis.devicePixelRatio,n._bodyRectangle=M.client(n.bodyContainer),super.onInternalResize(...arguments),l!==s&&(n._bodyHeight=n.bodyContainer.offsetHeight,n.isPainted&&n.rowManager.initWithHeight(n._bodyHeight)),n.refreshVirtualScrollbars(),r!==o&&n.setTimeout(()=>{n.isDestroyed||n.updateResponsive(r,o)},0)}get widgetClass(){}},Yt={string:1,object:1,function:1},st=i=>class extends(i||z){static get $name(){return"GridFeatures"}set features(e){const r=this,l=L.getInstanceDefaultFeatures(this);e=r._features=x.assign({},e),l&&Object.keys(l).forEach(s=>{s in e||(e[s]=!0)});const o=L.getInstanceFeatures(this);for(const s of Object.keys(e)){const n=e[s];if(n){const a=!globalThis.__bryntum_code_editor_changed;if(T.uncapitalize(s)!==s){const c=`Invalid feature name '${s}', must start with a lowercase letter`;if(a)throw new Error(c);console.error(c),r._errorDuringConfiguration=c}const d=o[s];if(!d){const c=`Feature '${s}' not available, make sure you have imported it`;if(a)throw new Error(c);console.error(c),r._errorDuringConfiguration=c;return}Reflect.defineProperty(e,s,r.createFeatureInitializer(e,s,d,n))}}}get features(){return this._features}createFeatureInitializer(e,r,l,o){const s=[this],n=l.prototype.construct;return o===!0&&(o={}),Yt[typeof o]&&(s[1]=o),{configurable:!0,get(){return delete e[r],l.prototype.construct=function(...a){e[r]=this,n.apply(this,a),l.prototype.construct=n},new l(...s)}}}hasFeature(e){const{features:r}=this;if(r){const l=Object.getOwnPropertyDescriptor(this.features,e);if(l)return!!(l.value||l.get)}return!1}hasActiveFeature(e){var r,l;return!!((r=this.features)!=null&&r[e]&&!((l=this.features)!=null&&l[e].disabled))}getConfigValue(e,r){var l,o;if(e==="features"){const s={};for(const n in this.features){const a=(o=(l=this.features[n])==null?void 0:l.getCurrentConfig)==null?void 0:o.call(l,r);a?x.isEmpty(a)?L.isDefaultFeatureForInstance(this.features[n].constructor,this)||(s[n]=!0):s[n]=a:s[n]=!1}return s}return super.getConfigValue(e,r)}get widgetClass(){}},nt=i=>class extends(i||z){static get $name(){return"GridResponsive"}static get defaultConfig(){return{responsiveLevels:Object.freeze({small:400,medium:600,large:"*"})}}getClosestBiggerLevel(e){const r=this,l=Object.keys(x.assign({},r.responsiveLevels));let o=null,s=99995,n=null;return l.forEach(a=>{let d=r.responsiveLevels[a];if(["number","string"].includes(typeof d)||(d=d.levelWidth),d==="*")n=a;else if(e<d){const c=d-e;c<s&&(s=c,o=a)}}),o||n}get responsiveLevel(){return this.getClosestBiggerLevel(this.width)}updateResponsive(e,r){const l=this,o=l.getClosestBiggerLevel(r),s=l.getClosestBiggerLevel(e);if(r===0||o!==s){const n=l.responsiveLevels[s];["number","string"].includes(typeof n)||l.applyState(n),l.columns.forEach(a=>{const d=a.responsiveLevels;d&&(d[s]?a.applyState(d[s]):d["*"]&&a.applyState(d["*"]))}),l.element.classList.remove("b-responsive-"+o),l.element.classList.add("b-responsive-"+s),l.trigger("responsive",{level:s,width:e,oldLevel:o,oldWidth:r})}}get widgetClass(){}},Jt={string:1,number:1},Qt={dataset:1,batch:1},at=i=>{var t;return t=class extends(i||z){static get $name(){return"GridSelection"}construct(e){this._selectedCells=[],this._selectedRows=[],super.construct(e),e!=null&&e.selectedRecords&&(this.selectedRecords=e.selectedRecords)}getDefaultGridSelection(e){if(e.$name==="GridSelection")return e.configurable.selectionMode;if(e.superclass)return this.getDefaultGridSelection(e.superclass)}changeSelectionMode(e){const r=this;return r.selectionMode?(x.assign(r.selectionMode,e),r.selectionMode):(r.$defaultGridSelection=r.getDefaultGridSelection(r.constructor),new Proxy(e,{set(l,o,s){const n=x.assign({},l);return l[o]=s,r.updateSelectionMode(l,n),!0}}))}updateSelectionMode(e,r=this.$defaultGridSelection){var l,o;const s=this,{columns:n,checkboxSelectionColumn:a}=s,d={},{rowReorder:c}=s.features;for(const u in e)e[u]!=r[u]&&(d[u]=e[u]);e.rowCheckboxSelection&&!e.checkboxOnly&&(e.checkboxOnly=!0,delete e.rowCheckboxSelection),d.column&&(e.cell=!0,e.multiSelect=!0),d.cell&&(e.checkboxOnly=!1),d.cell===!1&&(e.column=!1),d.checkboxOnly&&(e.checkbox||(e.checkbox=!0),e.cell=!1),d.checkbox===!1&&(d.checkboxOnly=!1,d.showCheckAll=!1),d.showCheckAll&&(e.checkbox=e.checkbox||!0,e.multiSelect=!0),(d.includeChildren||d.includeParents)&&(e.multiSelect=!0),d.multiSelect===!1&&(e.column=e.showCheckAll=e.dragSelect=e.includeChildren=e.includeParents=!1),d.dragSelect&&(c!=null&&c.enabled&&c.gripOnly!==!0&&(c.showGrip=c.gripOnly=!0),e.multiSelect=!0,s._selectionListenersDetachers={}),d.dragSelect===!1&&s._selectionListenersDetachers&&((o=(l=s._selectionListenersDetachers).selectiondrag)==null||o.call(l),delete s._selectionListenersDetachers.selectiondrag),r&&(d.cell!==void 0||d.deselectFilteredOutRecords!==void 0||d.multiSelect!==void 0)&&s.deselectAll(),d.rowNumber?n.findRecord("type","rownumber")||(n.insert(0,{...typeof e.rowNumber=="object"?e.rowNumber:{},type:"rownumber"}),s._selectionAddedRowNumberColumn=!0):d.rowNumber===!1&&s._selectionAddedRowNumberColumn&&(n.remove(n.findRecord("type","rownumber")),delete s._selectionAddedRowNumberColumn),(e.checkbox!==(r==null?void 0:r.checkbox)||e.checkbox&&e.showCheckAll!==(r==null?void 0:r.showCheckAll))&&(s.isConfiguring?s.shouldInitCheckboxSelection=!0:(r&&s.deselectAll(),s.initCheckboxSelection())),r&&e.checkbox&&r.checkbox&&e.checkboxIndex!==r.checkboxIndex&&a&&a.parent.insertChild(a,n.getAt(s.checkboxSelectionColumnInsertIndex)),s.trigger("selectionModeChange",x.clone(e)),s.afterSelectionModeChange(e)}afterConfigure(){this.shouldInitCheckboxSelection&&(this.shouldInitCheckboxSelection=!1,this.initCheckboxSelection()),super.afterConfigure()}initCheckboxSelection(){var e,r;const l=this,{selectionMode:o,columns:s,checkboxSelectionColumn:n}=l,{checkbox:a}=o;if(n&&(l.checkboxSelectionColumn=null,s.remove(n)),a){const d=K.getColumnClass("check"),c=a===!0?null:a;if(!d)throw new Error("CheckColumn must be imported for checkbox selection mode to work");const u=l.checkboxSelectionColumn=new d(x.assign({id:`${l.id}-selection-column`,width:"4em",minWidth:"4em",field:null,sortable:!1,filterable:!1,hideable:!1,cellCls:"b-checkbox-selection",region:(r=(e=l.items)==null?void 0:e[0])==null?void 0:r.region,showCheckAll:o.showCheckAll,draggable:!1,resizable:!1,widgets:[{type:"checkbox",valueProperty:"checked",ariaLabel:"L{Checkbox.toggleRowSelect}"}]},c),s,{isSelectionColumn:!0});u.meta.depth=0,u._grid=l;const h=u.renderer;u.renderer=g=>{g.value=l.isSelected(g.record),h.call(u,g)},u.ion({toggle:"onCheckChange",toggleAll:"onCheckAllChange",thisObj:l}),s.insert(l.checkboxSelectionColumnInsertIndex,u)}}get checkboxSelectionColumnInsertIndex(){const{columns:e}=this;let{checkboxIndex:r}=this.selectionMode;return r?typeof r=="string"&&(r=e.indexOf(e.getById(r))):r=e.indexOf(e.findRecord("type","rownumber"))+1,r}afterSelectionChange(){}afterSelectionModeChange(){}changeSelectedRecordCollection(e){return e!=null&&e.isCollection?(e.owner||(e.owner=this),e):_t.new(e,{owner:this})}updateSelectedRecordCollection(e){e.ion({change:"onSelectedRecordCollectionChange",thisObj:this})}onSelectedRecordCollectionChange({added:e=[],removed:r}){this.selectedRecordCollection._fromSelection!==this&&(e=e.filter(l=>this.isSelectable(l)),this.performSelection({selectedCells:[],deselectedCells:[],selectedRecords:e,deselectedRecords:r}))}changeSelectedRecordCollectionSilent(e){this.selectedRecordCollection._fromSelection=this;const r=e(this.selectedRecordCollection);return delete this.selectedRecordCollection._fromSelection,r}bindStore(e){var r;this.detachListeners("selectionStoreFilter"),e.ion({name:"selectionStoreFilter",filter:"onStoreFilter",thisObj:this}),(r=super.bindStore)==null||r.call(this,e)}unbindStore(e){this.detachListeners("selectionStoreFilter"),super.unbindStore(e)}onStoreFilter({source:e}){const r=this,l=[];for(const s of r.selectedRows)e.includes(s)||l.push(s);const o=r.prepareSelection(r.selectionMode.deselectFilteredOutRecords?l:[]);if(r.isCellSelectionMode){const{deselectedCells:s}=r.prepareSelection(r.getSelectedCellsForRecords(l));s!=null&&s.length&&(o.deselectedCells=(o.deselectedCells||[]).concat(s))}(o.deselectedCells.length||o.deselectedRecords.length)&&(r.performSelection(o,!1),r.updateCheckboxHeader())}onStoreRecordIdChange({record:e,oldValue:r}){var l;(l=super.onStoreRecordIdChange)==null||l.call(this,...arguments),this.selectedRecordCollection.get(r)===e&&this.selectedRecordCollection.rebuildIndices()}onStoreRemove(e){var r;if((r=super.onStoreRemove)==null||r.call(this,e),!e.isCollapse){const l=this,o=e.records.filter(s=>this.isSelected(s));if(o.length){const s=l.prepareSelection(o);if(l.isCellSelectionMode){const{deselectedCells:n}=l.prepareSelection(l.getSelectedCellsForRecords(o));n!=null&&n.length&&(s.deselectedCells=(s.deselectedCells||[]).concat(n))}l.performSelection(s)}}}onStoreDataChange({action:e,source:r}){var l;const o=this,{selectionMode:s}=o;let n;if((l=super.onStoreDataChange)==null||l.call(this,...arguments),e==="pageLoad")s.preserveSelectionOnPageChange||(n=o.prepareSelection(null,null,!0)),o.updateCheckboxHeader();else if(Qt[e]){const a=[];if(s.preserveSelectionOnDatasetChange===!1)n=o.prepareSelection(null,null,!0);else{a.push(...o.changeSelectedRecordCollectionSilent(d=>d.match(r.storage)));for(const d of o._selectedCells)r.getById(d.id)||a.push(d);n=o.prepareSelection(a)}}n&&(n.deselectAll||n.deselectedCells.length||n.deselectedRecords.length||n.selectedCells.length||n.selectedRecords.length)&&(o.performSelection(n,!1),o.updateCheckboxHeader())}onStoreRemoveAll(){var e;(e=super.onStoreRemoveAll)==null||e.call(this),this.performSelection(this.prepareSelection(null,null,!0),!1)}onCheckChange({checked:e,record:r,checkbox:l}){const o=this,{multiSelect:s}=o.selectionMode,n=!s&&e,a=!n&&!e?[r]:null,d=e?[r]:null;o._isCheckboxSelecting=!0,e&&!D.shiftKeyDown&&(o._lastSelectionChecked=r),e&&s&&o._lastSelectionChecked&&D.shiftKeyDown?o.performSelection(o.internalSelectRange(o._lastSelectionChecked,r,!0)):o.performSelection(o.prepareSelection(a,d,n,!0))===!1&&(l.checked=!l.checked),o._isCheckboxSelecting=!1}updateCheckboxHeader(){const{selectionMode:e,checkboxSelectionColumn:r,store:l}=this;if(!this._isCheckAllSelecting&&e.checkbox&&e.showCheckAll&&(r!=null&&r.headerCheckbox)){const o=l.count&&!l.some(s=>this.isSelectable(s)&&!this.isSelected(s));r.headerCheckbox.checked!==o&&(r.suspendEvents(),r.headerCheckbox.checked=o,r.resumeEvents())}}onCheckAllChange({checked:e}){const r=this;r._isCheckboxSelecting=r._isCheckAllSelecting=!0,r[e?"selectAll":"deselectAll"](r.store.isPaged&&r.selectionMode.preserveSelectionOnPageChange),r._isCheckboxSelecting=r._isCheckAllSelecting=!1}get selectionDragMouseEventListenerElement(){return globalThis}onSelectionDrag(e){var r;const l=this,{_selectionStartCell:o}=l;if(D.isMouseDown()||l.onSelectionEnd(),!o)return;const{items:s,_lastSelectionDragRegion:n}=l,a=l.getCellDataFromEvent(e,!0),d=a==null?void 0:a.column.region,c=(a==null?void 0:a.cellSelector)&&l.normalizeCellContext(a.cellSelector);if(c&&!c.equals(l._lastSelectionDragCell,!0)){if(l._isSelectionDragging||l.enableScrollingCloseToEdges(s),l._clearSelectionOnSelectionDrag&&!o.equals(c,!0)&&(l.deselectAll(),delete l._clearSelectionOnSelectionDrag),n&&d!==n){const h=l.subGrids[n],g=l.subGrids[d],f=h.scrollable,p=g.scrollable,v=s.indexOf(h)-s.indexOf(g)<0;if(p.x=v?0:p.maxX,v?f.x<f.maxX-1:f.x>1)return;const C=(r=l.scrollManager._activeScroll)==null?void 0:r.horizontal;C&&C.element!==p.element&&C.stopScroll(!0)}l._lastSelectionDragRegion=d,l._lastSelectionDragCell=c,l._isSelectionDragging=!0;const u=l._lastSelectionDragChange=l.internalSelectRange(o,c,l.isRowNumberSelecting(c)||l.isRowNumberSelecting(o));u.deselectedCells=u.deselectedCells.filter(h=>!l.isCellSelected(h)),u.deselectedRecords=u.deselectedRecords.filter(h=>!l.isSelected(h)),l.refreshGridSelectionUI(u),l.trigger("dragSelecting",u)}}onSelectionEnd(){var e,r;const l=this,o=l._lastSelectionDragChange;l._isSelectionDragging&&!l._selectionStartCell.equals(l._lastSelectionDragCell,!0)&&o&&l.performSelection(o,!1),l.disableScrollingCloseToEdges(l.items),l._isSelectionDragging=!1,l._lastSelectionDragChange=l._lastSelectionDragCell=l._lastSelectionDragRegion=null,(r=(e=l._selectionListenersDetachers).selectiondrag)==null||r.call(e),delete l._selectionListenersDetachers.selectiondrag}onHandleElementClick(e){const r=this;r.selectionMode.rowNumber&&e.target.closest(".b-rownumber-header")?(e.handled=!0,r.store.count&&r.store.some(l=>!r.isSelected(l))?r.selectAll():r.deselectAll()):r.selectionMode.column&&e.target.closest(".b-grid-header")&&(e.handled=!0,r.selectColumn(e,e.ctrlKey)),super.onHandleElementClick(e)}selectColumn(e,r=!1){const l=this,{store:o}=l,{columnId:s}=l.getHeaderDataFromEvent(e);l._shiftSelectRange=null,e.shiftKey||(l._shiftSelectColumn=s);const n=e.shiftKey&&l._shiftSelectColumn||s,a=l.internalSelectRange(l.normalizeCellContext({id:o.first.id,columnId:n}),l.normalizeCellContext({id:o.last.id,columnId:s}));r&&!a.selectedCells.some(d=>!l.isCellSelected(d))&&(a.deselectedCells=a.selectedCells,a.selectedCells=[]),r||(a.deselectedCells=l._selectedCells),l.cleanSelectionChange(a),l.performSelection(a)}isSelected(e){return e!=null&&e.id&&(e=e.id),Jt[typeof e]?this.selectedRows.some(r=>r.id===e):!1}isCellSelected(e,r){return e=this.normalizeCellContext(e),this.isCellSelectionMode&&this._selectedCells.some(l=>e.equals(l,!0))||r&&this.isSelected(e)}isSelectable(e){return this.normalizeCellContext({id:e.id||e}).isSelectable}get selectedRecord(){return this.selectedRecords[this.selectedRecords.length-1]||null}set selectedRecord(e){this.selectRow({record:e})}get selectedRecords(){return this.selectedRecordCollection.values}set selectedRecords(e){this.selectRows(e)}get selectedRows(){return[...this._selectedRows]}set selectedRows(e){this.selectRows(e)}spliceSelectedRecords(e,r,l){const o=this;if(typeof r=="number"){const s=[...o.selectedRecords];s.splice(e,r,...H.asArray(l)),o.performSelection(o.prepareSelection(null,s,!0,!0))}else o.performSelection(o.prepareSelection(r,l,!1,!0))}selectRow(e){(typeof e=="number"||e.isModel||!("record"in e))&&(e={records:[e]}),x.assignIf(e,{scrollIntoView:!0}),this.selectRows(e)}selectRows(e){(!e||Array.isArray(e)||e.isModel||typeof e=="number"||!("records"in e)&&!("record"in e))&&(e={records:H.asArray(e)||[]});const r=this,{store:l}=r,o=[],{records:s=e.record?[e.record]:[],column:n=r.columns.visibleColumns[0],scrollIntoView:a,addToSelection:d=arguments[1]}=e;for(let c of s)c=l.getById(c),c&&o.push(c);d||(r._shiftSelectRange=null),r.performSelection(r.prepareSelection(null,o,!d,!0)),o.length&&a&&r.scrollRowIntoView(o[0].id,{column:n})}selectAll(e=!1){const{store:r}=this,l=(r.isGrouped?r.allRecords:r.records).filter(o=>!o.isSpecialRow);this.performSelection(this.prepareSelection(null,l,!1,!0),!0,e)}deselectAll(e=!1,r=!1){const{store:l}=this,o=e?(l.isGrouped?l.allRecords:l.records).filter(s=>!s.isSpecialRow):null;this.performSelection(this.prepareSelection(o,null,!e),!0,r)}deselectRow(e){this.deselectRows(e)}deselectRows(e){const{store:r}=this,l=H.asArray(e).map(o=>r.getById(o)).filter(o=>o);this.performSelection(this.prepareSelection(l))}selectRange(e,r,l=!1){const o=this,{store:s}=o,n=o.internalSelectRange(s.getById(e),s.getById(r),!0);o._shiftSelectRange=null,o.performSelection(n)}get selectedCell(){return this._selectedCells[this._selectedCells.length-1]}set selectedCell(e){this.selectCells([e])}get selectedCells(){return[...this._selectedCells]}set selectedCells(e){this.selectCells(e)}get selectedCellCSSSelector(){const e=this.selectedCell,r=e&&this.getRowById(e.id);return!e||!r?"":`[data-index=${r.dataIndex}] [data-column-id=${e.columnId}]`}selectCell(e){var r;return"id"in e&&(e={cell:e},e=Object.assign({scrollIntoView:arguments[1],addToSelection:arguments[2],silent:arguments[3]},e)),(r=this.selectCells(e))==null?void 0:r[0]}selectCells(e){Array.isArray(e)&&(e={cells:e});const r=this,{cells:l=e.cell?[e.cell]:[],scrollIntoView:o=!0,addToSelection:s=!1,silent:n=!1}=e,a=r.prepareSelection(null,l,!s);return s||(r._shiftSelectRange=null),r.performSelection(a,!0,n),o&&r.scrollRowIntoView(l[0].id,{column:l[0].columnId}),r.isCellSelectionMode?a.selectedCells:a.selectedRecords}deselectCell(e){var r;return(r=this.deselectCells([e]))==null?void 0:r[0]}deselectCells(e){const r=this.prepareSelection(e);return this.performSelection(r),this.isCellSelectionMode?r.deselectedCells:r.deselectedRecords}toggleSelection(e){const r=this,{_focusedCell:l,selectionMode:o}=r,s=r.isRowNumberSelecting(l),n=r.isCellSelected(l,!0);if(o.selectOnKeyboardNavigation===!0||l.isActionable)return!1;r.performSelection(r.prepareSelection(n?l:null,n?null:l,!o.multiSelect,s)),e.preventDefault()}selectCellRange(e,r){this.performSelection(this.internalSelectRange(e,r))}getSelection(){return this.isRowSelectionMode?this.selectedRecords:this.selectedCells}cleanSelectionChange(e){var r,l;const{deselectedRecords:o,deselectedCells:s,selectedCells:n,deselectedCellRecords:a}=e,d=(r=e.selectedRecords)==null?void 0:r.map(u=>u.id),c=(l=e.selectedCellRecords)==null?void 0:l.map(u=>u.id);return o!=null&&o.length&&(d!=null&&d.length)&&(e.deselectedRecords=o.filter(u=>!d.includes(u.id))),s!=null&&s.length&&(n!=null&&n.length)&&(e.deselectedCells=s.filter(u=>!n.some(h=>u.equals(h,!0)))),a.length&&(c.length||d!=null&&d.length)&&(e.deselectedCellRecords=a.filter(u=>!c.includes(u.id)&&!d.includes(u.id))),e}getSelectedCellsForRecords(e){return this._selectedCells.filter(r=>r.id&&e.some(l=>l.id===r.id))}delayUntilMouseUp(e){const r=j.on({element:globalThis,blur:l=>e(l,r),mouseup:l=>e(l,r),thisObj:this,once:!0})}get isRowSelectionMode(){return!this.isCellSelectionMode}get isCellSelectionMode(){return this.selectionMode.cell===!0}isRowNumberSelecting(...e){return this.selectionMode.rowNumber&&!e.some(r=>r.column.type!=="rownumber")}selectionShouldIncludeChildren(e){var r;const{includeChildren:l,multiSelect:o}=this.selectionMode;return(l==="always"||l===!0&&this._isCheckboxSelecting)&&o&&!e.isLeaf&&((r=e.allChildren)==null?void 0:r.length)}extendSelectionLeft(){this.extendSelection("Left")}extendSelectionRight(){this.extendSelection("Right")}extendSelectionUp(){this.extendSelection("Up")}extendSelectionDown(){this.extendSelection("Down")}extendSelection(e){this._isKeyboardRangeSelecting=!0,this["navigate"+e](),this._isKeyboardRangeSelecting=!1}onCellNavigate(e,r,l,o){var s,n;const{selectionMode:a,_selectionListenersDetachers:d}=e,{multiSelect:c,deselectOnClick:u,dragSelect:h}=a,{ctrlKeyDown:g,shiftKeyDown:f}=D,p=D.isMouseDown(),v=D.isMouseDown(2),C=D.currentMouseDown||D.currentKeyDown;if(l=e.normalizeCellContext(l),e.selectionDisabled||!o||l.rowIndex===-1||(s=l.record)!=null&&s.isGroupHeader||C!=null&&C.fromKeyMap&&!a.selectOnKeyboardNavigation||e.columns.getById(l.columnId)===e.checkboxSelectionColumn||a.checkboxOnly||(C==null?void 0:C.handled)===!0)return;f||(e._isAddingToSelection=g&&c,e._selectionStartCell=l),c&&h&&p&&!d.selectiondrag&&!e.preventDragSelect&&(d.selectiondrag=j.on({name:"selectiondrag",element:e.selectionDragMouseEventListenerElement,blur:"onSelectionEnd",mouseup:{handler:"onSelectionEnd",element:globalThis},mousemove:"onSelectionDrag",thisObj:e})),e.preventDragSelect=!1;const b=e._selectionStartCell,w=e._isAddingToSelection;if((f&&p||e._isKeyboardRangeSelecting)&&b&&c)e.performSelection(e.internalSelectRange(b,l,e.isRowNumberSelecting(b,l)));else{let S=!1,y=!0,E;if(e.isCellSelected(l,!0)){if(v)return;if(w||u)E=u?null:[l],y=!1;else if(e.selectedRecords.length+(e.isCellSelectionMode?e._selectedCells.length:0)<=1)return;S=u||c}!E&&!w&&(E=null,h&&S&&d.selectiondrag&&(e._clearSelectionOnSelectionDrag=!0));const I=(A,G)=>{var U;if(G==null||G(),((U=A==null?void 0:A.target)==null?void 0:U.nodeType)===Node.ELEMENT_NODE){const _=new R(A.target);if(_!=null&&_.grid&&!_.equals(l,!0))return}f||(e._shiftSelectRange=null),e.performSelection(e.prepareSelection(E,y&&[l],E===null,y&&e.isRowNumberSelecting(l)))};if((n=e.features.rowReorder)!=null&&n.isDragging)return;S?e.delayUntilMouseUp(I):I()}}prepareSelection(e,r,l=!1,o=!1){const s=this,n=s._isSelectionDragging,{includeParents:a,selectRecordOnCell:d}=s.selectionMode,c=[],u=l?s._selectedCells:[],h=[],g=l?s._selectedRows:[],f=H.keyBy(g,"id",()=>1),p=l?s.selectedRecords.filter(C=>!f[C.id]):[];let v=[];if(!l&&e)for(const C of H.asArray(e)){const b=s.normalizeCellContext(C),w=(b==null?void 0:b.record)||(C.isModel?C:s.store.getById(b.id));if(!b.isSpecialRow&&(u.push(b),w&&!f[w.id]&&(n||s.isSelected(w)?(g.push(w),f[w.id]=1):d&&s.selectedRecordCollection.get(w.id)&&!p.some(S=>S.id===w.id)&&p.push(w),s.selectionShouldIncludeChildren(w))))for(const S of w.allChildren)!f[S.id]&&(n||s.isSelected(S))&&(g.push(S),f[w.id]=1)}if(r){const C={};for(const b of H.asArray(r)){const w=s.normalizeCellContext(b),S=(w==null?void 0:w.record)||(b.isModel?b:s.store.getById(w.id));if(!(!S||w.isSpecialRow)&&(s.isCellSelectionMode&&!o&&c.push(w),(s.isRowSelectionMode||o)&&!C[S.id]&&(h.push(S),C[S.id]=1,s.selectionShouldIncludeChildren(S))))for(const y of S.allChildren)C[y.id]||(h.push(y),C[y.id]=1)}d&&c.length&&(v=H.unique(c.map(b=>b.record)).filter(b=>!C[b.id]))}if(a&&(g.length||h.length)){const C=[...g,...h];H.unique(C.filter(w=>w.parent&&!w.allChildren.some(S=>C.includes(S))).map(w=>w.parent)).forEach(w=>s.toggleParentSelection(w,h,g))}return s.cleanSelectionChange({selectedCells:c,selectedRecords:h,deselectedCells:u,deselectedRecords:g,deselectAll:l,action:h!=null&&h.length||c!=null&&c.length?"select":"deselect",selectedCellRecords:v,deselectedCellRecords:p})}toggleParentSelection(e,r,l){if(!e||e.isRoot)return;const o=this.isSelected(e),s=r.includes(e),n=l.includes(e),a=d=>this.isSelected(d)&&!l.includes(d)||r.includes(d);this.selectionMode.includeParents==="some"?e.allChildren.some(a)?(!o||n)&&!s&&r.push(e):o&&!n&&l.push(e):o?!n&&!s&&e.allChildren.some(d=>l.includes(d))&&l.push(e):s||e.allChildren.every(a)&&r.push(e),e.parent&&this.toggleParentSelection(e.parent,r,l)}internalSelectRange(e,r,l=!1){const o=this,s=o.isRowSelectionMode||l,n=o.prepareSelection(o._shiftSelectRange,o.getRange(e,r,s),!1,l);return o._shiftSelectRange=n[`selected${s?"Records":"Cells"}`],n}getRange(e,r,l=!1){const o=this,{store:s}=o,n=o.normalizeCellContext(e),a=o.normalizeCellContext(r),d=Math.min(n.rowIndex,a.rowIndex),c=Math.max(n.rowIndex,a.rowIndex),u=[],h=Math.min(n.columnIndex,a.columnIndex),g=Math.max(n.columnIndex,a.columnIndex);if(d===-1||c===-1)throw new Error("Record not found in selectRange");if(l){const f=s.getRange(d,c+1,!1);a.rowIndex<n.rowIndex&&f.reverse(),u.push(...f)}else for(let f=d;f<=c;f++)for(let p=h;p<=g;p++)u.push({rowIndex:f,columnIndex:p});return u.map(f=>o.normalizeCellContext(f))}performSelection(e,r=!0,l=!1){const o=this,{selectedRecords:s=[],selectedCells:n=[],selectedCellRecords:a=[],deselectedRecords:d=[],deselectedCells:c=[],deselectedCellRecords:u=[],action:h}=e,g=[...s,...a],f=[...d,...u],p=o.isRowSelectionMode;if(o.trigger("beforeSelectionChange",{mode:p?"row":"cell",action:h,selected:g,deselected:f,selection:o.selectedRecords,selectedCells:n,deselectedCells:c,cellSelection:o.selectedCells})===!1)return!1;if(o._selectedCells===c)o._selectedCells=[];else{const v=[];for(const C of o._selectedCells)c.some(b=>C.equals(b,!0))||v.push(C);o._selectedCells=v}if(e.deselectedRecords=[...e.deselectedRecords],d===o._selectedRows)o.changeSelectedRecordCollectionSilent(v=>v.clear()),o._selectedRows.length=0;else{const v=[],C=[],b=H.keyBy(f,"id",()=>1);for(const w of o.selectedRecords)b[w.id]||(o.isSelected(w)?v.push(w):C.push(w));o.changeSelectedRecordCollectionSilent(w=>w.values=[...v,...C]),o._selectedRows=v}if(n.length)for(const v of n)o._selectedCells.some(C=>C.equals(v,!0))||o._selectedCells.push(v);s.length&&(o.changeSelectedRecordCollectionSilent(v=>v.add(...s)),o._selectedRows.push(...s.filter(v=>!o._selectedRows.some(C=>C.id===v.id)))),a.length&&o.changeSelectedRecordCollectionSilent(v=>v.add(...a)),r&&o.refreshGridSelectionUI(e),o.afterSelectionChange(e),l||o.triggerSelectionChangeEvent(e)}refreshGridSelectionUI({selectedRecords:e,selectedCells:r,deselectedRecords:l,deselectedCells:o}){const s=this,{checkboxSelectionColumn:n}=s;n==null||n.suspendEvents(),s.updateGridSelectionRecords(e,!0),s.updateGridSelectionRecords(l,!1),s.updateCheckboxHeader(),n==null||n.resumeEvents(),s.isCellSelectionMode&&(s.updateGridSelectionCells(r,!0),s.selectionMode.column&&s.updateGridSelectionColumns(r)),s.updateGridSelectionCells(o,!1)}updateGridSelectionRecords(e,r){const{checkboxSelectionColumn:l}=this;if(e!=null&&e.length)for(let o=0;o<e.length;o++){const s=this.getRowFor(e[o]);s&&(s.toggleCls("b-selected",r),s.setAttribute("aria-selected",r),l&&!l.hidden&&!e[o].isSpecialRow&&(s.getCell(l.id).widget.checked=r))}}updateGridSelectionCells(e,r){if(e!=null&&e.length)for(let l=0;l<e.length;l++){const o=this.getCell(e[l]);o&&(o.setAttribute("aria-selected",r),o.classList.toggle("b-selected",r))}}updateGridSelectionColumns(e){var r;const{count:l}=this.store;for(const o of this.columns.visibleColumns)(r=o.element)==null||r.classList.toggle("b-selected",(e==null?void 0:e.filter(s=>s.columnId===o.id).length)===l)}triggerSelectionChangeEvent(e){const{selectedRecords:r=[],selectedCells:l=[],selectedCellRecords:o=[],deselectedRecords:s=[],deselectedCells:n=[],deselectedCellRecords:a=[]}=e,d=[...r,...o],c=[...s,...a],u=this.isRowSelectionMode;this.trigger("selectionChange",{mode:u?"row":"cell",action:e.action,selected:d,deselected:c,selection:this.selectedRecords,selectedCells:l,deselectedCells:n,cellSelection:this.selectedCells})}doDestroy(){var e;((e=this.selectedRecordCollection)==null?void 0:e.owner)===this&&this.selectedRecordCollection.destroy(),this._selectedCells.length=0,this._selectedRows.length=0;for(const r in this._selectionListenersDetachers)this._selectionListenersDetachers[r]();super.doDestroy()}get widgetClass(){}},F(t,"configurable",{selectionMode:{cell:!1,multiSelect:!0,checkboxOnly:!1,checkbox:!1,checkboxPosition:null,showCheckAll:!1,deselectFilteredOutRecords:!1,includeChildren:!1,includeParents:!1,preserveSelectionOnPageChange:!1,preserveSelectionOnDatasetChange:!0,deselectOnClick:!1,dragSelect:!1,selectOnKeyboardNavigation:!0,column:!1,rowNumber:!1,selectRecordOnCell:!0},keyMap:{"Shift+ArrowUp":"extendSelectionUp","Shift+ArrowDown":"extendSelectionDown","Shift+ArrowLeft":"extendSelectionLeft","Shift+ArrowRight":"extendSelectionRight"," ":{handler:"toggleSelection",weight:10}},selectedRecordCollection:{},selectionDisabled:!1}),t},Zt=i=>i.columns.suspendEvents(),ei=i=>i.columns.resumeEvents(),ti=i=>{i.columns.clearCaches(),i.columns.fillFromMaster()},ze=(i,t)=>i.stateSortIndex-t.stateSortIndex,dt=i=>class extends(i||z){static get $name(){return"GridState"}static get configurable(){return{statefulEvents:["subGridCollapse","subGridExpand","horizontalScrollEnd","stateChange"]}}updateStore(e,r){var l;(l=super.updateStore)==null||l.call(this,e,r),this.detachListeners("stateStoreListeners"),e==null||e.ion({name:"stateStoreListeners",filter:"triggerUpdate",group:"triggerUpdate",sort:"triggerUpdate",thisObj:this})}updateColumns(e,r){var l;(l=super.updateColumns)==null||l.call(this,e,r),this.detachListeners("stateColumnListeners"),e.ion({name:"stateColumnListeners",change:"triggerUpdate",thisObj:this})}updateRowManager(e,r){var l;(l=super.updateRowManager)==null||l.call(this,e,r),this.detachListeners("stateRowManagerListeners"),e.ion({name:"stateRowManagerListeners",rowHeight:"triggerUpdate",thisObj:this})}triggerUpdate(){this.trigger("stateChange")}finalizeInit(){super.finalizeInit(),this.ion({selectionChange:"triggerUpdate",thisObj:this})}getState(){const e=this,r=e.element.style.cssText,l={rowHeight:e.rowHeight};if(r&&(l.style=r),e.selectedCell){const{id:o,columnId:s}=e.selectedCell;l.selectedCell={id:o,columnId:s}}return l.selectedRecords=e.selectedRecords.map(o=>o.id),l.columns=e.columns.allRecords.map(o=>o.getState()),l.store=e.store.state,l.scroll=e.storeScroll(),l.subGrids={},e.eachSubGrid(o=>{var s;const n=l.subGrids[o.region]=l.subGrids[o.region]||{};o.isPainted?o.flex==null&&(n.width=o.width):o.config.width!=null?n.width=o.config.width:n.flex=o.config.flex,n.collapsed=(s=o.collapsed)!=null?s:!1,n.collapsed&&(n._beforeCollapseState=o._beforeCollapseState)}),l}applyState(e){const r=this;if(r.suspendRefresh(),"columns"in e){let l=!1,o=!1;r.columns.suspendEvents(),r.eachSubGrid(Zt),e.columns.forEach((s,n)=>{const a=r.columns.getById(s.id);if(a){const d=a.generation;"region"in s&&!(s.region in r.subGrids)&&(delete s.region,delete s.locked),a.applyState(s),l=l||a.generation!==d,a.stateSortIndex=n,a.allIndex!==n&&(o=l=!0)}}),l&&r.eachSubGrid(ti),o&&(r.eachSubGrid(s=>{s.columns.records.sort(ze),s.columns.allRecords.sort(ze)}),r.columns.sort({fn:ze,ascending:!0})),r.isPainted&&l&&r.renderContents(),r.columns.resumeEvents(),r.eachSubGrid(ei)}"subGrids"in e&&r.eachSubGrid(l=>{if(l.region in e.subGrids){const o=e.subGrids[l.region];"width"in o?l.width=o.width:"flex"in o&&(l.flex=o.flex),"collapsed"in o&&(l.collapsed=o.collapsed,l._beforeCollapseState=o._beforeCollapseState)}l.clearWidthCache()}),"rowHeight"in e&&(r.rowHeight=e.rowHeight),"style"in e&&(r.style=e.style),"selectedCell"in e&&(r.selectedCell=e.selectedCell),"store"in e&&(r.store.state=e.store),"selectedRecords"in e&&(r.selectedRecords=e.selectedRecords),r.resumeRefresh(!0),r.whenVisible(()=>r.applyScrollState(e))}applyScrollState(e){const r=this;r.eachSubGrid(l=>l.refreshFakeScroll()),"scroll"in e&&(r.restoreScroll(e.scroll),e.scroll.scrollTop&&r.element.querySelectorAll(".b-resize-monitored").forEach(l=>{const o=be.fromElement(l);o&&o.onElementResize(l)}))}get widgetClass(){}},ii=Promise.resolve(),ri={block:"nearest"},je=class extends De{updateYScroller(i){i==null||i.addScroller(this)}scrollIntoView(i,t=ri){const e=this,{xDelta:r,yDelta:l}=e.getDeltaTo(i,t);let o=r||l?e.scrollBy(r,l,t):ii;if(t.highlight||t.focus){const s=o;o=o.then(()=>{var n,a;s.cancelled||(i=i instanceof M?i:(a=(n=t.elementAfterScroll)==null?void 0:n.call(t))!=null?a:i,t.highlight&&(i instanceof M?i.translate(-r,-l).highlight():m.highlight(i)),t.focus&&m.focusWithoutScrolling(i))}),o.cancel=()=>{var n;return(n=s.cancel)==null?void 0:n.call(s)}}return o}scrollBy(i,t,e){const r=t&&this.yScroller.scrollBy(0,t,e),l=i&&super.scrollBy(i,0,e),o=Promise.all([l,r]);return o.cancel=()=>{var s,n;(s=l==null?void 0:l.cancel)==null||s.call(l),(n=r==null?void 0:r.cancel)==null||n.call(r),o.cancelled=!0},l!=null&&l.cancel&&(r!=null&&r.cancel)&&(e.force=!0),o}scrollTo(i,t,e){const r=t!=null&&this.yScroller.scrollTo(null,t,e),l=i!=null&&super.scrollTo(i,null,e);e&&e.animate||this.syncPartners();const o=Promise.all([l,r]);return o.cancel=()=>{var s,n;(s=l==null?void 0:l.cancel)==null||s.call(l),(n=r==null?void 0:r.cancel)==null||n.call(r),o.cancelled=!0},l!=null&&l.cancel&&(r!=null&&r.cancel)&&(e.force=!0),o}get viewport(){const i=M.from(this.element);return i.intersect(M.from(this.yScroller.element))||new M(i.x,i.y,i.width,0)}set y(i){this.yScroller&&(this.yScroller.y=i)}get y(){return this.yScroller?this.yScroller.y:0}get maxY(){return this.yScroller?this.yScroller.maxY:0}get scrollHeight(){return this.yScroller?this.yScroller.scrollHeight:0}get clientHeight(){return this.yScroller?this.yScroller.clientHeight:0}suspendEvents(){var i;super.suspendEvents(),(i=this.yScroller)==null||i.suspendEvents()}resumeEvents(){var i;super.resumeEvents(),(i=this.yScroller)==null||i.resumeEvents()}};F(je,"configurable",{propagate:!1,overflowX:"hidden-scroll",yScroller:null}),je._$name="SubGridScroller";var ct=(i,t)=>i+t.getBoundingClientRect().width,re=class extends J{static get $name(){return"SubGrid"}static get type(){return"subgrid"}static get defaultConfig(){return{insertRowsBefore:null,appendTo:null,monitorResize:!0,headerClass:null,footerClass:null,weight:null,collapsed:null,scrollable:{overflowX:"hidden-scroll"},scrollerClass:je,hasCalculatedWidth:null,sealedColumns:null}}static get configurable(){return{element:!0,header:{},footer:{},virtualScrollerElement:!0,splitterElement:!0,headerSplitter:!0,scrollerSplitter:!0,footerSplitter:!0,resizable:null,role:"presentation"}}construct(i){const t=this;if(super.construct(i),this.rowManager.ion({addRows:"onAddRow",thisObj:this}),k.isFirefox){const{element:e}=t,r=t.grid.scrollable;let l=0;e.addEventListener("wheel",({ctrlKey:o,deltaY:s,deltaX:n})=>{const a=Math.abs(s)>Math.abs(n);!o&&a&&!t.scrollEndDetacher&&r.y!==l&&(e.style.pointerEvents="none",l=r.y,t.scrollEndDetacher=r.ion({scrollEnd:async()=>{l=r.y,e.style.pointerEvents="",t.scrollEndDetacher=null},once:!0}))})}$.isTestEnv&&(t.hideOverlayScroller.delay=50)}doDestroy(){var i;const t=this;t.header.destroy(),t.footer.destroy(),(i=t.fakeScroller)==null||i.destroy(),t.virtualScrollerElement.remove(),t.splitterElements.forEach(e=>e.remove()),super.doDestroy()}get barConfig(){const i=this,{width:t,flex:e}=i.element.style,r={subGrid:i,parent:i,maxWidth:i.maxWidth||void 0,minWidth:i.minWidth||void 0};return e?r.flex=e:t&&(r.width=t),r}changeHeader(i){return new this.headerClass(x.assign({id:this.id+"-header"},this.barConfig,i))}changeFooter(i){return new this.footerClass(x.assign({id:this.id+"-footer"},this.barConfig,i))}get splitterElements(){return[this.splitterElement,this.headerSplitter,this.scrollerSplitter,this.footerSplitter]}toggleSplitterCls(i,t=!0){this.splitterElements.forEach(e=>e==null?void 0:e.classList[t?"add":"remove"](i))}hideSplitter(){this.splitterElements.forEach(i=>i.classList.add("b-hide-display")),this.$showingSplitter=!1}showSplitter(){this.splitterElements.forEach(i=>i.classList.remove("b-hide-display")),this.$showingSplitter=!0}changeElement(i,t){const{region:e}=this;return super.changeElement({"aria-label":e,className:{"b-grid-subgrid":1,[`b-grid-subgrid-${e}`]:e,"b-grid-subgrid-collapsed":this.collapsed},dataset:{region:e}},t)}get rowElementConfig(){const{grid:i}=this;return{role:"row",className:i.rowCls,children:this.columns.visibleColumns.map((t,e)=>({role:"gridcell","aria-colindex":e+1,tabIndex:i.cellTabIndex,className:"b-grid-cell",dataset:{column:t.field||"",columnId:t.id}}))}}changeVirtualScrollerElement(){const i=m.createElement({role:"presentation",reference:"virtualScrollerElement",className:"b-virtual-scroller",tabIndex:-1,dataset:{region:this.region},children:[{reference:"virtualScrollerWidth",className:"b-virtual-width"}]});return this.virtualScrollerWidth=i.virtualScrollerWidth,i.virtualScrollerElement}changeSplitterElement(){const i=m.createElement({reference:"splitterElement",className:{"b-grid-splitter":1,"b-grid-splitter-collapsed":this.collapsed,"b-hide-display":1},dataset:{region:this.region},children:[k.isTouchDevice?{className:"b-splitter-touch-area"}:null,{className:"b-grid-splitter-inner b-grid-splitter-main",children:[{className:"b-grid-splitter-buttons",reference:"splitterButtons",children:[{className:"b-grid-splitter-button-collapse",children:[k.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",className:"b-grid-splitter-button-icon b-gridregion-collapse-arrow",viewBox:"0 0 256 512",children:[{tag:"path",d:"M192 448c-8.188 0-16.38-3.125-22.62-9.375l-160-160c-12.5-12.5-12.5-32.75 0-45.25l160-160c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25L77.25 256l137.4 137.4c12.5 12.5 12.5 32.75 0 45.25C208.4 444.9 200.2 448 192 448z"}]}]},{className:"b-grid-splitter-button-expand",children:[k.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",className:"b-grid-splitter-button-icon b-gridregion-expand-arrow",viewBox:"0 0 256 512",children:[{tag:"path",d:"M64 448c-8.188 0-16.38-3.125-22.62-9.375c-12.5-12.5-12.5-32.75 0-45.25L178.8 256L41.38 118.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0l160 160c12.5 12.5 12.5 32.75 0 45.25l-160 160C80.38 444.9 72.19 448 64 448z"}]}]}]}]}]});return this.splitterButtons=i.splitterButtons,i.splitterElement}get splitterConfig(){return{className:this.splitterElement.className.trim(),children:[k.isTouchDevice?{className:"b-splitter-touch-area"}:null,{className:"b-grid-splitter-inner"}],dataset:{region:this.region}}}changeHeaderSplitter(){return m.createElement(this.splitterConfig)}changeScrollerSplitter(){return m.createElement(this.splitterConfig)}changeFooterSplitter(){return m.createElement(this.splitterConfig)}render(...i){const t=this;super.render(...i),t.grid&&(t.updateHasFlex(),t.element.parentNode.insertBefore(t.splitterElement,t.element.nextElementSibling),t.splitterElements.forEach(e=>j.on({element:e,mouseenter:"onSplitterMouseEnter",mouseleave:"onSplitterMouseLeave",thisObj:t})),t._collapsed&&t.collapse())}toggleHeaders(i){const t=this;if(i)t.headerSplitter.remove(),t.header.element.remove(),t.scrollable.removePartner(t.header.scrollable,"x");else{const{grid:e}=t;if(!t.isConfiguring){const r=e.items.indexOf(t)*2;m.insertAt(e.headerContainer,t.headerSplitter,r),m.insertAt(e.headerContainer,t.header.element,r),t.refreshHeader()}t.scrollable.addPartner(t.header.scrollable,"x")}}refreshHeader(){this.header.refreshContent()}refreshColumnHeader(i){this.header.refreshColumn(i)}refreshFooter(){var i;(i=this.footer)==null||i.refreshContent()}eachWidget(i,t=!0){const e=this,r=[e.header,e.footer];for(let l=0;l<r.length;l++){const o=r[l];if(i(o)===!1)return;t&&o.eachWidget&&o.eachWidget(i,t)}}fixCellWidths(i){const{visibleColumns:t}=this.columns;let e=i.firstElementChild,r=0;for(;e;){const l=t[r],{element:o}=l;l.minWidth&&(e.style.minWidth=m.setLength(l.minWidth)),l.maxWidth&&(e.style.maxWidth=m.setLength(l.maxWidth)),l.flex?l.childLevel&&o?(e.style.flex=`0 0 ${o.getBoundingClientRect().width}px`,e.style.width=""):(e.style.flex=l.flex,e.style.width=""):l.width?e.style.width=m.setLength(l.width):e.style.flex=e.style.width=e.style.minWidth="",e=e.nextElementSibling,r++}}get totalFixedWidth(){return this.columns.totalFixedWidth}get headerScrollWidth(){return[...this.header.contentElement.children].reduce(ct,0)||this.columns.totalFixedWidth}fixWidths(){const i=this,{element:t,header:e,footer:r}=i;if(!i.collapsed){if(i.flex)e.flex=i.flex,r&&(r.flex=i.flex),t.style.flex=i.flex;else{if(i.hasCalculatedWidth&&!i.columns.some(o=>!o.hidden&&o.flex)&&i.totalFixedWidth!==i.width){i.width=i.totalFixedWidth,i.hasCalculatedWidth=!0;return}let l=i.width;if(!l&&i.hasCalculatedWidth){l=0;for(const o of i.columns)!o.flex&&!o.hidden&&(l+=o.width)}t.style.width=`${l}px`,e.width=l,r&&(r.width=l)}i.handleHorizontalScroll(!1)}}fixRowWidthsInSafariEdge(){if(k.isSafari){const i=this,{region:t,header:e}=i,r=e.calculateMinWidthForSafari();i.rowManager.forEach(l=>{const o=l.getElement(t);o&&(o.style.width=`${r}px`)}),e.headersElement.style.width=`${r}px`}}set width(i){var t,e;const r=this;r.hasCalculatedWidth=!1,super.width=i,r.header.width=i,r.footer.width=i,r.isPainted&&r.onElementResize(),!r.isExpanding&&!r.isCollapsing&&!r.isConfiguring&&((e=(t=r.grid).syncSplits)==null||e.call(t,l=>l.subGrids[r.region]&&(l.subGrids[r.region].width=i)))}get width(){return super.width}set flex(i){var t,e;const r=this;r.hasCalculatedWidth=!1,r.header.flex=i,r.footer.flex=i,super.flex=i,r.isPainted&&r.onElementResize(),!r.isExpanding&&!r.isCollapsing&&!r.isConfiguring&&((e=(t=r.grid).syncSplits)==null||e.call(t,l=>l.subGrids[r.region]&&(l.subGrids[r.region].flex=i)))}get flex(){return super.flex}onInternalResize(i,t,e,r,l){const o=this,{grid:s}=o;super.onInternalResize(...arguments),s!=null&&s.isPainted&&(o.syncSplitterButtonPosition(),t!==r&&(o.trigger("beforeInternalResize",o),s.trigger("horizontalScroll",{grid:s,subGrid:o,scrollLeft:o.scrollable.scrollLeft,scrollX:o.scrollable.x}),s.trigger("horizontalScrollEnd",{subGrid:o}),o.fakeScroller&&o.refreshFakeScroll(),s.syncFlexedSubCols(),o.fixRowWidthsInSafariEdge()),e!==l&&s.onHeightChange(),o.trigger("afterInternalResize",o))}syncParallelSplitters(i){const t=this,{grid:e}=t;if(t.splitterElement&&t.$showingSplitter)t.toggleSplitterCls("b-grid-splitter-collapsed",i);else{const r=e.getSubGrid(e.getPreviousRegion(t.region));r&&r.splitterElement&&r.syncParallelSplitters(i)}}onSplitterMouseEnter(){const i=this,{nextSibling:t}=i;!i.collapsed&&(!t||!t.collapsed)&&i.toggleSplitterCls("b-hover"),i.startSplitterButtonSyncing()}onSplitterMouseLeave(){const i=this,{nextSibling:t}=i;i.toggleSplitterCls("b-hover",!1),!i.collapsed&&(!t||!t.collapsed)&&i.stopSplitterButtonSyncing()}startSplitterButtonSyncing(){const i=this;i.splitterElement&&(i.syncSplitterButtonPosition(),i.splitterSyncScrollListener||(i.splitterSyncScrollListener=i.grid.scrollable.ion({scroll:"syncSplitterButtonPosition",thisObj:i})))}stopSplitterButtonSyncing(){this.splitterSyncScrollListener&&(this.splitterSyncScrollListener(),this.splitterSyncScrollListener=null)}syncSplitterButtonPosition(){const{grid:i}=this;this.splitterButtons.style.top=`${i.scrollable.y+(i.bodyHeight-(this.headerSplitter?i.headerHeight:0))/2}px`}get viewRectangle(){const{scrollable:i}=this;return new M(i.x,i.y,this.width||0,this.rowManager.viewHeight)}updateHasFlex(){this.scrollable.element.classList.toggle("b-has-flex",this.columns.hasFlex)}updateResizable(i){this.splitterElements.forEach(t=>m.toggleClasses(t,["b-disabled"],!i))}resizeColumnsToFitContent(){this.grid.beginGridMeasuring(),this.columns.visibleColumns.forEach(i=>{i.resizeToFitContent(null,null,!0)}),this.grid.endGridMeasuring()}get overflowingHorizontally(){return!this.collapsed&&(this.hideHeaders?this.scrollable.hasOverflow("x"):this.header.scrollable.hasOverflow("x"))}get overflowingVertically(){return!1}refreshFakeScroll(){const i=this,{element:t,virtualScrollerElement:e,virtualScrollerWidth:r,header:l,footer:o,scrollable:s}=i,n=[...l.contentElement.children].reduce(ct,0);s.scrollWidth=n,t.style.setProperty("--total-column-width",`${i.headerScrollWidth}px`),e.style.width=t.style.width,e.style.flex=t.style.flex,e.style.minWidth=t.style.minWidth,e.style.maxWidth=t.style.maxWidth,l.scrollable.syncOverflowState(),o.scrollable.syncOverflowState(),i.collapsed||(i.overflowingHorizontally?(r.style.width=`${s.scrollWidth||0}px`,i.grid.virtualScrollers.classList.remove("b-hide-display")):r.style.width=0)}initScroll(){const i=this,{scrollable:t,virtualScrollerElement:e,grid:r}=i;k.isFirefox&&t.element.addEventListener("wheel",l=>{l.deltaX&&(t.x+=l.deltaX,l.preventDefault())}),i.fakeScroller=new De({element:e,overflowX:!0,widget:i}),t.ion({scroll:"onSubGridScroll",scrollend:"onSubGridScrollEnd",thisObj:i}),r.hideHorizontalScrollbar||(t.addPartner(i.fakeScroller,"x"),i.refreshFakeScroll()),r.hideHeaders||t.addPartner(i.header.scrollable,"x"),r.hideFooters||t.addPartner(i.footer.scrollable,"x")}onSubGridScrollEnd(i){const t=this,{grid:e}=t;t.scrollingToCenter=i==null?void 0:i.scrollingToCenter,t.scrolling=!1,t.handleHorizontalScroll(!1),m.scrollBarWidth||(e.virtualScrollers.classList.remove("b-scrolling"),t.hideOverlayScroller()),e.trigger("horizontalScrollEnd",{subGrid:t})}onSubGridScroll(i){const t=this;t.scrollingToCenter=i==null?void 0:i.scrollingToCenter,t.handleHorizontalScroll()}showOverlayScroller(){this.hideOverlayScroller.cancel(),this.virtualScrollerElement.classList.add("b-show-virtual-scroller")}hideOverlayScroller(){this.virtualScrollerElement.classList.remove("b-show-virtual-scroller")}set scrolling(i){this._scrolling=i}get scrolling(){return this._scrolling}handleHorizontalScroll(i=!0){const t=this,{grid:e}=t;!t.scrolling&&i&&(t.scrolling=!0,m.scrollBarWidth||(e.virtualScrollers.classList.add("b-scrolling"),t.showOverlayScroller())),e.trigger("horizontalScroll",{subGrid:t,grid:e,scrollLeft:t.scrollable.scrollLeft,scrollX:t.scrollable.x,scrollingToCenter:t==null?void 0:t.scrollingToCenter})}scrollColumnIntoView(i,t){const{columns:e,header:r}=this,l=r.scrollable;if(i=i instanceof O?i:e.get(i)||e.getById(i)||e.getAt(i),i){const o=r.getHeader(i.id);if(o)return l.scrollIntoView(M.from(o,null,!0),t)}}onAddRow({source:i=this.grid.rowManager,rows:t,isExport:e}){var r;const l=this,{region:o}=l,s=l.rowElementConfig,n=document.createDocumentFragment(),a=(r=i.rows[t[t.length-1].index+1])==null?void 0:r.elements[o];t.forEach(d=>{const c=m.createElement(s);m.syncClassList(c,d.cls),n.appendChild(c),d.addElement(o,c),l.fixCellWidths(c)}),e||(l.fixRowWidthsInSafariEdge(),l.element.insertBefore(n,a||l.insertRowsBefore))}get rowElements(){return this.fromCache(".b-grid-row",!0)}clearRows(){this.emptyCache();const i=this.element.querySelectorAll(".b-grid-row"),t=document.createRange();i.length&&(t.setStartBefore(i[0]),t.setEndAfter(i[i.length-1]),t.deleteContents())}addNewRowElement(){const i=m.append(this.element,this.rowElementConfig);return this.fixCellWidths(i),i}get store(){return this.grid.store}get rowManager(){var i;return(i=this.grid)==null?void 0:i.rowManager}toggleTransitionClasses(i=!1){const t=this,e=t.grid,r=e.getSubGrid(e.getNextRegion(t.region)),l=e.resolveSplitter(r);r.element.classList[i?"remove":"add"]("b-grid-subgrid-animate-collapse"),r.header.element.classList[i?"remove":"add"]("b-grid-subgrid-animate-collapse"),t.element.classList[i?"remove":"add"]("b-grid-subgrid-animate-collapse"),t.header.element.classList[i?"remove":"add"]("b-grid-subgrid-animate-collapse"),l.classList[i?"remove":"add"]("b-grid-splitter-animate")}get collapsed(){return this._collapsed}set collapsed(i){this.isConfiguring?this._collapsed=i:i?this.collapse():this.expand()}async collapse(){var i;const t=this,{grid:e,element:r}=t,l=e.getSubGrid(e.getNextRegion(t.region)),o=t.splitterElement?t:t.previousSibling;let{_beforeCollapseState:s}=t,n=0;if(!(e.rendered&&t._collapsed===!0)){if(t.isCollapsing=!0,e.eachSubGrid(a=>{a!==t&&!a._collapsed&&++n}),(i=e.syncSplits)==null||i.call(e,a=>{var d;return(d=a.subGrids[t.region])==null?void 0:d.collapse()}),n===0){if(!l)return;await l.expand()}return new Promise(a=>{if(s)a();else{s=t._beforeCollapseState={};let d=!1;t.width&&(d=!0,t.ion({afterinternalresize:()=>{a(t)},thisObj:t,once:!0})),s.width=t.width,s.elementWidth=r.style.width,l.element.style.flex===""&&(s.nextRegionWidth=l.width,l.width="",l.flex="1"),r.style.flex!==""&&(s.flex=r.style.flex,t.header.element.style.flex=r.style.flex=""),r.classList.add("b-grid-subgrid-collapsed"),t.virtualScrollerElement.classList.add("b-collapsed"),t.header.element.classList.add("b-collapsed"),t.footer.element.classList.add("b-collapsed"),t._collapsed=!0,t.width="",d||(t.syncParallelSplitters(!0),a(!1))}e.trigger("subGridCollapse",{subGrid:t}),e.afterToggleSubGrid({subGrid:t,collapsed:!0}),t.isCollapsing=!1}).then(a=>{var d;t.isDestroyed||a!==!1&&(e.refreshVirtualScrollbars(),t.syncParallelSplitters(!0),(d=o.startSplitterButtonSyncing)==null||d.call(o))})}}async expand(){var i;const t=this,{grid:e,_beforeCollapseState:r}=t,l=e.getSubGrid(e.getNextRegion(t.region)),o=t.splitterElement?t:t.previousSibling;if(!(e.rendered&&t._collapsed!==!0))return t.isExpanding=!0,(i=e.syncSplits)==null||i.call(e,s=>{var n;return(n=s.subGrids[t.region])==null?void 0:n.expand()}),new Promise(s=>{if(r!=null){let n=!1;t.width!==r.elementWidth&&(n=!0,t.ion({afterinternalresize(){t.setTimeout(()=>s(t),10)},thisObj:t,once:!0})),r.nextRegionWidth&&(l.width=r.nextRegionWidth,l.flex=null),t.element.classList.remove("b-grid-subgrid-collapsed"),t._collapsed=!1,t.virtualScrollerElement.classList.remove("b-collapsed"),t.header.element.classList.remove("b-collapsed"),t.footer.element.classList.remove("b-collapsed"),r.flex?(t.width=r.width,t.header.flex=t.flex=r.flex,t.footer.flex=r.flex,t._width=null):t.width=r.elementWidth,t.element.classList.remove("b-grid-subgrid-collapsed"),t._collapsed=!1,n?(o.stopSplitterButtonSyncing(),t.syncParallelSplitters(!1)):s(!1),delete t._beforeCollapseState}else s();e.trigger("subGridExpand",{subGrid:t}),e.afterToggleSubGrid({subGrid:t,collapsed:!1}),t.isExpanding=!1})}hide(){var i,t;return(i=this.header)==null||i.hide(),(t=this.footer)==null||t.hide(),this.hideSplitter(),super.hide()}show(){var i,t;const e=this;return(i=e.header)==null||i.show(),(t=e.footer)==null||t.show(),e.region!==e.grid.regions[e.grid.regions.length-1]&&e.showSplitter(),super.show()}};F(re,"delayable",{hideOverlayScroller:1e3}),re.initClass(),re._$name="SubGrid";var ut=i=>class extends(i||z){static get $name(){return"GridSubGrids"}static get properties(){return{subGrids:{}}}changeSubGridConfigs(e){const r=this,l=new Set;for(const o of r.columns){const{region:s}=o;s&&(e[s]||(e[s]={}),l.add(s))}e.normal&&x.isEmpty(e.normal)&&(e.normal={flex:1});for(const o of l)r.createSubGrid(o,e[o]);return r.items=r.subGrids,e}createSubGrid(e,r=null){const l=this,o=l.columns.makeChained(d=>d.region===e,["region"]),s=x.assign({type:"subgrid",id:`${l.id}-${e}Subgrid`,parent:l,grid:l,region:e,headerClass:l.headerClass,footerClass:l.footerClass,columns:o,weight:e,scrollable:{yScroller:l.scrollable}},r||l.subGridConfigs[e]);let n=!1;!s.flex&&!s.width&&(s.width=o.totalFixedWidth,n=!0);const a=l.subGrids[e]=re.create(s);return a.element.style.setProperty("--total-column-width",o.totalFixedWidth),a.hasCalculatedWidth=n,e===l.regions[0]&&(a.isFirstRegion=!0),a}onChildAdd(e){if(e.isSubGrid){const r=this,{items:l,headerContainer:o,virtualScrollers:s,footerContainer:n}=r,a=l.indexOf(e)*2;(!r.hideHeaders||r.columns.some(d=>d.flex))&&(m.insertAt(o,e.headerSplitter,a),m.insertAt(o,e.header.element,a)),m.insertAt(s,e.scrollerSplitter,a),m.insertAt(s,e.virtualScrollerElement,a),m.insertAt(n,e.footerSplitter,a),m.insertAt(n,e.footer.element,a),l.forEach((d,c)=>{c<l.length-1&&d.showSplitter()}),a===0&&r.emptyTextEl&&e.element.appendChild(r.emptyTextEl)}return super.onChildAdd(e)}onChildRemove(e){if(super.onChildRemove(e),e.isSubGrid){const{items:r}=this;delete this.subGrids[e.region],H.remove(this.regions,e.region),e.destroy(),r.length&&r[r.length-1].hideSplitter()}}doDestroy(){this.eachSubGrid(e=>e.destroy()),super.doDestroy()}eachSubGrid(e,r=null){this.items.forEach((l,o)=>{l.isSubGrid&&e.call(r||l,l,o++)})}callEachSubGrid(e,...r){let l=null;return this.items.forEach((o,s)=>{if(o.isSubGrid&&o[e]){const n=o[e](...r);s===0&&(l=n)}}),l}get regions(){return this.items.map(e=>e.region)}getLastRegions(){const e=this.regions.slice(-2);return e.length===2?e:[e[0],e[0]]}getNextRegion(e){const r=this.regions;return r[r.indexOf(e)+1]||r[r.length-2]}getPreviousRegion(e){return this.regions[this.regions.indexOf(e)-1]}getSubGrid(e){return this.subGrids[e]}getSubGridFromColumn(e){return e=e instanceof O?e:this.columns.getById(e)||this.columns.get(e),this.getSubGrid(e.region)}resolveSplitter(e){const r=this.getLastRegions();let l=e instanceof re?e.region:e;return r[1]===l&&(l=r[0]),this.subGrids[l].splitterElement}get widgetClass(){}},li={x:1},ht=i=>i.isSubGrid,gt=class extends De{addScroller(i){(this.xScrollers||(this.xScrollers=[])).push(i)}addPartner(i,t=li){if(typeof t=="string"&&(t={[t]:1}),t.x){i.owner.initScroll();const e=this.widget.items.filter(ht),r=i.widget.items.filter(ht);for(let l=0,{length:o}=e;l<o;l++)e[l].scrollable.addPartner(r[l].scrollable,"x")}t.y&&super.addPartner(i,"y")}removePartner(i){this.xScrollers.forEach((t,e)=>{t.isDestroyed||t.removePartner(i.xScrollers[e])}),super.removePartner(i)}updateOverflowX(i){var t;const e=i===!1;(t=this.xScrollers)==null||t.forEach(r=>r.overflowX=e?"hidden":"hidden-scroll"),this.widget.virtualScrollers.classList.toggle("b-hide-display",e)}scrollIntoView(i,t){if(i.nodeType===Element.ELEMENT_NODE&&this.element.contains(i)){for(const e of this.xScrollers)if(e.element.contains(i))return e.scrollIntoView(i,t)}else return super.scrollIntoView(i,t)}hasOverflow(i="y"){return i==="y"?this.scrollHeight>this.clientHeight:!1}set x(i){this.xScrollers&&(this.xScrollers[0].x=i)}get x(){return this.xScrollers?this.xScrollers[0].x:0}};gt._$name="GridScroller";var oi=Object.freeze({}),si=Object.freeze({x:!1,y:!1}),ni=function(i){return this.focusableFinderCell.contains(i)?m.isFocusable(i)&&!i.disabled?m.NodeFilter.FILTER_ACCEPT:m.NodeFilter.FILTER_SKIP:m.NodeFilter.FILTER_REJECT},ai=i=>{var t;return t=class extends(i||z){static get $name(){return"GridNavigation"}onStoreRecordIdChange(e){var r;(r=super.onStoreRecordIdChange)==null||r.call(this,e);const{focusedCell:l}=this,{oldValue:o,value:s}=e;l&&l.id===o&&(l._id=s)}onFocusedRowDerender(){const e=this,{focusedCell:r}=e;if((r==null?void 0:r.id)!=null&&r.cell){const l=r.cell.contains(m.getActiveElement(e));if(e.hideHeaders)l&&e.revertFocus();else{const o=e.normalizeCellContext({rowIndex:-1,columnIndex:l?r.columnIndex:0});l?e.focusCell(o):o.cell.tabIndex=0}r.cell.tabIndex=-1}}navigateFirstCell(){this.focusCell(R.FIRST_CELL)}navigateFirstColumn(){this.focusCell(R.FIRST_COLUMN)}navigateLastCell(){this.focusCell(R.LAST_CELL)}navigateLastColumn(){this.focusCell(R.LAST_COLUMN)}navigatePrevPage(){this.focusCell(R.PREV_PAGE)}navigateNextPage(){this.focusCell(R.NEXT_PAGE)}activateHeader(e){var r;if(e.target.classList.contains("b-grid-header")&&this.focusedCell.isColumnHeader){const{column:l}=this.focusedCell;(r=l.onKeyDown)==null||r.call(l,e),this.getHeaderElement(l.id).click()}return!1}onEscape(e){var r,l;const o=this,{focusedCell:s}=o;!e.target.closest(".b-dragging")&&(s!=null&&s.isActionable)?(e.stopImmediatePropagation(),o._focusedCell=null,o.focusCell({rowIndex:s.rowIndex,column:s.column},{disableActionable:!0})):o.isNested&&o.owner&&!((l=(r=o.owner).catchFocus)!=null&&l.call(r,{source:o}))&&o.revertFocus(!0)}onTab(e){const{target:r}=e,{focusedCell:l,bodyElement:o}=this,{isActionable:s,actionTargets:n}=l;if(s&&m.isEditable(r)&&!r.readOnly&&r===n[n.length-1])e.preventDefault(),this.navigateRight(e);else if(!s||r===n[n.length-1])return o.style.display="none",this.requestAnimationFrame(()=>o.style.display=""),!1}onShiftTab(e){const r=this,{target:l}=e,{focusedCell:o,bodyElement:s}=r,{cell:n,isActionable:a,actionTargets:d}=o,c=a&&m.isEditable(l)&&!l.readOnly,u=o.columnIndex===0&&o.rowIndex===(r.hideHeaders?0:-1);if(!u&&c&&l===d[0])e.preventDefault(),r.navigateLeft(e);else if(!a||l===d[0]){const h=!u&&!r.hideHeaders&&r.focusCell({rowIndex:-1,column:0},{disableActionable:!0});return h?(h.cell.tabIndex=-1,n.tabIndex=0,r._focusedCell=o):(s.style.display="none",r.requestAnimationFrame(()=>s.style.display="")),!1}}onSpace(e){return this.focusedCell.isActionable||e.preventDefault(),!1}get focusedCell(){return this._focusedCell}get isActionableLocation(){var e;return(e=this._focusedCell)==null?void 0:e.isActionable}set focusedCell(e){this.focusCell(e)}get focusedRecord(){var e;return(e=this._focusedCell)==null?void 0:e.record}get cellCSSSelector(){const e=this._focusedCell;return e?`[data-index=${e.rowIndex}] [data-column-id=${e.columnId}]`:""}afterHide(){super.afterHide(...arguments),this.lastFocusedCell=null}isFocused(e){var r;return!!((r=this._focusedCell)!=null&&r.equals(this.normalizeCellContext(e)))}get focusElement(){var e;if(!this.isDestroying){let r;this.store.count&&this._focusedCell?r=this._focusedCell.target:r=this.normalizeCellContext({rowIndex:-1,columnIndex:((e=this._focusedCell)==null?void 0:e.columnIndex)||0}).target;const l=super.focusElement;return l&&(!r||r.compareDocumentPosition(l)===Node.DOCUMENT_POSITION_PRECEDING)?l:r}}onInternalPaint({firstPaint:e}){var r;const l=this;(r=super.onInternalPaint)==null||r.call(this,...arguments);const o=this.normalizeCellContext({rowIndex:l.hideHeaders?0:-1,column:l.hideHeaders?0:l.columns.find(s=>!s.hidden&&s.isFocusable)});if(o.cell){o._isDefaultFocus=!0,l._focusedCell=o;const{target:s}=o;s===o.cell&&(o.cell.tabIndex=0)}}onGridBodyFocusIn(e){var r,l,o;const s=this,{bodyElement:n}=s,a=s.focusedCell,d=(a==null?void 0:a.initialTarget)||(a==null?void 0:a.target),{target:c,relatedTarget:u}=e,h=c.closest(s.focusableSelector);if(h&&(!D.currentMouseDown||D.isMouseDown(0)||D.isMouseDown(2))){const g=new R(c),{cell:f}=g,p=a==null?void 0:a.cell,v=g.actionTargets=s.findFocusables(h),C=(!s._fromFocusCell||s.selectOnFocus)&&(c===f||s._selectActionCell)&&!(c!=null&&c._isRevertingFocus);if(!s.store.getById(h.parentNode.dataset.id)&&f!==h){f.focus({preventScroll:!0});return}if(c.matches(s.focusableSelector)){if(s.disableActionable)g._target=f;else if(v.length){s._selectActionCell=((r=D.currentMouseDown)==null?void 0:r.target)===c,v[0].focus(),delete s._selectActionCell;return}}else{if(a!=null&&a.target&&u&&(!D.isMouseDown()||!n.contains((l=D.currentMouseDown)==null?void 0:l.target))&&!n.contains(u)&&!g.equals(a)){d.focus();return}g._target=c}if(p&&(p.classList.remove("b-focused"),p.tabIndex=-1),f&&(f.classList.add("b-focused"),g.column.onCellFocus(g),f===c&&(f.tabIndex=0),f.contains(e.relatedTarget)&&d===c))return;s._focusedCell=g,(o=s.onCellNavigate)==null||o.call(s,s,a,g,C),s.trigger("navigate",{lastFocusedCell:a,focusedCell:g,event:e})}else c.closest(".b-rowexpander-body")||d==null||d.focus({preventScroll:!0})}findFocusables(e){const{focusableFinder:r}=this,l=[];r.currentNode=this.focusableFinderCell=e;for(let o=r.nextNode();o;o=r.nextNode())l.push(o);return l}get focusableFinder(){const e=this;return e._focusableFinder||(e._focusableFinder=e.setupTreeWalker(e.bodyElement,m.NodeFilter.SHOW_ELEMENT,{acceptNode:ni.bind(e)})),e._focusableFinder}restoreActiveItem(e=this._focusedCell){if(this.rowManager.count)return isNaN(e)?e.isModel||(e=this.store.getById(e)):e=this.store.getAt(e),this.focusCell(e)}focusCell(e,r=oi){var l,o,s,n;const a=this,{_focusedCell:d}=a,{scroll:c,disableActionable:u}=r,h=e===R.DOWN,g=e===R.UP;if((e==null?void 0:e.rowIndex)===-1&&a.hideHeaders){a.revertFocus();return}e=typeof e=="number"&&(d!=null&&d.isLocation)?d.move(e):a.normalizeCellContext(e);const f="doSelect"in r?r.doSelect:!e.isActionable||e.initialTarget===e.cell;if(e.equals(d))return a.isNested&&(h||g)?(o=(l=a.owner)==null?void 0:l.catchFocus)!=null&&o.call(l,{source:a,navigationDirection:h?"down":"up"})||a.revertFocus(!0):(s=a.onCellNavigate)==null||s.call(a,a,d,e,f),d;const p=a.getSubGridFromColumn(e.columnId),{cell:v}=e,C=v||a.getCell({rowIndex:a.rowManager.topIndex,columnId:e.columnId}),b=M.from(p.element),w=M.from(a.bodyElement),S=M.from(C).moveTo(null,b.y);return c===!1||e.rowIndex===-1?r=Object.assign({},r,si):(r=Object.assign({},r,c),S.width>b.width||S.height>w.height?r.x=r.y=!1:r.column=e.columnId,a.scrollRowIntoView(e.id,r)),(a._hoveredRow||a.hoveredCell)&&(a.hoveredCell=null),a.disableActionable=u,a.selectOnFocus=f,a._fromFocusCell=!0,(n=e[u?"cell":"target"])==null||n.focus({preventScroll:!0}),a.disableActionable=a.selectOnFocus=!1,delete a._fromFocusCell,e}blurCell(e){const r=this,l=r.getCell(e);l&&l.classList.remove("b-focused")}clearFocus(e){const r=this;r._focusedCell&&(r.lastFocusedCell=e?null:r._focusedCell,r.blurCell(r._focusedCell),r._focusedCell=null)}catchFocus(){}internalNextPrevCell(e=!0){const r=this,l=r._focusedCell;return l?r.focusCell({id:l.id,columnId:r.columns.getAdjacentVisibleLeafColumn(l.column,e,!0).id}):null}navigateRight(){var e;return(e=arguments[0])!=null&&e.fromKeyMap?this.focusCell(this.rtl?R.PREV_CELL:R.NEXT_CELL):(arguments[0]&&$.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevCell(!this.rtl))}navigateLeft(){var e;return(e=arguments[0])!=null&&e.fromKeyMap?this.focusCell(this.rtl?R.NEXT_CELL:R.PREV_CELL):(arguments[0]&&$.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevCell(!!this.rtl))}internalNextPrevRow(e,r=!0,l=!0){const o=this,s=o._focusedCell;if(!s)return!1;const n=o.store[`get${e?"Next":"Prev"}`](s.id,!1,r);return n?o.focusCell({id:n.id,columnId:s.columnId,scroll:{x:!1}}):(!e&&l&&!s.isColumnHeader&&(this.clearFocus(),this.getHeaderElement(s.columnId).focus()),!1)}navigateDown(){var e;return(e=arguments[0])!=null&&e.fromKeyMap?this.focusCell(R.DOWN):(arguments[0]&&$.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevRow(!0,!1))}navigateUp(){var e;return(e=arguments[0])!=null&&e.fromKeyMap?this.focusCell(R.UP):(arguments[0]&&$.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevRow(!1,!1))}get widgetClass(){}},F(t,"configurable",{focusable:!1,focusableSelector:".b-grid-cell,.b-grid-header.b-depth-0",isNested:!1,keyMap:{ArrowUp:{handler:"navigateUp",weight:10},ArrowRight:{handler:"navigateRight",weight:10},ArrowDown:{handler:"navigateDown",weight:10},ArrowLeft:{handler:"navigateLeft",weight:10},"Ctrl+Home":"navigateFirstCell",Home:"navigateFirstColumn","Ctrl+End":"navigateLastCell",End:"navigateLastColumn",PageUp:"navigatePrevPage",PageDown:"navigateNextPage",Enter:"activateHeader",Escape:{handler:"onEscape",weight:10},"Shift+Tab":{handler:"onShiftTab",preventDefault:!1,weight:200},Tab:{handler:"onTab",preventDefault:!1,weight:200}," ":{handler:"onSpace",preventDefault:!1}}}),t},di=new String,ci={localeName:"En",localeDesc:"English (US)",localeCode:"en-US",ColumnPicker:{column:"Column",columnsMenu:"Columns",hideColumn:"Hide column",hideColumnShort:"Hide",newColumns:"New columns"},Filter:{applyFilter:"Apply filter",filter:"Filter",editFilter:"Edit filter",on:"On",before:"Before",after:"After",equals:"Equals",lessThan:"Less than",moreThan:"More than",removeFilter:"Remove filter",disableFilter:"Disable filter"},FilterBar:{enableFilterBar:"Show filter bar",disableFilterBar:"Hide filter bar"},Group:{group:"Group",groupAscending:"Group ascending",groupDescending:"Group descending",groupAscendingShort:"Ascending",groupDescendingShort:"Descending",stopGrouping:"Stop grouping",stopGroupingShort:"Stop"},HeaderMenu:{moveBefore:i=>`Move before "${i}"`,moveAfter:i=>`Move after "${i}"`,collapseColumn:"Collapse column",expandColumn:"Expand column"},ColumnRename:{rename:"Rename"},MergeCells:{mergeCells:"Merge cells",menuTooltip:"Merge cells with same value when sorted by this column"},Search:{searchForValue:"Search for value"},Sort:{sort:"Sort",sortAscending:"Sort ascending",sortDescending:"Sort descending",multiSort:"Multi sort",removeSorter:"Remove sorter",addSortAscending:"Add ascending sorter",addSortDescending:"Add descending sorter",toggleSortAscending:"Change to ascending",toggleSortDescending:"Change to descending",sortAscendingShort:"Ascending",sortDescendingShort:"Descending",removeSorterShort:"Remove",addSortAscendingShort:"+ Ascending",addSortDescendingShort:"+ Descending"},Split:{split:"Split",unsplit:"Unsplit",horizontally:"Horizontally",vertically:"Vertically",both:"Both"},Column:{columnLabel:i=>`${i.text?`${i.text} column. `:""}SPACE for context menu${i.sortable?", ENTER to sort":""}`,cellLabel:di},Checkbox:{toggleRowSelect:"Toggle row selection",toggleSelection:"Toggle selection of entire dataset"},RatingColumn:{cellLabel:i=>{var t;return`${i.text?i.text:""} ${(t=i.location)!=null&&t.record?`rating : ${i.location.record.get(i.field)||0}`:""}`}},GridBase:{loadFailedMessage:"Data loading failed!",syncFailedMessage:"Data synchronization failed!",unspecifiedFailure:"Unspecified failure",networkFailure:"Network error",parseFailure:"Failed to parse server response",serverResponse:"Server response:",noRows:"No records to display",moveColumnLeft:"Move to left section",moveColumnRight:"Move to right section",moveColumnTo:i=>`Move column to ${i}`},CellMenu:{removeRow:"Delete"},RowCopyPaste:{copyRecord:"Copy",cutRecord:"Cut",pasteRecord:"Paste",rows:"rows",row:"row"},CellCopyPaste:{copy:"Copy",cut:"Cut",paste:"Paste"},PdfExport:{"Waiting for response from server":"Waiting for response from server...","Export failed":"Export failed","Server error":"Server error","Generating pages":"Generating pages...","Click to abort":"Cancel"},ExportDialog:{width:"40em",labelWidth:"12em",exportSettings:"Export settings",export:"Export",printSettings:"Print settings",print:"Print",exporterType:"Control pagination",cancel:"Cancel",fileFormat:"File format",rows:"Rows",alignRows:"Align rows",columns:"Columns",paperFormat:"Paper format",orientation:"Orientation",repeatHeader:"Repeat header"},ExportRowsCombo:{all:"All rows",visible:"Visible rows"},ExportOrientationCombo:{portrait:"Portrait",landscape:"Landscape"},SinglePageExporter:{singlepage:"Single page"},MultiPageExporter:{multipage:"Multiple pages",exportingPage:({currentPage:i,totalPages:t})=>`Exporting page ${i}/${t}`},MultiPageVerticalExporter:{multipagevertical:"Multiple pages (vertical)",exportingPage:({currentPage:i,totalPages:t})=>`Exporting page ${i}/${t}`},RowExpander:{loading:"Loading",expand:"Expand",collapse:"Collapse"},TreeGroup:{group:"Group by",stopGrouping:"Stop grouping",stopGroupingThisColumn:"Ungroup column"}},xi=Lt.publishLocale(ci),ft=new Promise(i=>i()),Ke="GridBase:store",ui={block:"nearest",inline:"nearest"},hi={dataset:1,pageLoad:1,filter:1},gi=Object.freeze([]),fi=(i,t)=>i-t,Me=class extends Ot.mixin(Bt,Pt,ot,st,ai,nt,at,dt,ut,Tt){static get $name(){return"GridBase"}static get type(){return"gridbase"}static get delayable(){return{onGridVerticalScroll:{type:"raf"},bufferedAfterColumnsResized:250,bufferedElementResize:250}}static get configurable(){return{autoHeight:null,enableSticky:null,enableTextSelection:null,fillLastColumn:!0,positionMode:"translate",showDirty:null,subGridConfigs:{normal:{flex:1}},store:{value:{},$config:"nullify"},rowManager:{value:{},$config:["nullify","lazy"]},scrollManager:{value:{},$config:["nullify","lazy"]},columns:{value:[],$config:"nullify"},minHeight:"10em",hideHeaders:null,hideFooters:!0,hideHorizontalScrollbar:null,contentElMutationObserver:!1,trapFocus:!1,ariaElement:"bodyElement",cellTabIndex:-1,rowCls:{value:"b-grid-row",$config:{merge:this.mergeCls}},cellCls:{value:"b-grid-cell",$config:{merge:this.mergeCls}},emptyText:"L{noRows}",sortFeatureStore:"store",rowHeight:null,preserveScroll:!1,animateTreeNodeToggle:$.checkVersion("core","6.0",">="),columnLines:!0,rowLines:!0}}static get defaultConfig(){return{fixedRowHeight:null,defaultRowHeight:45,fullRowRefresh:!0,preserveScrollOnDatasetChange:null,preserveFocusOnDatasetChange:!0,data:null,defaultRegion:"normal",destroyStore:null,maskDefaults:{cover:"body",target:"element"},resizeToFitIncludesHeader:!0,animateRemovingRows:!0,disableGridRowModelWarning:null,headerClass:ie,footerClass:_e,testPerformance:!1,rowScrollMode:"move",monitorResize:!0,features:!0,scrollable:{overflowY:!0},scrollerClass:gt,refreshSuspended:0,transitionDuration:500,contextMenuTriggerEvent:"contextmenu",localizableProperties:["emptyText"],asyncEventSuffix:"",fixElementHeightsBuffer:350,testConfig:{transitionDuration:50,fixElementHeightsBuffer:50}}}static get properties(){return{_selectedRecords:[],_verticalScrollHeight:0,virtualScrollHeight:0,_scrollTop:null}}finishConfigure(i){const t=this,{initScroll:e}=t;t.initScroll=()=>!t.scrollInitialized&&e.call(t),$.isTestEnv&&(t.bufferedAfterColumnsResized.delay=50,t.bufferedElementResize.delay=50),super.finishConfigure(i),Je.ion({locale:"onBeforeLocaleChange",prio:1,thisObj:t}),Je.ion({locale:"onLocaleChange",prio:-1,thisObj:t}),D.ion({theme:"onThemeChange",thisObj:t}),t.ion({subGridExpand:"onSubGridExpand",prio:-1,thisObj:t}),t.bufferedFixElementHeights=t.buffer("fixElementHeights",t.fixElementHeightsBuffer,t),t.setGridClassList(t.element.classList),t.verticalScroller.classList.remove("b-content-element","b-auto-container"),t.bodyWrapElement.classList.remove("b-auto-container-panel")}onSubGridExpand(){this.renderContents()}onBeforeLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!0}onLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!1,this.isPainted&&this.renderContents()}finalizeInit(){super.finalizeInit(),this.store.isLoading&&this.onStoreBeforeRequest()}changeScrollManager(i,t){return t==null||t.destroy(),i?Ze.new({element:this.element,owner:this},i):null}doDestroy(){var i,t;const e=this;e.detachListeners(Ke),(i=e.scrollManager)==null||i.destroy();for(const r of Object.values(e.features))(t=r.destroy)==null||t.call(r);e._focusedCell=null,e.columns.destroy(),super.doDestroy()}setGridClassList(i){Object.values(this.features).forEach(e=>{if(e.disabled||e===!1)return;let r;Object.prototype.hasOwnProperty.call(e.constructor,"featureClass")?r=e.constructor.featureClass:r=`b-${e instanceof z?e.$$name:e.constructor.name}`,r&&i.add(r.toLowerCase())})}compose(){const{autoHeight:i,enableSticky:t,enableTextSelection:e,fillLastColumn:r,positionMode:l,showDirty:o}=this;return{class:{[`b-grid-${l}`]:1,"b-enable-sticky":t,"b-grid-notextselection":!e,"b-autoheight":i,"b-fill-last-column":r,"b-show-dirty":o,"b-show-dirty-during-edit":o==null?void 0:o.duringEdit}}}get cellCls(){const{_cellCls:i}=this;return i.value||i}get bodyConfig(){const{autoHeight:i,hideFooters:t,hideHeaders:e}=this;return{reference:"bodyElement",className:{"b-autoheight":i,"b-grid-panel-body":1},[this.hasHeader?"ariaLabelledBy":""]:`${this.id}-panel-title`,children:{headerContainer:{tag:"header",role:"row","aria-rowindex":1,className:{"b-grid-header-container":1,"b-hidden":e}},bodyContainer:{className:"b-grid-body-container",tabIndex:-1,role:"presentation",children:{verticalScroller:{className:"b-grid-vertical-scroller"}}},virtualScrollers:{className:"b-virtual-scrollers b-hide-display",style:k.isFirefox&&m.scrollBarWidth?{height:`${m.scrollBarWidth}px`}:void 0},footerContainer:{tag:"footer",className:{"b-grid-footer-container":1,"b-hidden":t}}}}}get contentElement(){return this.verticalScroller}get overflowElement(){return this.bodyContainer}updateHideHeaders(i){var t;i=!!i,(t=this.headerContainer)==null||t.classList.toggle("b-hidden",i),this.eachSubGrid(e=>e.toggleHeaders(i))}updateHideFooters(i){var t;i=!!i,(t=this.footerContainer)==null||t.classList.toggle("b-hidden",i),this.eachSubGrid(e=>{e.scrollable[i?"removePartner":"addPartner"](e.footer.scrollable,"x")})}updateHideHorizontalScrollbar(i){i=!!i,this.eachSubGrid(t=>{t.virtualScrollerElement.classList.toggle("b-hide-display",i),t.scrollable[i?"removePartner":"addPartner"](t.fakeScroller,"x"),i||t.refreshFakeScroll()})}changeColumns(i,t){const e=this;if(!i&&t)return e.isDestroying?t.owner===e&&t.destroy():t.removeAll(),t;if(i.isStore)return(t==null?void 0:t.owner)===e&&t.destroy(),i.grid=e,i;if(Array.isArray(i)){if(t){const r=t.allRecords.slice();t.data=i;for(const l of r)t.includes(l)||l.destroy();return t}i={data:i}}if(t)throw new Error("Replacing ColumnStore is not supported");return K.new({grid:e,owner:e},i)}updateColumns(i,t){var e,r;const l=this;(e=super.updateColumns)==null||e.call(this,i,t),i.ion({refresh:l.onColumnsChanged,sort:l.onColumnsChanged,change:l.onColumnsChanged,move:l.onColumnsChanged,thisObj:l}),i.ion(Nt(l.onColumnsResized,l)),k.isTouchDevice&&(l.touch=!0,i.forEach(o=>{const{touchConfig:s}=o;s&&o.applyState(s)})),(r=l.bodyElement)==null||r.setAttribute("aria-colcount",i.visibleColumns.length)}onColumnsChanged({type:i,action:t,changes:e,record:r,records:l,isMove:o}){var s;const n=this,{columns:a,checkboxSelectionColumn:d}=n,c=e&&Object.keys(e).length===1;if(o=o===!0?!0:o&&Object.values(o).some(h=>h),o||i==="refresh"&&t!=="batch"&&t!=="sort"||t==="update"&&c&&"parentIndex"in e||t==="sort"&&a.isSyncingDataOnLoad)return;const u=t==="add"&&l.some(h=>h.region&&!n.subGrids[h.region]);if(!(n.isConfiguring||!u&&(!n.isPainted||o&&t==="remove"))){if(t==="add")for(const h of l){const{region:g}=h;n.subGrids[g]||n.add(n.createSubGrid(g,(s=n.subGridConfigs)==null?void 0:s[g]))}if(t==="update"){if(("width"in e||"minWidth"in e||"maxWidth"in e||"flex"in e)&&!("region"in e)){const{region:h}=r;a.visibleColumns.forEach(g=>{g.region===h&&g.repaintOnResize&&n.refreshColumn(g)}),n.afterColumnsChange({action:t,changes:e,column:r});return}if("text"in e&&c){r.subGrid.refreshHeader();return}if("hidden"in e){const h=n.getSubGridFromColumn(r.id);h.header.fixHeaderWidths(),h.footer.fixFooterWidths(),h.updateHasFlex()}}if(t==="dataset"||t==="batch"||t==="update"&&"region"in e){const h=a.getDistinctValues("region",!0),{toRemove:g,toAdd:f}=H.delta(h,n.regions,!0);n.remove(g.map(p=>n.getSubGrid(p))),n.add(f.map(p=>n.createSubGrid(p,n.subGridConfigs[p])))}if(d&&!a.includes(d)){const h=a.indexOf(a.findRecord("type","rownumber"))+1;a.insert(h,d,!0)}n._suspendRenderContentsOnColumnsChanged||n.renderContents(),n.syncFlexedSubCols(),n.bodyElement.setAttribute("aria-colcount",a.visibleColumns.length),n.afterColumnsChange({action:t,changes:e,column:r,columns:l})}}onColumnsResized({changes:i,record:t}){var e;const r=this;if(r.isConfiguring)return;const l=m.setLength(t.width),o=m.setLength(t.minWidth),s=m.setLength(t.maxWidth),n=r.getSubGridFromColumn(t.id);if(n.header.fixHeaderWidths(),n.footer.fixFooterWidths(),n.updateHasFlex(),!(t.flex&&t.childLevel)){(!r.cellEls||t!==r.lastColumnResized)&&(r.cellEls=m.children(r.element,`.b-grid-cell[data-column-id="${t.id}"]`),r.lastColumnResized=t);for(const a of r.cellEls)"width"in i&&(a.style.width=l),"minWidth"in i&&(a.style.minWidth=o),"maxWidth"in i&&(a.style.maxWidth=s),"flex"in i&&(a.style.flex=(e=t.flex)!=null?e:null)}r.resizingColumns||r.afterColumnsResized(t),r.syncFlexedSubCols()}afterColumnsResized(i){const t=this;t.eachSubGrid(e=>{!e.collapsed&&(!i||i.region===e.region)&&(e.fixWidths(),e.fixRowWidthsInSafariEdge())}),t.lastColumnResized=t.cellEls=null,t.bufferedAfterColumnsResized(i),t.onHeightChange()}syncFlexedSubCols(){const i=this.columns.query(t=>t.flex&&t.childLevel&&t.element);if(i)for(const t of i){const e=t.element.getBoundingClientRect().width,r=m.children(this.element,`.b-grid-cell[data-column-id="${t.id}"]`);for(const l of r)l.style.flex=`0 0 ${e}px`}}bufferedAfterColumnsResized(i){this.columns.usesAutoHeight&&this.refreshRows(),this.refreshVirtualScrollbars(),this.eachSubGrid(t=>{!t.collapsed&&(!i||i.region===t.region)&&t.refreshFakeScroll()})}bufferedElementResize(){this.refreshRows()}onInternalResize(i,t,e,r,l){m.scrollBarWidth&&t<r&&this.eachSubGrid(o=>{o.flex&&o.onElementResize(o.element)}),super.onInternalResize(...arguments),this.isPainted&&t!==r&&this.columns.usesFlexAutoHeight&&this.bufferedElementResize()}changeRowManager(i,t){const e=this;if(e._isRowMeasured||e.measureRowHeight(),t==null||t.destroy(),i){const r=Ie.new({grid:e,rowHeight:e.rowHeight,rowScrollMode:e.rowScrollMode||"move",autoHeight:e.autoHeight,fixedRowHeight:e.fixedRowHeight,internalListeners:{changeTotalHeight:"onRowManagerChangeTotalHeight",requestScrollChange:"onRowManagerRequestScrollChange",thisObj:e}},i);return e.relayEvents(r,["beforeRenderRow","renderRow"]),e._rowManager=null,r}}updateRowHeight(i){!this.isConfiguring&&this.rowManager&&(this.rowManager.rowHeight=i)}get rowHeight(){var i,t;return(t=(i=this._rowManager)==null?void 0:i.rowHeight)!=null?t:this._rowHeight}getRowHeight(i){return i.rowHeight}processRowHeight(i,t){}getAsyncEventSuffixForStore(i){return this.asyncEventSuffix}bindStore(i){const t=this.getAsyncEventSuffixForStore(i);i.ion({name:Ke,[`refresh${t}`]:"onStoreDataChange",[`add${t}`]:"onStoreAdd",[`remove${t}`]:"onStoreRemove",[`replace${t}`]:"onStoreReplace",[`removeAll${t}`]:"onStoreRemoveAll",[`move${t}`]:i.tree?null:"onFlatStoreMove",change:"relayStoreDataChange",idChange:"onStoreRecordIdChange",update:"onStoreUpdateRecord",beforeRequest:"onStoreBeforeRequest",afterRequest:"onStoreAfterRequest",exception:"onStoreException",commit:"onStoreCommit",startApplyChangeset:"internalOnStoreStartApplyChangeset",endApplyChangeset:"internalOnStoreEndApplyChangeset",thisObj:this}),super.bindStore(i)}unbindStore(i){this.detachListeners(Ke),this.destroyStore&&i.destroy()}changeStore(i){var t;return i==null?null:(typeof i=="string"&&(i=Ae.getStore(i)),i.isStore||(i=x.assign({data:this.data,tree:!!((t=this.initialConfig.features)!=null&&t.tree)},i),i.data||delete i.data,i.modelClass||(i.modelClass=qe),i=new(i.readUrl?Et:Ae)(i)),i)}updateStore(i,t){var e,r;const l=this;(e=super.updateStore)==null||e.call(this,i,t),t&&l.unbindStore(t),i&&(t&&l.deselectAll(),l.bindStore(i)),l.trigger("bindStore",{store:i,oldStore:t}),!l.isDestroying&&l.isPainted&&!l.refreshSuspended&&((r=l._rowManager)==null||r.reinitialize())}onStoreUpdateRecord({source:i,record:t,changes:e}){const r=this;if(!r.refreshSuspended)if(r.forceFullRefresh)r.rowManager.refresh(),r.forceFullRefresh=!1;else{let l;if(t.isFieldModified("id")&&(l=r.getRowFor(t.meta.modified.id)),l=l||r.getRowFor(t),!l)return;if(r.fullRowRefresh||t.isSpecialRow){const o=i.indexOf(t);o!==-1&&l.render(o,t)}else r.columns.visibleColumns.forEach(o=>{const s=o.field;if(!(o.constructor.simpleRenderer&&!Object.prototype.hasOwnProperty.call(o.data,"renderer"))||e[s]){const a=l.getCell(s);a&&l.renderCell(a)}})}}refreshFromRowOnStoreAdd(i,t){const e=this,{rowManager:r}=e;r.renderFromRow(i),r.trigger("changeTotalHeight",{totalHeight:r.totalHeight}),e.store.count===1&&e.callEachSubGrid("refreshFakeScroll")}onMaskAutoClose(i){super.onMaskAutoClose(i),this.toggleEmptyText()}onStoreAdd({source:i,records:t,index:e,oldIndex:r,isChild:l,oldParent:o,parent:s,isMove:n,isExpand:a,isExpandAll:d}){const c=this,{rowManager:u}=c;if(!c.isPainted||d||c.refreshSuspended)return;if(a&&c.animateTreeNodeToggle)return u.insert(e,t.length);const h=n&&t.some(S=>{if(n[S.id]){const y=i.getById(S.meta.modified.parentId);return(y==null?void 0:y.isExpanded(i))&&(y==null?void 0:y.ancestorsExpanded(i))}});if(l&&!t[0].ancestorsExpanded(i)&&!h){if(!s.isLeaf){const S=u.getRowById(s);S&&u.renderRows([S])}return}u.calculateRowCount(!1,!0,!0),i.isFiltered&&(e=i.indexOf(t[0]));const{topIndex:g,rows:f,rowCount:p}=u,v=u.topIndex+u.rowCount-1,C=e,b=e+t.length-1,w=v>=i.count-t.length-1;o||r>-1||l&&n&&Object.values(n).some(S=>S)?u.refresh():C>=g&&C<g+p?c.refreshFromRowOnStoreAdd(f[C-g],...arguments):b>=g&&b<g+p?u.refresh():(w&&e>v&&u.fillBelow(c._scrollTop||0),u.estimateTotalHeight(!0))}onStoreException({action:i,type:t,response:e,exceptionType:r,error:l}){var o;const s=this;let n;switch(t){case"server":n=e.message||s.L("L{unspecifiedFailure}");break;case"exception":n=r==="network"?s.L("L{networkFailure}"):(l==null?void 0:l.message)||((o=e==null?void 0:e.parsedJson)==null?void 0:o.message)||s.L("L{parseFailure}");break}s.applyMaskError(`<div class="b-grid-load-failure">
                <div class="b-grid-load-fail">${s.L(i==="read"?"L{loadFailedMessage}":"L{syncFailedMessage}")}</div>
                ${e!=null&&e.url?`<div class="b-grid-load-fail">${e.url}</div>`:""}
                <div class="b-grid-load-fail">${s.L("L{serverResponse}")}</div>
                <div class="b-grid-load-fail">${n}</div>
            </div>`)}onStoreDataChange({action:i,changes:t,source:e,syncInfo:r}){var l;(l=super.onStoreDataChange)==null||l.call(this,...arguments);const o=this;if(o.refreshSuspended||!o.rowManager||i==="dataset"&&(o.rowManager.clearKnownHeights(),e.isTree&&e.isFiltered))return;const s=e.isGrouped&&t&&e.groupers.some(n=>n.field in t);o.isPainted&&!s&&o.renderRows(!!(!(i in hi)||o.preserveScrollOnDatasetChange)),o.toggleEmptyText()}onStoreRecordIdChange(){var i;(i=super.onStoreRecordIdChange)==null||i.call(this,...arguments)}onStoreBeforeRequest(){this.applyLoadMask()}onStoreAfterRequest(i){this.loadMask&&!i.exception&&(this.masked=null,this.toggleEmptyText())}needsFullRefreshOnStoreRemove({isCollapse:i}){var t,e;const{store:r}=this;return((e=(t=this.features)==null?void 0:t.group)==null?void 0:e.enabled)&&r.isGrouped||r.tree&&!i&&r.modelClass.convertEmptyParentToLeaf}onStoreRemove({source:i,records:t,isCollapse:e,isChild:r,isMove:l,isCollapseAll:o}){var s;if(!this.isPainted||l||o)return;(s=super.onStoreRemove)==null||s.call(this,...arguments);const n=this,{rowManager:a}=n;if(a.invalidateKnownHeight(t),!n.refreshSuspended)if(n.animateRemovingRows&&!e&&!r){const d=t.reduce((c,u)=>{const h=a.getRowById(u.id);return h&&c.push(h),c},[]);if(d.length){const c=d[0];n.isAnimating=!0,j.onTransitionEnd({element:c._elementsArray[0],property:"left",duration:n.transitionDuration+50,thisObj:n,handler:()=>{n.isAnimating=!1,d.forEach(u=>!u.isDestroyed&&u.removeCls("b-removing")),a.refresh(),n.trigger("rowRemove"),n.afterRemove(arguments[0])}}),d.forEach(u=>u.addCls("b-removing"))}}else if(e&&n.animateTreeNodeToggle){const d=t.flatMap(u=>{const h=a.getRowFor(u);return h?h.index:gi}).sort(fi),{length:c}=d;if(c&&d[c-1]===d[0]+c-1)return a.insert(d[0],-d.length)}else if(n.needsFullRefreshOnStoreRemove(...arguments))a.refresh(),n.afterRemove(arguments[0]);else{const{rows:d}=a,c=t.reduce((u,h)=>{const g=a.getRowById(h.id);return g&&(u=Math.min(u,d.indexOf(g))),u},d.length);d[c]?!n.refreshSuspended&&a.renderFromRow(d[c]):a.trigger("changeTotalHeight",{totalHeight:a.totalHeight}),n.trigger("rowRemove",{isCollapse:e}),n.afterRemove(arguments[0])}}onFlatStoreMove({from:i,to:t}){const{rowManager:e,store:r}=this,{topIndex:l,rowCount:o}=e,[s,n]=[i,t].sort((c,u)=>c-u),a=r.indexOf(r.getAt(s,!0)),d=r.indexOf(r.getAt(n,!0));a>=l&&a<l+o?e.renderFromRow(e.rows[a-l]):d>=l&&d<l+o&&e.refresh()}onStoreReplace({records:i,all:t}){const{rowManager:e}=this;if(t)e.clearKnownHeights(),e.refresh();else{const r=i.reduce((l,[,o])=>{const s=this.getRowFor(o);return s&&l.push(s),l},[]);e.invalidateKnownHeight(i),e.renderRows(r)}}relayStoreDataChange(i){var t;if((t=this.ariaElement)==null||t.setAttribute("aria-rowcount",this.store.count+1),!this.project)return this.trigger("dataChange",{...i,store:i.source,source:this})}onStoreRemoveAll(){var i;(i=super.onStoreRemoveAll)==null||i.call(this,...arguments),this.isPainted&&(this.rowManager.clearKnownHeights(),this.renderRows(!1),this.toggleEmptyText())}onStoreCommit({changes:i}){if(this.showDirty&&i.modified.length){const t=[];i.modified.forEach(e=>{const r=this.rowManager.getRowFor(e);r&&t.push(r)}),this.rowManager.renderRows(t)}}internalOnStoreStartApplyChangeset(){this.suspendRefresh(),this.constructor.bindStoreChangeset&&this.captureScrollTargetRow()}internalOnStoreEndApplyChangeset(){this.resumeRefresh(!0),this.constructor.bindStoreChangeset&&this.restoreScrollTargetRow()}captureScrollTargetRow(){const i=this;if(i.preserveScroll){const{firstFullyVisibleRow:t,lastVisibleRow:e}=i.rowManager;if(t){i.lastVisibleRowIds=[t.id];for(let r=t.dataIndex+1;r<=e.dataIndex;r++)i.lastVisibleRowIds.push(i.rowManager.getRow(r).id);i.lastTopRowOffset=i.scrollable.getDeltaTo(t.element,{block:"start",x:!1,constrainToScrollable:!1})}}}restoreScrollTargetRow(){const i=this;if(i.preserveScroll){if(i.lastVisibleRowIds){i.rowManager.refresh();const t=i.lastVisibleRowIds.find(e=>i.store.getById(e));if(t!=null&&t!==i.rowManager.firstFullyVisibleRow.id){if(i.preserveScroll.overscroll){const e=i.scrollable.getDeltaTo(i.getRecordCoords(t),{block:"start",x:!1,constrainToScrollable:!1,edgeOffset:i.lastTopRowOffset.yDelta}).yDelta;e>i.scrollable.maxY&&(i.scrollable.scrollHeight+=e)}i.scrollRowIntoView(t,{block:"start",edgeOffset:i.lastTopRowOffset.yDelta,x:!1})}}i.lastVisibleRowIds=void 0,i.lastTopRowOffset=void 0}}get data(){return this._store?this._store.records:this._data}set data(i){this._store?this._store.data=i:this._data=i}populateHeaderMenu({column:i,items:t}){const e=this,{subGrids:r,regions:l}=e,{parent:o}=i;let s=!0;Object.entries(r).forEach(([n,a])=>{if(!a.sealedColumns&&i.draggable&&n!==i.region&&(!o&&r[i.region].columns.count>1||o&&o.children.length>1)){const d=a.element.compareDocumentPosition(r[i.region].element)===document.DOCUMENT_POSITION_PRECEDING,c=e.rtl?!d:d,u=l.length>2?e.L("L{moveColumnTo}",e.optionalL(n)):e.L(c?"L{moveColumnRight}":"L{moveColumnLeft}");t[`${n}Region`]={targetSubGrid:n,text:u,icon:"b-fw-icon b-icon-column-move-"+(c?"right":"left"),separator:s,disabled:!i.allowDrag,onItem:({item:h})=>{i.traverse(g=>g.region=n),e.columns.insert(e.columns.indexOf(r[h.targetSubGrid].columns.last)+1,i),e.scrollColumnIntoView(i)}},s=!1}})}populateCellMenu({record:i,items:t}){}getColumnDragToolbarItems(i,t){return t}normalizeCellContext(i){const t=this,{columns:e}=t;return i.isLocation?i:i.isModel?new R({grid:t,id:i.id,columnId:e.visibleColumns[0].id}):new R(x.assign({grid:t},i))}getCell(i){const{store:t,columns:e}=this,{visibleColumns:r}=this.columns,l=isNaN(i.row)?isNaN(i.rowIndex)?t.indexOf(i.record||i.id):i.rowIndex:i.row,o=isNaN(i.column)?isNaN(i.columnIndex)?r.indexOf(i.column||e.getById(i.columnId)||e.get(i.field)||r[0]):i.columnIndex:i.column;return l>-1&&l<t.count&&o>-1&&o<r.length&&this.normalizeCellContext(i).cell||null}getHeaderElement(i){return i.isModel&&(i=i.id),this.fromCache(`.b-grid-header[data-column-id="${i}"]`)}getHeaderElementByField(i){const t=this.columns.get(i);return t?this.getHeaderElement(t):null}get bodyHeight(){return this._bodyHeight}get headerHeight(){const i=this;return i.isPainted&&!i._headerHeight&&(i._headerHeight=i.headerContainer.offsetHeight),i._headerHeight}get footerHeight(){const i=this;return i.isPainted&&!i._footerHeight&&(i._footerHeight=i.footerContainer.offsetHeight),i._footerHeight}get isTreeGrouped(){var i;return!!((i=this.features.treeGroup)!=null&&i.isGrouped)}getRecordFromElement(i){const t=i.closest(".b-grid-row");return t?this.store.getAt(t.dataset.index):null}getColumnFromElement(i){const t=i.closest(".b-grid-cell, .b-grid-header");if(!t)return null;if(t.matches(".b-grid-header"))return this.columns.getById(t.dataset.columnId);const e=B.get(t);return this.columns.getById(e.columnId)}updateAutoHeight(i){x.assertBoolean(i,"autoHeight")}updateColumnLines(i){x.assertBoolean(i,"columnLines"),m.toggleClasses(this.element,"b-no-column-lines",!i)}updateRowLines(i){m.toggleClasses(this.element,"b-no-row-lines",!i)}get keyMapElement(){return this.bodyElement}fixSizes(){this.callEachSubGrid("fixWidths");const i=this.headerContainer.querySelectorAll(".b-grid-header.b-depth-0");for(let t=0,{length:e}=i;t<e;t++)i[t].setAttribute("aria-colindex",t+1)}onRowManagerChangeTotalHeight({totalHeight:i,immediate:t}){return this.refreshTotalHeight(i,t)}refreshTotalHeight(i=this.rowManager.totalHeight,t=!1){const e=this;if(e.renderingRows||!e.isVisible)return!1;const r=e.scrollable,l=Math.abs(e.virtualScrollHeight-i),o=e._bodyRectangle.height,s=i-o;if(l){const n=s-e._scrollTop<o*2||e._verticalScrollHeight&&e._verticalScrollHeight-o<e._scrollTop;r.scrollHeight=e.virtualScrollHeight=i,e.isPainted&&(e.scrolling&&!n||l<100)&&!t?e.bufferedFixElementHeights():(e.virtualScrollHeightDirty&&e.virtualScrollHeightDirty(),e.bufferedFixElementHeights.cancel(),e.fixElementHeights())}}fixElementHeights(){const i=this,t=i.virtualScrollHeight,e=`${t}px`;i._verticalScrollHeight=t,i.verticalScroller.style.height=e,i.virtualScrollHeightDirty=!1,i.autoHeight&&(i.bodyContainer.style.height=e,i._bodyHeight=t,i.refreshBodyRectangle()),i.refreshVirtualScrollbars()}refreshBodyRectangle(){return this._bodyRectangle=M.client(this.bodyContainer)}set scrolling(i){this._scrolling=i}get scrolling(){return this._scrolling}enableScrollingCloseToEdges(i){this.scrollManager.startMonitoring({scrollables:[{element:this.scrollable.element,direction:"vertical"},...H.asArray(i||[]).map(t=>({element:(typeof t=="string"?this.subGrids[t]:t).scrollable.element}))],direction:"horizontal"})}disableScrollingCloseToEdges(i){this.scrollManager.stopMonitoring([this.scrollable.element,...H.asArray(i||[]).map(t=>(typeof t=="string"?this.subGrids[t]:t).element)])}onRowManagerRequestScrollChange({bottom:i}){this.scrollable.y=i-this.bodyHeight}initScroll(){const i=this,{scrollable:t}=i;i.scrollInitialized||(i.scrollInitialized=!0,t.contentElement=i.contentElement,t.ion({scroll:"onGridVerticalScroll",scrollend:"onGridVerticalScrollEnd",thisObj:i}),i.callEachSubGrid("initScroll"),k.isMobileSafari&&(t.element.style.transform="translate3d(0, 0, 0)"))}onGridVerticalScroll({source:i}){const t=this,{y:e}=i;e!==t._scrollTop&&(t._scrollTop=e,t.scrolling||(t.scrolling=!0,t.eachSubGrid(r=>r.suspendResizeMonitor=!0)),t.rowManager.updateRenderedRows(e),t.afterScroll({scrollTop:e}),t.trigger("scroll",{scrollTop:e}))}onGridVerticalScrollEnd(){this.scrolling=!1,this.eachSubGrid(i=>i.suspendResizeMonitor=!1)}async scrollRowIntoView(i,t=ui){var e;const r=this,l=t.block||"nearest",{rowManager:o}=r,s=r.store.getById(i);if(s){let n;if(r.store.indexOf(s)===-1)return ft;let a=r.scrollable,d=r.getRecordCoords(s);const c=M.from(a.element);if(d.virtual){const u=d.block,h=l!=="nearest"?t:{block:u};if(n=a.scrollIntoView(d,{block:"center"}),o.scrollTargetRecordId=s,o.updateRenderedRows(a.y,!0),d=r.getRecordCoords(s),o.lastScrollTop=a.y,d.virtual)return ft;t.animate?(a.suspendEvents(),l==="end"||l==="nearest"&&u==="end"?a.y-=c.bottom-d.bottom:(l==="start"||l==="nearest"&&u==="start")&&(a.y+=d.y-c.y),o.updateRenderedRows(a.y,!1,!0),u==="end"?a.y-=o.appendRowBuffer*o.rowHeight-1:a.y+=o.prependRowBuffer*o.rowHeight-1,a.resumeEvents(),await a.scrollIntoView(r.getRecordCoords(s),Object.assign({},t,h))):(t.recursive||await n,await((e=r.scrollRowIntoView)==null?void 0:e.call(r,s,Object.assign({recursive:!0},t,h))))}else{let{column:u}=t;if(u){if(u.isModel||(u=r.columns.getById(u)||r.columns.get(u)),u){a=r.getSubGridFromColumn(u).scrollable;const h=M.from(o.getRowFor(s).getCell(u.id));d.x=h.x,d.width=h.width}}else t=x.assign({},t,{x:!1});await a.scrollIntoView(d,t)}}}scrollColumnIntoView(i,t){return i=i instanceof O?i:this.columns.get(i)||this.columns.getById(i)||this.columns.getAt(i),this.getSubGridFromColumn(i).scrollColumnIntoView(i,t)}scrollCellIntoView(i,t){return this.scrollRowIntoView(i.id,Object.assign({column:i.columnId},typeof t=="boolean"?{animate:t}:t))}scrollToBottom(i){return this.scrollRowIntoView(this.store.last,i)}scrollToTop(i){return this.scrollable.scrollBy(0,-this.scrollable.y,i)}storeScroll(){const i=this,t=i.storedScrollState={scrollTop:i.scrollable.y,scrollLeft:{}};return i.eachSubGrid(e=>{t.scrollLeft[e.region]=e.scrollable.x}),t}restoreScroll(i=this.storedScrollState){const t=this;t.eachSubGrid(e=>{var r;const l=i.scrollLeft[e.region];l!=null&&(e.scrollable.updateX(l),e.header.scrollable.updateX(l),e.footer.scrollable.updateX(l),(r=e.fakeScroller)==null||r.updateX(l))}),t.scrollable.updateY(i.scrollTop)}beginGridMeasuring(){const i=this;if(i.$measureCellElements||(i.$measureCellElements=m.createElement({className:"b-grid-subgrid "+(!i._isRowMeasured&&i.hasFeature("stripe")?"b-stripe":""),reference:"subGridElement",style:{position:"absolute",top:"-10000px",left:"-100000px",visibility:"hidden",contain:"strict"},children:[{className:"b-grid-row",reference:"rowElement",children:[{className:"b-grid-cell",reference:"cellElement",style:{width:"auto",contain:k.isFirefox?"layout paint":"layout style paint"}}]}]})),i.getConfig("element"),i.verticalScroller.appendChild(i.$measureCellElements.subGridElement),!i.rendered){const t=i.appendTo||i.insertBefore||document.body,e=m.getRootElement(typeof t=="string"?document.getElementById(t):t)||document.body;(!i.adopt||!e.contains(i.element))&&(e.appendChild(i.element),i.$removeAfterMeasuring=!0)}return i.$measureCellElements}endGridMeasuring(){this.$removeAfterMeasuring&&(this.element.remove(),this.$removeAfterMeasuring=!1),this.$measureCellElements.subGridElement.remove()}measureRowHeight(){const i=this,{rowElement:t}=i.beginGridMeasuring(),e=m.getStyleValue(t,["height","border-top-width","border-bottom-width"]),r=parseInt(e.height),l=k.isFirefox?globalThis.devicePixelRatio/Math.max(Math.trunc(globalThis.devicePixelRatio),1):1,o=e["border-top-width"]?Math.round(l*parseFloat(e["border-top-width"])):0,s=e["border-bottom-width"]?Math.round(l*parseFloat(e["border-bottom-width"])):0;(i.rowHeight==null||i.rowHeight===i._rowHeightFromStyle)&&(i.rowHeight=!isNaN(r)&&r?r:i.defaultRowHeight,i._rowHeightFromStyle=i.rowHeight),i._rowBorderHeight=o+s,i._isRowMeasured=!0,i.endGridMeasuring()}onThemeChange({theme:i}){this.whenVisible("measureRowHeight"),this.trigger("theme",{theme:i})}refreshRows(i=!1){const{element:t,rowManager:e}=this;t.classList.add("b-notransition"),i?e.returnToTop():e.refresh(!0),t.classList.remove("b-notransition")}refreshColumn(i){i.isVisible&&(i.isLeaf?this.rowManager.forEach(t=>t.renderCell(t.getCell(i.id))):i.children.forEach(t=>this.refreshColumn(t)))}refreshVirtualScrollbars(){const i=this,{headerContainer:t,footerContainer:e,virtualScrollers:r,scrollable:l,hasVerticalOverflow:o}=i,{classList:s}=r,n=!s.contains("b-hide-display"),a=Object.values(i.subGrids).some(c=>c.overflowingHorizontally),d=a!==n;if(d&&r.classList.toggle("b-hide-display",!a),m.scrollBarWidth){const c=o||l.overflowY==="scroll";t.classList.toggle("b-show-yscroll-padding",c),e.classList.toggle("b-show-yscroll-padding",c),r.classList.toggle("b-show-yscroll-padding",c),d&&(a&&i.callEachSubGrid("refreshFakeScroll"),i.onHeightChange())}}get hasVerticalOverflow(){return this.scrollable.hasOverflow("y")}get contentHeight(){const i=this.rowManager;return Math.max(i.totalHeight,i.bottomRow?i.bottomRow.bottom:0)}onContentChange(){const i=this,t=i.rowManager;i.isVisible?(t.estimateTotalHeight(),i.paintListener=null,i.refreshTotalHeight(i.contentHeight),i.callEachSubGrid("refreshFakeScroll"),i.onHeightChange()):i.paintListener||(i.paintListener=i.ion({paint:"onContentChange",once:!0,thisObj:i}))}triggerPaint(){this.isPainted||this.refreshBodyRectangle(),super.triggerPaint()}onHeightChange(){const i=this;i.refreshBodyRectangle(),i._bodyHeight=i.autoHeight?i.contentHeight:i.bodyContainer.offsetHeight}suspendRefresh(){this.refreshSuspended++}resumeRefresh(i){this.refreshSuspended&&!--this.refreshSuspended&&(i&&this.refreshRows(),this.trigger("resumeRefresh",{trigger:i}))}renderRows(i=!0){const t=this,e=i&&t.storeScroll();t.refreshSuspended||(t.trigger("beforeRenderRows"),t.renderingRows=!0,t.element.classList.add("b-grid-refreshing"),i||(t.scrollable.y=t._scrollTop=0),t.rowManager.reinitialize(!i),t.trigger("renderRows"),t.renderingRows=!1,t.onContentChange(),i&&t.restoreScroll(e),t.element.classList.remove("b-grid-refreshing"))}renderContents(){const i=this,{element:t,headerContainer:e,footerContainer:r,rowManager:l}=i;if(i.emptyCache(),i.isPainted){i._headerHeight=null,i.callEachSubGrid("refreshHeader"),i.callEachSubGrid("refreshFooter"),i.renderHeader(e,t),i.renderFooter(r,t),i.fixSizes();const o=l.removeAllRows();l.calculateRowCount(!1,!0,!0),l.rowCount&&(l.setPosition(o),i.renderRows())}}refreshHeaders(){this.callEachSubGrid("refreshHeader")}refreshHeader(i){i.subGrid.refreshHeader()}onPaintOverride(){}onInternalPaint({firstPaint:i}){var t;const e=this;if(e.ariaElement.setAttribute("aria-rowcount",e.store.count+1),(t=super.onInternalPaint)==null||t.call(this,...arguments),e.onPaintOverride()||!i)return;const{rowManager:r,store:l,element:o,headerContainer:s,bodyContainer:n,footerContainer:a}=e,d=m.scrollBarPadElement;let c,u=0;e.role=l!=null&&l.isTree?"treegrid":"grid",e.columns.ion({change:()=>c=!0,once:!0}),e.updateResponsive(e.width,0),c&&(e.callEachSubGrid("refreshHeader",s),e.callEachSubGrid("refreshFooter",a)),e.renderHeader(s,o),e.renderFooter(a,o),m.append(s,d),m.append(a,d),m.append(e.virtualScrollers,d),e.refreshBodyRectangle();const h=e.bodyContainer.offsetHeight;if(e.autoHeight?(e._bodyHeight=r.initWithHeight(o.offsetHeight-s.offsetHeight-a.offsetHeight,!0),n.style.height=e.bodyHeight+"px"):(e._bodyHeight=h,r.initWithHeight(e._bodyHeight,!0)),e.eachSubGrid(g=>{g.header.maxDepth>u&&(u=g.header.maxDepth)}),s.dataset.maxDepth=u,e.fixSizes(),(l.count||!l.isLoading)&&e.renderRows(),e.columns.usesAutoHeight){const{fonts:g}=document;(g==null?void 0:g.status)!=="loaded"&&g.ready.then(()=>!e.isDestroyed&&e.refreshRows())}e.initScroll(),e.initInternalEvents()}render(){var i;const t=this;t.requireSize=!!t.owner,super.render(...arguments),t.setupFocusListeners(),t.autoHeight||(t.headerContainer.offsetHeight&&!t.bodyContainer.offsetHeight&&console.warn("Grid element not sized correctly, please check your CSS styles and review how you size the widget"),!t.splitFrom&&!((i=t.features.split)!=null&&i.owner)&&!("minHeight"in t.initialConfig)&&!("height"in t.initialConfig)&&parseInt(globalThis.getComputedStyle(t.element).minHeight)===t.height&&console.warn(`The ${t.$$name} is sized by its predefined minHeight, likely this is not intended. Please check your CSS and review how you size the widget, or assign a fixed height in the config. For more information, see the "Basics/Sizing the component" guide in docs.`))}renderHeader(i,t){}renderFooter(i,t){}beforeRenderCell(){}beforeRenderRow(){}afterRenderRow(){}afterScroll(){}processCellEditor(i){}afterColumnsChange(){}afterRemove(i){}afterToggleGroup(){}afterToggleSubGrid(){}onConfigChange(i){super.onConfigChange(i),this.isConfiguring||this.afterConfigChange(i)}afterConfigChange(i){}afterAddListener(i,t){}afterRemoveListener(i,t){}syncMaskCover(i=this.masked){if(i){const t=i.cover==="body"&&this.rectangleOf("bodyContainer"),e=t&&this.rectangleOf("virtualScrollers"),{style:r}=i.element;r.marginTop=t?`${t.y}px`:"",r.height=t?`${t.height+((e==null?void 0:e.height)||0)}px`:""}}maskBody(i){let t;return this.bodyContainer&&(this.masked=Dt.mergeConfigs(this.loadMaskDefaults,i),t=this.masked),t}unmaskBody(){this.masked=null}updateEmptyText(i){var t,e;(t=this.emptyTextEl)==null||t.remove(),this.emptyTextEl=m.createElement({parent:(e=this.firstItem)==null?void 0:e.element,className:"b-empty-text",[i!=null&&i.includes("<")?"html":"text"]:i})}toggleEmptyText(){const{bodyContainer:i,store:t}=this;i==null||i.classList.toggle("b-grid-empty",!(t.count>0||t.isLoading||t.isCommitting))}updateReadOnly(i,t){var e;if(super.updateReadOnly(i,t),!this.isConfiguring)for(const r of this.columns.bottomColumns)(e=r.updateReadOnly)==null||e.call(r,i)}getCurrentConfig(i){const t=super.getCurrentConfig(i),{store:e}=this,r=e.getInlineData(i),l=e.getCurrentConfig(i)||t.store;return r.length&&(t.data=r),l&&e.originalModelClass===qe&&delete l.modelClass,x.isEmpty(l)||(t.store=l),t.store&&delete t.store.data,t}};F(Me,"bindStoreChangeset",!0),Me.initClass(),$.setVersion("grid","5.6.2"),Me._$name="GridBase";export{ge as Bar,ye as CellEdit,de as CellMenu,X as CheckColumn,O as Column,xe as ColumnDragToolbar,ce as ColumnPicker,Z as ColumnReorder,Be as ColumnResize,K as ColumnStore,Oe as CopyPasteBase,We as Filter,Re as FilterBar,_e as Footer,Me as GridBase,ot as GridElementEvents_default,L as GridFeatureManager,st as GridFeatures_default,Pe as GridFieldFilterPicker,ue as GridFieldFilterPickerGroup,nt as GridResponsive_default,at as GridSelection_default,dt as GridState_default,ut as GridSubGrids_default,Ee as Group,ie as Header,Fe as HeaderMenu,R as Location,ee as RegionResize,he as Row,Ie as RowManager,ne as RowNumberColumn,te as Sort,Ne as Stripe,re as SubGrid,q as WidgetColumn};
//# sourceMappingURL=chunk-GGOYEX2W.js.map
