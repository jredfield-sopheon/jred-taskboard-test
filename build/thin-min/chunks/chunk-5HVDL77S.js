/*!
 *
 * Bryntum TaskBoard 5.6.2
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
import{RowReorder as W,Summary as q}from"./chunk-JZO6LOO7.js";import{TransactionalFeature_default as U}from"./chunk-PFWHNAB4.js";import{ExportDialog as X,MultiPageExporter as Y,MultiPageVerticalExporter as J,PdfExport as K,SinglePageExporter as Q}from"./chunk-6RG3ITZU.js";import{Column as Z,ColumnStore as ee,GridFeatureManager as M}from"./chunk-GGOYEX2W.js";import{AvatarRendering as te}from"./chunk-4LHHPUQ6.js";import{Combo as re,DateHelper as E,DomHelper as b,DomSync as C,Editor as _,EventHelper as ae,Field as se,InstancePlugin as ie,ObjectHelper as V,Rectangle as T,StringHelper as k,Tooltip as ne,VersionHelper as le,__publicField as oe}from"./chunk-MZVS5JQA.js";var P=class extends Z{static get $name(){return"ResourceInfoColumn"}static get type(){return"resourceInfo"}static get fields(){return["showEventCount","showRole","showMeta","showImage","validNames","autoScaleThreshold","useNameAsImageName"]}static get defaults(){return{showImage:!0,showEventCount:!0,showMeta:null,showRole:!1,validNames:null,autoScaleThreshold:40,useNameAsImageName:!0,field:"name",htmlEncode:!1,width:140,cellCls:"b-resourceinfo-cell",editor:le.isTestEnv?!1:"text"}}construct(...t){super.construct(...t),this.avatarRendering=new te({element:this.grid.element})}doDestroy(){super.doDestroy(),this.avatarRendering.destroy()}getImageURL(t){const d=this.grid.resourceImagePath||"",e=d.split("//"),a=e.length>1?e[1]:d,r=k.joinPaths([a||"",t||""]);return e.length>1?e[0]+"//"+r:r}template(t,d){const e=this,{showImage:a,showRole:r,showMeta:i,showEventCount:l,grid:s}=e,{timeAxis:o,resourceImageExtension:n="",defaultResourceImageName:c}=s,m=typeof r=="string"?r:"role",g=l&&t.eventStore.getEvents({includeOccurrences:s.enableRecurringEvents,resourceRecord:t,startDate:o.startDate,endDate:o.endDate}).length;let u;if(a&&t.image!==!1)if(t.imageUrl)u=t.imageUrl;else{const h=typeof a=="string"?a:t.image||d&&e.useNameAsImageName&&d.toLowerCase()+n||c||"";u=h&&e.getImageURL(h),u&&!h.includes(".")&&(!e.validNames||e.validNames.includes(h))&&(u+=n)}return{class:"b-resource-info",children:[a&&e.avatarRendering.getResourceAvatar({resourceRecord:t,initials:t.initials,color:t.eventColor,iconCls:t.iconCls,imageUrl:u,defaultImageUrl:c&&this.getImageURL(c)}),r||l||i?{tag:"dl",children:[{tag:"dt",text:d},r?{tag:"dd",class:"b-resource-role",text:t.getValue(m)}:null,l?{tag:"dd",class:"b-resource-events",html:e.L("L{eventCountText}",g)}:null,i?{tag:"dd",class:"b-resource-meta",html:e.showMeta(t)}:null]}:d]}}defaultRenderer({grid:t,record:d,cellElement:e,value:a,isExport:r}){let i;return d.isSpecialRow?i="":r?i=a:(this.autoScaleThreshold&&t.rowHeight<this.autoScaleThreshold?e.style.fontSize=t.rowHeight/40+"em":e.style.fontSize="",i=this.template(d,a)),i}};ee.registerColumnType(P),P._$name="ResourceInfoColumn";var de=["top","before","after","bottom"],ce=(t,d)=>{switch(t){case"top":return"b-b";case"after":return d.rtl?"r-r":"l-l";case"right":return"l-l";case"bottom":return"t-t";case"before":return d.rtl?"l-l":"r-r";case"left":return"r-r"}},ue={top:1,bottom:1},me={estimate:1,measure:1},he={before:1,after:1},L=class extends ie{static get $name(){return"Labels"}static get configurable(){return{labelCls:"b-sch-label",top:null,after:null,right:null,bottom:null,before:null,left:null,thisObj:null,blurAction:"cancel",labelLayoutMode:"default",labelCharWidth:7}}static get pluginConfig(){return{chain:["onEventDataGenerated"]}}construct(t,d){const e=this;if(t.isVertical)throw new Error("Labels feature is not supported in vertical mode");e.scheduler=t,super.construct(t,d),(e.top||e.bottom||e.before||e.after)&&e.updateHostClasslist()}updateHostClasslist(){const{top:t,bottom:d}=this,{classList:e}=this.scheduler.element;e.remove("b-labels-topbottom"),e.remove("b-labels-top"),e.remove("b-labels-bottom"),(t||d)&&(e.add("b-labels-topbottom"),t&&e.add("b-labels-top"),d&&e.add("b-labels-bottom"))}onLabelDblClick(t){const d=this,e=t.target;if(e&&!d.scheduler.readOnly){const{side:a}=e.dataset,r=d[a],{editor:i,field:l}=r;if(i){const s=this.scheduler.resolveEventRecord(t.target);return s.readOnly?void 0:(i instanceof _||(r.editor=new _({blurAction:d.blurAction,inputField:i,scrollAction:"realign"})),r.editor.render(d.scheduler.element),r.editor.startEdit({target:e,align:ce(a,d.client),matchSize:!1,record:s,field:l}),t.stopImmediatePropagation(),!1)}}}changeTop(t){return this.processLabelSpec(t,"top")}updateTop(){this.updateHostClasslist()}changeAfter(t){return this.processLabelSpec(t,"after")}updateAfter(){this.updateHostClasslist()}changeRight(t){this[this.client.rtl?"before":"after"]=t}changeBottom(t){return this.processLabelSpec(t,"bottom")}updateBottom(){this.updateHostClasslist()}changeBefore(t){return this.processLabelSpec(t,"before")}updateBefore(){this.updateHostClasslist()}changeLeft(t){this[this.client.rtl?"after":"before"]=t}processLabelSpec(t,d){if(typeof t=="function")t={renderer:t};else if(typeof t=="string")t={field:t};else if(t)t=Object.setPrototypeOf({},t);else return null;const{scheduler:e}=this,{eventStore:a,resourceStore:r,taskStore:i,id:l}=e,{field:s,editor:o}=t;if(ue[d]&&(e.milestoneWidth=null),a&&!i?t.recordType="event":t.recordType="task",s){let n,c=!1;a&&!i&&(n=a.modelClass.fieldMap[s],n?(t.fieldDef=n,t.recordType="event",c=!0):Reflect.has(a.modelClass.prototype,s)&&(t.recordType="event",c=!0)),!n&&i&&(n=i.modelClass.fieldMap[s],n?(t.fieldDef=n,t.recordType="task",c=!0):Reflect.has(r.modelClass.prototype,s)&&(t.recordType="task",c=!0)),!n&&r&&(n=r.modelClass.fieldMap[s],n?(t.fieldDef=n,t.recordType="resource",c=!0):Reflect.has(r.modelClass.prototype,s)&&(t.recordType="resource",c=!0)),o&&(typeof o=="boolean"?e.editor={type:"textfield"}:typeof o=="string"&&(e.editor={type:o}),ae.on({element:e.timeAxisSubGrid.element,delegate:".b-sch-label",dblclick:"onLabelDblClick",thisObj:this}))}return t}doDisable(t){super.doDisable(t),this.client.isPainted&&this.client.refresh()}generateLabelConfigs(t){const d=this,e=[];for(const a of de)if(d[a]){const{field:r,fieldDef:i,recordType:l,renderer:s,thisObj:o}=d[a],n={tag:"label",className:{[d.labelCls]:1,[`${d.labelCls}-${a}`]:1},dataset:{side:a,taskFeature:`label-${a}`}};let c;const m=`${l}Record`,g=t[m];s?c=s.call(o||d.thisObj||d,{[m]:g,resourceRecord:t.resourceRecord,assignmentRecord:t.assignmentRecord,domConfig:n}):(c=g.getValue(r),(i==null?void 0:i.type)==="date"&&!s?c=E.format(c,d.client.displayDateFormat):c=k.encodeHtml(c)),n.html=c||"\xA0",e.push(n)}return e}measureLabels(t,d){const e=this,a=e.client.timeAxisViewModel.getSingleUnitInPixels("millisecond");for(const r of t)if(he[r.dataset.side]){let{html:i}=r,l=0;if(e.labelLayoutMode==="estimate")i.includes("<")&&(i=b.stripTags(i)),l=i.length*e.labelCharWidth+18;else{const o=e.labelMeasureElement||(e.labelMeasureElement=b.createElement({className:"b-sch-event-wrap b-measure-label",parent:e.client.foregroundCanvas}));o.retainElement=!0,C.sync({targetElement:o,domConfig:{onlyChildren:!0,children:[r]}}),l=o.firstElementChild.offsetWidth}const s=l/a;switch(r.dataset.side){case"before":d.startMS-=s;break;case"after":d.endMS+=s;break}}}onEventDataGenerated(t){var d;if(!this.disabled&&!((d=t.eventRecord)!=null&&d.isResourceTimeRange)){const e=this.generateLabelConfigs(t);me[this.labelLayoutMode]&&this.measureLabels(e,t),t.wrapperChildren.push(...e)}}updateLabelLayoutMode(){this.isConfiguring||this.client.refreshWithTransition()}updateLabelCharWidth(){this.isConfiguring||this.client.refreshWithTransition()}};L.featureClass="b-sch-labels",L._$name="Labels",M.registerFeature(L,!1,"Scheduler");var S=class extends U(W){onDragStart(...t){if(super.onDragStart(...t),this.client.transactionalFeaturesEnabled)return this.startFeatureTransaction()}onDrop(...t){return this.rejectFeatureTransaction(),super.onDrop(...t)}onAbort(...t){return this.rejectFeatureTransaction(),super.onAbort(...t)}};oe(S,"$name","RowReorder"),S._$name="RowReorder",M.registerFeature(S,!1,"Scheduler"),M.registerFeature(S,!0,"Gantt");var O=class extends q{static get $name(){return"TimelineSummary"}static get configurable(){return{showTooltip:!0}}static get pluginConfig(){return{chain:["renderRows","updateProject"]}}construct(t,d){const e=this;super.construct(t,d),e.summaries||(e.summaries=[{renderer:e.renderer}]),t.isTimelineBase&&(e.updateProject(t.project),t.ion({timeAxisViewModelUpdate:e.renderRows,thisObj:e}))}updateProject(t){this.detachListeners("summaryProject"),t.ion({name:"summaryProject",dataReady:"updateTimelineSummaries",thisObj:this})}renderRows(){this.client.isHorizontal&&this.client.timeAxisSubGrid.footer.element.querySelector(".b-grid-footer").classList.add("b-sch-summarybar"),super.renderRows(),this.disabled||this.render()}get summaryBarElement(){return this.client.element.querySelector(".b-sch-summarybar")}render(){const t=this,{client:d}=t,e=d.isHorizontal?"width":"height",a=d.timeAxisViewModel.columnConfig,r=t.summaryBarElement;r&&(!t._tip&&t.showTooltip&&t.summaries.some(i=>i.label)&&(t._tip=new ne({id:`${d.id}-summary-tip`,cls:"b-timeaxis-summary-tip",hoverDelay:0,hideDelay:100,forElement:r,anchorToTarget:!0,trackMouse:!1,forSelector:".b-timeaxis-tick",getHtml:({activeTarget:i})=>i._tipHtml})),r.innerHTML=a[a.length-1].map(i=>`<div class="b-timeaxis-tick" style="${e}: ${i.width}px"></div>`).join(""),t.updateTimelineSummaries())}refresh(){super.refresh(),this.updateTimelineSummaries()}doDisable(t){var d;const{isConfiguring:e}=this.client;super.doDisable(t),(d=this.summaryColumn)==null||d.toggle(!t),!e&&!t&&this.render()}doDestroy(){var t;(t=this._tip)==null||t.destroy(),super.doDestroy()}};O._$name="TimelineSummary";var y={completeview:"completeview",currentview:"currentview",daterange:"daterange"},ge=Promise.resolve(),A=t=>class extends t{async scrollRowIntoView(e,a){const{rowManager:r,scrollable:i}=e,l=i.y;return a<e.store.count&&(i.scrollTo(null,r.calculateTop(a)),i.y!==l)?new Promise(s=>{const o=e.ion({scroll({scrollTop:n}){n!=null&&r.getRow(a)&&(o(),s())}})}):ge}async scrollToDate(e,a){let r=!1;const i=[],l=e.timeAxisSubGrid.scrollable.ion({scrollStart({x:s}){s!=null&&(r=!0)}});i.push(e.scrollToDate(a,{block:"start"})),l(),r&&i.push(e.timeAxisSubGrid.header.scrollable.await("scrollEnd",{checkLog:!1})),await Promise.all(i)}cloneElement(e,a,r){super.cloneElement(e,a,r);const i=this.element.querySelector(".b-schedulerbase");i==null||i.classList.remove(...["fade-in","slide-from-left","slide-from-top","zoom-in"].map(l=>`b-initial-${l}`))}async prepareComponent(e){const a=this,{client:r}=e,{currentOrientation:i}=r,l=r.timeAxisSubGrid.width>0;switch(e.scheduleRange){case y.completeview:e.rangeStart=r.startDate,e.rangeEnd=r.endDate;break;case y.currentview:{const{startDate:h,endDate:f}=r.visibleDateRange;e.rangeStart=h,e.rangeEnd=f;break}}await r.waitForAnimations(),e.infiniteScroll=r.infiniteScroll,r.infiniteScroll=!1,l&&(r.setTimeSpan(e.rangeStart,e.rangeEnd),e.scheduleRange===y.daterange&&(e.rangeStart=r.startDate,e.rangeEnd=r.endDate),r.svgCanvas),a._oldEnableEventAnimations=r.enableEventAnimations,r.enableEventAnimations=!1,i.isHorizontalRendering&&(a._oldScrollBuffer=i.scrollBuffer,a._oldVerticalBuffer=i.verticalBufferSize,i.scrollBuffer=100,i.verticalBufferSize=-1),r.ignoreViewBox=!0,await super.prepareComponent(e);const{exportMeta:s,element:o}=a,n=o.querySelector(".b-sch-foreground-canvas"),c=o.querySelector(".b-horizontaltimeaxis");if(s.includeTimeline=l,l&&e.scheduleRange!==y.completeview){s.totalWidth-=s.subGrids.normal.width,s.totalWidth+=s.subGrids.normal.width=r.timeAxisViewModel.getDistanceBetweenDates(e.rangeStart,e.rangeEnd);const h=Math.ceil(s.totalWidth/s.pageWidth),f=h*s.verticalPages;s.horizontalPages=h,s.totalPages=f,s.subGrids.normal.scrollLeft=r.getCoordinateFromDate(e.rangeStart)}s.timeAxisHeaders=[],s.timeAxisPlaceholders=[],s.headersColleted=!1,b.forEachSelector(c,".b-sch-header-row",h=>{s.timeAxisPlaceholders.push(a.createPlaceholder(h)),s.timeAxisHeaders.push(new Map)}),s.subGrids.normal.eventsPlaceholder=a.createPlaceholder(n,!1),b.removeEachSelector(n,".b-sch-event-wrap,.b-sch-resourcetimerange"),b.removeEachSelector(a.element,".b-released"),s.eventsBoxes=new Map,s.client=r;const m=o.querySelector(".b-column-lines-canvas"),g=o.querySelector(".b-sch-timeaxiscolumn .b-sch-timeranges-canvas"),u=o.querySelector(".b-timeaxissubgrid .b-sch-timeranges-canvas");if(r.hasActiveFeature("columnLines")&&m&&(s.columnLinesPlaceholder=a.createPlaceholder(m),s.columnLines={lines:new Map,majorLines:new Map}),r.hasActiveFeature("timeRanges")&&u&&(s.timeRanges={},g&&(s.timeRanges.header=e.enableDirectRendering?"":{},s.timeRangesHeaderPlaceholder=a.createPlaceholder(g)),s.timeRanges.body=e.enableDirectRendering?"":{},s.timeRangesBodyPlaceholder=a.createPlaceholder(u)),r.hasActiveFeature("dependencies")){r.features.dependencies.fillDrawingCache();const h=o.querySelector(`[id="${r.svgCanvas.getAttribute("id")}"]`);h&&(s.dependencyCanvasEl=h,s.dependenciesPlaceholder=a.createPlaceholder(h,!1,{ns:"http://www.w3.org/2000/svg",tag:"path"}),b.removeEachSelector(h,".b-sch-dependency"))}l&&!E.betweenLesser(e.rangeStart,r.startDate,r.endDate)&&await a.scrollToDate(r,e.rangeStart)}async restoreState(e){let a=!1;const{client:r}=e,i=[],l=r.timeAxisSubGrid.scrollable.ion({scrollStart({x:s}){this.element.scrollLeft!==s&&(a=!0)}});i.push(super.restoreState(e)),l(),a&&i.push(r.timeAxisSubGrid.header.scrollable.await("scrollEnd",{checkLog:!1})),await Promise.all(i)}async restoreComponent(e){const{client:a}=e,{currentOrientation:r}=a;a.ignoreViewBox=!1,a.infiniteScroll=e.infiniteScroll,a.enableEventAnimations=this._oldEnableEventAnimations,r.isHorizontalRendering&&(r.scrollBuffer=this._oldScrollBuffer,r.verticalBufferSize=this._oldVerticalBuffer),await super.restoreComponent(e)}async onRowsCollected(e,a){const r=this;if(await super.onRowsCollected(e,a),r.exportMeta.includeTimeline){const{client:i,enableDirectRendering:l}=a,{timeView:s}=i,{pageRangeStart:o,pageRangeEnd:n}=r.getCurrentPageDateRange(a);if(l)o&&n&&(r.renderHeaders(a,o,n),r.renderLines(a,o,n),r.renderRanges(a,o,n),r.renderEvents(a,e,o,n));else{if(o){let c=!1;for(await r.scrollToDate(i,o);!c;)if(r.collectLines(a),r.collectHeaders(a),r.collectRanges(a),r.collectEvents(e,a),E.timeSpanContains(s.startDate,s.endDate,o,n))c=!0;else if(s.endDate.getTime()>=n.getTime())c=!0;else{const m=s.endDate;if(await r.scrollToDate(i,s.endDate),m.getTime()===s.endDate.getTime())throw new Error("Could not scroll to date")}}await r.scrollToDate(i,a.rangeStart)}}}getCurrentPageDateRange({rangeStart:e,rangeEnd:a,enableDirectRendering:r,client:i}){const l=this,{exportMeta:s}=l,{horizontalPages:o,horizontalPosition:n,pageWidth:c,subGrids:m}=s;let g,u;if(o>1){const h=n*c,f=(n+1)*c,p=m.locked.width+m.locked.splitterWidth;if(f<=p)u=g=null;else{const{scrollLeft:x=0}=m.normal;g=i.getDateFromCoordinate(Math.max(h-p+x,0));const v=r?1:1.2;u=i.getDateFromCoordinate((f-p+x)*v)||a}}else g=e,u=a;return{pageRangeStart:g,pageRangeEnd:u}}prepareExportElement(){const{element:e,exportMeta:a}=this,{id:r,headerId:i,footerId:l,scrollLeft:s}=a.subGrids.normal;return e.querySelector(`[id="${r}"]`).querySelectorAll(".b-sch-canvas").forEach(n=>{a.lastExportedRowBottom?n.style.height=`${a.lastExportedRowBottom}px`:n.style.height="",s&&(n.style.marginLeft=`-${s}px`)}),s&&[i,l].forEach(n=>{const c=e.querySelector(`[id="${n}"] .b-widget-scroller`);c&&(c.style.marginLeft=`-${s}px`)}),super.prepareExportElement()}collectHeaders(e){const a=this,{client:r}=e,{exportMeta:i}=a;if(!i.headersCollected){const l=r.timeView.element,s=i.timeAxisHeaders;b.forEachSelector(l,".b-sch-header-row",(o,n,c)=>{const m=s[n];b.forEachSelector(o,".b-sch-header-timeaxis-cell",g=>{m.has(g.dataset.tickIndex)||m.set(g.dataset.tickIndex,g.outerHTML)}),n===c.length-1&&m.has(String(r.timeAxis.count-1))&&(i.headersCollected=!0)})}}collectRanges(e){const a=this,{client:r}=e,{exportMeta:i}=a,{timeRanges:l}=i;if(!i.headersCollected&&l){const{headerCanvas:s,bodyCanvas:o}=r.features.timeRanges;s&&b.forEachSelector(s,".b-sch-timerange",n=>{l.header[n.dataset.id]=n.outerHTML}),b.forEachSelector(o,".b-sch-timerange",n=>{l.body[n.dataset.id]=n.outerHTML})}}collectLines(e){const a=this,{client:r}=e,{exportMeta:i}=a,{columnLines:l}=i;!i.headersCollected&&l&&r.timeAxisSubGridElement.querySelectorAll(".b-column-line, .b-column-line-major").forEach(s=>{if(s.classList.contains("b-column-line")){const o=Number(s.dataset.line.replace(/line-/,""));l.lines.set(o,s.outerHTML)}else{const o=Number(s.dataset.line.replace(/major-/,""));l.majorLines.set(o,s.outerHTML)}})}collectEvents(e,a){const r=this,i=e.length,{client:l}=a,s=r.exportMeta.subGrids.normal.rows;e.forEach((o,n)=>{var c,m;const g=s[s.length-i+n],u=l.store.getAt(o.dataIndex),h=g[3];(c=u.events)==null||c.forEach(f=>{if(f.isScheduled){let p=l.getElementFromEventRecord(f,u);p&&(p=p.parentElement)&&!h.has(f.id)&&h.set(f.id,[p.outerHTML,T.from(p,p.offsetParent)])}}),(m=u.timeRanges)==null||m.forEach(f=>{var p;const x=((p=l.features.resourceTimeRanges)==null?void 0:p.generateElementId(f))||"",v=l.foregroundCanvas.syncIdMap[x];v&&!h.has(x)&&h.set(x,[v.outerHTML,T.from(v,v.offsetParent)])})})}renderHeaders(e,a,r){const i=this,{exportMeta:l}=i,{client:s}=e,o=l.timeAxisHeaders,{timeAxisView:n}=s.timeAxisColumn,c=n.buildCells(a,r),m=document.createElement("div");C.sync({targetElement:m,domConfig:c}),b.forEachSelector(m,".b-sch-header-row",(g,u)=>{const h=o[u];b.forEachSelector(g,".b-sch-header-timeaxis-cell",f=>{h.has(f.dataset.tickIndex)||h.set(f.dataset.tickIndex,f.outerHTML)})})}renderEvents(e,a,r,i){const l=this,{client:s}=e,o=l.exportMeta.subGrids.normal.rows;a.forEach((n,c)=>{const m=o[c],g=m[3],u=s.store.getAt(n.dataIndex),h=s.currentOrientation.getResourceLayout(u),f=s.getCoordinateFromDate(r),p=s.getCoordinateFromDate(i),x=s.currentOrientation.getEventDOMConfigForCurrentView(h,n,f,p),v=document.createElement("div");x.forEach(w=>{const{eventId:D}=w.dataset,{left:R,top:G,width:N,height:z}=w.style;C.sync({targetElement:v,domConfig:w}),g.set(D,[v.outerHTML,new T(R,G,N,z)])})})}renderLines(e,a,r){const i=this,{client:l}=e,{exportMeta:s}=i,{columnLines:o}=s;if(o){const n=l.features.columnLines.getColumnLinesDOMConfig(a,r),c=document.createElement("div");C.sync({targetElement:c,domConfig:{onlyChildren:!0,children:n}}),o.lines.set(0,c.innerHTML)}}renderRanges(e,a,r){const i=this,{client:l}=e,{exportMeta:s}=i,{timeRanges:o}=s;if(o){const n=l.features.timeRanges.getDOMConfig(a,r),c=document.createElement("div");n.forEach((m,g)=>{C.sync({targetElement:c,domConfig:{children:m,onlyChildren:!0}}),g===0?o.body=c.innerHTML:o.header=c.innerHTML})}}buildPageHtml(e){const a=this,{subGrids:r,timeAxisHeaders:i,timeAxisPlaceholders:l,columnLines:s,columnLinesPlaceholder:o,timeRanges:n,timeRangesHeaderPlaceholder:c,timeRangesBodyPlaceholder:m}=a.exportMeta,{enableDirectRendering:g}=e;let u=a.prepareExportElement();if(Object.values(r).forEach(({placeHolder:h,eventsPlaceholder:f,rows:p,mergedCellsHtml:x})=>{const v=h.outerHTML,{resources:w,events:D}=a.positionRows(p,e);let R=w.join("");x!=null&&x.length&&(R+=`<div class="b-grid-merged-cells-container">${x.join("")}</div>`),u=u.replace(v,R),f&&(u=u.replace(f.outerHTML,D.join("")))}),i.forEach((h,f)=>{u=u.replace(l[f].outerHTML,Array.from(h.values()).join(""))}),s){const h=Array.from(s.lines.values()).concat(Array.from(s.majorLines.values()));u=u.replace(o.outerHTML,h.join("")),g&&(a.exportMeta.columnLines.lines.clear(),a.exportMeta.columnLines.majorLines.clear())}return n&&(g?(u=u.replace(m.outerHTML,n.body),c&&(u=u.replace(c.outerHTML,n.header)),a.exportMeta.timeRanges={}):(u=u.replace(m.outerHTML,Object.values(n.body).join("")),c&&(u=u.replace(c.outerHTML,Object.values(n.body).join(""))))),u=a.buildDependenciesHtml(u),u}getEventBox(e){const a=this,{eventsBoxes:r,enableDirectRendering:i}=a.exportMeta,l=e&&r.get(String(e.id));return i&&l&&e.isMilestone&&l.translate(-l.width/2,0),l}renderDependencies(){const e=this,{client:a,eventsBoxes:r}=e.exportMeta,{dependencies:i}=a,l=a.features.dependencies,s=b.createElement();let o=!1;return i.forEach(n=>{if(!r.has(String(n.from))&&!r.has(String(n.to))||!l.isDependencyVisible(n))return;const c=e.getEventBox(n.fromEvent),m=e.getEventBox(n.toEvent);l.drawDependency(n,!0,{from:c==null?void 0:c.clone(),to:m==null?void 0:m.clone()}),o=!0}),o&&l.domSync(s,!0),s.innerHTML}buildDependenciesHtml(e){const{dependenciesPlaceholder:a,includeTimeline:r}=this.exportMeta;if(a&&r){const i=a.outerHTML;e=e.replace(i,this.renderDependencies())}return e}},H=class extends A(Y){static get $name(){return"MultiPageExporter"}static get type(){return"multipage"}async stateNextPage(t){await super.stateNextPage(t),this.exportMeta.eventsBoxes.clear()}positionRows(t){const d=[],e=[];return t.forEach(([a,r,i,l])=>{d.push(a),l&&Array.from(l.entries()).forEach(([s,[o,n,c=[]]])=>{e.push(o+c.join("")),this.exportMeta.eventsBoxes.set(String(s),n)})}),{resources:d,events:e}}};H._$name="MultiPageExporter";var F=class extends A(J){static get $name(){return"MultiPageVerticalExporter"}static get type(){return"multipagevertical"}async stateNextPage(t){await super.stateNextPage(t),this.exportMeta.eventsBoxes.clear()}async prepareComponent(t){await super.prepareComponent(t),t.scheduleRange!==y.completeview&&this.estimateTotalPages(t)}positionRows(t){const d=[],e=[];return t.forEach(([a,,,r])=>{d.push(a),r&&Array.from(r.entries()).forEach(([i,[l,s,o=[]]])=>{e.push(l+o.join("")),this.exportMeta.eventsBoxes.set(String(i),s)})}),{resources:d,events:e}}};F._$name="MultiPageVerticalExporter";var B=class extends re{static get $name(){return"ScheduleRangeCombo"}static get type(){return"schedulerangecombo"}static get defaultConfig(){return{editable:!1,localizeDisplayFields:!0,displayField:"text",buildItems(){return Object.entries(y).map(([t,d])=>({value:t,text:"L{"+d+"}"}))}}}};B.initClass(),B._$name="ScheduleRangeCombo";var I=class extends X{static get $name(){return"SchedulerExportDialog"}static get type(){return"schedulerexportdialog"}static get configurable(){return{defaults:{localeClass:this},items:{scheduleRangeField:{type:"schedulerangecombo",label:"L{Schedule range}",name:"scheduleRange",value:"completeview",weight:150,onChange({value:t}){this.parent.widgetMap.rangesContainer.hidden=t!==y.daterange}},rangesContainer:{type:"container",flex:"1 0 100%",weight:151,hidden:!0,defaults:{localeClass:this},items:{filler:{weight:0,type:"widget",style:"margin-inline-end: -1em;"},rangeStartField:{type:"datefield",label:"L{Export from}",name:"rangeStart",labelWidth:"3em",flex:"1 0 25%",weight:10,onChange({value:t}){this.parent.widgetMap.rangeEndField.min=E.add(t,1,"d")}},rangeEndField:{type:"datefield",label:"L{Export to}",name:"rangeEnd",labelWidth:"1em",flex:"1 0 25%",weight:30,onChange({value:t}){this.parent.widgetMap.rangeStartField.max=E.add(t,-1,"d")}}}}}}}onLocaleChange(){const t=this.L("labelWidth");this.width=this.L("L{width}"),this.items.forEach(d=>{d instanceof se?d.labelWidth=t:d.ref==="rangesContainer"&&(d.items[0].width=t)})}applyInitialValues(t){super.applyInitialValues(t);const d=this,{client:e,scheduleRange:a}=t,r=t.items=t.items||{},i=r.scheduleRangeField=r.scheduleRangeField||{},l=r.rangesContainer=r.rangesContainer||{},s=l.items=l.items||{},o=s.filler=s.filler||{},n=s.rangeStartField=s.rangeStartField||{},c=s.rangeEndField=s.rangeEndField||{};o.width=d.L("labelWidth"),i.value=i.value||a,i.value===y.daterange&&(l.hidden=!1);const m=n.value=n.value||e.startDate;n.max=E.max(e.startDate,E.add(e.endDate,-1,"d"));let g=c.value||e.endDate;g<=m&&(g=E.add(m,1,"d")),c.value=g,c.min=E.min(e.endDate,E.add(e.startDate,1,"d"))}};I._$name="SchedulerExportDialog";var j=class extends A(Q){static get $name(){return"SinglePageExporter"}static get type(){return"singlepage"}collectDependencies(){}positionRows(t,d){const e=[],a=[],r=/translate\((\d+.?\d*)px, (\d+.?\d*)px\)/,i=/top:.+?px/;if(d.enableDirectRendering)t.forEach(([l,,,s])=>{e.push(l),s&&Array.from(s.entries()).forEach(([o,[n,c,m=[]]])=>{this.exportMeta.eventsBoxes.set(String(o),c),a.push(n+m.join(""))})});else{let l=0;t.forEach(([s,o,n,c])=>{e.push(s.replace(r,`translate($1px, ${l}px)`));const m=l-o;c&&Array.from(c.entries()).forEach(([g,[u,h]])=>{h.translate(0,m),this.exportMeta.eventsBoxes.set(String(g),h),a.push(u.replace(i,`top: ${h.y}px`))}),l+=n})}return{resources:e,events:a}}};j._$name="SinglePageExporter";var $=class extends K{static get $name(){return"PdfExport"}static get defaultConfig(){return{exporters:[j,H,F],dialogClass:I,scheduleRange:"completeview",rangeStart:null,rangeEnd:null}}get defaultExportDialogConfig(){return V.copyProperties(super.defaultExportDialogConfig,this,["scheduleRange"])}buildExportConfig(t){t=super.buildExportConfig(t);const{scheduleRange:d,rangeStart:e,rangeEnd:a}=this;return t.columns&&!t.columns.find(r=>r.type==="timeAxis")&&t.columns.push(t.client.timeAxisColumn.id),V.assign({scheduleRange:d,rangeStart:e,rangeEnd:a},t)}};$._$name="PdfExport",M.registerFeature($,!1,"Scheduler");export{L as Labels,H as MultiPageExporter,F as MultiPageVerticalExporter,$ as PdfExport,P as ResourceInfoColumn,S as RowReorder,y as ScheduleRange,B as ScheduleRangeCombo,I as SchedulerExportDialog,j as SinglePageExporter,O as TimelineSummary};
//# sourceMappingURL=chunk-5HVDL77S.js.map
