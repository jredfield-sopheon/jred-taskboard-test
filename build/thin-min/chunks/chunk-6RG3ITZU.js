/*!
 *
 * Bryntum TaskBoard 5.6.2
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
import{GridFeatureManager as U}from"./chunk-GGOYEX2W.js";import{Toast as k}from"./chunk-6ZLMCHE5.js";import{AjaxHelper as q,Base as J,BrowserHelper as $,Combo as _,Delayable_default as X,DomHelper as C,DomSync as Y,EventHelper as K,Events_default as Q,Field as Z,IdHelper as ee,InstancePlugin as te,LocaleManager_default as re,Localizable_default as oe,ObjectHelper as D,Popup as ie,TemplateHelper as ae,VersionHelper as se}from"./chunk-MZVS5JQA.js";var v={all:"all",visible:"visible"},F={A6:{width:4.11,height:5.81},A5:{width:5.81,height:8.25},A4:{width:8.25,height:11.69,portraitWidth:8.3,portraitHeight:11.7,landscapeWidth:11.7,landscapeHeight:8.26},A3:{width:11.69,height:16.49,portraitWidth:11.7,portraitHeight:16.49,landscapeWidth:16.54,landscapeHeight:11.68},Legal:{width:8.5,height:14},Letter:{width:8.5,height:11}};function G(){return $.isFirefox?{portraitWidth:0,portraitHeight:0,landscapeWidth:0,landscapeHeight:.26}:$.isSafari?{portraitWidth:0,portraitHeight:.1,landscapeWidth:0,landscapeHeight:.5}:{portraitWidth:0,portraitHeight:0,landscapeWidth:0,landscapeHeight:.25}}var T={portrait:"portrait",landscape:"landscape"},W={pdf:"pdf",png:"png"},le={pdf:"application/pdf",png:"image/png"},O=class extends _{static get $name(){return"ExportRowsCombo"}static get type(){return"exportrowscombo"}static get defaultConfig(){return{editable:!1}}buildItems(){const t=this;return[{id:v.all,text:t.L("L{all}")},{id:v.visible,text:t.L("L{visible}")}]}};O.initClass(),O._$name="ExportRowsCombo";var N=class extends _{static get $name(){return"ExportOrientationCombo"}static get type(){return"exportorientationcombo"}static get defaultConfig(){return{editable:!1}}buildItems(){const t=this;return[{id:T.portrait,text:t.L("L{portrait}")},{id:T.landscape,text:t.L("L{landscape}")}]}};N.initClass(),N._$name="ExportOrientationCombo";function z(t,e=r=>r){return Object.keys(t).map(r=>({id:r,text:e(r)}))}var V=class extends ie{static get $name(){return"ExportDialog"}static get type(){return"exportdialog"}static get configurable(){return{autoShow:!1,autoClose:!1,closable:!0,centered:!0,client:null,autoSelectVisibleColumns:!0,hidePNGMultipageOption:!0,useBrowserPrint:!1,title:"L{exportSettings}",maxHeight:"80%",scrollable:{overflowY:!0},defaults:{localeClass:this},items:{columnsField:{type:"combo",label:"L{ExportDialog.columns}",name:"columns",store:{},valueField:"id",displayField:"text",multiSelect:!0,weight:100,maxHeight:100},rowsRangeField:{type:"exportrowscombo",label:"L{ExportDialog.rows}",name:"rowsRange",value:"all",weight:200},exporterTypeField:{type:"combo",label:"L{ExportDialog.exporterType}",name:"exporterType",editable:!1,value:"singlepage",displayField:"text",buildItems(){const t=this.parent;return t.exporters.map(e=>({id:e.type,text:t.optionalL(e.title,this)}))},onChange({value:t}){this.owner.widgetMap.alignRowsField.hidden=t==="singlepage",this.owner.widgetMap.repeatHeaderField.hidden=t!=="multipagevertical"},weight:300},alignRowsField:{type:"checkbox",label:"L{ExportDialog.alignRows}",name:"alignRows",checked:!1,hidden:!0,weight:400},repeatHeaderField:{type:"checkbox",label:"L{ExportDialog.repeatHeader}",name:"repeatHeader",localeClass:this,hidden:!0,weight:500},fileFormatField:{type:"combo",label:"L{ExportDialog.fileFormat}",name:"fileFormat",localeClass:this,editable:!1,value:"pdf",items:[],onChange({value:t,oldValue:e}){const r=this.parent;if(r.hidePNGMultipageOption){const o=r.widgetMap.exporterTypeField,i=o.store.find(s=>s.id==="singlepage");t===W.png&&i?(this._previousDisabled=o.disabled,o.disabled=!0,this._previousValue=o.value,o.value="singlepage"):e===W.png&&this._previousValue&&(o.disabled=this._previousDisabled,o.value=this._previousValue)}},weight:600},paperFormatField:{type:"combo",label:"L{ExportDialog.paperFormat}",name:"paperFormat",editable:!1,value:"A4",items:[],weight:700},orientationField:{type:"exportorientationcombo",label:"L{ExportDialog.orientation}",name:"orientation",value:"portrait",weight:800}},bbar:{defaults:{localeClass:this},items:{exportButton:{color:"b-green",text:"L{ExportDialog.export}",weight:100,onClick:"up.onExportClick"},cancelButton:{color:"b-gray",text:"L{ExportDialog.cancel}",weight:200,onClick:"up.onCancelClick"}}}}}construct(t={}){const e=this,{client:r}=t;if(!r)throw new Error("`client` config is required");e.columnsStore=r.columns.chain(o=>o.isLeaf&&o.exportable,null,{excludeCollapsedRecords:!1}),e.applyInitialValues(t),super.construct(t),re.ion({locale:"onLocaleChange",prio:-1,thisObj:e})}updateUseBrowserPrint(t){const e=this;e.whenVisible(()=>{t?(e.widgetMap.exportButton.text=e.L("L{ExportDialog.print}"),e.widgetMap.fileFormatField.hidden=!0,e.title=e.L("L{printSettings}")):(e.widgetMap.exportButton.text=e.L("L{ExportDialog.export}"),e.widgetMap.fileFormatField.hidden=!!e.widgetMap.fileFormatField.initialConfig.hidden,e.title=e.L("L{exportSettings}"))})}applyInitialValues(t){const e=this,r=t.items=t.items||{};t.width=t.width||e.L("L{width}"),t.defaults=t.defaults||{},t.defaults.labelWidth=t.defaults.labelWidth||e.L("L{ExportDialog.labelWidth}"),r.columnsField=r.columnsField||{},r.fileFormatField=r.fileFormatField||{},r.paperFormatField=r.paperFormatField||{},r.fileFormatField.items=z(W,o=>o.toUpperCase()),r.paperFormatField.items=z(F),r.columnsField.store=e.columnsStore}onBeforeShow(){var t;const{columnsField:e,alignRowsField:r,exporterTypeField:o,repeatHeaderField:i}=this.widgetMap;this.autoSelectVisibleColumns&&(e.value=this.columnsStore.query(s=>!s.hidden)),r.hidden=o.value==="singlepage",i.hidden=o.value!=="multipagevertical",(t=super.onBeforeShow)==null||t.call(this,...arguments)}onLocaleChange(){const t=this.L("L{labelWidth}");this.width=this.L("L{width}"),this.eachWidget(e=>{e instanceof Z&&(e.labelWidth=t)})}onExportClick(){const t=this.values;this.trigger("export",{values:t})}onCancelClick(){this.trigger("cancel"),this.hide()}};V.initClass(),V._$name="ExportDialog";var L=class extends X(Q(oe(J))){static get defaultConfig(){return{translateURLsToAbsolute:!0,keepPathName:!0,filterStyles:t=>t}}static inchToPx(t){return t*96}pageTpl(t){const{title:e,header:r,footer:o,styles:i,htmlClasses:s,bodyClasses:a=[],paperHeight:l,paperWidth:g,html:h,currentPage:w,isPrint:c}=t;let{htmlStyle:p="",bodyStyle:n=""}=t;return a.push(`b-${this.constructor.type}`),C.scrollBarWidth?a.push("b-visible-scrollbar"):a.push("b-overlay-scrollbar"),$.isChrome?a.push("b-chrome"):$.isSafari?a.push("b-safari"):$.isFirefox&&a.push("b-firefox"),p=c?p:`${p}; width: ${g}in; height: ${l}in;`,n=c?`${n}; width: ${g}in;`:`${n}; width: ${g}in; height: ${l}in;`,ae.tpl`
            <!DOCTYPE html>
            <html class="${s} b-print-root" style="${p}">
                <head>
                    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
                    <title>${e}</title>
                    ${i.join("")}
                </head>
                <body class="b-export ${a.join(" ")}" style="${n}">
                    <div class="b-export-content b-page-${w}">
                        ${r&&`<div class="b-export-header" style="width: 100%">${r}</div>`}
                        <div class="b-export-body"><div class="b-export-viewport">${h}</div></div>
                        ${o&&`<div class="b-export-footer" style="width: 100%">${o}</div>`}
                    </div>
                </body>
            </html>`}get stylesheets(){const t=this;if(t._stylesheets)return t._stylesheets;const e=t.translateURLsToAbsolute,r=globalThis.origin,o=Array.from(document.querySelectorAll('link[rel="stylesheet"], style')),i=[];return o.forEach(s=>{if(s=s.cloneNode(!0),e&&s.href){let l;e===!0?l=s.href:this.keepPathName?l=s.href.replace(r,e):l=new URL(s.getAttribute("href"),e),s.setAttribute("href",l)}let a=s.outerHTML;if(e&&/style/i.test(s.tagName)){const l=t.getStyleTagURLConverter(e);a=a.replace(/url\(['"]?(.+?)['"]?\)/g,l)}i.push(a)}),t._stylesheets=t.filterStyles(i)}set stylesheets(t){this._stylesheets=t&&this.filterStyles(t)}getStyleTagURLConverter(t){return function(e,r){let o;try{let i;/^#/.test(r)?o=e:(t===!0?i=globalThis.location.href:this.keepPathName?i=globalThis.location.href.replace(globalThis.location.origin,t):i=t,o=`url('${new URL(r,i).href}')`)}catch(i){o=e}return o}.bind(this)}saveState({client:t}){this.state=t.state}async restoreState({client:t}){const e=[],r=new Set;r.add(t.scrollable.ion({scroll(){e.push(t.scrollable.await("scrollEnd"))}})),t.eachSubGrid(({header:o,scrollable:i})=>{r.add(i.ion({scroll(){e.push(i.await("scrollEnd"))}})),r.add(o.scrollable.ion({scroll(){e.push(o.scrollable.await("scrollEnd"))}}))}),t.state=this.state,await Promise.all(e),r.forEach(o=>o())}beforeExport(){this.element=document.createElement("div")}cloneElement(t,e=this.element,r=!0){r&&(e.innerHTML=""),e.appendChild(t.cloneNode(!0)),C.removeEachSelector(e,".b-grid-row,.b-grid-merged-cells-container");const o=e.querySelector(".b-gridbase > .b-mask");o&&o.remove()}createPlaceholder(t,e=!0,r={}){return e&&(t.innerHTML=""),C.createElement(Object.assign({parent:t,id:ee.generateId("export")},r))}prepareElement({client:t}){const{tbar:e,bbar:r}=t;e&&this.element.querySelector(`#${e.id}`).remove(),r&&this.element.querySelector(`#${r.id}`).remove()}measureElement(t=""){t instanceof HTMLElement&&(t=t.outerHTML);const e=C.createElement({parent:document.body,style:{visibility:"hidden",position:"absolute"},html:`<div style="height: 1px"></div>${t}<div style="height: 1px"></div>`}),r=e.offsetHeight-2;return e.remove(),r}prepareHTML(t){t instanceof HTMLElement&&(t=t.outerHTML);const e=C.createElement({parent:document.body,style:{visibility:"hidden",position:"absolute"},html:t}),r=e.querySelectorAll("img");for(let i=0,s=r.length;i<s;i++)r[i].setAttribute("src",r[i].src);const o=e.innerHTML;return e.remove(),o}getVirtualScrollerHeight(t){let e=0;return t.eachSubGrid(r=>{r.overflowingHorizontally&&(e=C.scrollBarWidth)}),e===0?e:e+1}getPaperWidth(t,e){if("portraitWidth"in t){const r=e?"portraitWidth":"landscapeWidth";return t[r]-(this.exportMeta.isPrinting?G()[r]:0)}else return e?t.width:t.height}getPaperHeight(t,e){if("portraitHeight"in t){const r=e?"portraitHeight":"landscapeHeight";return t[r]-(this.exportMeta.isPrinting?G()[r]:0)}else return e?t.height:t.width}inchToPx(t){return t*96}getScaleValue(t,e){return Math.floor(t*1e4/e)/1e4}getVisibleRowsCount(t){const e=t.rowManager,r=e.rows.indexOf(e.firstVisibleRow),o=e.rows.indexOf(e.lastVisibleRow);let i;return r!==-1?o===-1?i=t.store.count-r:i=o-r+1:i=t.store.count,i}async export(t){const e=this;let r;e.beforeExport(),e.saveState(t),await e.prepareComponent(t);try{r=await e.getPages(t)}finally{await e.restoreComponent(t),e.stylesheets=null,await new Promise(o=>e.requestAnimationFrame(o)),await e.restoreState(t)}return r}async getPages(t){const e=this.pagesExtractor(t),r=[];let o;for(;(o=await e.next())&&!o.done;)r.push(o.value);return r}adjustRowBuffer(t){const{contentHeight:e}=this.exportMeta,{rowManager:r}=t;this.oldRowManagerConfig={prependRowBuffer:r.prependRowBuffer,appendRowBuffer:r.appendRowBuffer};const o=Math.ceil(e/r.rowOffsetHeight);r.prependRowBuffer=o,r.appendRowBuffer=o,t.renderRows(),t.rowManager.jumpToPosition(t.scrollable.y)}restoreRowBuffer(t){t.rowManager.prependRowBuffer=this.oldRowManagerConfig.prependRowBuffer,t.rowManager.appendRowBuffer=this.oldRowManagerConfig.appendRowBuffer}async prepareComponent(t){const e=this,{client:r,columns:o,rowsRange:i,keepRegionSizes:s,enableDirectRendering:a,useRenderedColumnWidth:l}=t,{rowManager:g}=r,h=e.exportMeta={enableDirectRendering:a,totalWidth:0,totalHeight:0-(a?0:e.getVirtualScrollerHeight(r)),subGrids:{},isPrinting:t.useBrowserPrint};r.columns.forEach(p=>{o.includes(p.id)?p.show():p.hide()}),await new Promise(p=>r.requestAnimationFrame(p)),g.rowCount>0&&(i===v.all?h.firstVisibleDataIndex=g.rows[0].dataIndex:(h.firstVisibleDataIndex=g.firstVisibleRow.dataIndex,t.alignRows=!0),a||await r.scrollRowIntoView(r.store.getAt(h.firstVisibleDataIndex),{block:"start"}));const{element:w}=e;e.cloneElement(r.element),e.prepareElement(t);let c;a&&(h.fakeRow=c=g.rowClass.new({cls:r.rowCls,rowManager:g,grid:r,index:-10,dataIndex:-10})),r.eachSubGrid(p=>{var n,m,u;c&&(p.onAddRow({rows:[c],isExport:!0}),c.element.dataset.ownerCmp=r.id);const f=e.createPlaceholder(w.querySelector(`[id="${p.id}"]`),!1);let d;if(s!=null&&s[p.region])d=p.element.offsetWidth;else{const{visibleColumns:b}=p.columns;b.length===1&&!b[0].isTimeAxisColumn&&e.state.columns.filter(y=>y.region===p.region&&!y.hidden&&y.id!==b[0].id).length===0?d=p.element.offsetWidth:d=p.columns.visibleColumns.reduce((y,H)=>(!l&&typeof H.width=="number"?y+=H.width:y+=(r.hideHeaders?g.rows[0].getCell(H.id):H.element).offsetWidth,y),0)}h.totalWidth+=d;const R=((n=p.splitterElement)==null?void 0:n.offsetWidth)||0;h.totalWidth+=R,h.subGrids[p.region]={id:p.id,headerId:((m=p.header)==null?void 0:m.id)||null,footerId:((u=p.footer)==null?void 0:u.id)||null,rows:[],splitterWidth:R,placeHolder:f,width:d}})}prepareExportElement(){const t=this,{element:e,exportMeta:r}=t;return Object.values(r.subGrids).forEach(({width:o,id:i,headerId:s,footerId:a})=>{[i,s,a].forEach(l=>{if(l){const g=e.querySelector(`[id="${l}"]`);g&&(g.style.width=`${o}px`,g.style.flex="")}})}),e.innerHTML}async restoreComponent(t){this.exportMeta.fakeRow&&(this.exportMeta.fakeRow.destroy(),delete this.exportMeta.fakeRow)}async scrollRowIntoView(t,e){await t.scrollRowIntoView(t.store.getAt(e),{block:"start"}),await new Promise(r=>this.requestAnimationFrame(r))}collectRow(t){const e=this.exportMeta.subGrids,r=/data-owner-cmp=".+?"/;Object.entries(t.elements).forEach(([o,i])=>{e[o].rows.push([i.outerHTML.replace(r,""),t.top,t.offsetHeight,new Map])})}renderMergedCells(t,e,r,o){const i=this,{client:s}=t,{subGrids:a}=i.exportMeta,l=s.features.mergeCells.buildMergedCellsConfig(e,r,o);for(const g in a){const h=a[g],w=document.createElement("div");Y.sync({targetElement:w,domConfig:{children:l[g].children}}),w.childNodes.length&&(w.childNodes.forEach(c=>{const{syncId:p}=c.dataset,n=s.features.mergeCells.mergedRanges.find(m=>{var u;return((u=m.cellElement)==null?void 0:u.parentNode.dataset.syncId)===p});n&&(c.innerHTML=n.cellElement.outerHTML)}),h.mergedCellsHtml=[w.innerHTML])}}};L.prototype.pagesExtractor=async function*(){throw new Error("Implement this method in a subclass")},L._$name="Exporter";var I=class extends L{static get $name(){return"MultiPageExporter"}static get type(){return"multipage"}static get title(){return this.L("L{multipage}")}static get exportingPageText(){return"L{exportingPage}"}async stateNextPage({client:t,rowsRange:e,enableDirectRendering:r}){const{exportMeta:o}=this;++o.currentPage,++o.verticalPosition,delete o.lastExportedRowBottom,o.verticalPosition>=o.verticalPages&&(Object.assign(o,{verticalPosition:0,horizontalPosition:o.horizontalPosition+1,currentPageTopMargin:0,lastTop:0,lastRowIndex:e===v.visible?t.rowManager.firstVisibleRow.dataIndex:0}),delete o.lastRowDataIndex,r||await this.scrollRowIntoView(t,o.firstVisibleDataIndex,{block:"start"}))}async prepareComponent(t){await super.prepareComponent(t);const e=this,{exportMeta:r}=e,{client:o,headerTpl:i,footerTpl:s,alignRows:a,rowsRange:l,enableDirectRendering:g}=t,h=F[t.paperFormat],w=t.orientation===T.portrait,c=e.getPaperWidth(h,w),p=e.getPaperHeight(h,w),n=e.inchToPx(c),m=e.inchToPx(p),u=l===v.visible,f=Math.ceil(r.totalWidth/n);let d=m;i&&(d-=e.measureElement(i({totalWidth:r.totalWidth,totalPages:-1,currentPage:-1}))),s&&(d-=e.measureElement(s({totalWidth:r.totalWidth,totalPages:-1,currentPage:-1})));let R,b,y=o.store.count;if(u?(y=e.getVisibleRowsCount(o),R=r.totalHeight+o.headerHeight+o.footerHeight+o.bodyHeight):R=r.totalHeight+o.headerHeight+o.footerHeight+o.scrollable.scrollHeight,a&&!u){const H=o.rowManager.rowOffsetHeight,P=Math.floor((d-o.headerHeight)/H),x=Math.floor(d/H),M=y-P;b=1+Math.ceil(M/x)}else b=Math.ceil(R/d);Object.assign(r,{paperWidth:c,paperHeight:p,pageWidth:n,pageHeight:m,horizontalPages:f,verticalPages:b,totalHeight:R,contentHeight:d,totalRows:y,totalPages:f*b,currentPage:0,verticalPosition:0,horizontalPosition:0,currentPageTopMargin:0,lastTop:0,lastRowIndex:u?o.rowManager.firstVisibleRow.dataIndex:0}),g||this.adjustRowBuffer(o)}async restoreComponent(t){await super.restoreComponent(t),t.enableDirectRendering||this.restoreRowBuffer(t.client)}async collectRows(t){const e=this,{exportMeta:r}=e,{client:o,alignRows:i,rowsRange:s}=t,{subGrids:a,currentPageTopMargin:l,verticalPosition:g,contentHeight:h,totalRows:w,lastRowDataIndex:c}=r,{rowManager:p}=o,{rows:n}=p,m=s===v.visible,u=o.hasActiveFeature("mergeCells");let f,d;m&&c!=null?c===n[n.length-1].dataIndex?d=n.length-1:d=n.findIndex(x=>x.dataIndex===c):d=m?n.findIndex(x=>x.bottom>Math.ceil(o.scrollable.y)):n.findIndex(x=>x.bottom+l+o.headerHeight>0);const R=d,b=m||g===0?0:n[d].top+l+o.headerHeight;f=h-b,g===0&&(f-=o.headerHeight);let y,H=0;for(;f>0;){const x=n[d];i&&f<x.offsetHeight?(H=-f,f=0,e.exportMeta.lastExportedRowBottom=n[d-1].bottom):(e.collectRow(x),f-=x.offsetHeight,y=x.dataIndex,(++d===n.length&&f>0||m&&d-R===w)&&(f=0))}if(u)for(const x in a){const M=a[x],E=o.subGrids[x].element.querySelectorAll(".b-grid-merged-cells");M.mergedCellsHtml=[];for(const A of E)M.mergedCellsHtml.push(A.outerHTML)}const P=n[d-1];if(P&&(r.exactGridHeight=P.bottom+o.footerContainer.offsetHeight+o.headerContainer.offsetHeight,r.lastRowDataIndex=P.dataIndex+1),await e.onRowsCollected(n.slice(R,d),t),m)r.exactGridHeight-=r.scrollableTopMargin=o.scrollable.y;else{const x=p.ion({offsetRows:({offset:M})=>H+=M});await e.scrollRowIntoView(o,y+1),x()}return H}async renderRows(t){const e=this,{exportMeta:r}=e,{client:o,alignRows:i,rowsRange:s}=t,{currentPageTopMargin:a,verticalPosition:l,contentHeight:g,totalRows:h,lastRowIndex:w,fakeRow:c}=r,{store:p}=o,n=o.hasActiveFeature("mergeCells"),m=s===v.visible;let u=w,{lastTop:f}=r,d;const R=u,b=m||l===0?0:f+a+o.headerHeight,y=[];d=g-b,l===0&&(d-=o.headerHeight);let H,P,x=0;for(;d>0;)c.render(u,p.getAt(u),!0,!1,!0),i&&d<c.offsetHeight?(x=-d,d=0,e.exportMeta.lastExportedRowBottom=f):(P=f,H=u,f=c.translate(f),d-=c.offsetHeight,e.collectRow(c),y.push({top:c.top,bottom:c.bottom,offsetHeight:c.offsetHeight,dataIndex:c.dataIndex}),(++u===p.count&&d>0||m&&u-R===h)&&(d=0));return n&&e.renderMergedCells(t,R,u,y),r.lastRowIndex=i?u:H,r.lastTop=i?f:P,c&&(r.exactGridHeight=c.bottom+o.footerContainer.offsetHeight+o.headerContainer.offsetHeight),await e.onRowsCollected(y,t),x}async buildPage(t){const e=this,{exportMeta:r}=e,{client:o,headerTpl:i,footerTpl:s,enableDirectRendering:a}=t,{totalWidth:l,totalPages:g,currentPage:h,subGrids:w}=r;Object.values(w).forEach(u=>u.rows=[]),t.rowsRange===v.all&&(r.totalHeight=o.height-o.bodyHeight+o.scrollable.scrollHeight-e.getVirtualScrollerHeight(o));let c,p;i&&(c=e.prepareHTML(i({totalWidth:l,totalPages:g,currentPage:h}))),s&&(p=e.prepareHTML(s({totalWidth:l,totalPages:g,currentPage:h})));let n;return a?n=await e.renderRows(t):n=await e.collectRows(t),{html:e.buildPageHtml(t),header:c,footer:p,offset:n}}async onRowsCollected(){}buildPageHtml(){const t=this,{subGrids:e}=t.exportMeta;let r=t.prepareExportElement();return Object.values(e).forEach(({placeHolder:o,rows:i,mergedCellsHtml:s})=>{const a=o.outerHTML;let l=i.reduce((g,h)=>(g+=h[0],g),"");s!=null&&s.length&&(l+=`<div class="b-grid-merged-cells-container">${s.join("")}</div>`),r=r.replace(a,l)}),r}prepareExportElement(){const t=this,{element:e,exportMeta:r}=t;return r.scrollableTopMargin&&(e.querySelector(".b-grid-vertical-scroller").style.marginTop=`-${r.scrollableTopMargin}px`),super.prepareExportElement()}};I.prototype.pagesExtractor=async function*(e){const r=this,{exportMeta:o,stylesheets:i}=r,{totalWidth:s,totalPages:a,paperWidth:l,paperHeight:g,realPaperWidth:h,realPaperHeight:w,contentHeight:c}=o,p=e.useBrowserPrint;let n;for(;(n=o.currentPage)<a;){r.trigger("exportStep",{text:r.L(I.exportingPageText,{currentPage:n,totalPages:a}),progress:Math.round((n+1)/a*90)});const{html:m,header:u,footer:f,offset:d}=await r.buildPage(e),R=[...i,`
                <style>
                    .b-page-wrap {
                        width: ${l}in;
                        height: ${g}in;
                    }
                    .b-page-${n} #${e.client.id} {
                        height: ${o.exactGridHeight}px !important;
                        width: ${s}px !important;
                    }
                    .b-page-${n} .b-export-body .b-export-viewport {
                        transform: translate(${-l*o.horizontalPosition}in, ${o.currentPageTopMargin}px);
                    }
                </style>
            `];o.currentPageTopMargin-=c+d,await r.stateNextPage(e),yield{html:r.pageTpl({html:m,header:u,footer:f,styles:R,paperWidth:l,paperHeight:g,realPaperWidth:h,realPaperHeight:w,currentPage:n,isPrint:p})}}},I._$name="MultiPageExporter";var S=class extends L{static get $name(){return"MultiPageVerticalExporter"}static get type(){return"multipagevertical"}static get title(){return this.L("L{multipagevertical}")}static get exportingPageText(){return"L{exportingPage}"}async stateNextPage({client:t}){const{exportMeta:e}=this,{totalRows:r,processedRows:o,totalPages:i}=e;++e.currentPage,++e.verticalPosition,e.currentPage===i&&o.size!==r&&(++e.totalPages,++e.verticalPages)}estimateTotalPages(t){const e=this,{exportMeta:r}=e,{client:o,headerTpl:i,footerTpl:s,alignRows:a,rowsRange:l,repeatHeader:g,enableDirectRendering:h}=t,{pageWidth:w,pageHeight:c,totalWidth:p}=r,n=e.getScaleValue(w,p);let m=0-e.getVirtualScrollerHeight(o)+o.height-o.bodyElement.offsetHeight+o.scrollable.scrollHeight,u=c/n,f=o.store.count,d=0,R=m,b;if(i&&(u-=e.measureElement(i({totalWidth:p,totalPages:-1,currentPage:-1}))),s&&(u-=e.measureElement(s({totalWidth:p,totalPages:-1,currentPage:-1}))),g&&(u-=o.headerHeight+o.footerHeight,m-=o.headerHeight+o.footerHeight),l===v.visible){const y=o.rowManager,H=y.firstVisibleRow,P=y.lastVisibleRow;h||(d=H.top),f=e.getVisibleRowsCount(o),h?(m=o.headerHeight+o.footerHeight+P.bottom-H.top,R=P.bottom-H.top):R=m=m-o.scrollable.scrollHeight+P.bottom-H.top,r.lastRowIndex=H.dataIndex,r.finishRowIndex=P.dataIndex}else r.finishRowIndex=o.store.count-1;if(a&&!g&&l!==v.visible){const y=o.rowManager.rowOffsetHeight,H=Math.floor((u-o.headerHeight)/y),P=Math.floor(u/y),x=f-H;b=1+Math.ceil(x/P)}else b=Math.ceil(R/u);Object.assign(r,{scale:n,contentHeight:u,totalRows:f,totalHeight:m,verticalPages:b,initialScroll:d,horizontalPages:1,totalPages:b})}async prepareComponent(t){await super.prepareComponent(t);const e=this,{exportMeta:r}=e,{client:o}=t,i=F[t.paperFormat],s=t.orientation===T.portrait,a=e.getPaperWidth(i,s),l=e.getPaperHeight(i,s),g=e.inchToPx(a),h=e.inchToPx(l),w=1;Object.assign(r,{paperWidth:a,paperHeight:l,realPaperWidth:e.getPaperWidth(i,s),realPaperHeight:e.getPaperHeight(i,s),pageWidth:g,pageHeight:h,horizontalPages:w,currentPage:0,verticalPosition:0,horizontalPosition:0,currentPageTopMargin:0,lastTop:0,lastRowIndex:0,processedRows:new Set}),e.estimateTotalPages(t),t.enableDirectRendering||e.adjustRowBuffer(o)}async restoreComponent(t){await super.restoreComponent(t),t.enableDirectRendering||this.restoreRowBuffer(t.client)}async collectRows(t){const e=this,{exportMeta:r}=e,{client:o,alignRows:i,repeatHeader:s}=t,{subGrids:a,currentPageTopMargin:l,verticalPosition:g,totalRows:h,contentHeight:w}=r,c=s?0:o.headerHeight,{rowManager:p}=o,{rows:n}=p,m=t.rowsRange===v.visible,u=o.hasActiveFeature("mergeCells");let f=m?n.findIndex(x=>x.bottom>o.scrollable.y):n.findIndex(x=>x.bottom+l+c>0),d;const R=f,b=g===0?0:n[f].top+l+c;d=w-b,g===0&&(d-=c);let y,H=0;for(;d>0;){const x=n[f];i&&d<x.offsetHeight?(H=-d,d=0):(e.collectRow(x),d-=x.offsetHeight,d>0&&r.processedRows.add(x.dataIndex),y=x.dataIndex,(++f===n.length&&d>0||m&&f-R===h)&&(d=0))}if(u)for(const x in a){const M=a[x],E=o.subGrids[x].element.querySelectorAll(".b-grid-merged-cells");M.mergedCellsHtml=[];for(const A of E)M.mergedCellsHtml.push(A.outerHTML)}const P=n[f-1];if(P&&(r.exactGridHeight=P.bottom+o.footerContainer.offsetHeight+o.headerContainer.offsetHeight),await e.onRowsCollected(n.slice(R,f),t),m)r.scrollableTopMargin=o.scrollable.y;else{const x=p.ion({offsetRows:({offset:M})=>H+=M});await e.scrollRowIntoView(o,y+1),x()}return H}async renderRows(t){const e=this,{exportMeta:r}=e,{client:o,alignRows:i,repeatHeader:s}=t,{currentPageTopMargin:a,verticalPosition:l,totalRows:g,contentHeight:h,lastRowIndex:w,finishRowIndex:c,fakeRow:p}=r,n=s?0:o.headerHeight,{store:m}=o,u=o.hasActiveFeature("mergeCells"),f=t.rowsRange===v.visible;let d=w,{lastTop:R}=r,b;const y=d,H=l===0?0:R+a+n,P=[];b=h-H,l===0&&(b-=n);let x,M,E=0;for(;b>0;)p.render(d,m.getAt(d),!0,!1,!0),i&&b<p.offsetHeight?(E=-b,b=0):(M=R,x=d,R=p.translate(R),b-=p.offsetHeight,e.collectRow(p),P.push({top:p.top,bottom:p.bottom,offsetHeight:p.offsetHeight,dataIndex:p.dataIndex}),b>0&&r.processedRows.add(d),(d===c||++d-y===g&&f)&&(b=0));return u&&e.renderMergedCells(t,y,d,P),r.lastRowIndex=x,r.lastTop=M,p&&(r.exactGridHeight=p.bottom+o.footerContainer.offsetHeight+o.headerContainer.offsetHeight),await e.onRowsCollected(P,t),E}async buildPage(t){const e=this,{exportMeta:r}=e,{client:o,headerTpl:i,footerTpl:s,enableDirectRendering:a}=t,{totalWidth:l,totalPages:g,currentPage:h,subGrids:w}=r;Object.values(w).forEach(u=>u.rows=[]),t.rowsRange===v.all&&(r.totalHeight=o.headerHeight+o.footerHeight+o.scrollable.scrollHeight,a||(r.totalHeight-=e.getVirtualScrollerHeight(o)));let c,p,n;return i&&(c=e.prepareHTML(i({totalWidth:l,totalPages:g,currentPage:h}))),s&&(p=e.prepareHTML(s({totalWidth:l,totalPages:g,currentPage:h}))),a?n=await e.renderRows(t):n=await e.collectRows(t),{html:e.buildPageHtml(t),header:c,footer:p,offset:n}}async onRowsCollected(){}buildPageHtml(){const t=this,{subGrids:e}=t.exportMeta;let r=t.prepareExportElement();return Object.values(e).forEach(({placeHolder:o,rows:i,mergedCellsHtml:s})=>{const a=o.outerHTML;let l=i.reduce((g,h)=>(g+=h[0],g),"");s!=null&&s.length&&(l+=`<div class="b-grid-merged-cells-container">${s.join("")}</div>`),r=r.replace(a,l)}),r}};S.prototype.pagesExtractor=async function*(e){const r=this,{exportMeta:o,stylesheets:i}=r,{totalWidth:s,paperWidth:a,paperHeight:l,realPaperWidth:g,realPaperHeight:h,contentHeight:w,scale:c,initialScroll:p}=o,n=e.useBrowserPrint;let{totalPages:m}=o,u,f;for(;(u=o.currentPage)<m;){r.trigger("exportStep",{text:r.L(S.exportingPageText,{currentPage:u,totalPages:m}),progress:Math.round((u+1)/m*90)});const{html:d,header:R,footer:b,offset:y}=await r.buildPage(e);if(f=`
            ${n?`
                        .b-page-wrap {
                            width: ${g}in;
                            height: ${h}in;
                        }
                        .b-print:not(.b-firefox) .b-export-content {
                            zoom: ${c};
                            height: 100%;
                        }
                        .b-print.b-firefox .b-export-content {
                            transform: scale(${c});
                            transform-origin: top left;
                            height: ${100/c}%;
                            width: ${100/c}%;
                        }
                    `:`
                        .b-export .b-page-${u}.b-export-content {
                            transform: scale(${c});
                            transform-origin: top left;
                            height: ${100/c}%;
                            width: ${100/c}%;
                        }
                    `}
        `,e.repeatHeader){const P=o.exactGridHeight?`${o.exactGridHeight+o.currentPageTopMargin}px`:"100%";f=`
                ${f}
                .b-page-${u} #${e.client.id} {
                    height: ${P} !important;
                    width: ${s}px !important;
                }
                .b-export-body {
                    height: 100%;
                    display: flex;
                }
                .b-export-viewport {
                    height: 100%;
                }
                .b-page-${u} .b-grid-vertical-scroller {
                    margin-top: ${o.currentPageTopMargin-p}px;
                }
            `}else{const P=o.exactGridHeight||w-o.currentPageTopMargin;f=`
                ${f}
                .b-page-${u} #${e.client.id} {
                    height: ${P}px !important;
                    width: ${s}px !important;
                }
                .b-export-body {
                    overflow: hidden;
                }
                .b-page-${u} .b-export-body .b-export-viewport {
                    margin-top: ${o.currentPageTopMargin}px;
                }
                .b-page-${u} .b-grid-vertical-scroller {
                    margin-top: -${p}px;
                }
            `}const H=[...i,`<style>${f}</style>`];o.currentPageTopMargin-=w+y,await r.stateNextPage(e),{totalPages:m}=o,yield{html:r.pageTpl({html:d,header:R,footer:b,styles:H,paperWidth:a,paperHeight:l,realPaperWidth:g,realPaperHeight:h,currentPage:u,isPrint:n})}}},S._$name="MultiPageVerticalExporter";var B=class extends L{static get $name(){return"SinglePageExporter"}static get type(){return"singlepage"}static get title(){return this.localize("L{singlepage}")}static get defaultConfig(){return{centerContentHorizontally:!1}}async prepareComponent(t){await super.prepareComponent(t),Object.assign(this.exportMeta,{verticalPages:1,horizontalPages:1,totalPages:1,currentPage:0,verticalPosition:0,horizontalPosition:0})}async onRowsCollected(){}positionRows(t,e){if(e.enableDirectRendering)return t.map(r=>r[0]);{let r=0;return t.map(([o,,i])=>{const s=o.replace(/translate\(\d+px, \d+px\)/,`translate(0px, ${r}px)`);return r+=i,s})}}async collectRows(t){const e=this,{client:r}=t,{rowManager:o,store:i}=r,s=r.hasActiveFeature("mergeCells"),{subGrids:a}=e.exportMeta,l=t.rowsRange===v.visible&&i.count?e.getVisibleRowsCount(r):i.count;let{totalHeight:g}=e.exportMeta,h=0,w=-1;if(o.rows.length>0){if(t.rowsRange===v.visible&&(w=o.firstVisibleRow.dataIndex-1),s)for(const c of Object.values(a))c.mergedCellsHtml=[];for(;h<l;){const c=o.rows,p=c[c.length-1],n=h;if(c.forEach(f=>{f.dataIndex>w&&h<l&&(++h,g+=f.offsetHeight,e.collectRow(f))}),s)for(const f in a){const d=a[f],R=r.subGrids[f].element.querySelectorAll(".b-grid-merged-cells");for(const b of R)d.mergedCellsHtml.push(b.outerHTML)}const m=c.findIndex(f=>f.dataIndex===w+1),u=m+(h-n);await e.onRowsCollected(c.slice(m,u),t),h<l&&(w=p.dataIndex,await e.scrollRowIntoView(r,w+1))}}return g}async renderRows(t){const e=this,{client:r,rowsRange:o}=t,{rowManager:i,store:s}=r,a=r.hasActiveFeature("mergeCells"),l=o===v.visible;let{totalHeight:g}=e.exportMeta;if(s.count){const{fakeRow:h}=e.exportMeta,{firstVisibleRow:w}=i,c=l?w.dataIndex:0,p=l?i.lastVisibleRow.dataIndex:s.count-1,n=[];let m=0;if(h.cells.length){for(let u=c;u<=p;u++)h.render(u,s.getAt(u),!0,!1,!0),m=h.translate(m),e.collectRow(h),n.push({top:h.top,bottom:h.bottom,offsetHeight:h.offsetHeight,dataIndex:h.dataIndex});await e.onRowsCollected(n,t)}g+=m,a&&e.renderMergedCells(t,c,p,n)}return g}buildPageHtml(t){const e=this,{subGrids:r}=e.exportMeta;let o=e.prepareExportElement();return Object.values(r).forEach(({placeHolder:i,rows:s,mergedCellsHtml:a})=>{const l=i.outerHTML;let g=e.positionRows(s,t).join("");a!=null&&a.length&&(g+=`<div class="b-grid-merged-cells-container">${a.join("")}</div>`),o=o.replace(l,g)}),o}};B.prototype.pagesExtractor=async function*(e){const r=this,{client:o}=e,{totalWidth:i}=r.exportMeta,s=r.stylesheets,a=e.orientation===T.portrait,l=F[e.paperFormat],g=e.useBrowserPrint,h=r.getPaperWidth(l,a),w=r.getPaperHeight(l,a),c=r.getPaperWidth(l,a),p=r.getPaperHeight(l,a);let n,m,u;e.enableDirectRendering?(n=await r.renderRows(e),n+=o.headerHeight+o.footerHeight):(n=await r.collectRows(e),n+=o.height-o.bodyHeight);const f=r.buildPageHtml(e),d=n;if(e.headerTpl){m=r.prepareHTML(e.headerTpl({totalWidth:i}));const H=r.measureElement(m);n+=H}if(e.footerTpl){u=r.prepareHTML(e.footerTpl({totalWidth:i}));const H=r.measureElement(u);n+=H}const R=Math.min(1,r.getScaleValue(r.inchToPx(h),i)),b=Math.min(1,r.getScaleValue(r.inchToPx(w),n)),y=Math.min(R,b);s.push(`<style>
                #${o.id} {
                    height: ${d}px !important;
                    width: ${i}px !important;
                }
                ${g?`
                            html, body {
                                overflow: hidden;
                            }
                            .b-page-wrap {
                                width: ${c}in;
                                height: ${p}in;
                            }
                            .b-print:not(.b-firefox) .b-export-content {
                                zoom: ${y};
                                height: 100%;
                            }
                            .b-print.b-firefox .b-export-content {
                                transform: scale(${y}) ${r.centerContentHorizontally?"translateX(-50%)":""};
                                transform-origin: top left;
                                height: ${y===1?"inherit":"auto !important"};
                            }
                            .b-export-content {
                                ${r.centerContentHorizontally?"left: 50%;":""}
                            }
                        `:`
                            .b-export-content {
                                ${r.centerContentHorizontally?"left: 50%;":""}
                                transform: scale(${y}) ${r.centerContentHorizontally?"translateX(-50%)":""};
                                transform-origin: top left;
                                height: ${y===1?"inherit":"auto !important"};
                            }
                        `}
            </style>`),yield{html:r.pageTpl({html:f,header:m,footer:u,styles:s,paperWidth:h,paperHeight:w,realPaperHeight:p,realPaperWidth:c,currentPage:0,isPrint:e.useBrowserPrint})}},B._$name="SinglePageExporter";var j=class extends te{static get $name(){return"PdfExport"}static get configurable(){return{dialogClass:V,exportServer:void 0,exportDialog:{value:!0,$config:["lazy"]},fileName:null,fileFormat:"pdf",clientURL:null,paperFormat:"A4",orientation:"portrait",rowsRange:"all",alignRows:!1,repeatHeader:!1,keepRegionSizes:null,pagesPerRequest:0,exporterConfig:null,exporterType:"singlepage",exporters:[B,I,S],translateURLsToAbsolute:!0,keepPathName:!0,openAfterExport:!0,sendAsBinary:!1,openInNewTab:!1,headerTpl:null,footerTpl:null,fetchOptions:null,exportMask:"L{Generating pages}",exportProgressMask:"L{Waiting for response from server}",showErrorToast:!0,localizableProperties:["exportMask","exportProgressMask"],filterStyles:t=>t,enableDirectRendering:!0,useRenderedColumnWidth:!1,useBrowserPrint:!1}}updateEnableDirectRendering(t){t||se.deprecate("Grid","6.0.0","Indirect rendering is deprecated")}doDestroy(){var t;(t=this.exportDialog)==null||t.destroy(),this.exportersMap.forEach(e=>e.destroy()),super.doDestroy()}get currentExportPromise(){return this._currentExportPromise}set currentExportPromise(t){this._currentExportPromise=t}get exportersMap(){return this._exportersMap||(this._exportersMap=new Map)}getExporter(t={}){const e=this,{exportersMap:r}=e,{type:o}=t;let i;if(r.has(o))i=r.get(o),Object.assign(i,t);else{const s=this.exporters.find(a=>a.type===o);if(!s)throw new Error(`Exporter type ${o} is not found. Make sure you've configured it`);t=D.clone(t),delete t.type,i=new s(t),i.relayAll(e),r.set(o,i)}return i}buildExportConfig(t={}){const e=this,{client:r,exportServer:o,clientURL:i,fileFormat:s,fileName:a,paperFormat:l,rowsRange:g,alignRows:h,repeatHeader:w,keepRegionSizes:c,orientation:p,translateURLsToAbsolute:n,keepPathName:m,sendAsBinary:u,headerTpl:f,footerTpl:d,filterStyles:R,enableDirectRendering:b,useRenderedColumnWidth:y,useBrowserPrint:H}=e;t.columns||(t.columns=r.columns.visibleColumns.filter(x=>x.exportable).map(x=>x.id));const P=D.assign({client:r,exportServer:o,clientURL:i,fileFormat:s,paperFormat:l,rowsRange:g,alignRows:h,repeatHeader:w,keepRegionSizes:c,orientation:p,translateURLsToAbsolute:n,keepPathName:m,sendAsBinary:u,headerTpl:f,footerTpl:d,enableDirectRendering:b,useRenderedColumnWidth:y,useBrowserPrint:H,exporterType:e.exporterType,fileName:a||r.$$name},t);return P.columns=t.columns.slice(),P.exporterType!=="multipagevertical"&&(P.repeatHeader=!1),!("alignRows"in t)&&t.repeatHeader&&(P.alignRows=!0),P.exporterConfig=D.assign({type:P.exporterType,translateURLsToAbsolute:P.translateURLsToAbsolute,keepPathName:P.keepPathName,filterStyles:R},P.exporterConfig||{}),delete P.exporterType,delete P.translateURLsToAbsolute,delete P.keepPathName,P}async export(t={}){var e,r;const o=this,{client:i,pagesPerRequest:s}=o;t=o.buildExportConfig(t);let a;if(i.trigger("beforePdfExport",{config:t})!==!1){i.isExporting=!0,i.mask(o.exportMask);try{const l=o.getExporter(t.exporterConfig);if(s===0){const g=await l.export(t);if(o.isDestroying)return;if((e=o.exportDialog)==null||e.close(),i.unmask(),o.trigger("exportStep",{progress:90,text:o.exportProgressMask,contentGenerated:!0}),t.useBrowserPrint)await o.doPrint(g,t),a={};else{const h=o.receiveExportContent(g,t);o.toast=o.showLoadingToast(h);const w=await h;a={response:w},await o.processExportContent(w,t)}}}catch(l){throw l instanceof Response?a={response:l}:a={error:l},l}finally{o.toast&&!o.toast.isDestroying&&o.toast.hide(),o.isDestroying||((r=o.exportDialog)==null||r.close(),i.unmask(),o.showErrorToast&&(a.error?a.error.name!=="AbortError"&&k.show({html:o.L("L{Export failed}"),rootElement:o.rootElement}):a.response&&!a.response.ok&&k.show({html:o.L("L{Server error}"),rootElement:o.rootElement})),i.trigger("pdfExport",a),i.isExporting=!1)}}return a}receiveExportContent(t,e){return q.fetch(e.exportServer,Object.assign({method:"POST",credentials:"omit",headers:{"Content-Type":"application/json"},body:JSON.stringify({html:t,orientation:e.orientation,format:e.paperFormat,fileFormat:e.fileFormat,fileName:e.fileName,clientURL:e.clientURL,sendAsBinary:e.sendAsBinary})},this.fetchOptions))}async processExportContent(t,e){const r=this;if(t.ok&&r.openAfterExport){t=t.clone();const o=t.headers.get("content-type");if(o.match(/application\/octet-stream/)){const i=le[e.fileFormat],s=await r.responseBlobToObjectURL(t,i);r.getDownloadLink(e.fileName,s).click()}else if(o.match(/application\/json/)){const i=await t.json();i.success?r.getDownloadLink(e.fileName,i.url).click():k.show({html:i.msg,rootElement:this.rootElement})}}}doPrint(t){}async responseBlobToObjectURL(t,e){const r=await t.blob();return URL.createObjectURL(r.slice(0,r.size,e))}getDownloadLink(t,e){const r=document.createElement("a");return r.download=t,r.href=e,this.openInNewTab&&(r.target="_blank"),r}get defaultExportDialogConfig(){return D.copyProperties({},this,["client","exporters","exporterType","orientation","fileFormat","paperFormat","alignRows","rowsRange","repeatHeader","useBrowserPrint"])}changeExportDialog(t,e){const r=this;if(e==null||e.destroy(),t){const o=r.dialogClass.mergeConfigs({rootElement:r.rootElement,client:r.client,modal:{transparent:!0},items:{rowsRangeField:{value:r.rowsRange},exporterTypeField:{value:r.exporterType},orientationField:{value:r.orientation},paperFormatField:{value:r.paperFormat},repeatHeaderField:{value:r.repeatHeader},fileFormatField:{value:r.fileFormat},alignRowsField:{checked:r.alignRows}}},r.defaultExportDialogConfig,t);t=r.dialogClass.new(o),t.ion({export:r.onExportButtonClick,thisObj:r})}return t}async showExportDialog(){return this.exportDialog.show()}onExportButtonClick({values:t}){const e=this,r=e.exportDialog.mask({progress:0,maxProgress:100,text:e.exportMask}),o=e.ion({exportstep({progress:i,text:s,contentGenerated:a}){a?(e.exportDialog.unmask(),o()):(r.progress=i,s!=null&&(r.text=s))}});e.currentExportPromise=e.export(t),e.currentExportPromise.catch(()=>{}).finally(()=>{var i;o(),(i=e.exportDialog)==null||i.unmask(),e.currentExportPromise=null})}showLoadingToast(t){const e=k.show({timeout:0,showProgress:!1,rootElement:this.rootElement,html:`
    <span class="b-mask-icon b-icon b-icon-spinner"></span>
    <span>${this.exportProgressMask}</span>
    <button class="b-button">${this.L("L{Click to abort}")}</button>`});return K.on({element:e.element,click(){var r;(r=t.abort)==null||r.call(t)}}),e}};j._$name="PdfExport",U.registerFeature(j,!1,"Grid");var ne=t=>class extends t{static get $name(){return"PrintMixin"}static get configurable(){return{useBrowserPrint:!0,exporterType:"multipagevertical"}}static get pluginConfig(){return{assign:["print","showPrintDialog"]}}showPrintDialog(r){return this.showExportDialog(r)}print(r){return this.export(r)}async onPrintIFrameLoad(r){}async showBrowserPrintDialog(r,o){if(await this.onPrintIFrameLoad(r),await this.client.trigger("beforeShowPrintDialog",{iframe:r})!==!1){const{contentWindow:i}=r;i.onafterprint=()=>{r.remove(),o()},i.print()}else r.remove(),o()}doPrint(r){const o=this;return new Promise((i,s)=>{const a=document.createElement("iframe");a.className="b-print-wrapper",a.style.visibility="hidden",a.style.height="0",a.onload=()=>{var l;const g=a.contentWindow,h=g.document,{body:w}=h,c=new DOMParser;let p;r.forEach(({html:m})=>{const u=c.parseFromString(m,"text/html"),f=h.adoptNode(u.body.firstChild),d=h.createElement("div");u.head.querySelectorAll('style,link[rel="stylesheet"],link[as="style"]').forEach(R=>{const b=h.adoptNode(R);h.head.appendChild(b)}),d.classList.add("b-page-wrap"),d.style.height=u.body.parentElement.style.height,d.style.width=u.body.parentElement.style.width,p=parseFloat(u.body.parentElement.style.height),w.appendChild(d),d.appendChild(f)});const{html:n}=r[0];w.className=((l=n.match(/<body class="(.+?)"/))==null?void 0:l[1])||"",w.classList.add("b-print"),w.parentElement.classList.add("b-print-root"),w.parentElement.style.height=`${p*r.length}in`,Promise.all(Array.from(h.head.querySelectorAll('link[rel="stylesheet"]')).map(m=>new Promise((u,f)=>{m.onload=u,m.onerror=f}))).then(()=>h.fonts.ready).then(()=>o.showBrowserPrintDialog(a,i)).catch(m=>{console.warn(`Failed to load stylesheets ${m.message?`: ${m.message}`:""}`),s(o.L("L{PdfExport.Export failed}"))})},o.client.element.parentElement.appendChild(a)})}};export{V as ExportDialog,N as ExportOrientationCombo,O as ExportRowsCombo,L as Exporter,W as FileFormat,I as MultiPageExporter,S as MultiPageVerticalExporter,T as Orientation,F as PaperFormat,j as PdfExport,ne as PrintMixin_default,v as RowsRange,B as SinglePageExporter};
//# sourceMappingURL=chunk-6RG3ITZU.js.map
