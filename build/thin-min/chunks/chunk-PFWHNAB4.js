/*!
 *
 * Bryntum TaskBoard 5.6.2
 *
 * Copyright(c) 2023 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
import{NumberColumn as xe}from"./chunk-U2MM24JY.js";import{AttachToProjectMixin_default as ne,ClockTemplate as J,TaskEditStm_default as ke}from"./chunk-MS4QMERY.js";import{ColumnStore as ze,GridFeatureManager as F,HeaderMenu as Ae}from"./chunk-GGOYEX2W.js";import{DragHelper as fe,ResizeHelper as Le}from"./chunk-6ZLMCHE5.js";import{DependencyBaseModel as U,DependencyModel as B,TimeSpan as pe}from"./chunk-KVD75ID2.js";import{Draggable_default as ve,Droppable_default as Oe}from"./chunk-4LHHPUQ6.js";import{ArrayHelper as _e,Base as ae,BrowserHelper as He,DateHelper as R,Delayable_default as de,DomHelper as _,DomSync as Q,Duration as $e,EventHelper as P,IdHelper as Fe,InstancePlugin as j,ObjectHelper as Y,Objects as N,Rectangle as O,StringHelper as G,Tooltip as I,VersionHelper as q,WalkHelper as Pe,Widget as Ie,__publicField as x}from"./chunk-MZVS5JQA.js";var ce=class extends xe{constructor(){super(...arguments),x(this,"compositeField",!0)}static get $name(){return"DurationColumn"}static get type(){return"duration"}static get isGanttColumn(){return!0}static get fields(){return[{name:"decimalPrecision",defaultValue:1}]}static get defaults(){return{min:null,max:null,step:1,largeStep:0,field:"fullDuration",text:"L{Duration}",instantUpdate:!0,filterType:"duration",sortable(e,r){const t=e.getValue(this.field),i=r.getValue(this.field);return t-i}}}construct(){super.construct(...arguments);const e=this.sortable;this.sortable=(...r)=>e.call(this,...r)}get defaultEditor(){const{max:e,min:r,step:t,largeStep:i}=this;return Y.cleanupProperties({type:"duration",name:this.field,max:e,min:r,step:t,largeStep:i})}get durationUnitField(){return`${this.field}Unit`}roundValue(e){const r=typeof this.grid.durationDisplayPrecision=="number"?this.grid.durationDisplayPrecision:this.decimalPrecision,t=Math.pow(10,r);return Math.round(e*t)/t}formatValue(e,r){return e instanceof $e&&(r=e.unit,e=e.magnitude),e=this.roundValue(e),e+" "+R.getLocalizedNameOfUnit(r,e!==1)}defaultRenderer({value:e,record:r,isExport:t}){const i=typeof e,n=i==="number"?e:e==null?void 0:e.magnitude,a=i==="number"?r.getValue(this.durationUnitField):e==null?void 0:e.unit;return typeof n!="number"?t?"":null:this.formatValue(n,a)}toClipboardString({record:e}){return e.getValue(this.field).toString()}fromClipboardString({string:e,record:r}){const t=R.parseDuration(e,!0,this.durationUnit);return t&&"magnitude"in t?t:r.fullDuration}calculateFillValue({value:e,record:r}){return this.fromClipboardString({string:e,record:r})}};ze.registerColumnType(ce),ce._$name="DurationColumn";var De=class extends j{static get defaultConfig(){return{tooltipTemplate:e=>`
                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">
                    ${e.startClockHtml}
                    ${e.endClockHtml}
                    <div class="b-sch-tip-message">${e.message}</div>
                </div>
            `,showTooltip:!0,showExactDropPosition:!1,store:null,dragHelperConfig:null,tooltipCls:"b-eventdrag-tooltip"}}static get configurable(){return{constrainDragToTimeline:!0,constrainDragToResource:!0,constrainDragToTimeSlot:!1,tip:{$config:["lazy","nullify"],value:{align:{align:"b-t",allowTargetOut:!0},autoShow:!0,updateContentOnMouseMove:!0}},throttleDragEvent:!0}}static get pluginConfig(){return{chain:["onInternalPaint"]}}internalSnapToPosition(e){var r;const{dragData:t}=this;(r=this.snapToPosition)==null||r.call(this,{assignmentRecord:t.assignmentRecord,eventRecord:t.eventRecord,resourceRecord:t.newResource||t.resourceRecord,startDate:t.startDate,endDate:t.endDate,snapTo:e})}buildDragHelperConfig(){const e=this,{client:r,constrainDragToTimeline:t,constrainDragToResource:i,constrainDragToTimeSlot:n,dragHelperConfig:a={}}=e,{timeAxisViewModel:s,isHorizontal:o}=r,l=o?i:n,d=o?n:i;return e.externalDropTargetSelector&&(a.dropTargetSelector=`.b-timeaxissubgrid,${e.externalDropTargetSelector}`),N.merge({name:e.constructor.name,positioning:"absolute",lockX:d,lockY:l,minX:!0,maxX:!0,constrain:!1,cloneTarget:!t,removeProxyAfterDrop:!1,dragWithin:t?null:document.body,hideOriginalElement:!0,dropTargetSelector:".b-timelinebase",dropTargetCls:e.externalDropTargetSelector?"b-drop-target":"",outerElement:r.timeAxisSubGridElement,targetSelector:r.eventSelector,scrollManager:t?r.scrollManager:null,createProxy:c=>e.createProxy(c),snapCoordinates:({element:c,newX:u,newY:m})=>{const{dragData:f}=e,h=this.currentOverClient;if(e.constrainDragToTimeline&&!e.constrainDragToTimeSlot&&(e.showExactDropPosition||s.snap)){const p=f.draggedEntities[0].event||f.draggedEntities[0],D=e.getCoordinate(p,c,[u,m]),v=h.fillTicks&&r.timeAxis.isContinuous?f.startDate:s.getDateFromPosition(D,"round"),{calendar:S}=p;if(!S||v&&S.isWorkingTime(v,R.add(v,p.fullDuration))){const b=v&&s.getPositionFromDate(v);v&&v>=r.startDate&&b!=null&&(o?u=b:m=b)}}const g={x:u,y:m};return e.internalSnapToPosition(g),g},internalListeners:{beforedragstart:"onBeforeDragStart",dragstart:"onDragStart",afterdragstart:"onAfterDragStart",drag:"onDrag",drop:"onDrop",abort:"onDragAbort",abortFinalized:"onDragAbortFinalized",reset:"onDragReset",thisObj:e}},a,{isElementDraggable:(c,u)=>(!a||!a.isElementDraggable||a.isElementDraggable(c,u))&&e.isElementDraggable(c,u)})}onInternalPaint({firstPaint:e}){var r;const t=this,{client:i}=t;(r=t.drag)==null||r.destroy(),t.drag=fe.new(t.buildDragHelperConfig()),e&&i.rowManager.ion({changeTotalHeight:()=>{var n;return t.updateYConstraint((n=t.dragData)==null?void 0:n[`${i.scheduledEventName}Record`])},thisObj:t}),t.showTooltip&&(t.clockTemplate=new J({scheduler:i}))}doDestroy(){var e,r,t;(e=this.drag)==null||e.destroy(),(r=this.clockTemplate)==null||r.destroy(),(t=this.tip)==null||t.destroy(),super.doDestroy()}get tipId(){return`${this.client.id}-event-drag-tip`}changeTip(e,r){const t=this;if(e){const i=I.reconfigure(r,I.mergeConfigs({forElement:t.element,id:t.tipId,getHtml:t.getTipHtml.bind(t),cls:t.tooltipCls,owner:t.client},e),{owner:t.client,defaults:{type:"tooltip"}});return i.ion({innerHtmlUpdate:"updateDateIndicator",thisObj:t}),i}else r==null||r.destroy()}createProxy(e){const r=e.cloneNode(!0);return delete r.id,r.classList.add(`b-sch-${this.client.mode}`),r}onBeforeDragStart({context:e,event:r}){var t;const i=this,{client:n}=i,a=i.getMinimalDragData(e,r),s=a==null?void 0:a[`${n.scheduledEventName}Record`],o=a.resourceRecord;if(n.readOnly||i.disabled||!s||s.isDraggable===!1||s.readOnly||o!=null&&o.readOnly)return!1;e.pointerStartDate=n.getDateFromXY([e.startClientX,e.startPageY],null,!1);const l=i.triggerBeforeEventDrag(`before${n.capitalizedEventName}Drag`,{...a,event:r,context:{...e,...a}})!==!1;return l&&(i.updateYConstraint(s,o),(t=n[`before${n.capitalizedEventName}DragStart`])==null||t.call(n,e,a)),l}onAfterDragStart({context:e,event:r}){}get isDragging(){var e;return(e=this.drag)==null?void 0:e.isDragging}get isActivelyDragging(){return this.isDragging&&!this.finalizing}onDragStart({context:e,event:r}){var t,i,n;const a=this,s=(t=a.findClientFromTarget(r,e))!=null?t:a.client;a.currentOverClient=s,a.drag.unifiedProxy=a.unifiedDrag,a.onMouseOverNewTimeline(s,!0);const o=a.dragData=a.getDragData(e);if(a.suspendElementRedrawing(e.element),a.showTooltip&&a.tip){const u=o.context.dragProxy?o.context.dragProxy.firstChild:e.element;a.tip.showBy(u)}a.triggerDragStart(o),(i=s[`after${s.capitalizedEventName}DragStart`])==null||i.call(s,e,o);const{eventMenu:l,taskMenu:d}=s.features,c=l||d;(n=c==null?void 0:c.hideContextMenu)==null||n.call(c,!1)}updateDateIndicator(){const{startDate:e,endDate:r}=this.dragData,{tip:t,clockTemplate:i}=this,n=t.element.querySelector(".b-sch-tooltip-enddate");i.updateDateIndicator(t.element,e),n&&i.updateDateIndicator(n,r)}findClientFromTarget(e,r){let{target:t}=e;if(/^touch/.test(e.type)){const n=O.from(r.element,null,!0).center;t=_.elementFromPoint(n.x,n.y)}const i=Ie.fromElement(t,"timelinebase");return i!=null&&i.isResourceHistogram?null:i}onDrag({context:e,event:r}){const t=this,i=t.dragData,n=i.startDate;let a;if(t.constrainDragToTimeline?a=t.client:a=t.findClientFromTarget(r,i.context),t.updateDragContext(e,r),!!a){if(a!==t.currentOverClient&&t.onMouseOverNewTimeline(a),i.dirty||!t.throttleDragEvent){const s=i.valid;t.triggerEventDrag(i,n),s!==i.valid&&(i.context.valid=i.externalDragValidity=i.valid)}t.showTooltip&&t.tip&&(t.tip.lastAlignSpec.allowTargetOut=!i.valid,t.tip.realign())}}onMouseOverNewTimeline(e,r){const t=this,{drag:{lockX:i,lockY:n}}=t,a=[];t.currentOverClient.element.classList.remove("b-dragging-"+t.currentOverClient.scheduledEventName),e.element.classList.add("b-dragging-"+e.scheduledEventName),r||t.currentOverClient.scrollManager.stopMonitoring(),i||a.push({element:e.timeAxisSubGrid.scrollable.element,direction:"horizontal"}),n||a.push({element:e.scrollable.element,direction:"vertical"}),e.scrollManager.startMonitoring({scrollables:a,callback:t.drag.onScrollManagerScrollCallback}),t.currentOverClient=e}triggerBeforeEventDropFinalize(e,r,t){t.trigger(e,r)}onDrop({context:e,event:r}){var t;const i=this,{currentOverClient:n,dragData:a}=i;let s=!1;if(n==null||n.scrollManager.stopMonitoring(),(t=i.tip)==null||t.hide(),e.valid=e.valid&&i.isValidDrop(a),i.drag.removeProxyAfterDrop=!!a.externalDropTarget,e.valid&&a.startDate&&a.endDate){let o=!1;a.finalize=async l=>{o||a.async?await i.finalize(l):e.valid=e.valid&&l},i.triggerBeforeEventDropFinalize(`before${n.capitalizedEventName}DropFinalize`,{context:a,domEvent:r},n),o=!0,e.async=a.async,!e.async&&!a.externalDropTarget&&(s=a.startDate-a.origStart!==0||a.newResource!==a.resourceRecord)}e.async||i.finalize(a.valid&&e.valid&&s)}onDragAbort({context:e}){var r,t;const i=this;i.isAborting=!0,(r=i.currentOverClient)==null||r.scrollManager.stopMonitoring(),i.client.currentOrientation.onDragAbort({context:e,dragData:i.dragData}),i.resetDraggedElements(),(t=i.tip)==null||t.hide(),i.triggerDragAbort(i.dragData)}onDragAbortFinalized({context:e}){var r,t;const i=this;i.triggerDragAbortFinalized(i.dragData),(t=(r=i.client)[`after${i.client.capitalizedEventName}DragAbortFinalized`])==null||t.call(r,e,i.dragData),i.isAborting=!1}onDragReset({source:e}){var r;const t=this,i=t.currentOverClient;(r=e.context)!=null&&r.started&&(t.resetDraggedElements(),i.trigger(`${i.scheduledEventName}DragReset`)),i==null||i.element.classList.remove(`b-dragging-${i.scheduledEventName}`),t.dragData=null}resetDraggedElements(){const{dragData:e}=this,{eventBarEls:r,draggedEntities:t}=e;this.resumeRecordElementRedrawing(e.record),t.forEach((i,n)=>{this.resumeRecordElementRedrawing(i),r[n].classList.remove(this.drag.draggingCls),r[n].retainElement=!1}),e.context.element.retainElement=!1}onInternalInvalidDrop(e){var r;const t=this,{context:i}=t.drag;(r=t.tip)==null||r.hide(),t.triggerAfterDrop(t.dragData,!1),i.valid=!1,e&&t.drag.abort()}async finalize(e){const r=this,{dragData:t,currentOverClient:i}=r,n=i.features.taskTooltip||i.features.eventTooltip;if(!t||r.finalizing)return;const{context:a,draggedEntities:s,externalDropTarget:o}=t;let l;return r.finalizing=!0,s.forEach((d,c)=>{r.resumeRecordElementRedrawing(d),t.eventBarEls[c].classList.remove(r.drag.draggingCls),t.eventBarEls[c].retainElement=!1}),a.element.retainElement=!1,o&&t.valid||e?(l=r.updateRecords(t),!o&&N.isPromise(l)&&(a.async=!0,await l),t.valid?(a.async&&a.finalize(),o&&r.client.refreshRows(!1),r.triggerAfterDrop(t,!0)):r.onInternalInvalidDrop(!0)):r.onInternalInvalidDrop(a.async||t.async),r.finalizing=!1,n!=null&&n.enabled&&(n.disabled=!0,i.setTimeout(()=>{n.disabled=!1},200)),l}getEventNewStartEndDates(e,r){let t=this.adjustStartDate(e.startDate,r),i;return e.graph?(t=e.run("skipNonWorkingTime",t),i=e.run("calculateProjectedXDateWithDuration",t,!0,e.duration)):i=R.add(t,e.fullDuration),{startDate:t,endDate:i}}updateDragContext(e,r){var t,i,n;const a=this,{drag:s}=a,o=a.dragData,l=a.currentOverClient,{isHorizontal:d}=l,[c]=o.draggedEntities,u=c.isAssignment?c.event:c,m=o.startDate,f=a.constrainDragToTimeSlot||(d?s.lockX:s.lockY);if(o.browserEvent=r,Object.assign(o,a.getProductDragContext(o)),f)o.timeDiff=0;else{let g;if(l.timeAxis.isContinuous||o.startsOutsideView&&o.endsOutsideView){const p=l.isHorizontal?(t=e.pageX)!=null?t:e.startPageX:(i=e.pageY)!=null?i:e.startPageY,D=l.getDateFromCoordinate(p,null,!1,!0);g=o.timeDiff=D-e.pointerStartDate,g!==null&&(Object.assign(o,a.getEventNewStartEndDates(u,g)),o.valid&&(o.timeDiff=o.startDate-o.origStart))}else{const p=a.resolveStartEndDates(e.element);o.valid=!!(p.startDate&&p.endDate),o.valid&&(g=p.startDate-o.origStart),g!==void 0&&(u.graph?(o.startDate=u.run("skipNonWorkingTime",p.startDate),o.endDate=u.run("calculateProjectedXDateWithDuration",p.startDate,!0,u.duration)):(o.startDate=p.startDate,o.endDatee=p.endDate)),o.timeDiff=g}}const h=o.dirty=o.dirty||m-o.startDate!==0;if(o.valid)if(a.constrainDragToTimeline&&(o.endDate<=l.timeAxis.startDate||o.startDate>=l.timeAxis.endDate))o.valid=!1,o.context.message=a.L("L{EventDrag.noDropOutsideTimeline}");else if(h||o.externalDropTarget){const g=o.externalDragValidity=!r||e.pageX&&a.checkDragValidity(o,r);!g||typeof g=="boolean"?(o.valid=g!==!1,o.context.message=""):(o.valid=g.valid!==!1,o.context.message=g.message)}else o.valid=o.externalDragValidity!==!1&&((n=o.externalDragValidity)==null?void 0:n.valid)!==!1;else o.valid=!1;o.context.valid=o.valid}suspendRecordElementRedrawing(e,r=!0){this.suspendElementRedrawing(this.getRecordElement(e),r),e.instanceMeta(this.client).retainElement=r}resumeRecordElementRedrawing(e){this.suspendRecordElementRedrawing(e,!1)}suspendElementRedrawing(e,r=!0){e&&(e.retainElement=r)}resumeElementRedrawing(e){this.suspendElementRedrawing(e,!1)}getDragData(e){const r=this,{client:t,drag:i}=r,n=r.setupProductDragData(e),{record:a,eventBarEls:s,draggedEntities:o}=n,{startEvent:l}=i,d=a.isAssignment?a.event:a,c=d.startDate,u=d.endDate,m=t.timeAxis,f=c<m.startDate,h=u>m.endDate,g=t.isSchedulerBase?t.multiEventSelect:t.selectionMode.multiSelect,p=r.getCoordinate(d,e.element,[e.elementStartX,e.elementStartY]),D=r.getCoordinate(d,e.element,[e.startClientX,e.startClientY]);r.suspendRecordElementRedrawing(a),o.forEach(S=>r.suspendRecordElementRedrawing(S)),a.isAssignment?t.selectAssignment(a,l.ctrlKey&&g):t.selectEvent(a,l.ctrlKey&&g);const v={context:e,...n,sourceDate:f?c:t.getDateFromCoordinate(p),screenSourceDate:t.getDateFromCoordinate(D,null,!1),startDate:c,endDate:u,timeDiff:0,origStart:c,origEnd:u,startsOutsideView:f,endsOutsideView:h,duration:u-c,browserEvent:l};return s.forEach(S=>S.classList.remove("b-sch-event-hover","b-active")),s.length>1&&(e.relatedElements=s.slice(1)),v}setupConstraints(e,r,t,i){const n=this,a=!n.showExactDropPosition&&t>1?t:0,s=0;i?n.setXConstraint(e.left,e.right-r.width,a):n.setXConstraint(!0,!0,a),n.setYConstraint(e.top,e.bottom-r.height,s)}updateYConstraint(e,r){const t=this,{client:i}=t,{context:n}=t.drag,a=i.timeAxisViewModel.snapPixelAmount;if(n&&!t.drag.lockY){let s;if(t.constrainDragToTimeline)s=i.getScheduleRegion(r,e);else{t.setYConstraint(null,null,a);return}t.setYConstraint(s.top,s.bottom-n.element.offsetHeight,a)}else t.setYConstraint(null,null,a)}setXConstraint(e,r,t){const{drag:i}=this;i.minX=e,i.maxX=r}setYConstraint(e,r,t){const{drag:i}=this;i.minY=e,i.maxY=r}adjustStartDate(e,r){const t=this.client.timeAxis.roundDate(new Date(e-0+r),this.client.snapRelativeToEventStartDate?e:!1);return this.constrainStartDate(t)}resolveStartEndDates(e){const r=this.currentOverClient,{timeAxis:t}=r,i=O.from(e.querySelector(r.eventInnerSelector),r.timeAxisSubGridElement),n=this.dragData,[a]=n.draggedEntities,s=a.isAssignment?a.event:a,o=r.fillTicks&&r.snapRelativeToEventStartDate,l=s.endDate-s.startDate;let{start:d,end:c}=r.getStartEndDatesFromRectangle(i,o?null:"round",l,!0);if(d&&c){if(o){const u=s.startDate-R.startOf(s.startDate,t.unit),m=c-d,f=u/m*i.width;i.deflate(f,0,0,f);const h=i.getStart(r.rtl,!r.isVertical);d=r.getDateFromCoordinate(h,null,!0),d=t.roundDate(d,s.startDate)}if(d=this.adjustStartDate(d,0),n.startsOutsideView)n.endsOutsideView||(d=c&&R.add(c,-l));else{if(!t.dateInAxis(d,!1)){const u=t.getTickFromDate(d);u>=0&&(d=t.getDateFromTick(u))}c=d&&R.add(d,l)}}return{startDate:d,endDate:c}}getTipHtml(){const e=this,{dragData:r,client:t,tooltipTemplate:i}=e,{startDate:n,endDate:a,draggedEntities:s}=r,o=t.getFormattedDate(n),l=t.getFormattedEndDate(a,n),{valid:d,message:c,element:u,dragProxy:m}=r.context,f=m?m.firstChild:u,h=s[0],g=h.isTask?h:h.event;return e.tip.lastAlignSpec.target=f,i({valid:d,startDate:n,endDate:a,startText:o,endText:l,dragData:r,message:c||"",[t.scheduledEventName+"Record"]:g,startClockHtml:e.clockTemplate.template({date:n,text:o,cls:"b-sch-tooltip-startdate"}),endClockHtml:g.isMilestone?"":e.clockTemplate.template({date:a,text:l,cls:"b-sch-tooltip-enddate"})})}updateConstrainDragToTimeSlot(e){const r=this.client.isHorizontal?"lockX":"lockY";this.drag&&(this.drag[r]=e)}updateConstrainDragToResource(e){const r=this;if(r.drag){const{constrainDragToTimeSlot:t}=r,{isHorizontal:i}=r.client;e&&(r.constrainDragToTimeline=!0),r.drag.lockY=i?e:t,r.drag.lockX=i?t:e}}updateConstrainDragToTimeline(e){this.isConfiguring||Object.assign(this.drag,{cloneTarget:!e,dragWithin:e?null:document.body,scrollManager:e?this.client.scrollManager:null})}constrainStartDate(e){const{dragData:r}=this,{dateConstraints:t}=r,i=r.eventRecord||r.taskRecord||r.draggedEntities[0];return t!=null&&t.start&&(e=R.max(t.start,e)),t!=null&&t.end&&(e=R.min(new Date(t.end-i.durationMS),e)),e}getElementFromContext(e){return e.grabbed||e.dragProxy||e.element}getRelatedRecords(e){return[]}getMinimalDragData(e,r){return{}}isValidDrop(e){throw new Error("Implement in subclass")}checkDragValidity(e){throw new Error("Implement in subclass")}updateRecords(e){throw new Error("Implement in subclass")}isElementDraggable(e,r){throw new Error("Implement in subclass")}getCoordinate(e,r,t){throw new Error("Implement in subclass")}setupProductDragData(e){throw new Error("Implement in subclass")}getProductDragContext(e){throw new Error("Implement in subclass")}getRecordElement(e){throw new Error("Implement in subclass")}};De._$name="DragBase";var be={top:"b-t",right:"b100-t100",bottom:"t-b",left:"b0-t0"},ee=class extends j.mixin(ve,Oe){static get $name(){return"EventResize"}static get configurable(){return{draggingItemCls:"b-sch-event-wrap-resizing",resizingItemInnerCls:"b-sch-event-resizing",leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,handleSize:null,dynamicHandleSize:!0,allowResizeToZero:null,reservedSpace:5,touchHandleSize:null,dragThreshold:0,dragTouchStartDelay:0,draggingClsSelector:".b-timeline-base",showTooltip:!0,showExactResizePosition:!1,validatorFn:()=>!0,validatorFnThisObj:null,tip:{$config:["lazy","nullify"],value:{autoShow:!1,axisLock:!0,trackMouse:!1,updateContentOnMouseMove:!0,hideDelay:0}},tooltipTemplate:e=>`
                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">
                    ${e.startClockHtml}
                    ${e.endClockHtml}
                    <div class="b-sch-tip-message">${e.message}</div>
                </div>
            `,ignoreSelector:".b-sch-terminal",dragActiveCls:"b-resizing-event",lockLayout:q.checkVersion("core","6.0",">=")}}static get pluginConfig(){return{chain:["render","onEventDataGenerated","isEventElementDraggable"]}}doDestroy(){var e;super.doDestroy(),(e=this.dragging)==null||e.destroy()}render(){const e=this,{client:r}=e;e.dragSelector=e.dragItemSelector=r.eventSelector,e.dragRootElement=e.dropRootElement=r.timeAxisSubGridElement,e.dragLock=r.isVertical?"y":"x"}isEventElementDraggable(e,r,t,i){const n=this,a=r==null?void 0:r.resizable;return n.disabled||!a||r.isMilestone?!0:(a!==!0&&a!=="start"||!n.isOverStartHandle(i,e))&&(a!==!0&&a!=="end"||!n.isOverEndHandle(i,e))}onEventDataGenerated({eventRecord:e,wrapperCls:r,cls:t}){var i,n;e===((n=(i=this.dragging)==null?void 0:i.context)==null?void 0:n.eventRecord)&&(r["b-active"]=r[this.draggingItemCls]=r["b-over-resize-handle"]=t["b-resize-handle"]=t[this.resizingItemInnerCls]=1)}onDragPointerMove(e){var r;const{client:t,dragging:i}=this,{visibleDateRange:n,isHorizontal:a}=t,s=a&&t.rtl,o=a?"X":"Y",l=globalThis[`page${o}Offset`],d=e[`page${o}`]+(((r=i.context)==null?void 0:r.offset)||0),c=O.from(t.timeAxisSubGridElement,null,!0),u=c.getStart(s,a),m=c.getEnd(s,a);let f=t.getDateFromCoord({coord:d,local:!1});s?d-l>u?f=n.startDate:d<m&&(f=n.endDate):d-l<u?f=n.startDate:d-l>m&&(f=n.endDate),i.clientStartCoord=u,i.clientEndCoord=m,i.date=f,super.onDragPointerMove(e)}get isResizing(){return!!this.dragging}beforeDrag(e){const{client:r}=this,t=r.resolveTimeSpanRecord(e.itemElement),i=!r.isGanttBase&&r.resolveResourceRecord(r.isVertical?e.startEvent:e.itemElement);return this.disabled||r.readOnly||i!=null&&i.readOnly||t&&(t.readOnly||!(t.project||t.isOccurrence))||super.beforeDrag(e)===!1?!1:(e.mousedownDate=e.date=r.getDateFromCoordinate(e.event[`page${r.isHorizontal?"X":"Y"}`],null,!1),this.triggerBeforeResize(e))}dragStart(e){var r,t;const i=this,{client:n,tip:a}=i,{startEvent:s,itemElement:o}=e,l=n.scheduledEventName,d=n.resolveEventRecord(o),{isBatchUpdating:c,wrapStartDate:u,wrapEndDate:m}=d,f=(r=n.features.eventBuffer)==null?void 0:r.enabled,h=c?d.get("startDate"):d.startDate,g=c?d.get("endDate"):d.endDate,p=i.dragLock==="x",D=p&&n.rtl,v=i.isOverEndHandle(s,o),S=v?"endDate":"startDate",b=f?v?"wrapEndDate":"wrapStartDate":null,y=v?"startDate":"endDate",T=v?"setEndDate":"setStartDate",C=v?"setStartDate":"setEndDate",w=O.from(o),M=p?s.clientX:s.clientY,k=v?w.getEnd(D,p):w.getStart(D,p),z=e.context={eventRecord:d,element:o,timespanRecord:d,taskRecord:d,owner:i,valid:!0,oldValue:v?g:h,startDate:h,endDate:g,offset:f?0:k-M,edge:p?v?"right":"left":v?"bottom":"top",finalize:i.finalize,event:e.event,originalStartDate:h,originalEndDate:g,wrapStartDate:u,wrapEndDate:m,draggingEnd:v,toSet:S,wrapToSet:b,otherEnd:y,setMethod:T,setOtherMethod:C};d.meta.isResizing=!0,n.element.classList.add(...i.dragActiveCls.split(" ")),n.listenToBatchedUpdates||n.beginListeningForBatchedUpdates(),c||i.beginEventRecordBatch(d),i.setupProductResizeContext(z,s),i.triggerEventResizeStart(`${l}ResizeStart`,{[`${l}Record`]:d,event:s,...i.getResizeStartParams(z)},z),z.resizedRecord=((t=n.resolveAssignmentRecord)==null?void 0:t.call(n,z.element))||d,a&&(a.show(),a.align=be[z.edge],a.showBy(i.getTooltipTarget(e)))}triggerBeforeResize(e){const{client:r}=this,t=r.resolveTimeSpanRecord(e.itemElement);return r.trigger(`before${r.capitalizedEventName}Resize`,{[`${r.scheduledEventName}Record`]:t,event:e.event,...this.getBeforeResizeParams({event:e.startEvent,element:e.itemElement})})}triggerEventResizeStart(e,r,t){var i,n;this.client.trigger(e,r),(n=(i=this.client)[`after${G.capitalize(e)}`])==null||n.call(i,t,r)}triggerEventResizeEnd(e,r){this.client.trigger(e,r)}triggerEventPartialResize(e,r){this.client.trigger(e,r)}triggerBeforeEventResizeFinalize(e,r){this.client.trigger(e,r)}dragEnter(e){var r;return((r=e.context)==null?void 0:r.owner)===this}resizeEventPartiallyInternal(e,r){var t;const{client:i}=this,{toSet:n}=r;if((t=i.features.eventBuffer)!=null&&t.enabled){if(n==="startDate"){const a=r.startDate.getTime()-r.originalStartDate.getTime();e.wrapStartDate=new Date(r.wrapStartDate.getTime()+a)}else if(n==="endDate"){const a=r.endDate.getTime()-r.originalEndDate.getTime();e.wrapEndDate=new Date(r.wrapEndDate.getTime()+a)}}e.set(n,r[n])}applyDateConstraints(e,r,t){var i,n;const a=(i=t.dateConstraints)==null?void 0:i.start,s=(n=t.dateConstraints)==null?void 0:n.end;return(a||s)&&(e=R.constrain(e,a,s),t.snappedDate=R.constrain(t.snappedDate,a,s)),e}moveDrag(e){const r=this,{client:t,tip:i}=r,n=r.dragLock==="x",a=n?"X":"Y",s=t.scheduledEventName,{visibleDateRange:o,enableEventAnimations:l,timeAxis:d,weekStartDay:c}=t,u=n&&t.rtl,{resolutionUnit:m,resolutionIncrement:f}=d,{event:h,context:g}=e,{eventRecord:p,oldValue:D}=g,v=g.offset*(u?-1:1),{isOccurrence:S}=p,b=p.get("startDate"),y=p.get("endDate"),T=h[`client${a}`]+v,C=O.from(t.timeAxisSubGridElement,null,!0),w=C.getStart(u,n),M=C.getEnd(u,n);g.event=h,h.isScroll&&(e.date=t.getDateFromCoordinate(h[`page${a}`]+v,null,!1));let k,z,{date:E}=e,{toSet:A,otherEnd:H,draggingEnd:X}=g;u?T>w?E=e.date=o.startDate:T<M&&(E=e.date=o.endDate):T<w?E=e.date=o.startDate:T>M&&(E=e.date=o.endDate),A==="endDate"?E<b&&(k=-1):E>y&&(k=1),k&&r.onDragEndSwitch&&(r.onDragEndSwitch(g,E,k),H=g.otherEnd,A=g.toSet),t.snapRelativeToEventStartDate&&(E=d.roundDate(E,D)),g.snappedDate=R.round(E,d.resolution,null,c);const L=R.diff(E,g[H],m)*(X?-1:1);if(r.isEventDragCreate)g.tooNarrow=L<f/2;else if(L<f)if(r.allowResizeToZero)g.snappedDate=E=g[H];else{const $=H==="startDate"?1:-1,V=d.roundDate(R.add(p.get(H),f*$,m));(V-D)*$<0||(E-D)*$>0?g.snappedDate=V:(E=$>0?R.max(E,D):R.min(E,D),g.snappedDate=D),z=!0}if(E=r.applyDateConstraints(E,p,g),(!g.date||E-g.date||z)&&(g.date=E,g[A]=r.showExactResizePosition||t.timeAxisViewModel.snap?g.snappedDate:E,g.valid=r.allowResizeToZero||g[A]-g[A==="startDate"?"endDate":"startDate"]!==0,p.get(A)-g[A])){if(g.valid=r.checkValidity(g,h),g.message="",g.valid&&typeof g.valid!="boolean"&&(g.message=g.valid.message,g.valid=g.valid.valid),g.valid=g.valid!==!1,g.valid){const $={[`${s}Record`]:p,startDate:b,endDate:y,element:e.itemElement,context:g};$[A]=g[A],r.triggerEventPartialResize(`${s}PartialResize`,$),S&&p.stores.push(t.eventStore),t.enableEventAnimations=!1,this.resizeEventPartiallyInternal(p,g),t.enableEventAnimations=l,S&&(p.stores.length=0)}g.tooNarrow&&(g.valid=!1)}i&&(i.align=be[g.edge],i.alignTo(r.getTooltipTarget(e))),super.moveDrag(e)}dragEnd(e){const{context:r}=e;r&&(r.event=e.event),e.aborted?r==null||r.finalize(!1):!this.isEventDragCreate&&!e.started&&!P.getPagePoint(e.event).equals(P.getPagePoint(e.startEvent))&&(this.dragStart(e),this.cleanup(e.context,!1))}async dragDrop({context:e,event:r}){var t;e[e.toSet]=e.snappedDate;const{client:i}=this,{startDate:n,endDate:a}=e;let s;(t=this.tip)==null||t.hide(),e.valid=n&&a&&(this.allowResizeToZero||a-n>0)&&e[e.toSet]-e.oldValue&&e.valid!==!1,e.valid&&(this.triggerBeforeEventResizeFinalize(`before${i.capitalizedEventName}ResizeFinalize`,{context:e,event:r,[`${i.scheduledEventName}Record`]:e.eventRecord}),s=!0),e.async||await e.finalize(s)}async finalize(e){const r=this.owner,t=this,{eventRecord:i,oldValue:n,toSet:a}=t,{snapRelativeToEventStartDate:s,timeAxis:o}=r.client;let l=!1;e?(s&&(t[a]=t.snappedDate=o.roundDate(t.date,n)),l=await r.internalUpdateRecord(t,i)):(r.cancelEventRecordBatch(i),i.isOccurrence&&i.resources.forEach(d=>r.client.repaintEventsForResource(d))),r.isDestroyed||r.cleanup(t,l)}cleanup(e,r){var t;const i=this,{client:n}=i,{element:a,eventRecord:s}=e,o=n.scheduledEventName;s.meta.isResizing=!1,n.endListeningForBatchedUpdates(),(t=i.tip)==null||t.hide(),i.unHighlightHandle(a),n.element.classList.remove(...i.dragActiveCls.split(" ")),i.triggerEventResizeEnd(`${o}ResizeEnd`,{changed:r,[`${o}Record`]:s,...i.getResizeEndParams(e)})}async internalUpdateRecord(e,r){var t;const{client:i}=this,{generation:n}=r;if(r.isOccurrence)i.endListeningForBatchedUpdates(),r[r.batching>1?"endBatch":"cancelBatch"](),r.set(pe.prototype.inSetNormalize.call(r,{startDate:e.startDate,endDate:e.endDate}));else{const a={[e.toSet]:e[e.toSet]},s=Object.assign({},r.meta.batchChanges);if(delete s[e.toSet],delete s.duration,r.isEntity){const{startDate:o,endDate:l,draggingEnd:d}=e;e.duration=a.duration=r.run("calculateProjectedDuration",o,l),a[e.toSet]=r.run("calculateProjectedXDateWithDuration",d?o:l,d,e.duration);const c=!r[e.otherEnd];c&&(a[e.otherEnd]=e[e.otherEnd]),r.set(a),i.endListeningForBatchedUpdates(),this.cancelEventRecordBatch(r),(t=i.features.eventBuffer)!=null&&t.enabled&&(r[e.wrapToSet]=null);const u=[];c&&u.push(r[e.setOtherMethod](a[e.otherEnd],!1)),u.push(r[e.setMethod](a[e.toSet],!1)),await Promise.all(u)}else i.endListeningForBatchedUpdates(),this.cancelEventRecordBatch(r),r[e.setMethod](a[e.toSet],!1);Object.keys(s).length&&r.set(s)}return await i.project.commitAsync(),r.generation!==n}onDragItemMouseMove(e){e.pointerType!=="touch"&&!this.handleSelector&&this.checkResizeHandles(e)}checkResizeHandles(e){const r=this,{overItem:t}=r;if(t&&!r.client.readOnly&&(!r.allowResize||r.allowResize(t,e))){const i=r.client.resolveTimeSpanRecord(t);if(i!=null&&i.readOnly)return;r.isOverAnyHandle(e,t)?r.highlightHandle():r.unHighlightHandle()}}onDragItemMouseLeave(e,r){this.unHighlightHandle(r)}highlightHandle(){var e,r;const{overItem:t,client:i}=this;((r=(e=t.syncIdMap)==null?void 0:e[i.scheduledEventName])!=null?r:t.querySelector(i.eventInnerSelector)).classList.add("b-resize-handle"),t.classList.add("b-over-resize-handle")}unHighlightHandle(e=this.overItem){var r,t;if(e){const i=this,n=(t=(r=e.syncIdMap)==null?void 0:r[i.client.scheduledEventName])!=null?t:e.querySelector(i.client.eventInnerSelector);n&&n.classList.remove("b-resize-handle",i.resizingItemInnerCls),e.classList.remove("b-over-resize-handle",i.draggingItemCls)}}isOverAnyHandle(e,r){return this.isOverStartHandle(e,r)||this.isOverEndHandle(e,r)}isOverStartHandle(e,r){var t;return(t=this.getHandleRect("start",e,r))==null?void 0:t.contains(P.getPagePoint(e))}isOverEndHandle(e,r){var t;return(t=this.getHandleRect("end",e,r))==null?void 0:t.contains(P.getPagePoint(e))}getHandleRect(e,r,t){if(this.overItem){if(t=r.target.closest(`.${this.client.eventCls}`)||t.querySelector(`.${this.client.eventCls}`),!t)return;const i=this,n=e==="start",{client:a}=i,s=!!a.rtl,o=i.dragLock,l=o==="x",d=l?"width":"height",c=`${l?n&&!s?"left":"right":n?"top":"bottom"}Handle`,{offsetWidth:u}=t,m=a.resolveTimeSpanRecord(t),f=m==null?void 0:m.isResizable,h=O.from(t),g=h.clone(),p=globalThis.getComputedStyle(t,":before"),D=!i.handleSelector&&!He.isHoverableDevice?i.touchHandleSize:void 0,v=D||i.handleSize||parseFloat(p[d]),S=i.handleVisibilityThreshold||2*i.handleSize,b=i.dynamicHandleSize?i.reservedSpace/2:0,y=[0,0,0,0];if(!i.disabled&&i[c]&&(u>=S||i.dynamicHandleSize)&&(f===!0||f===e)&&(!l&&!n||l&&s===n?(g[o]+=h[d]-v,y[l?3:0]=h[d]/2+b):y[l?1:2]=h[d]/2+b,h.deflate(...y),g[d]=v,g.constrainTo(h),g[d]))return g}}setupDragContext(e){const r=this;if(r.overItem&&r.isOverAnyHandle(e,r.overItem)&&r.isElementResizable(r.overItem,e)){const t=super.setupDragContext(e);return t.scrollManager=r.client.scrollManager,t}}changeHandleSize(){q.deprecate("Scheduler","6.0.0","Handle size is from CSS")}changeTouchHandleSize(){q.deprecate("Scheduler","6.0.0","Handle size is from CSS")}changeTip(e,r){var t;const i=this;return i.showTooltip?(e?(e.isTooltip?e.owner=i:e=I.reconfigure(r,I.mergeConfigs({id:i.tipId},e,{getHtml:i.getTipHtml.bind(i),owner:i.client},i.tip),{owner:i,defaults:{type:"tooltip"}}),e.ion({innerhtmlupdate:"updateDateIndicator",thisObj:i}),i.clockTemplate=new J({scheduler:i.client})):r&&(r.destroy(),(t=i.clockTemplate)==null||t.destroy()),e):null}isElementResizable(e,r){var t;const i=this,{client:n}=i,a=n.resolveTimeSpanRecord(e);if(n.readOnly)return!1;let s=a==null?void 0:a.isResizable;const o=(t=e==null?void 0:e.syncIdMap[n.scheduledEventName])!=null?t:e,l=r.target.closest('[class$="-handle"]');if(!s||l&&l!==o||(e=r.target.closest(i.dragSelector),!e))return!1;const d=e.classList.contains("b-sch-event-startsoutside"),c=e.classList.contains("b-sch-event-endsoutside");if(s===!0){if(d&&c)return!1;if(d)s="end";else if(c)s="start";else return i.isOverStartHandle(r,e)||i.isOverEndHandle(r,e)}return d&&s==="start"||c&&s==="end"?!1:!!(i.isOverStartHandle(r,e)&&s==="start"||i.isOverEndHandle(r,e)&&s==="end")}updateDateIndicator(){const{clockTemplate:e}=this,{eventRecord:r,draggingEnd:t,snappedDate:i}=this.dragging.context,n=t?r.get("startDate"):i,a=t?i:r.get("endDate"),{element:s}=this.tip;e.updateDateIndicator(s.querySelector(".b-sch-tooltip-startdate"),n),e.updateDateIndicator(s.querySelector(".b-sch-tooltip-enddate"),a)}getTooltipTarget({itemElement:e,context:r}){const t=this,{rtl:i}=t.client,n=O.from(e,null,!0);return t.dragLock==="x"?(!i&&r.edge==="right"||i&&r.edge==="left"?n.x=n.right-1:n.x-=t.tip.anchorSize[0]/2,n.width=t.tip.anchorSize[0]/2):(r.edge==="bottom"&&(n.y=n.bottom-1),n.height=t.tip.anchorSize[1]/2),{target:n}}basicValidityCheck(e,r){return e.startDate&&(e.endDate>e.startDate||this.allowResizeToZero)&&this.validatorFn.call(this.validatorFnThisObj||this,e,r)}getTipHtml({tip:e}){const r=this,{startDate:t,endDate:i,toSet:n,snappedDate:a,valid:s,message:o="",timespanRecord:l}=r.dragging.context;if(!t||!i)return e.html;const d={record:l,valid:s,message:o,startDate:t,endDate:i,[n]:a};return d.startText=r.client.getFormattedDate(d.startDate),d.endText=r.client.getFormattedDate(d.endDate),d.startClockHtml=r.clockTemplate.template({date:d.startDate,text:d.startText,cls:"b-sch-tooltip-startdate"}),d.endClockHtml=r.clockTemplate.template({date:d.endDate,text:d.endText,cls:"b-sch-tooltip-enddate"}),r.tooltipTemplate(d)}beginEventRecordBatch(e){e.beginBatch()}cancelEventRecordBatch(e){e.cancelBatch()}getBeforeResizeParams(e){const{client:r}=this;return{resourceRecord:r.resolveResourceRecord(r.isVertical?e.event:e.element)}}getResizeStartParams(e){return{resourceRecord:e.resourceRecord}}getResizeEndParams(e){return{resourceRecord:e.resourceRecord,event:e.event}}setupProductResizeContext(e,r){var t,i,n;const{client:a}=this,{element:s}=e,o=a.resolveEventRecord(s),l=(t=a.resolveResourceRecord)==null?void 0:t.call(a,s),d=(i=a.resolveAssignmentRecord)==null?void 0:i.call(a,s);Object.assign(e,{eventRecord:o,taskRecord:o,resourceRecord:l,assignmentRecord:d,dateConstraints:(n=a.getDateConstraints)==null?void 0:n.call(a,l,o)})}checkValidity({startDate:e,endDate:r,eventRecord:t,resourceRecord:i}){const{client:n}=this;return!n.allowOverlap&&t.resources.some(a=>!n.isDateRangeAvailable(e,r,t,a))?{valid:!1,message:this.L("L{EventDrag.eventOverlapsExisting}")}:this.basicValidityCheck(...arguments)}get tipId(){return`${this.client.id}-event-resize-tip`}};ee._$name="EventResize",F.registerFeature(ee,!0,"Scheduler"),F.registerFeature(ee,!1,"ResourceHistogram");var Se=e=>class extends(e||ae){static get $name(){return"TaskEditTransactional"}captureStm(t){if(this.client.transactionalFeaturesEnabled)return super.captureStm(),this.startStmTransaction(t);super.captureStm(t)}freeStm(t){if(this.hasStmCapture||!this.client.transactionalFeaturesEnabled)return super.freeStm(t)}async startStmTransaction(t){this.client.transactionalFeaturesEnabled?await this.startFeatureTransaction(t):super.startStmTransaction()}commitStmTransaction(){if(this.client.transactionalFeaturesEnabled)return this.finishFeatureTransaction();super.commitStmTransaction()}async rejectStmTransaction(){this.client.transactionalFeaturesEnabled?this.rejectFeatureTransaction():await super.rejectStmTransaction()}},Te=e=>{var r;return r=class extends ne(e||ae){detachFromProject(t){this.rejectFeatureTransaction(),super.detachFromProject(t)}getStmCapture(){const t=super.getStmCapture();return t._editorPromiseResolve=this._editorPromiseResolve,t}applyStmCapture(t){super.applyStmCapture(t),this._editorPromiseResolve=t._editorPromiseResolve}async startFeatureTransaction(){if(!this.client.transactionalFeaturesEnabled)return;const t=this,{project:i}=t.client,{stm:n}=i;let a;t.hasStmCapture?n.startTransaction():a=i.queue(()=>i.commitAsync()),i.queue(()=>{var s;return t.hasStmCapture||(t._stmInitiallyDisabled=n.disabled,t._stmInitiallyAutoRecord=n.autoRecord,n.isRecording?n.stopTransaction():t._stmInitiallyDisabled&&n.enable(),n.autoRecord=!1),n.isRecording||n.startTransaction(),(s=t.trigger)==null||s.call(t,"featureTransactionStart"),new Promise(o=>t._editorPromiseResolve=o)}),await a}rejectFeatureTransaction(){var t;if(!this.client.transactionalFeaturesEnabled)return;const i=this,{stm:n}=i.client.project;(t=i._editorPromiseResolve)==null||t.call(i),i._editorPromiseResolve=null,n.isRecording&&n.rejectTransaction(),!i.hasStmCapture&&i._stmInitiallyDisabled!=null&&(n.disabled=i._stmInitiallyDisabled,n.autoRecord=i._stmInitiallyAutoRecord),i.trigger("featureTransactionReject")}async finishFeatureTransaction(t){var i;if(!this.client.transactionalFeaturesEnabled)return;const n=this,{project:a}=n.client,{stm:s}=a;a.isEngineReady()||await a.commitAsync();const o=s.stash(),{_stmInitiallyDisabled:l,_stmInitiallyAutoRecord:d}=n,c=Fe.generateId("featureTransaction");return(i=n._editorPromiseResolve)==null||i.call(n),n._editorPromiseResolve=null,n.isDestroying||n.trigger("featureTransactionFinalizeStart",{id:c}),a.queue(async()=>{var u,m;s==null||s.applyStash(o),await(t==null?void 0:t()),await((u=a.commitAsync)==null?void 0:u.call(a)),s.isRecording&&s.stopTransaction(),!n.hasStmCapture&&s&&!s.isDestroying&&l!=null&&(s.disabled=l,s.autoRecord=d),(m=n.trigger)==null||m.call(n,"featureTransactionFinalized",{id:c})})}},x(r,"$name","TransactionalFeature"),r},Ve=function(e){var r,t;return(t=(r=this.source)==null?void 0:r.client.features.taskEdit)!=null&&t._canceling?!1:P.getDistanceBetween(this.startEvent,e)},se=class extends ee.mixin(ke,Te,Se){construct(e,r){(r==null?void 0:r.showTooltip)===!1&&(r.tip=null),super.construct(...arguments)}changeValidatorFn(e){this.createValidatorFn=e}render(){const e=this,{client:r}=e;e.dragRootElement=e.dropRootElement=r.timeAxisSubGridElement,e.dragLock=r.isVertical?"y":"x"}onDragEndSwitch(e){const{client:r}=this,{enableEventAnimations:t}=r,{eventRecord:i,draggingEnd:n}=e,a=this.dragLock==="x",{initialDate:s}=this.dragging;r.enableEventAnimations=!1,i.set({startDate:s,endDate:s}),n?Object.assign(e,{endDate:s,toSet:"startDate",otherEnd:"endDate",setMethod:"setStartDate",setOtherMethod:"setEndDate",edge:a?"left":"top"}):Object.assign(e,{startDate:s,toSet:"endDate",otherEnd:"startDate",setMethod:"setEndDate",setOtherMethod:"setStartDate",edge:a?"right":"bottom"}),e.draggingEnd=this.draggingEnd=!n,r.enableEventAnimations=t}beforeDrag(e){const r=this,t=super.beforeDrag(e),{pan:i,eventDragSelect:n}=r.client.features;return t!==!1&&(r.preventMultiple&&!r.isRowEmpty(e.rowRecord)||r.disabled||i&&!i.disabled||n&&!n.disabled)?!1:(r.client.preventDragSelect=!0,t)}startDrag(e){const r=super.startDrag(e);if(r!==!1){const{context:t}=e;e.initialDate=t.eventRecord.get(this.draggingEnd?"startDate":"endDate"),this.client.trigger("dragCreateStart",{proxyElement:e.element,eventElement:e.element,eventRecord:t.eventRecord,resourceRecord:t.resourceRecord}),e.context.offset=0,e.context.oldValue=e.mousedownDate}return r}isOverEndHandle(){return this.draggingEnd}setupDragContext(e){var r;const{client:t}=this;if(t.matchScheduleCell(e.target)){const i=(r=t.resolveResourceRecord(e))==null?void 0:r.$original;if(i&&!i.isSpecialRow){const n=ve().prototype.setupDragContext.call(this,e),a=[];return t.isVertical?a.push({element:t.scrollable.element,direction:"vertical"}):a.push({element:t.timeAxisSubGrid.scrollable.element,direction:"horizontal"}),n.scrollManager=t.scrollManager,n.monitoringConfig={scrollables:a},n.resourceRecord=n.rowRecord=i,n.getDistance=Ve,n}}}async dragDrop({context:e,event:r}){var t;e[e.toSet]=e.snappedDate;const{client:i}=this,{startDate:n,endDate:a,eventRecord:s}=e,{generation:o}=s;let l;(t=this.tip)==null||t.hide(),await i.project.commitAsync(),s.generation!==o&&(e.eventRecord[e.toSet]=e.oldValue,e.eventRecord[e.toSet]=e[e.toSet]),e.valid=n&&a&&a-n>0&&e[e.toSet]-e.oldValue&&e.valid!==!1,e.valid&&(i.trigger("beforeDragCreateFinalize",{context:e,event:r,proxyElement:e.element,eventElement:e.element,eventRecord:e.eventRecord,resourceRecord:e.resourceRecord}),l=!0),e.async||await e.finalize(l)}updateDragTolerance(e){this.dragThreshold=e}changeTip(e,r){return super.changeTip(!e||e.isTooltip?e:Y.assign({id:`${this.client.id}-drag-create-tip`},e),r)}async finalize(e){var r;if(this.finalized)return;this.finalized=!0;const t=this.owner,i=this,n=()=>{t.isDestroyed||(t.client.trigger("afterDragCreate",{proxyElement:i.element,eventElement:i.element,eventRecord:i.eventRecord,resourceRecord:i.resourceRecord}),t.cleanup(i))};e?(await t.finalizeDragCreate(i),n()):(await t.cancelDragCreate(i),(r=t.onAborted)==null||r.call(t,i),n())}async cancelDragCreate(e){}async finalizeDragCreate(e){var r,t;await this.internalUpdateRecord(e,e.eventRecord);const i=this.getStmCapture();return(r=this.client)==null||r.trigger("dragCreateEnd",{eventRecord:e.eventRecord,resourceRecord:e.resourceRecord,event:e.event,eventElement:e.element,stmCapture:i}),(t=this.client)==null||t.trigger("eventAutoCreated",{eventRecord:e.eventRecord,resourceRecord:e.resourceRecord}),i.transferred}cleanup(e){var r;const{client:t}=this,{eventRecord:i}=e;i.meta.isResizing=!1,t.endListeningForBatchedUpdates(),(r=this.tip)==null||r.hide(),t.element.classList.remove(...this.dragActiveCls.split(" ")),e.element.parentElement.classList.remove("b-sch-dragcreating")}onElementContextMenu(){if(this.proxy)return!1}prepareCreateContextForFinalization(e,r,t,i=!1){return{...e,async:i,event:r,finalize:t}}onEventDataGenerated(e){var r,t;((t=(r=this.dragging)==null?void 0:r.context)==null?void 0:t.eventRecord)===e.eventRecord&&(e.wrapperCls["b-sch-dragcreating"]=!0,e.wrapperCls["b-too-narrow"]=this.dragging.context.tooNarrow)}triggerBeforeResize(){}triggerEventResizeStart(){}checkValidity(e,r){throw new Error("Implement in subclass")}handleBeforeDragCreate(e,r){throw new Error("Implement in subclass")}isRowEmpty(e){throw new Error("Implement in subclass")}};x(se,"configurable",{showTooltip:!0,dragTolerance:2,preventMultiple:!1,dragTouchStartDelay:300,validatorFnThisObj:null,tipTemplate:e=>`
            <div class="b-sch-tip-${e.valid?"valid":"invalid"}">
                ${e.startClockHtml}
                ${e.endClockHtml}
                <div class="b-sch-tip-message">${e.message}</div>
            </div>
        `,dragActiveCls:"b-dragcreating"}),x(se,"pluginConfig",{chain:["render","onEventDataGenerated"],before:["onElementContextMenu"]}),se._$name="DragCreateBase";var ye=class extends j{static get defaultConfig(){return{autoUpdate:!1,hoverDelay:250,hideDelay:100,template:null,cls:null,align:{align:"b-t"},clockTemplate:null,monitorRecordUpdate:null,testConfig:{hoverDelay:0}}}static get pluginConfig(){return{chain:["onInternalPaint"]}}construct(e,r){const t=this;r=t.processConfig(r),super.construct(e,r),t.forSelector||(t.forSelector=`${e.eventInnerSelector}:not(.b-dragproxy,.b-iscreating)`),t.clockTemplate=new J({scheduler:e}),e.ion({[`before${e.scheduledEventName}drag`]:()=>{var i;(i=t.tooltip)==null||i.hide()}})}processConfig(e){return typeof e=="function"?{template:e}:e}setConfig(e){super.setConfig(this.processConfig(e))}doDestroy(){this.destroyProperties("clockTemplate","tooltip"),super.doDestroy()}doDisable(e){this.tooltip&&(this.tooltip.disabled=e),super.doDisable(e)}onInternalPaint({firstPaint:e}){var r;if(e){const t=this,{client:i}=t,n=`:not(${[".b-dragselecting",".b-eventeditor-editing",".b-taskeditor-editing",".b-resizing-event",".b-task-percent-bar-resizing-task",".b-dragcreating",`.b-dragging-${i.scheduledEventName}`,".b-creating-dependency",".b-dragproxy"].join()})`;(r=t.tooltip)==null||r.destroy();const a=t.tooltip=new I({axisLock:"flexible",id:t.tipId||`${t.client.id}-event-tip`,cls:t.tipCls,forSelector:`.b-timelinebase${n} .b-grid-body-container:not(.b-scrolling) ${t.forSelector}`,scrollAction:"realign",forElement:i.timeAxisSubGridElement,showOnHover:!0,anchorToTarget:!0,getHtml:t.getTipHtml.bind(t),disabled:t.disabled,...t.config,internalListeners:t.configuredListeners});a.ion({innerhtmlupdate:"updateDateIndicator",overtarget:"onOverNewTarget",show:"onTipShow",hide:"onTipHide",thisObj:t}),Object.keys(a.$meta.configs).forEach(s=>{Object.defineProperty(this,s,{set:o=>a[s]=o,get:()=>a[s]})})}}processConfiguredListeners(){}addListener(...e){var r;const t=super.addListener(...e),i=(r=this.tooltip)==null?void 0:r.addListener(...e);if(t||i)return()=>{t==null||t(),i==null||i()}}removeListener(...e){var r;super.removeListener(...e),(r=this.tooltip)==null||r.removeListener(...e)}updateDateIndicator(){const e=this,r=e.tooltip,t=r.element.querySelector(".b-sch-tooltip-enddate");e.record&&(e.clockTemplate.updateDateIndicator(r.element,e.record.startDate),t&&e.clockTemplate.updateDateIndicator(t,e.record.endDate))}resolveTimeSpanRecord(e){return this.client.resolveTimeSpanRecord(e)}getTipHtml({tip:e,activeTarget:r}){const t=this,{client:i}=t,n=t.recordType||`${i.scheduledEventName}Record`,a=t.resolveTimeSpanRecord(r);if((a==null?void 0:a.startDate)instanceof Date){const{startDate:s,endDate:o}=a,l=i.getFormattedDate(s),d=i.getDisplayEndDate(o,s),c=i.getFormattedDate(d);return e.eventRecord=a,t.template({tip:e,[`${n}`]:a,startDate:s,endDate:o,startText:l,endText:c,startClockHtml:t.clockTemplate.template({date:s,text:l,cls:"b-sch-tooltip-startdate"}),endClockHtml:a.isMilestone?"":t.clockTemplate.template({date:d,text:c,cls:"b-sch-tooltip-enddate"})})}else return e.hide(),""}get record(){return this.tooltip.eventRecord}onTipShow(){const e=this;e.monitorRecordUpdate&&!e.updateListener&&(e.updateListener=e.client.eventStore.ion({change:e.onRecordUpdate,buffer:300,thisObj:e}))}onTipHide(){var e;this.tooltip.eventRecord=null,(e=this.updateListener)==null||e.call(this),this.updateListener=null}onOverNewTarget({newTarget:e}){const{tooltip:r}=this;r.isVisible&&(this.client.timeAxisSubGrid.scrolling||this.client.scrolling?r.hide(!1):r.eventRecord=this.resolveTimeSpanRecord(e))}onRecordUpdate({record:e}){const{tooltip:r}=this;r!=null&&r.isVisible&&e===this.record&&(r.updateContent(),r.lastAlignSpec.aligningToElement?r.realign():r.internalOnPointerOver(this.client.lastPointerEvent))}};ye._$name="TooltipBase";var te=class extends j.mixin(de){static get defaultConfig(){return{rangeCls:"b-sch-range",lineCls:"b-sch-line",enableResizing:!1,showTooltip:!0,hoverTooltip:null,tooltipTemplate:null,dragTipTemplate:e=>`
                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">
                    <div class="b-sch-tip-name">${G.encodeHtml(e.name)||""}</div>
                    ${e.startClockHtml}
                    ${e.endClockHtml||""}
                </div>
            `,baseCls:"b-sch-timerange",headerRenderer:null,bodyRenderer:null,cls:null,narrowThreshold:80}}construct(e,r){const t=this;super.construct(e,r),e.isVertical&&e.ion({renderRows:t.onUIReady,thisObj:t,once:!0}),t.cls=t.cls||`b-sch-${t.constructor.$$name.toLowerCase()}`,t.baseSelector=`.${t.baseCls}.${t.cls}`,t.enableResizing&&(t.showHeaderElements=!0)}doDestroy(){var e,r,t,i;const n=this;n.detachListeners("timeAxisViewModel"),n.detachListeners("timeAxis"),(e=n.clockTemplate)==null||e.destroy(),(r=n.tip)==null||r.destroy(),(t=n.drag)==null||t.destroy(),(i=n.resize)==null||i.destroy(),super.doDestroy()}doDisable(e){this.renderRanges(),super.doDisable(e)}setupTimeAxisViewModelListeners(){const e=this;e.detachListeners("timeAxisViewModel"),e.detachListeners("timeAxis"),e.client.timeAxisViewModel.ion({name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",thisObj:e}),e.client.timeAxis.ion({name:"timeAxis",includeChange:"renderRanges",thisObj:e}),e.updateLineBuffer()}onUIReady(){const e=this,{client:r}=e;r.ion({timeAxisViewModelChange:e.setupTimeAxisViewModelListeners,thisObj:e}),e.setupTimeAxisViewModelListeners(),r.hideHeaders||(e.headerContainerElement&&P.on({click:e.onTimeRangeClick,dblclick:e.onTimeRangeClick,contextmenu:e.onTimeRangeClick,delegate:e.baseSelector,element:e.headerContainerElement,thisObj:e}),e.enableResizing&&(e.drag=fe.new({name:"rangeDrag",lockX:r.isVertical,lockY:r.isHorizontal,constrain:!0,outerElement:e.headerContainerElement,targetSelector:`${e.baseSelector}`,isElementDraggable:(t,i)=>!r.readOnly&&e.isElementDraggable(t,i),rtlSource:r,internalListeners:{dragstart:"onDragStart",drag:"onDrag",drop:"onDrop",reset:"onDragReset",abort:"onInvalidDrop",thisObj:e}},e.dragHelperConfig),e.resize=Le.new({direction:r.mode,targetSelector:`${e.baseSelector}.b-sch-range`,outerElement:e.headerContainerElement,isElementResizable:(t,i)=>!t.matches(".b-dragging,.b-readonly")&&!i.target.matches(".b-fa"),internalListeners:{resizestart:"onResizeStart",resizing:"onResizeDrag",resize:"onResize",cancel:"onInvalidResize",reset:"onResizeReset",thisObj:e}},e.resizeHelperConfig))),e.renderRanges(),e.tooltipTemplate&&(e.hoverTooltip=new I(Y.assign({forElement:e.headerContainerElement,getHtml({activeTarget:t}){const i=e.resolveTimeRangeRecord(t);return e.tooltipTemplate({timeRange:i})},forSelector:`.b-timelinebase:not(.b-dragging-timerange, .b-resizing-timerange) .${e.baseCls}${e.cls?"."+e.cls:""}`},e.hoverTooltip)))}refresh(){this._timeRanges=null,this.renderRanges()}getDOMConfig(e,r){const t=this,i=[],n=[];if(!t.disabled){t._labelRotationMap={};for(const a of t.timeRanges){const s=t.renderRange(a,e,r);s&&(i.push(s.bodyConfig),n.push(s.headerConfig))}}return[i,n]}renderRanges(){const e=this,{client:r}=e;if(r.isPainted&&!r.timeAxisSubGrid.collapsed){const{headerContainerElement:t}=e,i=[],[n,a]=e.getDOMConfig();e.bodyCanvas||(e.bodyCanvas=_.createElement({className:`b-timeranges-canvas b-timeranges-body-canvas ${e.cls}-canvas b-sch-canvas`,parent:r.timeAxisSubGridElement,retainElement:!0})),Q.sync({targetElement:e.bodyCanvas,domConfig:{children:n,onlyChildren:!0,syncOptions:{releaseThreshold:0,syncIdField:"id"}},callback:e.showHeaderElements?null:({targetElement:s,action:o})=>{(o==="reuseElement"||o==="newElement"||o==="reuseOwnElement")&&i.push(s)}}),e.showHeaderElements&&!e.headerCanvas&&(e.headerCanvas=_.createElement({className:`b-timeranges-canvas b-timeranges-header-canvas ${e.cls}-canvas`,parent:t,retainElement:!0})),e.headerCanvas&&Q.sync({targetElement:e.headerCanvas,domConfig:{onlyChildren:!0,children:a,syncOptions:{releaseThreshold:0,syncIdField:"id"}}});for(const s of i)e.cacheRotation(s.elementData.timeRange,s);for(const s of i)e.applyRotation(s.elementData.timeRange,s)}}get timeRanges(){return[]}shouldRenderRange(e,r=this.client.visibleDateRange.startDate,t=this.client.visibleDateRange.endDate){const{timeAxis:i}=this.client,{startDate:n,endDate:a,duration:s}=e;return!!(n&&(i.isContinuous||i.isTimeSpanInAxis(e))&&R.intersectSpans(r,t,n,s?a:R.add(n,this._lineBufferDurationMS)))}getRangeDomConfig(e,r,t,i=0){const n=this,{client:a}=n,{rtl:s}=a,o=a.getCoordinateFromDate(R.max(e.startDate,r),{respectExclusion:!0})-i,l=e.endDate?a.getCoordinateFromDate(R.min(e.endDate,t),{respectExclusion:!0,isEnd:!0})-i:o,d=Math.abs(l-o),c=d>0,u=s?`calc(${o}px - 100%)`:`${o}px`;return{className:{[n.baseCls]:1,[n.cls]:n.cls,[n.rangeCls]:c,[n.lineCls]:!c,[e.cls]:e.cls,"b-narrow-range":c&&d<n.narrowThreshold,"b-readonly":e.readOnly,"b-rtl":s},dataset:{id:e.id},elementData:{timeRange:e},style:a.isVertical?`transform: translateY(${u}); ${c?`height:${d}px`:""};`:`transform: translateX(${u}); ${c?`width:${d}px`:""};`}}renderRange(e,r,t){const i=this,{client:n}=i,{timeAxis:a}=n;if(i.shouldRenderRange(e,r,t)&&a.startDate){const s=i.getRangeDomConfig(e,a.startDate,a.endDate),o=e.iconCls&&G.xss`<i class="${e.iconCls}"></i>`,l=e.name&&G.encodeHtml(e.name),d=l||o?`${o||""}<label>${l||"&nbsp;"}</label>`:"",c={...s,style:s.style+(e.style||""),html:i.bodyRenderer?i.bodyRenderer({timeRange:e}):i.showHeaderElements&&!i.showLabelInBody?"":d};let u;return i.showHeaderElements&&(u={...s,html:i.headerRenderer?i.headerRenderer({timeRange:e}):i.showLabelInBody?"":d}),{bodyConfig:c,headerConfig:u}}}cacheRotation(e,r){if(!e.iconCls&&!e.name||!e.duration)return;const t=r.firstElementChild;t&&!e.recurringTimeSpan&&(this._labelRotationMap[e.id]=this.client.isVertical?t.offsetHeight<r.offsetHeight:t.offsetWidth>r.offsetWidth)}applyRotation(e,r){var t,i,n;const a=this._labelRotationMap[(i=(t=e.recurringTimeSpan)==null?void 0:t.id)!=null?i:e.id];(n=r.firstElementChild)==null||n.classList.toggle("b-vertical",!!a)}getBodyElementByRecord(e){const r=typeof e=="string"?e:e==null?void 0:e.id;return r!=null&&Q.getChild(this.bodyCanvas,r)}resolveTimeRangeRecord(e){}get headerContainerElement(){const e=this,{isVertical:r,timeView:t,timeAxisColumn:i}=e.client;return e._headerContainerElement||(r&&t.element?e._headerContainerElement=t.element.parentElement:r||(e._headerContainerElement=i.element)),e._headerContainerElement}get showHeaderElements(){return!this.client.hideHeaders&&this._showHeaderElements}updateShowHeaderElements(e){const{client:r}=this;this.isConfiguring||(r.element.classList.toggle("b-sch-timeranges-with-headerelements",!!e),this.renderRanges())}populateTimeAxisHeaderMenu({column:e,items:r}){}onInternalPaint({firstPaint:e}){e&&this.client.isHorizontal&&this.onUIReady()}onSchedulerHorizontalScroll(){this.client.isHorizontal&&this.renderRanges()}afterScroll(){this.client.isVertical&&this.renderRanges()}updateLineBuffer(){const{timeAxisViewModel:e}=this.client;this._lineBufferDurationMS=e.getDateFromPosition(300)-e.getDateFromPosition(0)}onInternalResize(e,r,t,i,n){this.client.isVertical&&n!==t&&this.renderRanges()}onTimeAxisViewModelUpdate(){this.updateLineBuffer(),this.refresh()}onTimeRangeClick(e){const r=this.resolveTimeRangeRecord(e.target);this.client.trigger(`timeRangeHeader${G.capitalize(e.type)}`,{event:e,domEvent:e,timeRangeRecord:r})}showTip(e){const r=this;r.showTooltip&&(r.clockTemplate=new J({scheduler:r.client}),r.tip=new I(Y.assign({id:`${r.client.id}-time-range-tip`,cls:"b-interaction-tooltip",align:"b-t",autoShow:!0,updateContentOnMouseMove:!0,forElement:e.element,getHtml:()=>r.getTipHtml(e.record,e.element)},r.showTooltip)))}destroyTip(){this.tip&&(this.tip.destroy(),this.tip=null)}isElementDraggable(e){return e=e.closest(this.baseSelector+":not(.b-resizing):not(.b-readonly)"),e&&!e.classList.contains("b-over-resize-handle")}onDragStart({context:e}){const{client:r,drag:t}=this;r.isVertical?(t.minY=0,t.maxY=r.timeAxisViewModel.totalSize-e.element.offsetHeight,t.minX=0,t.maxX=Number.MAX_SAFE_INTEGER):(t.minX=0,t.maxX=r.timeAxisViewModel.totalSize-e.element.offsetWidth,t.minY=0,t.maxY=Number.MAX_SAFE_INTEGER),r.element.classList.add("b-dragging-timerange")}onDrop({context:e}){this.client.element.classList.remove("b-dragging-timerange")}onInvalidDrop(){this.drag.reset(),this.client.element.classList.remove("b-dragging-timerange"),this.destroyTip()}updateDateIndicator({startDate:e,endDate:r}){const t=this,{tip:i}=t,n=i.element.querySelector(".b-sch-tooltip-enddate");t.clockTemplate.updateDateIndicator(i.element,e),n&&t.clockTemplate.updateDateIndicator(n,r)}onDrag({context:e}){const r=this,{client:t}=r,i=O.from(e.element),n=i.getStart(t.rtl,t.isHorizontal),a=i.getEnd(t.rtl,t.isHorizontal),s=t.getDateFromCoordinate(n,"round",!1),o=t.getDateFromCoordinate(a,"round",!1);r.updateDateIndicator({startDate:s,endDate:o})}onDragReset(){}onResizeStart(){var e;this.client.element.classList.add("b-resizing-timerange"),(e=this.hoverTooltip)==null||e.hide()}onResizeDrag(){}onResize(){}onInvalidResize(){}onResizeReset(){this.client.element.classList.remove("b-resizing-timerange")}getTipHtml(e,r){const t=this,{client:i}=t,n=O.from(r),a=n.getStart(i.rtl,i.isHorizontal),s=n.getEnd(i.rtl,i.isHorizontal),o=i.getDateFromCoordinate(a,"round",!1),l=e.endDate&&i.getDateFromCoordinate(s,"round",!1),d=i.getFormattedDate(o),c=l&&i.getFormattedEndDate(l,o);return t.dragTipTemplate({name:e.name||"",startDate:o,endDate:l,startText:d,endText:c,startClockHtml:t.clockTemplate.template({date:o,text:d,cls:"b-sch-tooltip-startdate"}),endClockHtml:c&&t.clockTemplate.template({date:l,text:c,cls:"b-sch-tooltip-enddate"})})}};x(te,"configurable",{showHeaderElements:!0}),x(te,"pluginConfig",{chain:["onInternalPaint","populateTimeAxisHeaderMenu","onSchedulerHorizontalScroll","afterScroll","onInternalResize"]}),te._$name="AbstractTimeRanges";var Be=Object.freeze({}),ue=class extends j.mixin(ne,de){static get $name(){return"ColumnLines"}static get delayable(){return{refresh:{type:"raf",cancelOutstanding:!0}}}static get pluginConfig(){return{after:["render","updateCanvasSize","internalOnVisibleDateRangeChange","onVisibleResourceRangeChange"]}}attachToResourceStore(e){const{client:r}=this;super.attachToResourceStore(e),r.isVertical&&r.resourceStore.ion({name:"resourceStore",group({groupers:t}){t.length===0&&this.refresh()},thisObj:this})}doDisable(e){super.doDisable(e),this.isConfiguring||this.refresh()}render(){this.refresh()}getColumnLinesDOMConfig(e,r){var t;const i=this,{client:n}=i,{rtl:a}=n,s=a?-1:1,{timeAxisViewModel:o,isHorizontal:l,resourceStore:d,variableColumnWidths:c}=n,{columnConfig:u}=o,m=o.columnLinesFor,f=Math.max(m-1,0),h=e.getTime(),g=r.getTime(),p=[],D=new Set,v=l?"X":"Y";if(!i.disabled){const S=(b,y)=>{const T=b.start.getTime();T>h&&T<g&&!D.has(T)&&(D.add(T),p.push({role:"presentation",className:y?"b-column-line-major":"b-column-line",style:{transform:`translate${v}(${b.coord*s}px)`},dataset:{line:y?`major-${b.index}`:`line-${b.index}`}}))};if(m!==f)for(let b=1;b<=u[f].length-1;b++)S(u[f][b],!0);for(let b=1;b<=u[m].length-1;b++)S(u[m][b],!1);if(!l&&n.columnLines){const{columnWidth:b}=n.resourceColumns;let{first:y,last:T}=n.currentOrientation.getResourceRange(!0),C=0;if(y>-1)for(let w=y;w<T+1;w++){const M=d.getAt(w);if(M.isGroupHeader){T++,C++;continue}const k=M.instanceMeta(d),z=c?k.insetStart+M.columnWidth-1:(w-C+1)*b-1,E=(t=M.groupParent)==null?void 0:t.get(n.resourceStore.id);p.push({className:{"b-column-line":1,"b-resource-column-line":1,"b-resource-group-divider":d.isGrouped&&(E==null?void 0:E.groupChildren[(E==null?void 0:E.groupChildren.length)-1])===M},style:{transform:`translateX(${z*s}px)`},dataset:{line:`resource-${w}`}})}}}return p}refresh(){const e=this,{client:r}=e,{timeAxis:t}=r,{startDate:i,endDate:n}=r.visibleDateRange||Be;if(!t.startDate||!i||e.client.timeAxisSubGrid.collapsed)return;e.element||(e.element=_.createElement({parent:r.timeAxisSubGridElement,className:"b-column-lines-canvas b-sch-canvas"}));const s=e.getColumnLinesDOMConfig(i,n);Q.sync({targetElement:e.element,domConfig:{onlyChildren:!0,children:s,syncOptions:{releaseThreshold:4}},syncIdField:"line"})}internalOnVisibleDateRangeChange(){this.refresh()}onVisibleResourceRangeChange({firstResource:e,lastResource:r}){this.refresh()}updateCanvasSize(){this.refresh()}};ue._$name="ColumnLines",F.registerFeature(ue,!0,["Scheduler","Gantt","TimelineHistogram"]);var Ce=e=>{var r;return r=class extends(e||ae){static get $name(){return"DependencyCreation"}static get defaultConfig(){return{showCreationTooltip:!0,creationTooltip:null,terminalCls:"b-sch-terminal",terminalSides:["start","top","end","bottom"],allowCreate:!0}}construct(t,i){super.construct(t,i);const n=this;n.eventName=t.scheduledEventName,t.ion({readOnly:()=>n.updateCreateListeners()}),n.updateCreateListeners(),n.chain(t,"onElementTouchMove","onElementTouchMove")}doDestroy(){var t,i;const n=this;n.detachListeners("view"),n.creationData=null,(t=n.pointerUpMoveDetacher)==null||t.call(n),(i=n.creationTooltip)==null||i.destroy(),super.doDestroy()}updateCreateListeners(){const t=this;t.client&&(t.detachListeners("view"),t.isCreateAllowed&&t.client.ion({name:"view",[`${t.eventName}MouseEnter`]:"onTimeSpanMouseEnter",[`${t.eventName}MouseLeave`]:"onTimeSpanMouseLeave",thisObj:t}))}set allowCreate(t){this._allowCreate=t,this.updateCreateListeners()}get allowCreate(){return this._allowCreate}get isCreateAllowed(){return this.allowCreate&&!this.client.readOnly&&!this.disabled}updateTerminalOffset(t){this.client.whenVisible(()=>{this.client.foregroundCanvas.style.setProperty("--scheduler-dependency-terminal-offset",`${-t}px`)})}updateTerminalSize(t){typeof t=="number"&&(t=`${t}px`),this.client.whenVisible(()=>{this.client.foregroundCanvas.style.setProperty("--scheduler-dependency-terminal-size",t?`${t}`:null)})}onTimeSpanMouseEnter({event:t,source:i,[`${this.eventName}Record`]:n,[`${this.eventName}Element`]:a,resourceRecord:s}){if(!n.isCreating&&!n.readOnly){const o=this,{creationData:l,client:d}=o,c=_.down(a,i.eventInnerSelector);if(n!==(l==null?void 0:l.source)){const{parent:u}=n;if(n.isEventModel&&u&&!u.isRoot&&d.eventStore.includes(u)){const m=d.getElementFromEventRecord(u,s,!0);m&&o.delayHideTerminals(m)}o.delayShowTerminals(n,a),l&&t.target.closest(d.eventSelector)&&(l.timeSpanElement=c,o.onOverTargetEventBar(t))}}}onTimeSpanMouseLeave(t){var i,n,a,s;const o=this,{creationData:l,client:d}=o,{eventRecord:c,event:u}=t,m=(i=u.relatedTarget)==null?void 0:i.closest(d.eventSelector),f=(s=(n=m==null?void 0:m.elementData)==null?void 0:n.eventRecord)!=null?s:(a=m==null?void 0:m.elementData)==null?void 0:a.taskRecord,{parent:h}=c!=null?c:{},g=t[`${o.eventName}Element`];if(u){if((u.isTrusted||q.isTestEnv||l)&&o.delayHideTerminals(g),h&&!h.isRoot&&d.eventStore.includes(h)){const p=d.getElementFromEventRecord(h);p&&o.delayShowTerminals(h,p)}l&&o.onOverNewTargetWhileCreating(u.relatedTarget,!(f!=null&&f.readOnly)&&!(f!=null&&f.isOccurence)?f:null,u)}}onTerminalMouseOver(t){this.clearTimeout(`hide-${t.target.closest(this.client.eventSelector).dataset.syncId}`),this.creationData&&this.onOverTargetEventBar(t)}onTerminalMouseOut(t){var i,n,a,s;const o=this,{creationData:l,client:d}=o,c=t.target.closest(d.eventSelector),u=(i=t.relatedTarget)==null?void 0:i.closest(d.eventSelector),m=(s=(n=u==null?void 0:u.elementData)==null?void 0:n.eventRecord)!=null?s:(a=u==null?void 0:u.elementData)==null?void 0:a.taskRecord;u!==c&&c&&!o.hasTimeout(`show-${c.dataset.syncId}`)&&(!l||c!==l.timeSpanElement)&&(o.delayHideTerminals(c),d.unhover(c,t)),l&&o.onOverNewTargetWhileCreating(t.relatedTarget,!(m!=null&&m.readOnly)&&!(m!=null&&m.isOccurence)?m:null,t)}onTerminalPointerDown(t){var i;const n=this;if(t.button===0&&!n.creationData){const{client:a}=n,s=a.timeAxisSubGridElement,o=t.target,l=o.closest(a.eventInnerSelector),d=O.from(a.element,document.body);t.stopPropagation(),n.creationData={sourceElement:l,source:a.resolveTimeSpanRecord(l).$original,fromSide:o.dataset.side,startPoint:O.from(o,s).center,startX:t.pageX-d.x+a.scrollLeft,startY:t.pageY-d.y+a.scrollTop,valid:!1,sourceResource:(i=a.resolveResourceRecord)==null?void 0:i.call(a,t),tooltip:n.creationTooltip},n.pointerUpMoveDetacher=P.on({pointerup:{element:a.element.getRootNode(),handler:"onMouseUp",passive:!1},pointermove:{element:s,handler:"onMouseMove",passive:!1},thisObj:n}),n.documentPointerUpDetacher=P.on({pointerup:{element:document,handler:"onDocumentMouseUp"},keydown:{element:document,handler:({key:c})=>{c==="Escape"&&n.abort()}},thisObj:n})}}onElementTouchMove(t){var i;(i=super.onElementTouchMove)==null||i.call(this,t),this.connector&&t.preventDefault()}onMouseMove(t){const i=this,{client:n,creationData:a}=i,s=O.from(n.element,document.body),o=t.pageX-s.x+n.scrollLeft-a.startX,l=t.pageY-s.y+n.scrollTop-a.startY,d=Math.round(Math.sqrt(o*o+l*l))-3,c=Math.atan2(l,o);let{connector:u}=i;if(!u){if(i.onRequestDragCreate(t)===!1)return;u=i.connector}u.style.width=`${d}px`,u.style.transform=`rotate(${c}rad)`,i.lastMouseMoveEvent=t}onRequestDragCreate(t){const i=this,{client:n,creationData:a}=i;if(n.trigger("beforeDependencyCreateDrag",{data:a,source:a.source})===!1)return i.abort(),!1;if(n.element.classList.add("b-creating-dependency"),i.createConnector(a.startPoint.x,a.startPoint.y),n.trigger("dependencyCreateDragStart",{data:a,source:a.source}),i.showCreationTooltip){const s=i.creationTooltip||(i.creationTooltip=i.createDragTooltip());i.creationData.tooltip=s,s.disabled=!1,s.show(),s.onMouseMove(t)}n.scrollManager.startMonitoring({scrollables:[{element:n.timeAxisSubGrid.scrollable.element,direction:"horizontal"},{element:n.scrollable.element,direction:"vertical"}],callback:()=>i.lastMouseMoveEvent&&i.onMouseMove(i.lastMouseMoveEvent)})}onOverTargetEventBar(t){const i=this,{client:n,creationData:a,allowDropOnEventBar:s}=i,{target:o}=t;let l=n.resolveTimeSpanRecord(o).$original;l!=null&&l.isEventSegment&&(l=l.event),!(N.isPromise(a.valid)||!s&&!o.classList.contains(i.terminalCls))&&l!==a.source&&i.onOverNewTargetWhileCreating(o,l,t)}async onOverNewTargetWhileCreating(t,i,n){var a,s;const o=this,{client:l,creationData:d,allowDropOnEventBar:c,connector:u}=o;if(!N.isPromise(d.valid)&&!d.finalizing&&u){if(u.classList.remove("b-valid","b-invalid"),d.timeSpanElement&&_.removeClsGlobally(d.timeSpanElement,"b-sch-terminal-active"),!i||i===d.source||!c&&!t.classList.contains(o.terminalCls))d.target=d.toSide=null,d.valid=!1,u.classList.add("b-invalid");else{const m=d.target=i,{source:f}=d;let h=t.dataset.side;c&&!t.classList.contains(o.terminalCls)&&(h=o.getTargetSideFromType(o.dependencyStore.modelClass.fieldMap.type.defaultValue||U.Type.EndToStart)),l.resolveResourceRecord&&(d.targetResource=l.resolveResourceRecord(n));let g;d.toSide=h;const p=d.fromSide,D=b=>{o.isDestroyed||(d.valid=b,t.classList.add(b?"b-valid":"b-invalid"),u.classList.add(b?"b-valid":"b-invalid"),l.trigger("dependencyValidationComplete",{data:d,source:f,target:m,dependencyType:g}))};switch(!0){case(p==="start"&&h==="start"):g=U.Type.StartToStart;break;case(p==="start"&&h==="end"):g=U.Type.StartToEnd;break;case(p==="end"&&h==="start"):g=U.Type.EndToStart;break;case(p==="end"&&h==="end"):g=U.Type.EndToEnd;break}l.trigger("dependencyValidationStart",{data:d,source:f,target:m,dependencyType:g});let v=d.valid=o.dependencyStore.isValidDependency(f,m,g);N.isPromise(v)&&(v=await v),D(v);const S=v?"b-valid":"b-invalid";u.classList.add(S),(s=(a=d.timeSpanElement)==null?void 0:a.querySelector(`.${o.terminalCls}[data-side=${h}]`))==null||s.classList.add("b-sch-terminal-active",S)}o.updateCreationTooltip()}}async onMouseUp(){var t;const i=this,n=i.creationData;if(n.finalizing=!0,(t=i.pointerUpMoveDetacher)==null||t.call(i),n.valid)if(await i.client.trigger("beforeDependencyCreateFinalize",n)===!1?n.valid=!1:N.isPromise(n.valid)&&(n.valid=await n.valid),n.valid){let s=i.createDependency(n);s!==null&&(N.isPromise(s)&&(s=await s),n.dependency=s,i.client.trigger("dependencyCreateDrop",{data:n,source:n.source,target:n.target,dependency:s}),i.doAfterDependencyDrop(n))}else i.doAfterDependencyDrop(n);else n.valid=!1,i.doAfterDependencyDrop(n);i.abort()}doAfterDependencyDrop(t){this.client.trigger("afterDependencyCreateDrop",{data:t,...t})}onDocumentMouseUp({target:t}){this.client.timeAxisSubGridElement.contains(t)||this.abort()}abort(){var t,i;const n=this,{client:a,creationData:s}=n;if(s){const{source:o,sourceResource:l,target:d,targetResource:c}=s;if(o){const u=a.getElementFromEventRecord(o,l);u&&n.hideTerminals(u)}if(d){const u=a.getElementFromEventRecord(d,c);u&&n.hideTerminals(u)}}n.creationTooltip&&(n.creationTooltip.disabled=!0),n.creationData=n.lastMouseMoveEvent=null,(t=n.pointerUpMoveDetacher)==null||t.call(n),(i=n.documentPointerUpDetacher)==null||i.call(n),n.removeConnector()}createConnector(t,i){const n=this,{client:a}=n;n.clearTimeout(n.removeConnectorTimeout),n.connector=_.createElement({parent:a.timeAxisSubGridElement,className:`${n.baseCls}-connector`,style:`left:${t}px;top:${i}px`}),a.element.classList.add("b-creating-dependency")}createDragTooltip(){const t=this,{client:i}=t;return t.creationTooltip=I.new({id:`${i.id}-dependency-drag-tip`,cls:"b-sch-dependency-creation-tooltip",loadingMsg:"",anchorToTarget:!1,forElement:i.timeAxisSubGridElement,trackMouse:!0,constrainTo:null,header:{dock:"right"},internalListeners:{beforeShow:"updateCreationTooltip",thisObj:t}},t.creationTooltip)}removeConnector(){const t=this,{connector:i,client:n}=t;i&&(i.classList.add("b-removing"),i.style.width="0",t.removeConnectorTimeout=t.setTimeout(()=>{i.remove(),t.connector=null},200)),n.element.classList.remove("b-creating-dependency"),t.creationTooltip&&t.creationTooltip.hide(),n.scrollManager.stopMonitoring()}delayShowTerminals(t,i){const n=this,{syncId:a}=i.dataset;n.clearTimeout(`hide-${a}`),n.clearTimeout(`show-${a}`),i.classList.remove("b-hiding-terminals"),n.terminalShowDelay?n.setTimeout({fn:()=>n.showTerminals(t,i),name:`show-${a}`,args:[t,i],delay:n.terminalShowDelay}):n.showTerminals(t,i)}delayHideTerminals(t){const i=this,{syncId:n}=t.dataset;i.clearTimeout(`hide-${n}`),i.clearTimeout(`show-${n}`),t.classList.add("b-hiding-terminals"),i.terminalHideDelay?i.setTimeout({fn:()=>i.hideTerminals(t),name:`hide-${n}`,args:[t],delay:i.terminalHideDelay}):i.hideTerminals(t)}showTerminals(t,i=this.client.getElementFromEventRecord(t)){const n=this;if(!n.isCreateAllowed||!t.project||!i)return;const{client:a}=n,s=n.terminalCls,o=`${s}s-visible`;if(n.showingTerminalsFor&&n.hideTerminals(n.showingTerminalsFor),i=_.down(i,n.client.eventInnerSelector),!i.classList.contains(o)&&!a.element.classList.contains("b-resizing-event")&&!a.readOnly){if(a.trigger("beforeShowTerminals",{source:t})===!1)return;_.createElement({parent:i.closest(a.eventSelector),className:"b-sch-terminal-hover-area"}),n.terminalSides.forEach(l=>{l=n.fixSide(l);const d=_.createElement({parent:i,className:`${s} ${s}-${l}`,dataset:{side:l,feature:!0}});d.detacher=P.on({element:d,mouseover:"onTerminalMouseOver",mouseout:"onTerminalMouseOut",pointerdown:{handler:"onTerminalPointerDown",capture:!0},thisObj:n})}),i.classList.add(o),t.internalCls.add(o)}}fixSide(t){return t==="left"?"start":t==="right"?"end":t}hideTerminals(t){var i;const n=this,{client:a}=n,s=a.getTimeSpanMouseEventParams(t),o=s==null?void 0:s[`${n.eventName}Record`],l=`${n.terminalCls}s-visible`;(i=t.querySelector(".b-sch-terminal-hover-area"))==null||i.remove(),_.forEachSelector(t,`> ${a.eventInnerSelector} > .${n.terminalCls}`,d=>{var c;(c=d.detacher)==null||c.call(d),d.remove()}),_.down(t,a.eventInnerSelector).classList.remove(l),o==null||o.internalCls.remove(l),t.classList.remove("b-hiding-terminals")}createDependency(t){const{source:i,target:n,fromSide:a,toSide:s}=t,o=(a==="start"?0:2)+(s==="end"?1:0),l=this.dependencyStore.add({from:i.id,to:n.id,type:o,fromSide:a,toSide:s});return l!==null?l[0]:null}getTargetSideFromType(t){return t===U.Type.StartToStart||t===U.Type.EndToStart?"start":"end"}updateCreationTooltip(){const t=this;if(!t.showCreationTooltip)return;const i=t.creationData,{valid:n}=i,a=t.creationTooltip,{classList:s}=a.element;if(N.isPromise(n))return s.remove("b-invalid"),s.add("b-checking"),new Promise(o=>n.then(l=>{i.valid=l,a.isDestroyed||o(t.updateCreationTooltip())}));a.html=t.creationTooltipTemplate(i)}creationTooltipTemplate(t){var i,n;const a=this,{tooltip:s,valid:o}=t,{classList:l}=s.element;Object.assign(t,{fromText:G.encodeHtml(t.source.name),toText:G.encodeHtml((n=(i=t.target)==null?void 0:i.name)!=null?n:""),fromSide:t.fromSide,toSide:t.toSide||""});let d,c;return l.toggle("b-invalid",!o),l.remove("b-checking"),o===!0?(d="valid",c=a.L("L{Dependencies.valid}")):(d="invalid",c=a.L("L{Dependencies.invalid}")),s.title=`<i class="b-icon b-icon-${d}"></i>${c}`,{children:[{className:"b-sch-dependency-tooltip",children:[{dataset:{ref:"fromLabel"},tag:"label",text:a.L("L{Dependencies.from}")},{dataset:{ref:"fromText"},text:t.fromText},{dataset:{ref:"fromBox"},className:`b-sch-box b-${t.fromSide}`},{dataset:{ref:"toLabel"},tag:"label",text:a.L("L{Dependencies.to}")},{dataset:{ref:"toText"},text:t.toText},{dataset:{ref:"toBox"},className:`b-sch-box b-${t.toSide}`}]}]}}doDisable(t){this.isConfiguring||this.updateCreateListeners(),super.doDisable(t)}},x(r,"configurable",{allowDropOnEventBar:!0,terminalSize:null,terminalOffset:null,terminalShowDelay:0,terminalHideDelay:0}),r},je=Math.min(1/globalThis.devicePixelRatio,.75),Ne=["start","end","top","bottom"],W=(e,r)=>Math.abs(e-r)<.1,We={l:"left",r:"right",t:"top",b:"bottom"},ge=class le extends ae{static get configurable(){return{startSide:"right",startArrowMargin:12,startShift:0,endSide:"left",endArrowMargin:12,endShift:0,verticalMargin:2,horizontalMargin:5,otherBoxes:null,client:{}}}findPath(r,t){const i=this,n=r;let a,s,o,l,d,c,u,m,f,h,g,p,D,v,S,b,y,T,C,w,M,k,z,E,A,H,X,L,$;for(t=_e.asArray(t),$=0;r&&!L;)for(a=Object.assign(i.config,r),s=a.startBox,o=a.endBox,l=a.startShift,d=a.endShift,c=a.startSide,u=a.endSide,m=a.startArrowMargin,f=a.endArrowMargin,h=a.horizontalMargin,g=a.verticalMargin,p=a.hasOwnProperty("startHorizontalMargin")?a.startHorizontalMargin:h,D=a.hasOwnProperty("startVerticalMargin")?a.startVerticalMargin:g,v=a.hasOwnProperty("endHorizontalMargin")?a.endHorizontalMargin:h,S=a.hasOwnProperty("endVerticalMargin")?a.endVerticalMargin:g,b=a.hasOwnProperty("otherHorizontalMargin")?a.otherHorizontalMargin:h,y=a.hasOwnProperty("otherVerticalMargin")?a.otherVerticalMargin:g,T=a.otherBoxes,c=i.normalizeSide(c),u=i.normalizeSide(u),C=i.getConnectionCoordinatesFromBoxSideShift(s,c,l),w=i.getConnectionCoordinatesFromBoxSideShift(o,u,d),A=i.calcGridBaseBoxFromBoxAndDrawParams(s,c,m,p,D),H=i.calcGridBaseBoxFromBoxAndDrawParams(o,u,f,v,S),Ne.forEach(V=>{Math.abs(A[V]-H[V])<=je&&(H[V]=A[V])}),i.shouldLookForPath(s,o,A,H)&&(T=T==null?void 0:T.map(V=>i.calcGridBaseBoxFromBoxAndDrawParams(V,!1,0,b,y)),M=i.getConnectionCoordinatesFromBoxSideShift(A,c,l),k=i.getConnectionCoordinatesFromBoxSideShift(H,u,d),X=i.buildPathGrid(A,H,M,k,c,u,T),z=i.convertDecartPointToGridPoint(X,M),E=i.convertDecartPointToGridPoint(X,k),L=i.findPathOnGrid(X,z,E,c,u)),r=!1;!L&&!r&&t&&$<t.length;$++)r=t[$](a,n);return L&&(L=i.prependPathWithArrowStaffSegment(L,C,c),L=i.appendPathWithArrowStaffSegment(L,w,u),L=i.optimizePath(L)),L}static calculateRelativePosition(r,t,i=!1){const n=i?"top":"start",a=i?"bottom":"end";let s;return r[a]<t[n]?s=0:r[a]<=t[a]&&r[a]>=t[n]&&r[n]<t[n]?s=1:r[n]>=t[n]&&r[a]<=t[a]?s=2:r[n]<t[n]&&r[a]>t[a]?s=-2:r[n]<=t[a]&&r[a]>t[a]?s=3:s=4,s}static boxOverlapChanged(r,t,i,n,a=!1){const s=le.calculateRelativePosition,o=s(r,t,a),l=s(i,n,a);return o!==l}shouldLookForPath(r,t,i,n){let a=!0;return(r.end-r.start<=this.startArrowMargin||t.end-t.start<=this.endArrowMargin)&&Math.abs(le.calculateRelativePosition(r,t,!0))===2&&(a=!le.boxOverlapChanged(r,t,i,n)),a}getConnectionCoordinatesFromBoxSideShift(r,t,i){let n;switch(t){case"left":n={x:r.start,y:(r.top+r.bottom)/2+i};break;case"right":n={x:r.end,y:(r.top+r.bottom)/2+i};break;case"top":n={x:(r.start+r.end)/2+i,y:r.top};break;case"bottom":n={x:(r.start+r.end)/2+i,y:r.bottom};break}return n}calcGridBaseBoxFromBoxAndDrawParams(r,t,i,n,a){let s;switch(this.normalizeSide(t)){case"left":s={start:r.start-Math.max(i,n),end:r.end+n,top:r.top-a,bottom:r.bottom+a};break;case"right":s={start:r.start-n,end:r.end+Math.max(i,n),top:r.top-a,bottom:r.bottom+a};break;case"top":s={start:r.start-n,end:r.end+n,top:r.top-Math.max(i,a),bottom:r.bottom+a};break;case"bottom":s={start:r.start-n,end:r.end+n,top:r.top-a,bottom:r.bottom+Math.max(i,a)};break;default:s={start:r.start-n,end:r.end+n,top:r.top-a,bottom:r.bottom+a}}return s}normalizeSide(r){const{rtl:t}=this.client;return r==="start"?t?"right":"left":r==="end"?t?"left":"right":r}buildPathGrid(r,t,i,n,a,s,o){let l,d,c,u,m,f,h,g,p,D,v,S,b;const y={},T=[];for(l=[r.start,a==="left"||a==="right"?(r.start+r.end)/2:i.x,r.end,t.start,s==="left"||s==="right"?(t.start+t.end)/2:n.x,t.end],d=[r.top,a==="top"||a==="bottom"?(r.top+r.bottom)/2:i.y,r.bottom,t.top,s==="top"||s==="bottom"?(t.top+t.bottom)/2:n.y,t.bottom],o&&o.forEach(C=>{l.push(C.start,(C.start+C.end)/2,C.end),d.push(C.top,(C.top+C.bottom)/2,C.bottom)}),l=[...new Set(l.sort((C,w)=>C-w))],d=[...new Set(d.sort((C,w)=>C-w))],f=0,g=d.length;f<g;++f)for(y[f]=y[f]||{},c=d[f],m=0,h=l.length;m<h;++m){if(u=l[m],S=(u<=r.start||u>=r.end||c<=r.top||c>=r.bottom)&&(u<=t.start||u>=t.end||c<=t.top||c>=t.bottom),o)for(p=0,D=o.length;S&&p<D;++p)v=o[p],S=u<=v.start||u>=v.end||c<=v.top||c>=v.bottom||u===i.x&&c===i.y||u===n.x&&c===n.y;b={distance:Number.MAX_SAFE_INTEGER,permitted:S,x:u,y:c,ix:m,iy:f},y[f][m]=b,T.push(b)}return{width:l.length,height:d.length,xs:l,ys:d,points:y,linearPoints:T}}convertDecartPointToGridPoint(r,t){const i=r.xs.indexOf(t.x),n=r.ys.indexOf(t.y);return r.points[n][i]}findPathOnGrid(r,t,i,n,a){const s=this;let o=!1;return t.permitted&&i.permitted&&(r=s.waveForward(r,t,0),o=s.collectPath(r,i,a)),o}getGridPointNeighbors(r,t,i){const n=t.ix,a=t.iy,s=[];let o;return a<r.height-1&&(o=r.points[a+1][n],(!i||i(o))&&s.push(o)),a>0&&(o=r.points[a-1][n],(!i||i(o))&&s.push(o)),n<r.width-1&&(o=r.points[a][n+1],(!i||i(o))&&s.push(o)),n>0&&(o=r.points[a][n-1],(!i||i(o))&&s.push(o)),s}waveForward(r,t,i){const n=this;return Pe.preWalkUnordered([t,i],([a,s])=>n.getGridPointNeighbors(r,a,o=>o.permitted&&o.distance>s+1).map(o=>[o,s+1]),([a,s])=>a.distance=s),r}collectPath(r,t,i){const n=this,a=[];let s=!0,o,l,d,c;for(;s&&t.distance;)if(o=n.getGridPointNeighbors(r,t,u=>u.permitted&&u.distance===t.distance-1),s=o.length>0,s){switch(o=o.sort((u,m)=>{let f,h;f=u.ix-t.ix,h=u.iy-t.iy;const g=(i==="left"||i==="right")&&h===0||(i==="top"||i==="bottom")&&f===0?-1:1;f=m.ix-t.ix,h=m.iy-t.iy;const p=(i==="left"||i==="right")&&h===0||(i==="top"||i==="bottom")&&f===0?-1:1;if(g>p)return 1;if(g<p)return-1;if(g===p)return u.y>m.y?-1:1}),l=o[0],a.push({x1:l.x,y1:l.y,x2:t.x,y2:t.y}),d=l.ix-t.ix,c=l.iy-t.iy,!0){case(!c&&d>0):i="left";break;case(!c&&d<0):i="right";break;case(!d&&c>0):i="top";break;case(!d&&c<0):i="bottom";break}t=l}return s&&a.reverse()||!1}prependPathWithArrowStaffSegment(r,t,i){if(r.length>0){const n=r[0],a={x2:n.x1,y2:n.y1};switch(i){case"left":a.x1=t.x,a.y1=n.y1;break;case"right":a.x1=t.x,a.y1=n.y1;break;case"top":a.x1=n.x1,a.y1=t.y;break;case"bottom":a.x1=n.x1,a.y1=t.y;break}r.unshift(a)}return r}appendPathWithArrowStaffSegment(r,t,i){if(r.length>0){const n=r[r.length-1],a={x1:n.x2,y1:n.y2};switch(i){case"left":a.x2=t.x,a.y2=n.y2;break;case"right":a.x2=t.x,a.y2=n.y2;break;case"top":a.x2=n.x2,a.y2=t.y;break;case"bottom":a.x2=n.x2,a.y2=t.y;break}r.push(a)}return r}optimizePath(r){const t=[];let i,n;if(r.length>0)for(i=r.shift(),t.push(i);r.length>0;)n=r.shift(),W(i.x1,n.x1)&&W(i.y1,n.y1)&&W(i.x2,n.x2)&&W(i.y2,n.y2)?i=n:W(i.y1,i.y2)&&W(n.y1,n.y2)?i.x2=n.x2:W(i.x1,i.x2)&&W(n.x1,n.x2)?i.y2=n.y2:(t.push(n),i=n);return t}};ge._$name="RectangularPathFinder";var Ue=["start","start","end","end"],Ge=["start","end","start","end"],Ee=e=>{var r;return r=class extends e{changeTooltip(t,i){const n=this;return i==null||i.destroy(),!n.showTooltip||!t?null:I.new({align:"b-t",id:`${n.client.id}-dependency-tip`,forSelector:`.b-timelinebase:not(.b-eventeditor-editing,.b-taskeditor-editing,.b-resizing-event,.b-dragcreating,.b-dragging-event,.b-creating-dependency) .${n.baseCls}`,forElement:n.client.timeAxisSubGridElement,showOnHover:!0,hoverDelay:0,hideDelay:0,anchorToTarget:!1,textContent:!1,trackMouse:!1,getHtml:n.getHoverTipHtml.bind(n)},t)}getHoverTipHtml({activeTarget:t}){return this.tooltipTemplate(this.resolveDependencyRecord(t))}},x(r,"$name","DependencyTooltip"),x(r,"configurable",{showTooltip:!0,showLagInTooltip:!1,tooltipTemplate(t){const i=this;return{children:[{className:"b-sch-dependency-tooltip",children:[{tag:"label",text:i.L("L{Dependencies.from}")},{text:t.fromEvent.name},{className:`b-sch-box b-${t.fromSide||Ue[t.type]}`},{tag:"label",text:i.L("L{Dependencies.to}")},{text:t.toEvent.name},{className:`b-sch-box b-${t.toSide||Ge[t.type]}`},i.showLagInTooltip&&{tag:"label",text:i.L("L{DependencyEdit.Lag}")},i.showLagInTooltip&&{text:`${t.lag||0} ${R.getLocalizedNameOfUnit(t.lagUnit,t.lag!==1)}`}]}]}},tooltip:{$config:"nullify",value:{}}}),r},oe=25,Xe=e=>{var r;return r=class extends e{constructor(){super(...arguments),x(this,"gridCache",null)}getDependenciesToConsider(t,i,n,a){const s=this,{gridCache:o}=s,{timeAxis:l}=s.client;if(o){const d=new Set,c=Math.floor((t-l.startMS)/s.MS_PER_CELL),u=Math.floor((i-l.startMS)/s.MS_PER_CELL),m=Math.floor(n/oe),f=Math.floor(a/oe);for(let h=c;h<=u;h++){const g=o[h];if(g)for(let p=m;p<=f;p++){const D=g[p];if(D)for(let v=0;v<D.length;v++)d.add(D[v])}}return d}}afterDrawDependency(t,i,n,a,s){var o,l;const d=this;if(d.constructGridCache){const{MS_PER_CELL:c}=d,{startMS:u,endMS:m}=d.client.timeAxis,f=Math.ceil((m-u)/c),h=Math.floor((a-u)/c),g=Math.floor((s-u)/c),p=Math.floor(i/oe),D=Math.floor(n/oe),v=Math.min(h,g),S=Math.max(h,g),b=Math.min(p,D),y=Math.max(p,D);if(v<0&&S<0||v>f&&S>f)return;const T=Math.max(v,0),C=Math.min(S,f);for(let w=T;w<=C;w++){const M=(o=d.gridCache[w])!=null?o:d.gridCache[w]={};for(let k=b;k<=y;k++)((l=M[k])!=null?l:M[k]=[]).push(t)}}}beforeDraw(){const t=this;if(!t.gridCache){const{visibleDateRange:i}=t.client;t.constructGridCache=!0,t.MS_PER_CELL=Math.max(i.endMS-i.startMS,1e3),t.gridCache={}}}afterDraw(){this.constructGridCache=!1}reset(){this.gridCache=null}},x(r,"$name","DependencyGridCache"),r};function Re(e){return e.x1===e.x2?e.y2>e.y1?"d":"u":e.x2>e.x1?"r":"l"}function he(e){return e.x1===e.x2?e.y2-e.y1:e.x2-e.x1}function Ye(e,r,t){const i=Re(e)+Re(r),n=t*(i.includes("l")?-1:1),a=t*(i.includes("u")?-1:1);return`a${n},${a} 0 0 ${i==="ur"||i==="lu"||i==="dl"||i==="rd"?1:0} ${n},${a}`}function qe(e,r,t,i,n){let a=e.x1===e.x2?"v":"h",s=i;if(i){const o=he(e),l=r?Math.abs(he(r)):Number.MAX_SAFE_INTEGER,d=Math.sign(o);n==null&&(n=i),(Math.abs(o)<i*2||l<i*2)&&(s=Math.min(Math.abs(o),l)/2);const c=t==="single"?0:t==="first"?s:t==="between"?n+s:n,u=o-c*d;a+=Math.sign(u)!==d?0:u,t!=="last"&&t!=="single"&&s>0&&(a+=` ${Ye(e,r,s)}`)}else a+=he(e);return{line:a,currentRadius:i!==s?s:null}}function Ze(e,r){const{length:t}=r;if(!t)return"";let i=null;return`M${r[0].x1},${r[0].y1} ${r.map((n,a)=>{const s=t===1?"single":a===t-1?"last":a===0?"first":"between",o=qe(n,r[a+1],s,e,i);return{currentRadius:i}=o,o.line}).join(" ")}`}var Ke=e=>{var r;return r=class extends e{constructor(){super(...arguments),x(this,"lineCache",{})}onSVGReady(){const t=this;t.pathFinder=new ge({...t.pathFinderConfig,client:t.client}),t.lineDefAdjusters=t.createLineDefAdjusters(),t.createMarker()}changeRadius(t){return t!==null&&Y.assertNumber(t,"radius"),t}resetAtRuntime(){this.isConfiguring||this.reset()}updateRadius(){this.resetAtRuntime()}updateRenderer(){this.resetAtRuntime()}changeClickWidth(t){return t!==null&&Y.assertNumber(t,"clickWidth"),t}updateClickWidth(){this.resetAtRuntime()}updateDrawAroundParents(){this.resetAtRuntime()}createMarker(){var t,i;const n=this,{markerDef:a}=n,s=this.client.svgCanvas,o=a?`${n.client.id}-arrowEnd`:"arrowEnd";(t=n.marker)==null||t.remove(),s.style.setProperty("--scheduler-dependency-marker",`url(#${o})`),n.marker=_.createElement({parent:s,id:o,tag:"marker",className:"b-sch-dependency-arrow",ns:"http://www.w3.org/2000/svg",markerHeight:11,markerWidth:11,refX:8.5,refY:3,viewBox:"0 0 9 6",orient:"auto-start-reverse",markerUnits:"userSpaceOnUse",retainElement:!0,children:[{tag:"path",ns:"http://www.w3.org/2000/svg",d:(i=n.markerDef)!=null?i:"M3,0 L3,6 L9,3 z"}]})}updateMarkerDef(){this.isConfiguring||this.createMarker()}getAssignmentElement(t){var i,n;return((n=(i=this.client.features.eventDrag)==null?void 0:i.getProxyElement)==null?void 0:n.call(i,t))||this.client.getElementFromAssignmentRecord(t)}getDomConfigs(t,i,n,a){var s,o;const l=this,d=l.getDependencyKey(t,i,n),c=l.lineCache[d];if(l.constructLineCache||!c||a||l.drawingLive&&(l.getAssignmentElement(i)||l.getAssignmentElement(n))){const u=l.prepareLineDef(t,i,n,a),m=u&&l.pathFinder.findPath(u,l.lineDefAdjusters),{client:f,clickWidth:h}=l,{toEvent:g}=t;if(m){const p=l.highlighted.get(t),D={tag:"path",ns:"http://www.w3.org/2000/svg",d:Ze((s=l.radius)!=null?s:0,m),role:"presentation",dataset:{syncId:d,depId:t.id,fromId:i.id,toId:n.id},elementData:{dependency:t,points:m},class:{[l.baseCls]:1,[t.cls]:t.cls,[t.highlighted]:t.highlighted,[p&&[...p].join(" ")]:p,[l.noMarkerCls]:u.hideMarker,"b-inactive":t.active===!1,"b-sch-bidirectional-line":t.bidirectional,"b-readonly":t.readOnly,"b-sch-dependency-ends-outside":!g.milestone&&(g.endDate<=f.startDate||f.endDate<=g.startDate)||g.milestone&&(g.endDate<f.startDate||f.endDate<g.startDate)}};(o=l.renderer)==null||o.call(l,{domConfig:D,points:m,dependencyRecord:t,fromAssignmentRecord:i,toAssignmentRecord:n,fromBox:u.startBox,toBox:u.endBox,fromSide:u.startSide,toSide:u.endSide});const v=[D];return h>1&&v.push({...D,class:{...D.class,"b-click-area":1},dataset:{...D.dataset,syncId:`${D.dataset.syncId}-click-area`},style:{strokeWidth:h}}),l.lineCache[d]=v}return l.lineCache[d]=null}return c}generateBoundaryBoxes(t,i){return i==="bottom"?[{start:t.left,end:t.left+t.width/2,top:t.rowTop,bottom:t.rowBottom},{start:t.left+t.width/2,end:t.right,top:t.rowTop,bottom:t.rowBottom}]:[{start:t.left-this.pathFinder.startArrowMargin,end:t.right+this.pathFinder.startArrowMargin,top:t.rowTop,bottom:t.rowBottom}]}getAssignmentBounds(t){const{client:i}=this,n=this.getAssignmentElement(t);if(n&&!i.isExporting){const a=O.from(n,this.relativeTo);if(i.isHorizontal){let s=i.getRowById(t.resource.id);if(s){if(a.y<s.top||a.bottom>s.bottom){const o=i.rowManager.getRowAt(a.center.y,!0);o&&(s=o)}a.rowTop=s.top,a.rowBottom=s.bottom}else return i.getAssignmentEventBox(t,!0)}return a}return i.isEngineReady&&i.getAssignmentEventBox(t,!0)}getConnectorStartSide(t){return this.client.currentOrientation.getConnectorStartSide(t)}getConnectorEndSide(t){return this.client.currentOrientation.getConnectorEndSide(t)}getDependencyStartSide(t){const{fromEvent:i,type:n,fromSide:a}=t;if(a)return a;switch(!0){case n===B.Type.StartToEnd:case n===B.Type.StartToStart:return this.getConnectorStartSide(i);case n===B.Type.EndToStart:case n===B.Type.EndToEnd:return this.getConnectorEndSide(i);default:return this.getConnectorEndSide(i)}}getDependencyEndSide(t){const{toEvent:i,type:n,toSide:a}=t;if(a)return a;switch(!0){case n===B.Type.EndToEnd:case n===B.Type.StartToEnd:return this.getConnectorEndSide(i);case n===B.Type.EndToStart:case n===B.Type.StartToStart:return this.getConnectorStartSide(i);default:return this.getConnectorStartSide(i)}}createLineDefAdjusters(){var t;const{client:i}=this;function n(l){const{barMargin:d}=i;return l.startArrowMargin>d||l.endArrowMargin>d?(l.startArrowMargin=l.endArrowMargin=d,l):!1}function a(l){return l.startArrowMargin>0||l.endArrowMargin>0?(l.startArrowMargin=l.endArrowMargin=0,l):!1}function s(l,d){return l.horizontalMargin>2?(l.horizontalMargin=1,d.hideMarker=!0,l):!1}const o=[n,a,s];return(t=i.features.nestedEvents)!=null&&t.enabled&&o.unshift(l=>(l.otherBoxes.length&&(l.otherBoxes.length=l.otherBoxes.nestedStart),l)),o}adjustLineDef(t,i){return i}prepareLineDef(t,i,n,a){var s,o,l,d;const c=this,u=c.getDependencyStartSide(t),m=c.getDependencyEndSide(t),f=(s=a==null?void 0:a.from)!=null?s:c.getAssignmentBounds(i),h=(o=a==null?void 0:a.to)!=null?o:c.getAssignmentBounds(n),g=[];if(!f||!h)return null;let{startArrowMargin:p,verticalMargin:D}=c.pathFinder;if(c.client.isHorizontal){if(f.rowTop!=null&&f.rowTop!==h.rowTop&&g.push(...c.generateBoundaryBoxes(f,u)),(l=c.client.features.nestedEvents)!=null&&l.enabled&&c.drawAroundParents){const{resourceStore:v}=c.client,S=i.resource,b=n.resource,y=v.indexOf(S),T=v.indexOf(b),C=Math.min(y,T),w=Math.max(y,T);g.nestedStart=g.length;for(const M of c.client.assignmentStore)if(M!==i&&M!==n&&((d=M.event)!=null&&d.isParent)&&i.event.parent!==M.event&&n.event.parent!==M.event){const k=v.indexOf(M.resource);if(k>=C&&k<=w){const z=c.getAssignmentBounds(M).inflate(p);z.isNestedParent=!0,g.push(z)}}}t.bidirectional||(/(top|bottom)/.test(u)&&(p=c.client.barMargin/2),D=c.client.barMargin/2)}return c.adjustLineDef(t,{startBox:f,endBox:h,otherBoxes:g,startArrowMargin:p,verticalMargin:D,otherVerticalMargin:0,otherHorizontalMargin:0,startSide:u,endSide:m})}beforeDraw(){super.beforeDraw(),Object.keys(this.lineCache).length||(this.constructLineCache=!0)}afterDraw(){super.afterDraw(),this.constructLineCache=!1}reset(){super.reset(),this.lineCache={}}},x(r,"$name","DependencyLineGenerator"),r},Je={click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu"},Qe=Object.freeze({}),we=e=>{var r;const t=[e];return(r=e.resource)!=null&&r.hasLinks&&t.push(...e.resource.$links.map(i=>({id:`${i.id}_${e.id}`,resource:i,event:e.event,drawDependencies:e.drawDependencies}))),t},Z=class extends j.mixin(ne,de,Ce,Xe,Ke,Ee){constructor(){super(...arguments),x(this,"domConfigs",new Map),x(this,"drawingLive",!1),x(this,"lastScrollX",null),x(this,"highlighted",new Map),x(this,"visibleResources",null),x(this,"usingLinks",null),x(this,"visibleDateRange",null),x(this,"relativeTo",null)}static get pluginConfig(){return{chain:["render","onInternalPaint","onElementClick","onElementDblClick","onElementContextMenu","onElementMouseOver","onElementMouseOut","bindStore"],assign:["getElementForDependency","getElementsForDependency","resolveDependencyRecord"]}}construct(e,r){super.construct(e,r);const{scheduledEventName:t}=e;e.ion({svgCanvasCreated:"onSVGReady",animationStart:"refresh",[t+"DragStart"]:"refresh",[t+"DragAbort"]:"refresh",[t+"ResizeStart"]:"refresh",[t+"SegmentDragStart"]:"refresh",[t+"SegmentResizeStart"]:"refresh",timelineViewportResize:"reset",timeAxisViewModelUpdate:"reset",toggleNode:"reset",thisObj:this}),e.rowManager.ion({refresh:"reset",changeTotalHeight:"reset",thisObj:this}),this.bindStore(e.store)}doDisable(e){this.isConfiguring||(this._isDisabling=e,this.draw(),this._isDisabling=!1),super.doDisable(e)}get rowStore(){return this.client.isVertical?this.client.resourceStore:this.client.store}bindStore(e){const r=this;r.client.isVertical||(r.detachListeners("store"),r.client.usesDisplayStore&&(e==null||e.ion({name:"store",refresh:"onStoreRefresh",thisObj:r}),r.reset()))}onStoreRefresh(){this.reset()}attachToProject(e){super.attachToProject(e),e==null||e.ion({name:"project",commitFinalized:"reset",thisObj:this})}attachToResourceStore(e){super.attachToResourceStore(e),e==null||e.ion({name:"resourceStore",change:"onResourceStoreChange",refresh:"onResourceStoreChange",thisObj:this})}onResourceStoreChange(){this.usingLinks=null,this.reset()}attachToEventStore(e){super.attachToEventStore(e),e==null||e.ion({name:"eventStore",refresh:"reset",thisObj:this})}attachToAssignmentStore(e){super.attachToAssignmentStore(e),e==null||e.ion({name:"assignmentStore",refresh:"reset",thisObj:this})}attachToDependencyStore(e){super.attachToDependencyStore(e),e==null||e.ion({name:"dependencyStore",change:"reset",refresh:"reset",thisObj:this})}updateDrawOnScroll(e){const r=this;r.detachListeners("scroll"),e?r.client.ion({name:"scroll",scroll:"doRefresh",horizontalScroll:"onHorizontalScroll",prio:-100,thisObj:r}):(r.client.scrollable.ion({name:"scroll",scrollEnd:"draw",thisObj:r}),r.client.timeAxisSubGrid.scrollable.ion({name:"scroll",scrollEnd:"draw",thisObj:r}))}onHorizontalScroll({subGrid:e,scrollX:r}){r!==this.lastScrollX&&e===this.client.timeAxisSubGrid&&(this.lastScrollX=r,this.draw())}onInternalPaint(){this.refresh()}static getLocalizedDependencyType(e){return e?this.L(`L{DependencyType.${e}}`):""}getElementForDependency(e,r,t){return this.getElementsForDependency(e,r,t)[0]}getElementsForDependency(e,r,t){let i=`[data-dep-id="${e.id}"]`;return r&&(i+=`[data-from-id="${r.id}"]`),t&&(i+=`[data-to-id="${t.id}"]`),Array.from(this.client.svgCanvas.querySelectorAll(i))}resolveDependencyRecord(e){var r;return(r=e.elementData)==null?void 0:r.dependency}isDependencyElement(e){return e.matches(`.${this.baseCls}`)}onElementClick(e){const r=this.resolveDependencyRecord(e.target);if(r){const t=Je[e.type];this.client.trigger(`dependency${t}`,{dependency:r,event:e})}}onElementDblClick(e){return this.onElementClick(e)}onElementContextMenu(e){return this.onElementClick(e)}onElementMouseOver(e){const r=this,t=r.resolveDependencyRecord(e.target);t&&(r.client.trigger("dependencyMouseOver",{dependency:t,event:e}),r.overCls&&r.highlight(t))}onElementMouseOut(e){const r=this,t=r.resolveDependencyRecord(e.target);t&&(r.client.trigger("dependencyMouseOut",{dependency:t,event:e}),r.overCls&&r.unhighlight(t))}isDependencyVisible(e){const r=this,{rowStore:t}=r,{fromEvent:i,toEvent:n}=e;if(!i||!n)return!1;const a=i.resource,s=n.resource;return!t.isAvailable(a)||!t.isAvailable(s)?!1:i.isModel&&!a.instanceMeta(t).hidden&&!s.instanceMeta(t).hidden}updateHighlightDependenciesOnEventHover(e){const r=this;if(e){const{client:t}=r;t.ion({name:"highlightOnHover",[`${t.scheduledEventName}MouseEnter`]:i=>r.highlightEventDependencies(i.eventRecord||i.taskRecord),[`${t.scheduledEventName}MouseLeave`]:i=>r.unhighlightEventDependencies(i.eventRecord||i.taskRecord),thisObj:r})}else r.detachListeners("highlightOnHover")}highlight(e,r=this.overCls){let t=this.highlighted.get(e);t||this.highlighted.set(e,t=new Set),t.add(r);for(const i of this.getElementsForDependency(e))i.classList.add(r)}unhighlight(e,r=this.overCls){const t=this.highlighted.get(e);t&&(t.delete(r),t.size||this.highlighted.delete(e));for(const i of this.getElementsForDependency(e))i.classList.remove(r)}highlightEventDependencies(e,r){e.dependencies.forEach(t=>this.highlight(t,r))}unhighlightEventDependencies(e,r){e.dependencies.forEach(t=>this.unhighlight(t,r))}getDependenciesToConsider(e,r,t,i){var n,a;const{eventStore:s}=this.project;return(a=(n=super.getDependenciesToConsider)==null?void 0:n.call(this,e,r,t,i))!=null?a:this.project.dependencyStore.records.filter(o=>o.isValid&&!s.isFiltered||s.isAvailable(o.fromEvent)&&s.isAvailable(o.toEvent))}getDependencyKey(e,r,t){return`dep:${e.id};from:${r.id};to:${t.id}`}drawDependency(e,r=!1,t=null){var i,n,a,s;const o=this,{domConfigs:l,client:d,rowStore:c,topIndex:u,bottomIndex:m}=o,{useInitialAnimation:f}=d,{idMap:h}=c,{startMS:g,endMS:p}=o.visibleDateRange,{fromEvent:D,toEvent:v}=e;let S=D.assigned,b=v.assigned;if(D.isScheduled&&v.isScheduled&&(S!=null&&S.size)&&(b!=null&&b.size)){o.usingLinks&&(S=[...S].flatMap(we),b=[...b].flatMap(we));for(const y of S)for(const T of b){const C=(n=h[(i=y.resource)==null?void 0:i.id])==null?void 0:n.index,w=(s=h[(a=T.resource)==null?void 0:a.id])==null?void 0:s.index,M=Math.min(D.startDateMS,v.startDateMS),k=Math.max(D.endDateMS,v.endDateMS);if(d.isExporting||C!=null&&w!=null&&y.drawDependencies!==!1&&T.drawDependencies!==!1&&c.isAvailable(y.resource)&&c.isAvailable(T.resource)&&!(C<u&&w<u||C>m&&w>m||M<g&&k<g||M>p&&k>p)){const z=o.getDependencyKey(e,y,T),E=o.getDomConfigs(e,y,T,t);E?(f&&(E[0].style={animationDelay:`${Math.max(C,w)/20*1e3}ms`}),l.set(z,E)):l.delete(z)}o.afterDrawDependency(e,C,w,M,k)}}r||o.domSync()}afterDrawDependency(e,r,t,i,n){var a;(a=super.afterDrawDependency)==null||a.call(this,e,r,t,i,n)}beforeDraw(){var e;(e=super.beforeDraw)==null||e.call(this)}afterDraw(){var e;(e=super.afterDraw)==null||e.call(this)}domSync(e=this.client.svgCanvas,r=!1){Q.sync({targetElement:e,domConfig:{onlyChildren:!0,children:Array.from(this.domConfigs.values()).flat()},syncIdField:"syncId",releaseThreshold:0,strict:!0,callback(){}}),r&&this.clearDomConfigs()}fillDrawingCache(){const e=this,{client:r}=e;e.relativeTo=O.from(r.svgCanvas),e.visibleResources=r.visibleResources,e.visibleDateRange=r.visibleDateRange,e.topIndex=e.rowStore.indexOf(e.visibleResources.first),e.bottomIndex=e.rowStore.indexOf(e.visibleResources.last),e.usingLinks==null&&(e.usingLinks=r.resourceStore.some(t=>t.hasLinks))}clearDomConfigs(){this.domConfigs.clear()}draw(){const e=this,{client:r}=e,{visibleDateRange:t}=r;if(!(r.refreshSuspended||!r.foregroundCanvas||!t||!r.isEngineReady||e.disabled&&!e._isDisabling||r.isExporting)){if(e.fillDrawingCache(),e.clearDomConfigs(),r.firstVisibleRow&&r.lastVisibleRow&&r.timeAxis.count&&!e.disabled&&t.endMS-t.startMS>0){const{topIndex:i,bottomIndex:n}=e,a=e.getDependenciesToConsider(t.startMS,t.endMS,i,n);e.beforeDraw();for(const s of a)e.drawDependency(s,!0);e.afterDraw()}e.domSync(),r.trigger("dependenciesDrawn")}}doRefresh(){var e,r,t,i,n;const a=this,{client:s}=a,{scheduledEventName:o,features:l}=s;a.draw(),a.drawingLive=s.dependencyStore.count&&(s.isAnimating||s.useInitialAnimation&&s.eventStore.count||((e=l[`${o}Drag`])==null?void 0:e.isActivelyDragging)||((r=l[`${o}Drag`])==null?void 0:r.isAborting)||((t=l[`${o}Resize`])==null?void 0:t.isResizing)||((i=l[`${o}SegmentDrag`])==null?void 0:i.isActivelyDragging)||((n=l[`${o}SegmentResize`])==null?void 0:n.isResizing)),a.drawingLive&&a.refresh(!1,!0)}rafRefresh(){this.doRefresh.now()}refresh(e=this.immediateRefresh,r=!1){const t=this,{client:i}=t;!i.refreshSuspended&&!t.disabled&&i.isPainted&&!i.timeAxisSubGrid.collapsed&&(e?t.doRefresh.now():r?t.rafRefresh():t.doRefresh())}reset({source:e,type:r}=Qe){var t;(t=super.reset)==null||t.call(this),this.refresh(e===this.client&&r==="timelineviewportresize")}drawForEvent(){q.deprecate("Scheduler","6.0.0","Dependencies.drawForEvent() is no longer needed"),this.refresh()}render(){this.client.getConfig("svgCanvas")}};x(Z,"$name","Dependencies"),x(Z,"configurable",{overCls:"b-sch-dependency-over",baseCls:"b-sch-dependency",noMarkerCls:"b-sch-dependency-markerless",markerDef:null,radius:null,renderer:null,highlightDependenciesOnEventHover:null,drawOnScroll:!0,clickWidth:null,immediateRefresh:null,drawAroundParents:null}),x(Z,"delayable",{doRefresh:10,rafRefresh:"raf"}),Z._$name="Dependencies",F.registerFeature(Z,!1,["Scheduler","ResourceHistogram"]);var re=class extends j{static get $name(){return"EventFilter"}static get pluginConfig(){return{chain:["populateTimeAxisHeaderMenu"]}}populateTimeAxisHeaderMenu({items:e}){const r=this;e.eventsFilter={text:"L{filterEvents}",icon:"b-fw-icon b-icon-filter",disabled:r.disabled,localeClass:r,weight:100,menu:{type:"popup",localeClass:r,items:{nameFilter:{weight:110,type:"textfield",cls:"b-eventfilter b-last-row",clearable:!0,keyStrokeChangeDelay:300,label:"L{byName}",localeClass:r,width:200,internalListeners:{change:r.onEventFilterChange,thisObj:r}}},onBeforeShow({source:t}){const[i]=t.items,n=r.store.filters.getBy("property","name");i.value=(n==null?void 0:n.value)||""}}}}onEventFilterChange({value:e}){e!==""?this.store.filter("name",e):this.store.removeFilter("name")}get store(){const{client:e}=this;return e.isGanttBase?e.store:e.eventStore}};re.featureClass="b-event-filter",re._$name="EventFilter",F.registerFeature(re,!0,["Scheduler","Gantt"]),F.registerFeature(re,!1,"ResourceHistogram");var Me=e=>{var r;return r=class extends e{getNonWorkingTimeRanges(t,i,n){const a=n.getTime()-i.getTime()+864e5;if(!t.getNonWorkingTimeRanges){const s=[];return t.forEachAvailabilityInterval({startDate:i,endDate:n,isForward:!0,maxRange:a},(o,l,d)=>{for(const[c,u]of d.intervalGroups)u.getIsWorking()||s.push({name:c.name,iconCls:c.iconCls,cls:c.cls,startDate:o,endDate:l})}),s}return t.getNonWorkingTimeRanges(i,n,a)}getCalendarTimeRanges(t,i=!1){const n=this,{timeAxis:a,fillTicks:s}=n.client,{unit:o,increment:l}=a,d=!n.maxTimeAxisUnit||R.compareUnits(o,n.maxTimeAxisUnit)<=0;if(t&&d&&a.count){const c=n.getNonWorkingTimeRanges(t,a.startDate,a.endDate),u=c.map(h=>new pe({name:h.name,cls:`b-nonworkingtime ${h.cls||""}`,startDate:h.startDate,endDate:h.endDate}));let m=[],f=null;for(const h of u)f&&h.startDate<=f.endDate&&(i||h.name===f.name)&&h.duration>0?f.endDate=h.endDate:(m.push(h),h.setData("id",`nonworking-${m.length}`),f=h);return s&&(m=m.filter(h=>!R.isSameDate(h.startDate,h.endDate)&&R.ceil(h.startDate,{magnitude:l,unit:o})<R.floor(h.endDate,{magnitude:l,unit:o})),m.forEach(h=>h.setStartEndDate(R.ceil(h.startDate,{magnitude:l,unit:o}),R.floor(h.endDate,{magnitude:l,unit:o})))),m}else return[]}setupDefaultCalendar(){const{client:t,project:i}=this;!this.autoGeneratedWeekends&&!t.isSchedulerPro&&!t.isGantt&&i.effectiveCalendar===i.defaultCalendar&&!i.defaultCalendar.intervalStore.count&&(this.autoGeneratedWeekends=!0,this.updateDefaultCalendar())}updateDefaultCalendar(){if(this.autoGeneratedWeekends){const t=this.client.project.effectiveCalendar,i=this.defaultNonWorkingIntervals,n=!!i.length;t.ignoreTimeZone=!0,t.clearIntervals(n),n&&t.addIntervals(i)}}updateLocalization(){var t;(t=super.updateLocalization)==null||t.call(this),this.autoGeneratedWeekends&&this.updateDefaultCalendar()}get defaultNonWorkingIntervals(){const t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return R.nonWorkingDaysAsArray.map(i=>({recurrentStartDate:`on ${t[i]} at 0:00`,recurrentEndDate:`on ${t[(i+1)%7]} at 0:00`,isWorking:!1}))}},x(r,"$name","NonWorkingTimeMixin"),x(r,"configurable",{maxTimeAxisUnit:"week"}),r},K=class extends te.mixin(ne,Me){static get defaultConfig(){return{highlightWeekends:null,hideRangesOnZooming:!0,showHeaderElements:!0,showLabelInBody:!0,autoGeneratedWeekends:!1}}doDestroy(){this.attachToCalendar(null),super.doDestroy()}set highlightWeekends(e){q.deprecate("Scheduler","6.0.0","Deprecated in favour of disabling the feature"),this.disabled=!e}get highlightWeekends(){return!this.disabled}onConfigChange({name:e}){!this.isConfiguring&&e==="fillTicks"&&this.refresh()}attachToProject(e){super.attachToProject(e),this.attachToCalendar(e.effectiveCalendar),!e.graph&&!this.client.isScheduler&&e.ion({name:"project",dataReady:{fn:()=>this.attachToCalendar(e.effectiveCalendar),once:!0},thisObj:this}),e.ion({name:"project",calendarChange:()=>this.attachToCalendar(e.effectiveCalendar),thisObj:this})}onTimeAxisViewModelUpdate(...e){return this._timeAxisUnitDurationMs=null,super.onTimeAxisViewModelUpdate(...e)}attachToCalendar(e){const r=this,{project:t,client:i}=r;r.detachListeners("calendar"),r.autoGeneratedWeekends=!1,e&&(r.setupDefaultCalendar(),e.intervalStore.ion({name:"calendar",change:()=>r.setTimeout(()=>r.refresh(),1)})),i.isEngineReady&&!i.project.isDelayingCalculation&&!i.isDestroying?r.refresh():t.isDestroyed||(r.detachListeners("initialProjectListener"),t.ion({name:"initialProjectListener",refresh({isCalculated:n}){n!==!1&&(r.refresh(),r.detachListeners("initialProjectListener"))},thisObj:r}))}get calendar(){var e;return(e=this.project)==null?void 0:e.effectiveCalendar}get timeAxisUnitDurationMs(){return this._timeAxisUnitDurationMs||(this._timeAxisUnitDurationMs=R.as("ms",1,this.client.timeAxis.unit)),this._timeAxisUnitDurationMs}shouldRenderRange(e){return super.shouldRenderRange(e)&&(!this.hideRangesOnZooming||e.durationMS>=this.timeAxisUnitDurationMs)}get timeRanges(){const e=this;return e._timeRanges||(e._timeRanges=e.getCalendarTimeRanges(e.calendar)),e._timeRanges}};x(K,"$name","NonWorkingTime"),x(K,"pluginConfig",{chain:["onInternalPaint","attachToProject","updateLocalization","onConfigChange","onSchedulerHorizontalScroll"]}),K._$name="NonWorkingTime",F.registerFeature(K,!1,"Scheduler"),F.registerFeature(K,!0,["SchedulerPro","Gantt","ResourceHistogram"]);var ie=class extends j{static get $name(){return"ScheduleTooltip"}static get configurable(){return{messageTemplate:e=>`<div class="b-sch-hovertip-msg">${e.message}</div>`,hideForNonWorkingTime:null}}static get pluginConfig(){return{chain:["onInternalPaint"]}}onInternalPaint({firstPaint:e}){if(!e)return;const r=this,{client:t}=r;t.isSchedulerPro&&r.hideForNonWorkingTime===void 0&&(r.hideForNonWorkingTime=!0);let i;const n=r.hoverTip=new I({id:`${t.id}-schedule-tip`,cls:"b-sch-scheduletip",allowOver:!0,hoverDelay:0,hideDelay:100,showOnHover:!0,forElement:t.timeAxisSubGridElement,anchorToTarget:!1,trackMouse:!0,updateContentOnMouseMove:!0,monitorResize:!1,textContent:!1,forSelector:".b-schedulerbase:not(.b-dragging-event,.b-dragcreating,.b-creating-dependency) .b-grid-body-container:not(.b-scrolling) .b-timeline-subgrid:not(.b-scrolling) > :not(.b-sch-foreground-canvas):not(.b-group-footer):not(.b-group-row) *",getHtml:r.getHoverTipHtml.bind(r),onDocumentMouseDown(a){n.forElement.contains(a.event.target)&&(i=P.on({thisObj:r,element:t.timeAxisSubGridElement,mousemove:o=>n.internalOnPointerOver(o),capture:!0}));const s=n.hideAnimation;n.hideAnimation=!1,n.constructor.prototype.onDocumentMouseDown.call(n,a),n.hideAnimation=s},...r.config,internalListeners:r.configuredListeners});n.ion({pointerover({event:a}){const s="buttons"in a?a.buttons>0:a.which>0;return!s&&i&&i(),!r.disabled&&!s},innerhtmlupdate({source:a}){r.clockTemplate.updateDateIndicator(a.element,r.lastTime)}}),t.ion({timeAxisViewModelUpdate:"updateTip",thisObj:r}),r.clockTemplate=new J({scheduler:t})}processConfiguredListeners(){}updateTip(){this.hoverTip.isVisible&&this.hoverTip.updateContent()}doDestroy(){this.destroyProperties("clockTemplate","hoverTip"),super.doDestroy()}getHoverTipHtml({tip:e,event:r}){const t=this,i=t.client,n=r&&i.getDateFromDomEvent(r,"floor",!0);let a=t.lastHtml;if(n&&r.target){const s=i.resolveResourceRecord(r);if(s&&(n-t.lastTime!==0||s.id!==t.lastResourceId)){if(t.hideForNonWorkingTime){const o=s.isWorkingTime(n);e.element.classList.toggle("b-nonworking-time",!o)}t.lastResourceId=s.id,a=t.lastHtml=t.generateTipContent({date:n,event:r,resourceRecord:s})}}else e.hide(),t.lastTime=null,t.lastResourceId=null;return a}generateTipContent({date:e,event:r,resourceRecord:t}){const i=this,n=i.clockTemplate.generateContent({date:e,text:i.client.getFormattedDate(e)}),a=i.messageTemplate({message:i.getText(e,r,t)||""});return i.lastTime=e,n+a}getText(e,r,t){}};ie.featureClass="b-scheduletip",ie._$name="ScheduleTooltip",F.registerFeature(ie,!0,"Scheduler"),F.registerFeature(ie,!1,"ResourceUtilization");var et={maintainVisibleStart:!0},me=class extends Ae{static get $name(){return"TimeAxisHeaderMenu"}static get defaultConfig(){return{processItems:null,items:null,type:"timeAxisHeader"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateTimeAxisHeaderMenu"),e}construct(){super.construct(...arguments),this.triggerEvent.includes("click")&&this.client.zoomOnTimeAxisDoubleClick&&(this.client.zoomOnTimeAxisDoubleClick=!1)}shouldShowMenu(e){const{column:r,targetElement:t}=e,{client:i}=this;return i.isHorizontal?(r==null?void 0:r.enableHeaderContextMenu)!==!1&&(r==null?void 0:r.isTimeAxisColumn):t.matches(".b-sch-header-timeaxis-cell")}showContextMenu(e){super.showContextMenu(...arguments),this.menu&&(this.menu.scrollAction="realign")}populateTimeAxisHeaderMenu({items:e}){const r=this,{client:t}=r,i={magnitude:t.timeAxis.shiftIncrement,unit:t.timeAxis.shiftUnit};Object.assign(e,{zoomLevel:{text:"L{pickZoomLevel}",localeClass:r,icon:"b-fw-icon b-icon-search-plus",disabled:!t.presets.count||r.disabled,weight:200,menu:{type:"popup",items:{zoomSlider:{weight:210,type:"slider",minWidth:130,showValue:!1,triggerChangeOnInput:!0}},onBeforeShow({source:n}){const[a]=n.items;a.min=t.minZoomLevel,a.max=t.maxZoomLevel,a.value=t.zoomLevel,r.zoomDetatcher=a.ion({change:"onZoomSliderChange",thisObj:r})},onHide(){r.zoomDetatcher&&(r.zoomDetatcher(),r.zoomDetatcher=null)}}},dateRange:{text:"L{activeDateRange}",localeClass:r,icon:"b-fw-icon b-icon-calendar",weight:300,menu:{type:"popup",cls:"b-sch-timeaxis-menu-daterange-popup",defaults:{localeClass:r},items:{startDateField:{type:"datefield",label:"L{startText}",weight:310,labelWidth:"6em",required:!0,step:i,internalListeners:{change:r.onRangeDateFieldChange,thisObj:r}},endDateField:{type:"datefield",label:"L{endText}",weight:320,labelWidth:"6em",required:!0,step:i,internalListeners:{change:r.onRangeDateFieldChange,thisObj:r}},leftShiftBtn:{type:"button",weight:330,cls:"b-left-nav-btn",icon:"b-icon b-icon-previous",color:"b-blue b-raised",flex:1,margin:0,internalListeners:{click:r.onLeftShiftBtnClick,thisObj:r}},todayBtn:{type:"button",weight:340,cls:"b-today-nav-btn",color:"b-blue b-raised",text:"L{todayText}",flex:4,margin:"0 8",internalListeners:{click:r.onTodayBtnClick,thisObj:r}},rightShiftBtn:{type:"button",weight:350,cls:"b-right-nav-btn",icon:"b-icon b-icon-next",color:"b-blue b-raised",flex:1,internalListeners:{click:r.onRightShiftBtnClick,thisObj:r}}},internalListeners:{paint:r.initDateRangeFields,thisObj:r}}}})}onZoomSliderChange({value:e}){const r=this;r.menu.scrollAction="realign",r.client.zoomLevel=e,r.menu.setTimeout({fn:()=>r.menu.scrollAction="hide",delay:100,cancelOutstanding:!0})}initDateRangeFields({source:e,firstPaint:r}){if(r){const{widgetMap:t}=e;this.startDateField=t.startDateField,this.endDateField=t.endDateField}this.initDates()}initDates(){const e=this;e.startDateField.suspendEvents(),e.endDateField.suspendEvents(),e.startDateField.value=e.startDateFieldInitialValue=e.client.startDate,e.endDateField.value=e.endDateFieldInitialValue=e.client.endDate,e.startDateField.resumeEvents(),e.endDateField.resumeEvents()}onRangeDateFieldChange({source:e}){const r=this,t=e===r.startDateField,{client:i}=r,{timeAxis:n}=i,a=r.startDateFieldInitialValue&&!t?r.startDateFieldInitialValue:r.startDateField.value;let s=r.endDateFieldInitialValue&&t?r.endDateFieldInitialValue:r.endDateField.value;t?r.startDateFieldInitialValue=null:r.endDateFieldInitialValue=null,s-a?s<a&&(s=R.add(a,n.shiftIncrement,n.shiftUnit)):s=R.add(s,n.shiftIncrement,n.shiftUnit),i.setTimeSpan(a,s,et),r.initDates()}onLeftShiftBtnClick(){this.client.timeAxis.shiftPrevious(),this.initDates()}onTodayBtnClick(){const e=R.clearTime(new Date);this.client.setTimeSpan(e,R.add(e,1,"day")),this.initDates()}onRightShiftBtnClick(){this.client.timeAxis.shiftNext(),this.initDates()}};me._$name="TimeAxisHeaderMenu",F.registerFeature(me,!0,["Scheduler","TimelineHistogram","Gantt"]);export{te as AbstractTimeRanges,ue as ColumnLines,Z as Dependencies,Ce as DependencyCreation_default,Ee as DependencyTooltip_default,De as DragBase,se as DragCreateBase,ce as DurationColumn,re as EventFilter,ee as EventResize,K as NonWorkingTime,Me as NonWorkingTimeMixin_default,ge as RectangularPathFinder,ie as ScheduleTooltip,Se as TaskEditTransactional_default,me as TimeAxisHeaderMenu,ye as TooltipBase,Te as TransactionalFeature_default};
//# sourceMappingURL=chunk-PFWHNAB4.js.map
